!function(P,O){var R=P.document,D=P.navigator,t=P.location,N=function(){var n,t,e,i,u=function(t,e){return new u.fn.init(t,e,n)},r=P.jQuery,o=P.$,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,s=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,d=/^[\],:{}\s]*$/,f=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,v=/(msie) ([\w.]+)/,b=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z]|[0-9])/gi,x=/^-ms-/,S=function(t,e){return(e+"").toUpperCase()},E=D.userAgent,C=Object.prototype.toString,T=Object.prototype.hasOwnProperty,N=Array.prototype.push,k=Array.prototype.slice,_=String.prototype.trim,A=Array.prototype.indexOf,B={};function M(){if(!u.isReady){try{R.documentElement.doScroll("left")}catch(t){return void setTimeout(M,1)}u.ready()}}return u.fn=u.prototype={constructor:u,init:function(t,e,n){var i,r,o,s;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("body"===t&&!e&&R.body)return this.context=R,this[0]=R.body,this.selector=t,this.length=1,this;if("string"!=typeof t)return u.isFunction(t)?n.ready(t):(t.selector!==O&&(this.selector=t.selector,this.context=t.context),u.makeArray(t,this));if(!(i="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:a.exec(t))||!i[1]&&e)return!e||e.jquery?(e||n).find(t):this.constructor(e).find(t);if(i[1])return s=(e=e instanceof u?e[0]:e)?e.ownerDocument||e:R,(o=h.exec(t))?u.isPlainObject(e)?(t=[R.createElement(o[1])],u.fn.attr.call(t,e,!0)):t=[s.createElement(o[1])]:t=((o=u.buildFragment([i[1]],[s])).cacheable?u.clone(o.fragment):o.fragment).childNodes,u.merge(this,t);if((r=R.getElementById(i[2]))&&r.parentNode){if(r.id!==i[2])return n.find(t);this.length=1,this[0]=r}return this.context=R,this.selector=t,this},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return k.call(this,0)},get:function(t){return null==t?this.toArray():t<0?this[this.length+t]:this[t]},pushStack:function(t,e,n){var i=this.constructor();return u.isArray(t)?N.apply(i,t):u.merge(i,t),i.prevObject=this,i.context=this.context,"find"===e?i.selector=this.selector+(this.selector?" ":"")+n:e&&(i.selector=this.selector+"."+e+"("+n+")"),i},each:function(t,e){return u.each(this,t,e)},ready:function(t){return u.bindReady(),e.add(t),this},eq:function(t){return-1===(t=+t)?this.slice(t):this.slice(t,t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(k.apply(this,arguments),"slice",k.call(arguments).join(","))},map:function(n){return this.pushStack(u.map(this,function(t,e){return n.call(t,e,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:N,sort:[].sort,splice:[].splice},u.fn.init.prototype=u.fn,u.extend=u.fn.extend=function(){var t,e,n,i,r,o,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},a=2),"object"==typeof s||u.isFunction(s)||(s={}),l===a&&(s=this,--a);a<l;a++)if(null!=(t=arguments[a]))for(e in t)n=s[e],s!==(i=t[e])&&(c&&i&&(u.isPlainObject(i)||(r=u.isArray(i)))?(o=r?(r=!1,n&&u.isArray(n)?n:[]):n&&u.isPlainObject(n)?n:{},s[e]=u.extend(c,o,i)):i!==O&&(s[e]=i));return s},u.extend({noConflict:function(t){return P.$===u&&(P.$=o),t&&P.jQuery===u&&(P.jQuery=r),u},isReady:!1,readyWait:1,holdReady:function(t){t?u.readyWait++:u.ready(!0)},ready:function(t){if(!0===t&&!--u.readyWait||!0!==t&&!u.isReady){if(!R.body)return setTimeout(u.ready,1);if((u.isReady=!0)!==t&&0<--u.readyWait)return;e.fireWith(R,[u]),u.fn.trigger&&u(R).trigger("ready").off("ready")}},bindReady:function(){if(!e){if(e=u.Callbacks("once memory"),"complete"===R.readyState)return setTimeout(u.ready,1);if(R.addEventListener)R.addEventListener("DOMContentLoaded",i,!1),P.addEventListener("load",u.ready,!1);else if(R.attachEvent){R.attachEvent("onreadystatechange",i),P.attachEvent("onload",u.ready);var t=!1;try{t=null==P.frameElement}catch(t){}R.documentElement.doScroll&&t&&M()}}},isFunction:function(t){return"function"===u.type(t)},isArray:Array.isArray||function(t){return"array"===u.type(t)},isWindow:function(t){return t&&"object"==typeof t&&"setInterval"in t},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):B[C.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==u.type(t)||t.nodeType||u.isWindow(t))return!1;try{if(t.constructor&&!T.call(t,"constructor")&&!T.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var e;for(e in t);return e===O||T.call(t,e)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw new Error(t)},parseJSON:function(t){return"string"==typeof t&&t?(t=u.trim(t),P.JSON&&P.JSON.parse?P.JSON.parse(t):d.test(t.replace(f,"@").replace(p,"]").replace(m,""))?new Function("return "+t)():void u.error("Invalid JSON: "+t)):null},parseXML:function(t){var e;try{P.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(t){e=O}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length||u.error("Invalid XML: "+t),e},noop:function(){},globalEval:function(t){t&&s.test(t)&&(P.execScript||function(t){P.eval.call(P,t)})(t)},camelCase:function(t){return t.replace(x,"ms-").replace(w,S)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,e,n){var i,r=0,o=t.length,s=o===O||u.isFunction(t);if(n)if(s){for(i in t)if(!1===e.apply(t[i],n))break}else for(;r<o&&!1!==e.apply(t[r++],n););else if(s){for(i in t)if(!1===e.call(t[i],i,t[i]))break}else for(;r<o&&!1!==e.call(t[r],r,t[r++]););return t},trim:_?function(t){return null==t?"":_.call(t)}:function(t){return null==t?"":t.toString().replace(l,"").replace(c,"")},makeArray:function(t,e){var n=e||[];if(null!=t){var i=u.type(t);null==t.length||"string"===i||"function"===i||"regexp"===i||u.isWindow(t)?N.call(n,t):u.merge(n,t)}return n},inArray:function(t,e,n){var i;if(e){if(A)return A.call(e,t,n);for(i=e.length,n=n?n<0?Math.max(0,i+n):n:0;n<i;n++)if(n in e&&e[n]===t)return n}return-1},merge:function(t,e){var n=t.length,i=0;if("number"==typeof e.length)for(var r=e.length;i<r;i++)t[n++]=e[i];else for(;e[i]!==O;)t[n++]=e[i++];return t.length=n,t},grep:function(t,e,n){var i=[];n=!!n;for(var r=0,o=t.length;r<o;r++)n!==!!e(t[r],r)&&i.push(t[r]);return i},map:function(t,e,n){var i,r,o=[],s=0,a=t.length;if(t instanceof u||a!==O&&"number"==typeof a&&(0<a&&t[0]&&t[a-1]||0===a||u.isArray(t)))for(;s<a;s++)null!=(i=e(t[s],s,n))&&(o[o.length]=i);else for(r in t)null!=(i=e(t[r],r,n))&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(t,e){if("string"==typeof e){var n=t[e];e=t,t=n}if(!u.isFunction(t))return O;var i=k.call(arguments,2),r=function(){return t.apply(e,i.concat(k.call(arguments)))};return r.guid=t.guid=t.guid||r.guid||u.guid++,r},access:function(t,e,n,i,r,o){var s=t.length;if("object"==typeof e){for(var a in e)u.access(t,a,e[a],i,r,n);return t}if(n===O)return s?r(t[0],e):O;i=!o&&i&&u.isFunction(n);for(var l=0;l<s;l++)r(t[l],e,i?n.call(t[l],l,r(t[l],e)):n,o);return t},now:function(){return(new Date).getTime()},uaMatch:function(t){t=t.toLowerCase();var e=g.exec(t)||y.exec(t)||v.exec(t)||t.indexOf("compatible")<0&&b.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},sub:function(){function n(t,e){return new n.fn.init(t,e)}u.extend(!0,n,this),n.superclass=this,((n.fn=n.prototype=this()).constructor=n).sub=this.sub,n.fn.init=function(t,e){return e&&e instanceof u&&!(e instanceof n)&&(e=n(e)),u.fn.init.call(this,t,e,i)},n.fn.init.prototype=n.fn;var i=n(R);return n},browser:{}}),u.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){B["[object "+e+"]"]=e.toLowerCase()}),(t=u.uaMatch(E)).browser&&(u.browser[t.browser]=!0,u.browser.version=t.version),u.browser.webkit&&(u.browser.safari=!0),s.test("Â ")&&(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),n=u(R),R.addEventListener?i=function(){R.removeEventListener("DOMContentLoaded",i,!1),u.ready()}:R.attachEvent&&(i=function(){"complete"===R.readyState&&(R.detachEvent("onreadystatechange",i),u.ready())}),u}(),f={};N.Callbacks=function(o){o=o?f[o]||function(t){var e,n,i=f[t]={};for(e=0,n=(t=t.split(/\s+/)).length;e<n;e++)i[t[e]]=!0;return i}(o):{};var n,r,i,s,a,l=[],c=[],u=function(t){var e,n,i,r;for(e=0,n=t.length;e<n;e++)i=t[e],"array"===(r=N.type(i))?u(i):"function"===r&&(o.unique&&d.has(i)||l.push(i))},h=function(t,e){for(e=e||[],n=!o.memory||[t,e],r=!0,a=i||0,i=0,s=l.length;l&&a<s;a++)if(!1===l[a].apply(t,e)&&o.stopOnFalse){n=!0;break}r=!1,l&&(o.once?!0===n?d.disable():l=[]:c&&c.length&&(n=c.shift(),d.fireWith(n[0],n[1])))},d={add:function(){if(l){var t=l.length;u(arguments),r?s=l.length:n&&!0!==n&&(i=t,h(n[0],n[1]))}return this},remove:function(){if(l)for(var t=arguments,e=0,n=t.length;e<n;e++)for(var i=0;i<l.length&&(t[e]!==l[i]||(r&&i<=s&&(s--,i<=a&&a--),l.splice(i--,1),!o.unique));i++);return this},has:function(t){if(l)for(var e=0,n=l.length;e<n;e++)if(t===l[e])return!0;return!1},empty:function(){return l=[],this},disable:function(){return l=c=n=O,this},disabled:function(){return!l},lock:function(){return c=O,n&&!0!==n||d.disable(),this},locked:function(){return!c},fireWith:function(t,e){return c&&(r?o.once||c.push([t,e]):o.once&&n||h(t,e)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!n}};return d};var u=[].slice;N.extend({Deferred:function(t){var e,n=N.Callbacks("once memory"),i=N.Callbacks("once memory"),r=N.Callbacks("memory"),o="pending",s={resolve:n,reject:i,notify:r},a={done:n.add,fail:i.add,progress:r.add,state:function(){return o},isResolved:n.fired,isRejected:i.fired,then:function(t,e,n){return l.done(t).fail(e).progress(n),this},always:function(){return l.done.apply(l,arguments).fail.apply(l,arguments),this},pipe:function(t,e,n){return N.Deferred(function(o){N.each({done:[t,"resolve"],fail:[e,"reject"],progress:[n,"notify"]},function(t,e){var n,i=e[0],r=e[1];N.isFunction(i)?l[t](function(){(n=i.apply(this,arguments))&&N.isFunction(n.promise)?n.promise().then(o.resolve,o.reject,o.notify):o[r+"With"](this===l?o:this,[n])}):l[t](o[r])})}).promise()},promise:function(t){if(null==t)t=a;else for(var e in a)t[e]=a[e];return t}},l=a.promise({});for(e in s)l[e]=s[e].fire,l[e+"With"]=s[e].fireWith;return l.done(function(){o="resolved"},i.disable,r.lock).fail(function(){o="rejected"},n.disable,r.lock),t&&t.call(l,l),l},when:function(t){var n=u.call(arguments,0),e=0,i=n.length,r=new Array(i),o=i,s=i<=1&&t&&N.isFunction(t.promise)?t:N.Deferred(),a=s.promise();function l(e){return function(t){n[e]=1<arguments.length?u.call(arguments,0):t,--o||s.resolveWith(s,n)}}function c(e){return function(t){r[e]=1<arguments.length?u.call(arguments,0):t,s.notifyWith(a,r)}}if(1<i){for(;e<i;e++)n[e]&&n[e].promise&&N.isFunction(n[e].promise)?n[e].promise().then(l(e),s.reject,c(e)):--o;o||s.resolveWith(s,n)}else s!==t&&s.resolveWith(s,i?[t]:[]);return a}}),N.support=function(){var c,t,e,n,i,r,o,s,u,a,l,h,d=R.createElement("div");R.documentElement;if(d.setAttribute("className","t"),d.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",t=d.getElementsByTagName("*"),e=d.getElementsByTagName("a")[0],!t||!t.length||!e)return{};i=(n=R.createElement("select")).appendChild(R.createElement("option")),r=d.getElementsByTagName("input")[0],c={leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:"/a"===e.getAttribute("href"),opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:"on"===r.value,optSelected:i.selected,getSetAttribute:"t"!==d.className,enctype:!!R.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==R.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},r.checked=!0,c.noCloneChecked=r.cloneNode(!0).checked,n.disabled=!0,c.optDisabled=!i.disabled;try{delete d.test}catch(t){c.deleteExpando=!1}if(!d.addEventListener&&d.attachEvent&&d.fireEvent&&(d.attachEvent("onclick",function(){c.noCloneEvent=!1}),d.cloneNode(!0).fireEvent("onclick")),(r=R.createElement("input")).value="t",r.setAttribute("type","radio"),c.radioValue="t"===r.value,r.setAttribute("checked","checked"),d.appendChild(r),(s=R.createDocumentFragment()).appendChild(d.lastChild),c.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked,c.appendChecked=r.checked,s.removeChild(r),s.appendChild(d),d.innerHTML="",P.getComputedStyle&&((o=R.createElement("div")).style.width="0",o.style.marginRight="0",d.style.width="2px",d.appendChild(o),c.reliableMarginRight=0===(parseInt((P.getComputedStyle(o,null)||{marginRight:0}).marginRight,10)||0)),d.attachEvent)for(l in{submit:1,change:1,focusin:1})(h=(a="on"+l)in d)||(d.setAttribute(a,"return;"),h="function"==typeof d[a]),c[l+"Bubbles"]=h;return s.removeChild(d),s=n=i=o=d=r=null,N(function(){var t,e,n,i,r,o,s,a,l=R.getElementsByTagName("body")[0];l&&(s="visibility:hidden;border:0;",a="style='"+(o="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;")+"border:5px solid #000;padding:0;'",(t=R.createElement("div")).style.cssText=s+"width:0;height:0;position:static;top:0;margin-top:1px",l.insertBefore(t,l.firstChild),d=R.createElement("div"),t.appendChild(d),d.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",u=d.getElementsByTagName("td"),h=0===u[0].offsetHeight,u[0].style.display="",u[1].style.display="none",c.reliableHiddenOffsets=h&&0===u[0].offsetHeight,d.innerHTML="",d.style.width=d.style.paddingLeft="1px",N.boxModel=c.boxModel=2===d.offsetWidth,void 0!==d.style.zoom&&(d.style.display="inline",d.style.zoom=1,c.inlineBlockNeedsLayout=2===d.offsetWidth,d.style.display="",d.innerHTML="<div style='width:4px;'></div>",c.shrinkWrapBlocks=2!==d.offsetWidth),d.style.cssText=o+s,d.innerHTML="<div style='position:absolute;top:0;left:0;width:1px;height:1px;margin:0;border:5px solid #000;padding:0;'><div></div></div><table style='position:absolute;top:0;left:0;width:1px;height:1px;margin:0;border:5px solid #000;padding:0;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",n=(e=d.firstChild).firstChild,i=e.nextSibling.firstChild.firstChild,r={doesNotAddBorder:5!==n.offsetTop,doesAddBorderForTableAndCells:5===i.offsetTop},n.style.position="fixed",n.style.top="20px",r.fixedPosition=20===n.offsetTop||15===n.offsetTop,n.style.position=n.style.top="",e.style.overflow="hidden",e.style.position="relative",r.subtractsBorderForOverflowNotVisible=-5===n.offsetTop,r.doesNotIncludeMarginInBodyOffset=1!==l.offsetTop,l.removeChild(t),d=t=null,N.extend(c,r))}),c}();var r=/^(?:\{.*\}|\[.*\])$/,o=/([A-Z])/g;function l(t,e,n){if(n===O&&1===t.nodeType){var i="data-"+e.replace(o,"-$1").toLowerCase();if("string"==typeof(n=t.getAttribute(i))){try{n="true"===n||"false"!==n&&("null"===n?null:N.isNumeric(n)?parseFloat(n):r.test(n)?N.parseJSON(n):n)}catch(t){}N.data(t,e,n)}else n=O}return n}function h(t){for(var e in t)if(("data"!==e||!N.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function s(t,e,n){var i=e+"defer",r=e+"queue",o=e+"mark",s=N._data(t,i);!s||"queue"!==n&&N._data(t,r)||"mark"!==n&&N._data(t,o)||setTimeout(function(){N._data(t,r)||N._data(t,o)||(N.removeData(t,i,!0),s.fire())},0)}N.extend({cache:{},uuid:0,expando:"jQuery"+(N.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return!!(t=t.nodeType?N.cache[t[N.expando]]:t[N.expando])&&!h(t)},data:function(t,e,n,i){if(N.acceptData(t)){var r,o,s,a=N.expando,l="string"==typeof e,c=t.nodeType,u=c?N.cache:t,h=c?t[a]:t[a]&&a,d="events"===e;if(h&&u[h]&&(d||i||u[h].data)||!l||n!==O)return h||(c?t[a]=h=++N.uuid:h=a),u[h]||(u[h]={},c||(u[h].toJSON=N.noop)),"object"!=typeof e&&"function"!=typeof e||(i?u[h]=N.extend(u[h],e):u[h].data=N.extend(u[h].data,e)),r=o=u[h],i||(o.data||(o.data={}),o=o.data),n!==O&&(o[N.camelCase(e)]=n),d&&!o[e]?r.events:(l?null==(s=o[e])&&(s=o[N.camelCase(e)]):s=o,s)}},removeData:function(t,e,n){if(N.acceptData(t)){var i,r,o,s=N.expando,a=t.nodeType,l=a?N.cache:t,c=a?t[s]:s;if(l[c]){if(e&&(i=n?l[c]:l[c].data)){N.isArray(e)||(e=e in i?[e]:(e=N.camelCase(e))in i?[e]:e.split(" "));for(r=0,o=e.length;r<o;r++)delete i[e[r]];if(!(n?h:N.isEmptyObject)(i))return}(n||(delete l[c].data,h(l[c])))&&(N.support.deleteExpando||!l.setInterval?delete l[c]:l[c]=null,a&&(N.support.deleteExpando?delete t[s]:t.removeAttribute?t.removeAttribute(s):t[s]=null))}}},_data:function(t,e,n){return N.data(t,e,n,!0)},acceptData:function(t){if(t.nodeName){var e=N.noData[t.nodeName.toLowerCase()];if(e)return!(!0===e||t.getAttribute("classid")!==e)}return!0}}),N.fn.extend({data:function(n,i){var r,t,e,o=null;if(void 0!==n)return"object"==typeof n?this.each(function(){N.data(this,n)}):((r=n.split("."))[1]=r[1]?"."+r[1]:"",i===O?((o=this.triggerHandler("getData"+r[1]+"!",[r[0]]))===O&&this.length&&(o=N.data(this[0],n),o=l(this[0],n,o)),o===O&&r[1]?this.data(r[0]):o):this.each(function(){var t=N(this),e=[r[0],i];t.triggerHandler("setData"+r[1]+"!",e),N.data(this,n,i),t.triggerHandler("changeData"+r[1]+"!",e)}));if(this.length&&(o=N.data(this[0]),1===this[0].nodeType&&!N._data(this[0],"parsedAttrs"))){for(var s=0,a=(t=this[0].attributes).length;s<a;s++)0===(e=t[s].name).indexOf("data-")&&(e=N.camelCase(e.substring(5)),l(this[0],e,o[e]));N._data(this[0],"parsedAttrs",!0)}return o},removeData:function(t){return this.each(function(){N.removeData(this,t)})}}),N.extend({_mark:function(t,e){t&&(e=(e||"fx")+"mark",N._data(t,e,(N._data(t,e)||0)+1))},_unmark:function(t,e,n){if(!0!==t&&(n=e,e=t,t=!1),e){var i=(n=n||"fx")+"mark",r=t?0:(N._data(e,i)||1)-1;r?N._data(e,i,r):(N.removeData(e,i,!0),s(e,n,"mark"))}},queue:function(t,e,n){var i;if(t)return e=(e||"fx")+"queue",i=N._data(t,e),n&&(!i||N.isArray(n)?i=N._data(t,e,N.makeArray(n)):i.push(n)),i||[]},dequeue:function(t,e){e=e||"fx";var n=N.queue(t,e),i=n.shift(),r={};"inprogress"===i&&(i=n.shift()),i&&("fx"===e&&n.unshift("inprogress"),N._data(t,e+".run",r),i.call(t,function(){N.dequeue(t,e)},r)),n.length||(N.removeData(t,e+"queue "+e+".run",!0),s(t,e,"queue"))}}),N.fn.extend({queue:function(e,n){return"string"!=typeof e&&(n=e,e="fx"),n===O?N.queue(this[0],e):this.each(function(){var t=N.queue(this,e,n);"fx"===e&&"inprogress"!==t[0]&&N.dequeue(this,e)})},dequeue:function(t){return this.each(function(){N.dequeue(this,t)})},delay:function(i,t){return i=N.fx&&N.fx.speeds[i]||i,t=t||"fx",this.queue(t,function(t,e){var n=setTimeout(t,i);e.stop=function(){clearTimeout(n)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){"string"!=typeof t&&(t,t=O),t=t||"fx";var n,i=N.Deferred(),r=this,o=r.length,s=1,a=t+"defer",l=t+"queue",c=t+"mark";function u(){--s||i.resolveWith(r,[r])}for(;o--;)(n=N.data(r[o],a,O,!0)||(N.data(r[o],l,O,!0)||N.data(r[o],c,O,!0))&&N.data(r[o],a,N.Callbacks("once memory"),!0))&&(s++,n.add(u));return u(),i.promise()}});var c,d,i,p=/[\n\t\r]/g,m=/\s+/,n=/\r/g,a=/^(?:button|input)$/i,g=/^(?:button|input|object|select|textarea)$/i,y=/^a(?:rea)?$/i,v=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,b=N.support.getSetAttribute;N.fn.extend({attr:function(t,e){return N.access(this,t,e,!0,N.attr)},removeAttr:function(t){return this.each(function(){N.removeAttr(this,t)})},prop:function(t,e){return N.access(this,t,e,!0,N.prop)},removeProp:function(t){return t=N.propFix[t]||t,this.each(function(){try{this[t]=O,delete this[t]}catch(t){}})},addClass:function(e){var t,n,i,r,o,s,a;if(N.isFunction(e))return this.each(function(t){N(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(m),n=0,i=this.length;n<i;n++)if(1===(r=this[n]).nodeType)if(r.className||1!==t.length){for(o=" "+r.className+" ",s=0,a=t.length;s<a;s++)~o.indexOf(" "+t[s]+" ")||(o+=t[s]+" ");r.className=N.trim(o)}else r.className=e;return this},removeClass:function(e){var t,n,i,r,o,s,a;if(N.isFunction(e))return this.each(function(t){N(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===O)for(t=(e||"").split(m),n=0,i=this.length;n<i;n++)if(1===(r=this[n]).nodeType&&r.className)if(e){for(o=(" "+r.className+" ").replace(p," "),s=0,a=t.length;s<a;s++)o=o.replace(" "+t[s]+" "," ");r.className=N.trim(o)}else r.className="";return this},toggleClass:function(o,s){var a=typeof o,l="boolean"==typeof s;return N.isFunction(o)?this.each(function(t){N(this).toggleClass(o.call(this,t,this.className,s),s)}):this.each(function(){if("string"===a)for(var t,e=0,n=N(this),i=s,r=o.split(m);t=r[e++];)i=l?i:!n.hasClass(t),n[i?"addClass":"removeClass"](t);else"undefined"!==a&&"boolean"!==a||(this.className&&N._data(this,"__className__",this.className),this.className=this.className||!1===o?"":N._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,i=this.length;n<i;n++)if(1===this[n].nodeType&&-1<(" "+this[n].className+" ").replace(p," ").indexOf(e))return!0;return!1},val:function(i){var r,t,o,e=this[0];return arguments.length?(o=N.isFunction(i),this.each(function(t){var e,n=N(this);1===this.nodeType&&(null==(e=o?i.call(this,t,n.val()):i)?e="":"number"==typeof e?e+="":N.isArray(e)&&(e=N.map(e,function(t){return null==t?"":t+""})),(r=N.valHooks[this.nodeName.toLowerCase()]||N.valHooks[this.type])&&"set"in r&&r.set(this,e,"value")!==O||(this.value=e))})):e?(r=N.valHooks[e.nodeName.toLowerCase()]||N.valHooks[e.type])&&"get"in r&&(t=r.get(e,"value"))!==O?t:"string"==typeof(t=e.value)?t.replace(n,""):null==t?"":t:void 0}}),N.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){var e,n,i,r,o=t.selectedIndex,s=[],a=t.options,l="select-one"===t.type;if(o<0)return null;for(n=l?o:0,i=l?o+1:a.length;n<i;n++)if((r=a[n]).selected&&(N.support.optDisabled?!r.disabled:null===r.getAttribute("disabled"))&&(!r.parentNode.disabled||!N.nodeName(r.parentNode,"optgroup"))){if(e=N(r).val(),l)return e;s.push(e)}return l&&!s.length&&a.length?N(a[o]).val():s},set:function(t,e){var n=N.makeArray(e);return N(t).find("option").each(function(){this.selected=0<=N.inArray(N(this).val(),n)}),n.length||(t.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(t,e,n,i){var r,o,s,a=t.nodeType;if(t&&3!==a&&8!==a&&2!==a)return i&&e in N.attrFn?N(t)[e](n):void 0===t.getAttribute?N.prop(t,e,n):((s=1!==a||!N.isXMLDoc(t))&&(e=e.toLowerCase(),o=N.attrHooks[e]||(v.test(e)?d:c)),n!==O?null===n?void N.removeAttr(t,e):o&&"set"in o&&s&&(r=o.set(t,n,e))!==O?r:(t.setAttribute(e,""+n),n):o&&"get"in o&&s&&null!==(r=o.get(t,e))?r:null===(r=t.getAttribute(e))?O:r)},removeAttr:function(t,e){var n,i,r,o,s=0;if(e&&1===t.nodeType)for(o=(i=e.toLowerCase().split(m)).length;s<o;s++)(r=i[s])&&(n=N.propFix[r]||r,N.attr(t,r,""),t.removeAttribute(b?r:n),v.test(r)&&n in t&&(t[n]=!1))},attrHooks:{type:{set:function(t,e){if(a.test(t.nodeName)&&t.parentNode)N.error("type property can't be changed");else if(!N.support.radioValue&&"radio"===e&&N.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}},value:{get:function(t,e){return c&&N.nodeName(t,"button")?c.get(t,e):e in t?t.value:null},set:function(t,e,n){if(c&&N.nodeName(t,"button"))return c.set(t,e,n);t.value=e}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(t,e,n){var i,r,o=t.nodeType;if(t&&3!==o&&8!==o&&2!==o)return(1!==o||!N.isXMLDoc(t))&&(e=N.propFix[e]||e,r=N.propHooks[e]),n!==O?r&&"set"in r&&(i=r.set(t,n,e))!==O?i:t[e]=n:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=t.getAttributeNode("tabindex");return e&&e.specified?parseInt(e.value,10):g.test(t.nodeName)||y.test(t.nodeName)&&t.href?0:O}}}}),N.attrHooks.tabindex=N.propHooks.tabIndex,d={get:function(t,e){var n,i=N.prop(t,e);return!0===i||"boolean"!=typeof i&&(n=t.getAttributeNode(e))&&!1!==n.nodeValue?e.toLowerCase():O},set:function(t,e,n){var i;return!1===e?N.removeAttr(t,n):((i=N.propFix[n]||n)in t&&(t[i]=!0),t.setAttribute(n,n.toLowerCase())),n}},b||(i={name:!0,id:!0},c=N.valHooks.button={get:function(t,e){var n;return(n=t.getAttributeNode(e))&&(i[e]?""!==n.nodeValue:n.specified)?n.nodeValue:O},set:function(t,e,n){var i=t.getAttributeNode(n);return i||(i=R.createAttribute(n),t.setAttributeNode(i)),i.nodeValue=e+""}},N.attrHooks.tabindex.set=c.set,N.each(["width","height"],function(t,n){N.attrHooks[n]=N.extend(N.attrHooks[n],{set:function(t,e){if(""===e)return t.setAttribute(n,"auto"),e}})}),N.attrHooks.contenteditable={get:c.get,set:function(t,e,n){""===e&&(e="false"),c.set(t,e,n)}}),N.support.hrefNormalized||N.each(["href","src","width","height"],function(t,n){N.attrHooks[n]=N.extend(N.attrHooks[n],{get:function(t){var e=t.getAttribute(n,2);return null===e?O:e}})}),N.support.style||(N.attrHooks.style={get:function(t){return t.style.cssText.toLowerCase()||O},set:function(t,e){return t.style.cssText=""+e}}),N.support.optSelected||(N.propHooks.selected=N.extend(N.propHooks.selected,{get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}})),N.support.enctype||(N.propFix.enctype="encoding"),N.support.checkOn||N.each(["radio","checkbox"],function(){N.valHooks[this]={get:function(t){return null===t.getAttribute("value")?"on":t.value}}}),N.each(["radio","checkbox"],function(){N.valHooks[this]=N.extend(N.valHooks[this],{set:function(t,e){if(N.isArray(e))return t.checked=0<=N.inArray(N(t).val(),e)}})});var w=/^(?:textarea|input|select)$/i,x=/^([^\.]*)?(?:\.(.+))?$/,e=/\bhover(\.\S+)?\b/,S=/^key/,E=/^(?:mouse|contextmenu)|click/,C=/^(?:focusinfocus|focusoutblur)$/,T=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,k=function(t){return N.event.special.hover?t:t.replace(e,"mouseenter$1 mouseleave$1")};function _(){return!1}function A(){return!0}N.event={add:function(t,e,n,i,r){var o,s,a,l,c,u,h,d,f,p,m;if(3!==t.nodeType&&8!==t.nodeType&&e&&n&&(o=N._data(t))){for(n.handler&&(n=(f=n).handler),n.guid||(n.guid=N.guid++),(a=o.events)||(o.events=a={}),(s=o.handle)||(o.handle=s=function(t){return void 0===N||t&&N.event.triggered===t.type?O:N.event.dispatch.apply(s.elem,arguments)},s.elem=t),e=N.trim(k(e)).split(" "),l=0;l<e.length;l++)u=(c=x.exec(e[l])||[])[1],h=(c[2]||"").split(".").sort(),m=N.event.special[u]||{},u=(r?m.delegateType:m.bindType)||u,m=N.event.special[u]||{},d=N.extend({type:u,origType:c[1],data:i,handler:n,guid:n.guid,selector:r,quick:(g=r,y=void 0,y=T.exec(g),y&&(y[1]=(y[1]||"").toLowerCase(),y[3]=y[3]&&new RegExp("(?:^|\\s)"+y[3]+"(?:\\s|$)")),y),namespace:h.join(".")},f),(p=a[u])||((p=a[u]=[]).delegateCount=0,m.setup&&!1!==m.setup.call(t,i,h,s)||(t.addEventListener?t.addEventListener(u,s,!1):t.attachEvent&&t.attachEvent("on"+u,s))),m.add&&(m.add.call(t,d),d.handler.guid||(d.handler.guid=n.guid)),r?p.splice(p.delegateCount++,0,d):p.push(d),N.event.global[u]=!0;var g,y;t=null}},global:{},remove:function(t,e,n,i,r){var o,s,a,l,c,u,h,d,f,p,m,g,y=N.hasData(t)&&N._data(t);if(y&&(d=y.events)){for(e=N.trim(k(e||"")).split(" "),o=0;o<e.length;o++)if(a=l=(s=x.exec(e[o])||[])[1],c=s[2],a){for(f=N.event.special[a]||{},u=(m=d[a=(i?f.delegateType:f.bindType)||a]||[]).length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null,h=0;h<m.length;h++)g=m[h],!r&&l!==g.origType||n&&n.guid!==g.guid||c&&!c.test(g.namespace)||i&&i!==g.selector&&("**"!==i||!g.selector)||(m.splice(h--,1),g.selector&&m.delegateCount--,f.remove&&f.remove.call(t,g));0===m.length&&u!==m.length&&(f.teardown&&!1!==f.teardown.call(t,c)||N.removeEvent(t,a,y.handle),delete d[a])}else for(a in d)N.event.remove(t,a+e[o],n,i,!0);N.isEmptyObject(d)&&((p=y.handle)&&(p.elem=null),N.removeData(t,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(t,e,n,i){if(!n||3!==n.nodeType&&8!==n.nodeType){var r,o,s,a,l,c,u,h,d,f,p=t.type||t,m=[];if(!C.test(p+N.event.triggered)&&(0<=p.indexOf("!")&&(p=p.slice(0,-1),o=!0),0<=p.indexOf(".")&&(p=(m=p.split(".")).shift(),m.sort()),n&&!N.event.customEvent[p]||N.event.global[p]))if((t="object"==typeof t?t[N.expando]?t:new N.Event(p,t):new N.Event(p)).type=p,t.isTrigger=!0,t.exclusive=o,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,c=p.indexOf(":")<0?"on"+p:"",n){if(t.result=O,t.target||(t.target=n),(e=null!=e?N.makeArray(e):[]).unshift(t),!(u=N.event.special[p]||{}).trigger||!1!==u.trigger.apply(n,e)){if(d=[[n,u.bindType||p]],!i&&!u.noBubble&&!N.isWindow(n)){for(f=u.delegateType||p,a=C.test(f+p)?n:n.parentNode,l=null;a;a=a.parentNode)d.push([a,f]),l=a;l&&l===n.ownerDocument&&d.push([l.defaultView||l.parentWindow||P,f])}for(s=0;s<d.length&&!t.isPropagationStopped();s++)a=d[s][0],t.type=d[s][1],(h=(N._data(a,"events")||{})[t.type]&&N._data(a,"handle"))&&h.apply(a,e),(h=c&&a[c])&&N.acceptData(a)&&!1===h.apply(a,e)&&t.preventDefault();return t.type=p,i||t.isDefaultPrevented()||u._default&&!1!==u._default.apply(n.ownerDocument,e)||"click"===p&&N.nodeName(n,"a")||!N.acceptData(n)||c&&n[p]&&("focus"!==p&&"blur"!==p||0!==t.target.offsetWidth)&&!N.isWindow(n)&&((l=n[c])&&(n[c]=null),n[N.event.triggered=p](),N.event.triggered=O,l&&(n[c]=l)),t.result}}else for(s in r=N.cache)r[s].events&&r[s].events[p]&&N.event.trigger(t,e,r[s].handle.elem,!0)}},dispatch:function(t){t=N.event.fix(t||P.event);var e,n,i,r,o,s,a,l,c,u,h,d,f,p=(N._data(this,"events")||{})[t.type]||[],m=p.delegateCount,g=[].slice.call(arguments,0),y=!t.exclusive&&!t.namespace,v=[];if((g[0]=t).delegateTarget=this,m&&!t.target.disabled&&(!t.button||"click"!==t.type))for((r=N(this)).context=this.ownerDocument||this,i=t.target;i!=this;i=i.parentNode||this){for(s={},l=[],r[0]=i,e=0;e<m;e++)s[u=(c=p[e]).selector]===O&&(s[u]=c.quick?(h=i,d=c.quick,void 0,f=h.attributes||{},(!d[1]||h.nodeName.toLowerCase()===d[1])&&(!d[2]||(f.id||{}).value===d[2])&&(!d[3]||d[3].test((f.class||{}).value))):r.is(u)),s[u]&&l.push(c);l.length&&v.push({elem:i,matches:l})}for(p.length>m&&v.push({elem:this,matches:p.slice(m)}),e=0;e<v.length&&!t.isPropagationStopped();e++)for(a=v[e],t.currentTarget=a.elem,n=0;n<a.matches.length&&!t.isImmediatePropagationStopped();n++)c=a.matches[n],(y||!t.namespace&&!c.namespace||t.namespace_re&&t.namespace_re.test(c.namespace))&&(t.data=c.data,t.handleObj=c,(o=((N.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g))!==O&&!1===(t.result=o)&&(t.preventDefault(),t.stopPropagation()));return t.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var n,i,r,o=e.button,s=e.fromElement;return null==t.pageX&&null!=e.clientX&&(i=(n=t.target.ownerDocument||R).documentElement,r=n.body,t.pageX=e.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),t.pageY=e.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),!t.relatedTarget&&s&&(t.relatedTarget=s===t.target?e.toElement:s),t.which||o===O||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[N.expando])return t;var e,n,i=t,r=N.event.fixHooks[t.type]||{},o=r.props?this.props.concat(r.props):this.props;for(t=N.Event(i),e=o.length;e;)t[n=o[--e]]=i[n];return t.target||(t.target=i.srcElement||R),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey===O&&(t.metaKey=t.ctrlKey),r.filter?r.filter(t,i):t},special:{ready:{setup:N.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(t,e,n){N.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(t,e,n,i){var r=N.extend(new N.Event,n,{type:t,isSimulated:!0,originalEvent:{}});i?N.event.trigger(r,null,e):N.event.dispatch.call(e,r),r.isDefaultPrevented()&&n.preventDefault()}},N.event.handle=N.event.dispatch,N.removeEvent=R.removeEventListener?function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)}:function(t,e,n){t.detachEvent&&t.detachEvent("on"+e,n)},N.Event=function(t,e){if(!(this instanceof N.Event))return new N.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||!1===t.returnValue||t.getPreventDefault&&t.getPreventDefault()?A:_):this.type=t,e&&N.extend(this,e),this.timeStamp=t&&t.timeStamp||N.now(),this[N.expando]=!0},N.Event.prototype={preventDefault:function(){this.isDefaultPrevented=A;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=A;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=A,this.stopPropagation()},isDefaultPrevented:_,isPropagationStopped:_,isImmediatePropagationStopped:_},N.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,r){N.event.special[t]={delegateType:r,bindType:r,handle:function(t){var e,n=t.relatedTarget,i=t.handleObj;i.selector;return n&&(n===this||N.contains(this,n))||(t.type=i.origType,e=i.handler.apply(this,arguments),t.type=r),e}}}),N.support.submitBubbles||(N.event.special.submit={setup:function(){if(N.nodeName(this,"form"))return!1;N.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,n=N.nodeName(e,"input")||N.nodeName(e,"button")?e.form:O;n&&!n._submit_attached&&(N.event.add(n,"submit._submit",function(t){this.parentNode&&!t.isTrigger&&N.event.simulate("submit",this.parentNode,t,!0)}),n._submit_attached=!0)})},teardown:function(){if(N.nodeName(this,"form"))return!1;N.event.remove(this,"._submit")}}),N.support.changeBubbles||(N.event.special.change={setup:function(){if(w.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(N.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),N.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1,N.event.simulate("change",this,t,!0))})),!1;N.event.add(this,"beforeactivate._change",function(t){var e=t.target;w.test(e.nodeName)&&!e._change_attached&&(N.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||N.event.simulate("change",this.parentNode,t,!0)}),e._change_attached=!0)})},handle:function(t){var e=t.target;if(this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type)return t.handleObj.handler.apply(this,arguments)},teardown:function(){return N.event.remove(this,"._change"),w.test(this.nodeName)}}),N.support.focusinBubbles||N.each({focus:"focusin",blur:"focusout"},function(t,e){var n=0,i=function(t){N.event.simulate(e,t.target,N.event.fix(t),!0)};N.event.special[e]={setup:function(){0==n++&&R.addEventListener(t,i,!0)},teardown:function(){0==--n&&R.removeEventListener(t,i,!0)}}}),N.fn.extend({on:function(t,e,n,i,r){var o,s;if("object"==typeof t){for(s in"string"!=typeof e&&(n=e,e=O),t)this.on(s,e,n,t[s],r);return this}if(null==n&&null==i?(i=e,n=e=O):null==i&&("string"==typeof e?(i=n,n=O):(i=n,n=e,e=O)),!1===i)i=_;else if(!i)return this;return 1===r&&(o=i,(i=function(t){return N().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=N.guid++)),this.each(function(){N.event.add(this,t,i,n,e)})},one:function(t,e,n,i){return this.on.call(this,t,e,n,i,1)},off:function(t,e,n){if(t&&t.preventDefault&&t.handleObj){var i=t.handleObj;return N(t.delegateTarget).off(i.namespace?i.type+"."+i.namespace:i.type,i.selector,i.handler),this}if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(n=e,e=O),!1===n&&(n=_),this.each(function(){N.event.remove(this,t,n,e)});for(var r in t)this.off(r,e,t[r]);return this},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},live:function(t,e,n){return N(this.context).on(t,this.selector,e,n),this},die:function(t,e){return N(this.context).off(t,this.selector||"**",e),this},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1==arguments.length?this.off(t,"**"):this.off(e,t,n)},trigger:function(t,e){return this.each(function(){N.event.trigger(t,e,this)})},triggerHandler:function(t,e){if(this[0])return N.event.trigger(t,e,this[0],!0)},toggle:function(n){var i=arguments,t=n.guid||N.guid++,r=0,e=function(t){var e=(N._data(this,"lastToggle"+n.guid)||0)%r;return N._data(this,"lastToggle"+n.guid,e+1),t.preventDefault(),i[e].apply(this,arguments)||!1};for(e.guid=t;r<i.length;)i[r++].guid=t;return this.click(e)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),N.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,n){N.fn[n]=function(t,e){return null==e&&(e=t,t=null),0<arguments.length?this.on(n,null,t,e):this.trigger(n)},N.attrFn&&(N.attrFn[n]=!0),S.test(n)&&(N.event.fixHooks[n]=N.event.keyHooks),E.test(n)&&(N.event.fixHooks[n]=N.event.mouseHooks)}),function(){var y=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,u="sizcache"+(Math.random()+"").replace(".",""),s=0,v=Object.prototype.toString,h=!1,n=!0,c=/\\/g,o=/\r\n/g,l=/\W/;[0,0].sort(function(){return n=!1,0});var b=function(t,e,n,i){n=n||[];var r=e=e||R;if(1!==e.nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return n;var o,s,a,l,c,u,h,d,f=!0,p=b.isXML(e),m=[],g=t;do{if(y.exec(""),(o=y.exec(g))&&(g=o[3],m.push(o[1]),o[2])){l=o[3];break}}while(o);if(1<m.length&&x.exec(t))if(2===m.length&&w.relative[m[0]])s=T(m[0]+m[1],e,i);else for(s=w.relative[m[0]]?[e]:b(m.shift(),e);m.length;)t=m.shift(),w.relative[t]&&(t+=m.shift()),s=T(t,s,i);else if(!i&&1<m.length&&9===e.nodeType&&!p&&w.match.ID.test(m[0])&&!w.match.ID.test(m[m.length-1])&&(e=(c=b.find(m.shift(),e,p)).expr?b.filter(c.expr,c.set)[0]:c.set[0]),e)for(s=(c=i?{expr:m.pop(),set:S(i)}:b.find(m.pop(),1!==m.length||"~"!==m[0]&&"+"!==m[0]||!e.parentNode?e:e.parentNode,p)).expr?b.filter(c.expr,c.set):c.set,0<m.length?a=S(s):f=!1;m.length;)h=u=m.pop(),w.relative[u]?h=m.pop():u="",null==h&&(h=e),w.relative[u](a,h,p);else a=m=[];if(a||(a=s),a||b.error(u||t),"[object Array]"===v.call(a))if(f)if(e&&1===e.nodeType)for(d=0;null!=a[d];d++)a[d]&&(!0===a[d]||1===a[d].nodeType&&b.contains(e,a[d]))&&n.push(s[d]);else for(d=0;null!=a[d];d++)a[d]&&1===a[d].nodeType&&n.push(s[d]);else n.push.apply(n,a);else S(a,n);return l&&(b(l,r,n,i),b.uniqueSort(n)),n};b.uniqueSort=function(t){if(i&&(h=n,t.sort(i),h))for(var e=1;e<t.length;e++)t[e]===t[e-1]&&t.splice(e--,1);return t},b.matches=function(t,e){return b(t,null,null,e)},b.matchesSelector=function(t,e){return 0<b(e,null,null,[t]).length},b.find=function(t,e,n){var i,r,o,s,a,l;if(!t)return[];for(r=0,o=w.order.length;r<o;r++)if(a=w.order[r],(s=w.leftMatch[a].exec(t))&&(l=s[1],s.splice(1,1),"\\"!==l.substr(l.length-1)&&(s[1]=(s[1]||"").replace(c,""),null!=(i=w.find[a](s,e,n))))){t=t.replace(w.match[a],"");break}return i||(i=void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):[]),{set:i,expr:t}},b.filter=function(t,e,n,i){for(var r,o,s,a,l,c,u,h,d,f=t,p=[],m=e,g=e&&e[0]&&b.isXML(e[0]);t&&e.length;){for(s in w.filter)if(null!=(r=w.leftMatch[s].exec(t))&&r[2]){if(c=w.filter[s],u=r[1],o=!1,r.splice(1,1),"\\"===u.substr(u.length-1))continue;if(m===p&&(p=[]),w.preFilter[s])if(r=w.preFilter[s](r,m,n,p,i,g)){if(!0===r)continue}else o=a=!0;if(r)for(h=0;null!=(l=m[h]);h++)l&&(d=i^(a=c(l,r,h,m)),n&&null!=a?d?o=!0:m[h]=!1:d&&(p.push(l),o=!0));if(a!==O){if(n||(m=p),t=t.replace(w.match[s],""),!o)return[];break}}if(t===f){if(null!=o)break;b.error(t)}f=t}return m},b.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)};var d=b.getText=function(t){var e,n,i=t.nodeType,r="";if(i){if(1===i||9===i){if("string"==typeof t.textContent)return t.textContent;if("string"==typeof t.innerText)return t.innerText.replace(o,"");for(t=t.firstChild;t;t=t.nextSibling)r+=d(t)}else if(3===i||4===i)return t.nodeValue}else for(e=0;n=t[e];e++)8!==n.nodeType&&(r+=d(n));return r},w=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")},type:function(t){return t.getAttribute("type")}},relative:{"+":function(t,e){var n="string"==typeof e,i=n&&!l.test(e),r=n&&!i;i&&(e=e.toLowerCase());for(var o,s=0,a=t.length;s<a;s++)if(o=t[s]){for(;(o=o.previousSibling)&&1!==o.nodeType;);t[s]=r||o&&o.nodeName.toLowerCase()===e?o||!1:o===e}r&&b.filter(e,t,!0)},">":function(t,e){var n,i="string"==typeof e,r=0,o=t.length;if(i&&!l.test(e)){for(e=e.toLowerCase();r<o;r++)if(n=t[r]){var s=n.parentNode;t[r]=s.nodeName.toLowerCase()===e&&s}}else{for(;r<o;r++)(n=t[r])&&(t[r]=i?n.parentNode:n.parentNode===e);i&&b.filter(e,t,!0)}},"":function(t,e,n){var i,r=s++,o=C;"string"!=typeof e||l.test(e)||(i=e=e.toLowerCase(),o=E),o("parentNode",e,r,t,i,n)},"~":function(t,e,n){var i,r=s++,o=C;"string"!=typeof e||l.test(e)||(i=e=e.toLowerCase(),o=E),o("previousSibling",e,r,t,i,n)}},find:{ID:function(t,e,n){if(void 0!==e.getElementById&&!n){var i=e.getElementById(t[1]);return i&&i.parentNode?[i]:[]}},NAME:function(t,e){if(void 0!==e.getElementsByName){for(var n=[],i=e.getElementsByName(t[1]),r=0,o=i.length;r<o;r++)i[r].getAttribute("name")===t[1]&&n.push(i[r]);return 0===n.length?null:n}},TAG:function(t,e){if(void 0!==e.getElementsByTagName)return e.getElementsByTagName(t[1])}},preFilter:{CLASS:function(t,e,n,i,r,o){if(t=" "+t[1].replace(c,"")+" ",o)return t;for(var s,a=0;null!=(s=e[a]);a++)s&&(r^(s.className&&0<=(" "+s.className+" ").replace(/[\t\n\r]/g," ").indexOf(t))?n||i.push(s):n&&(e[a]=!1));return!1},ID:function(t){return t[1].replace(c,"")},TAG:function(t,e){return t[1].replace(c,"").toLowerCase()},CHILD:function(t){if("nth"===t[1]){t[2]||b.error(t[0]),t[2]=t[2].replace(/^\+|\s*/g,"");var e=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(("even"===t[2]?"2n":"odd"===t[2]&&"2n+1")||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]);t[2]=e[1]+(e[2]||1)-0,t[3]=e[3]-0}else t[2]&&b.error(t[0]);return t[0]=s++,t},ATTR:function(t,e,n,i,r,o){var s=t[1]=t[1].replace(c,"");return!o&&w.attrMap[s]&&(t[1]=w.attrMap[s]),t[4]=(t[4]||t[5]||"").replace(c,""),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(t,e,n,i,r){if("not"===t[1]){if(!(1<(y.exec(t[3])||"").length||/^\w/.test(t[3]))){var o=b.filter(t[3],e,n,!0^r);return n||i.push.apply(i,o),!1}t[3]=b(t[3],null,null,e)}else if(w.match.POS.test(t[0])||w.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return!1===t.disabled&&"hidden"!==t.type},disabled:function(t){return!0===t.disabled},checked:function(t){return!0===t.checked},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,n){return!!b(n[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){var e=t.getAttribute("type"),n=t.type;return"input"===t.nodeName.toLowerCase()&&"text"===n&&(e===n||null===e)},radio:function(t){return"input"===t.nodeName.toLowerCase()&&"radio"===t.type},checkbox:function(t){return"input"===t.nodeName.toLowerCase()&&"checkbox"===t.type},file:function(t){return"input"===t.nodeName.toLowerCase()&&"file"===t.type},password:function(t){return"input"===t.nodeName.toLowerCase()&&"password"===t.type},submit:function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&"submit"===t.type},image:function(t){return"input"===t.nodeName.toLowerCase()&&"image"===t.type},reset:function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&"reset"===t.type},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)},focus:function(t){return t===t.ownerDocument.activeElement}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,n,i){return e===i.length-1},even:function(t,e){return e%2==0},odd:function(t,e){return e%2==1},lt:function(t,e,n){return e<n[3]-0},gt:function(t,e,n){return e>n[3]-0},nth:function(t,e,n){return n[3]-0===e},eq:function(t,e,n){return n[3]-0===e}},filter:{PSEUDO:function(t,e,n,i){var r=e[1],o=w.filters[r];if(o)return o(t,n,e,i);if("contains"===r)return 0<=(t.textContent||t.innerText||d([t])||"").indexOf(e[3]);if("not"===r){for(var s=e[3],a=0,l=s.length;a<l;a++)if(s[a]===t)return!1;return!0}b.error(r)},CHILD:function(t,e){var n,i,r,o,s,a,l=e[1],c=t;switch(l){case"only":case"first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===l)return!0;c=t;case"last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0;case"nth":if(n=e[2],i=e[3],1===n&&0===i)return!0;if(r=e[0],(o=t.parentNode)&&(o[u]!==r||!t.nodeIndex)){for(s=0,c=o.firstChild;c;c=c.nextSibling)1===c.nodeType&&(c.nodeIndex=++s);o[u]=r}return a=t.nodeIndex-i,0===n?0===a:a%n==0&&0<=a/n}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||!!t.nodeName&&t.nodeName.toLowerCase()===e},CLASS:function(t,e){return-1<(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)},ATTR:function(t,e){var n=e[1],i=b.attr?b.attr(t,n):w.attrHandle[n]?w.attrHandle[n](t):null!=t[n]?t[n]:t.getAttribute(n),r=i+"",o=e[2],s=e[4];return null==i?"!="===o:!o&&b.attr?null!=i:"="===o?r===s:"*="===o?0<=r.indexOf(s):"~="===o?0<=(" "+r+" ").indexOf(s):s?"!="===o?r!==s:"^="===o?0===r.indexOf(s):"$="===o?r.substr(r.length-s.length)===s:"|="===o&&(r===s||r.substr(0,s.length+1)===s+"-"):r&&!1!==i},POS:function(t,e,n,i){var r=e[2],o=w.setFilters[r];if(o)return o(t,n,e,i)}}},x=w.match.POS,t=function(t,e){return"\\"+(e-0+1)};for(var e in w.match)w.match[e]=new RegExp(w.match[e].source+/(?![^\[]*\])(?![^\(]*\))/.source),w.leftMatch[e]=new RegExp(/(^(?:.|\r|\n)*?)/.source+w.match[e].source.replace(/\\(\d+)/g,t));var i,f,r,a,p,m,g,S=function(t,e){return t=Array.prototype.slice.call(t,0),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(R.documentElement.childNodes,0)[0].nodeType}catch(t){S=function(t,e){var n=0,i=e||[];if("[object Array]"===v.call(t))Array.prototype.push.apply(i,t);else if("number"==typeof t.length)for(var r=t.length;n<r;n++)i.push(t[n]);else for(;t[n];n++)i.push(t[n]);return i}}function E(t,e,n,i,r,o){for(var s=0,a=i.length;s<a;s++){var l=i[s];if(l){var c=!1;for(l=l[t];l;){if(l[u]===n){c=i[l.sizset];break}if(1!==l.nodeType||o||(l[u]=n,l.sizset=s),l.nodeName.toLowerCase()===e){c=l;break}l=l[t]}i[s]=c}}}function C(t,e,n,i,r,o){for(var s=0,a=i.length;s<a;s++){var l=i[s];if(l){var c=!1;for(l=l[t];l;){if(l[u]===n){c=i[l.sizset];break}if(1===l.nodeType)if(o||(l[u]=n,l.sizset=s),"string"!=typeof e){if(l===e){c=!0;break}}else if(0<b.filter(e,[l]).length){c=l;break}l=l[t]}i[s]=c}}}R.documentElement.compareDocumentPosition?i=function(t,e){return t===e?(h=!0,0):t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e)?-1:1:t.compareDocumentPosition?-1:1}:(i=function(t,e){if(t===e)return h=!0,0;if(t.sourceIndex&&e.sourceIndex)return t.sourceIndex-e.sourceIndex;var n,i,r=[],o=[],s=t.parentNode,a=e.parentNode,l=s;if(s===a)return f(t,e);if(!s)return-1;if(!a)return 1;for(;l;)r.unshift(l),l=l.parentNode;for(l=a;l;)o.unshift(l),l=l.parentNode;n=r.length,i=o.length;for(var c=0;c<n&&c<i;c++)if(r[c]!==o[c])return f(r[c],o[c]);return c===n?f(t,o[c],-1):f(r[c],e,1)},f=function(t,e,n){if(t===e)return n;for(var i=t.nextSibling;i;){if(i===e)return-1;i=i.nextSibling}return 1}),r=R.createElement("div"),a="script"+(new Date).getTime(),p=R.documentElement,r.innerHTML="<a name='"+a+"'/>",p.insertBefore(r,p.firstChild),R.getElementById(a)&&(w.find.ID=function(t,e,n){if(void 0!==e.getElementById&&!n){var i=e.getElementById(t[1]);return i?i.id===t[1]||void 0!==i.getAttributeNode&&i.getAttributeNode("id").nodeValue===t[1]?[i]:O:[]}},w.filter.ID=function(t,e){var n=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&n&&n.nodeValue===e}),p.removeChild(r),p=r=null,(m=R.createElement("div")).appendChild(R.createComment("")),0<m.getElementsByTagName("*").length&&(w.find.TAG=function(t,e){var n=e.getElementsByTagName(t[1]);if("*"===t[1]){for(var i=[],r=0;n[r];r++)1===n[r].nodeType&&i.push(n[r]);n=i}return n}),m.innerHTML="<a href='#'></a>",m.firstChild&&void 0!==m.firstChild.getAttribute&&"#"!==m.firstChild.getAttribute("href")&&(w.attrHandle.href=function(t){return t.getAttribute("href",2)}),m=null,R.querySelectorAll&&function(){var h=b,t=R.createElement("div");if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){for(var e in b=function(t,e,n,i){if(e=e||R,!i&&!b.isXML(e)){var r=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(r&&(1===e.nodeType||9===e.nodeType)){if(r[1])return S(e.getElementsByTagName(t),n);if(r[2]&&w.find.CLASS&&e.getElementsByClassName)return S(e.getElementsByClassName(r[2]),n)}if(9===e.nodeType){if("body"===t&&e.body)return S([e.body],n);if(r&&r[3]){var o=e.getElementById(r[3]);if(!o||!o.parentNode)return S([],n);if(o.id===r[3])return S([o],n)}try{return S(e.querySelectorAll(t),n)}catch(t){}}else if(1===e.nodeType&&"object"!==e.nodeName.toLowerCase()){var s=e,a=e.getAttribute("id"),l=a||"__sizzle__",c=e.parentNode,u=/^\s*[+~]/.test(t);a?l=l.replace(/'/g,"\\$&"):e.setAttribute("id",l),u&&c&&(e=e.parentNode);try{if(!u||c)return S(e.querySelectorAll("[id='"+l+"'] "+t),n)}catch(t){}finally{a||s.removeAttribute("id")}}}return h(t,e,n,i)},h)b[e]=h[e];t=null}}(),function(){var t=R.documentElement,i=t.matchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.msMatchesSelector;if(i){var r=!i.call(R.createElement("div"),"div"),o=!1;try{i.call(R.documentElement,"[test!='']:sizzle")}catch(t){o=!0}b.matchesSelector=function(t,e){if(e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!b.isXML(t))try{if(o||!w.match.PSEUDO.test(e)&&!/!=/.test(e)){var n=i.call(t,e);if(n||!r||t.document&&11!==t.document.nodeType)return n}}catch(t){}return 0<b(e,null,null,[t]).length}}}(),(g=R.createElement("div")).innerHTML="<div class='test e'></div><div class='test'></div>",g.getElementsByClassName&&0!==g.getElementsByClassName("e").length&&(g.lastChild.className="e",1!==g.getElementsByClassName("e").length&&(w.order.splice(1,0,"CLASS"),w.find.CLASS=function(t,e,n){if(void 0!==e.getElementsByClassName&&!n)return e.getElementsByClassName(t[1])},g=null)),R.documentElement.contains?b.contains=function(t,e){return t!==e&&(!t.contains||t.contains(e))}:R.documentElement.compareDocumentPosition?b.contains=function(t,e){return!!(16&t.compareDocumentPosition(e))}:b.contains=function(){return!1},b.isXML=function(t){var e=(t?t.ownerDocument||t:0).documentElement;return!!e&&"HTML"!==e.nodeName};var T=function(t,e,n){for(var i,r=[],o="",s=e.nodeType?[e]:e;i=w.match.PSEUDO.exec(t);)o+=i[0],t=t.replace(w.match.PSEUDO,"");t=w.relative[t]?t+"*":t;for(var a=0,l=s.length;a<l;a++)b(t,s[a],r,n);return b.filter(o,r)};b.attr=N.attr,b.selectors.attrMap={},N.find=b,N.expr=b.selectors,N.expr[":"]=N.expr.filters,N.unique=b.uniqueSort,N.text=b.getText,N.isXMLDoc=b.isXML,N.contains=b.contains}();var B=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,L=/,/,I=/^.[^:#\[\.,]*$/,U=Array.prototype.slice,$=N.expr.match.POS,F={children:!0,contents:!0,next:!0,prev:!0};function V(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function G(t,n,i){if(n=n||0,N.isFunction(n))return N.grep(t,function(t,e){return!!n.call(t,e,t)===i});if(n.nodeType)return N.grep(t,function(t,e){return t===n===i});if("string"==typeof n){var e=N.grep(t,function(t){return 1===t.nodeType});if(I.test(n))return N.filter(n,e,!i);n=N.filter(n,e)}return N.grep(t,function(t,e){return 0<=N.inArray(t,n)===i})}function H(t){var e=j.split("|"),n=t.createDocumentFragment();if(n.createElement)for(;e.length;)n.createElement(e.pop());return n}N.fn.extend({find:function(t){var e,n,i=this;if("string"!=typeof t)return N(t).filter(function(){for(e=0,n=i.length;e<n;e++)if(N.contains(i[e],this))return!0});var r,o,s,a=this.pushStack("","find",t);for(e=0,n=this.length;e<n;e++)if(r=a.length,N.find(t,this[e],a),0<e)for(o=r;o<a.length;o++)for(s=0;s<r;s++)if(a[s]===a[o]){a.splice(o--,1);break}return a},has:function(t){var n=N(t);return this.filter(function(){for(var t=0,e=n.length;t<e;t++)if(N.contains(this,n[t]))return!0})},not:function(t){return this.pushStack(G(this,t,!1),"not",t)},filter:function(t){return this.pushStack(G(this,t,!0),"filter",t)},is:function(t){return!!t&&("string"==typeof t?$.test(t)?0<=N(t,this.context).index(this[0]):0<N.filter(t,this).length:0<this.filter(t).length)},closest:function(t,e){var n,i,r=[],o=this[0];if(N.isArray(t)){for(var s=1;o&&o.ownerDocument&&o!==e;){for(n=0;n<t.length;n++)N(o).is(t[n])&&r.push({selector:t[n],elem:o,level:s});o=o.parentNode,s++}return r}var a=$.test(t)||"string"!=typeof t?N(t,e||this.context):0;for(n=0,i=this.length;n<i;n++)for(o=this[n];o;){if(a?-1<a.index(o):N.find.matchesSelector(o,t)){r.push(o);break}if(!(o=o.parentNode)||!o.ownerDocument||o===e||11===o.nodeType)break}return r=1<r.length?N.unique(r):r,this.pushStack(r,"closest",t)},index:function(t){return t?"string"==typeof t?N.inArray(this[0],N(t)):N.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(t,e){var n="string"==typeof t?N(t,e):N.makeArray(t&&t.nodeType?[t]:t),i=N.merge(this.get(),n);return this.pushStack(V(n[0])||V(i[0])?i:N.unique(i))},andSelf:function(){return this.add(this.prevObject)}}),N.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return N.dir(t,"parentNode")},parentsUntil:function(t,e,n){return N.dir(t,"parentNode",n)},next:function(t){return N.nth(t,2,"nextSibling")},prev:function(t){return N.nth(t,2,"previousSibling")},nextAll:function(t){return N.dir(t,"nextSibling")},prevAll:function(t){return N.dir(t,"previousSibling")},nextUntil:function(t,e,n){return N.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return N.dir(t,"previousSibling",n)},siblings:function(t){return N.sibling(t.parentNode.firstChild,t)},children:function(t){return N.sibling(t.firstChild)},contents:function(t){return N.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:N.makeArray(t.childNodes)}},function(i,r){N.fn[i]=function(t,e){var n=N.map(this,r,t);return B.test(i)||(e=t),e&&"string"==typeof e&&(n=N.filter(e,n)),n=1<this.length&&!F[i]?N.unique(n):n,(1<this.length||L.test(e))&&M.test(i)&&(n=n.reverse()),this.pushStack(n,i,U.call(arguments).join(","))}}),N.extend({filter:function(t,e,n){return n&&(t=":not("+t+")"),1===e.length?N.find.matchesSelector(e[0],t)?[e[0]]:[]:N.find.matches(t,e)},dir:function(t,e,n){for(var i=[],r=t[e];r&&9!==r.nodeType&&(n===O||1!==r.nodeType||!N(r).is(n));)1===r.nodeType&&i.push(r),r=r[e];return i},nth:function(t,e,n,i){e=e||1;for(var r=0;t&&(1!==t.nodeType||++r!==e);t=t[n]);return t},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}});var j="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",z=/ jQuery\d+="(?:\d+|null)"/g,q=/^\s+/,W=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Y=/<([\w:]+)/,X=/<tbody/i,K=/<|&#?\w+;/,J=/<(?:script|style)/i,Q=/<(?:script|object|embed|option|style)/i,Z=new RegExp("<(?:"+j+")","i"),tt=/checked\s*(?:[^=]|=\s*.checked.)/i,et=/\/(java|ecma)script/i,nt=/^\s*<!(?:\[CDATA\[|\-\-)/,it={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},rt=H(R);function ot(t,e){if(1===e.nodeType&&N.hasData(t)){var n,i,r,o=N._data(t),s=N._data(e,o),a=o.events;if(a)for(n in delete s.handle,s.events={},a)for(i=0,r=a[n].length;i<r;i++)N.event.add(e,n+(a[n][i].namespace?".":"")+a[n][i].namespace,a[n][i],a[n][i].data);s.data&&(s.data=N.extend({},s.data))}}function st(t,e){var n;1===e.nodeType&&(e.clearAttributes&&e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(t),"object"===(n=e.nodeName.toLowerCase())?e.outerHTML=t.outerHTML:"input"!==n||"checkbox"!==t.type&&"radio"!==t.type?"option"===n?e.selected=t.defaultSelected:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue):(t.checked&&(e.defaultChecked=e.checked=t.checked),e.value!==t.value&&(e.value=t.value)),e.removeAttribute(N.expando))}function at(t){return void 0!==t.getElementsByTagName?t.getElementsByTagName("*"):void 0!==t.querySelectorAll?t.querySelectorAll("*"):[]}function lt(t){"checkbox"!==t.type&&"radio"!==t.type||(t.defaultChecked=t.checked)}function ct(t){var e=(t.nodeName||"").toLowerCase();"input"===e?lt(t):"script"!==e&&void 0!==t.getElementsByTagName&&N.grep(t.getElementsByTagName("input"),lt)}function ut(t,e){e.src?N.ajax({url:e.src,async:!1,dataType:"script"}):N.globalEval((e.text||e.textContent||e.innerHTML||"").replace(nt,"/*$0*/")),e.parentNode&&e.parentNode.removeChild(e)}it.optgroup=it.option,it.tbody=it.tfoot=it.colgroup=it.caption=it.thead,it.th=it.td,N.support.htmlSerialize||(it._default=[1,"div<div>","</div>"]),N.fn.extend({text:function(n){return N.isFunction(n)?this.each(function(t){var e=N(this);e.text(n.call(this,t,e.text()))}):"object"!=typeof n&&n!==O?this.empty().append((this[0]&&this[0].ownerDocument||R).createTextNode(n)):N.text(this)},wrapAll:function(e){if(N.isFunction(e))return this.each(function(t){N(this).wrapAll(e.call(this,t))});if(this[0]){var t=N(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(n){return N.isFunction(n)?this.each(function(t){N(this).wrapInner(n.call(this,t))}):this.each(function(){var t=N(this),e=t.contents();e.length?e.wrapAll(n):t.append(n)})},wrap:function(e){var n=N.isFunction(e);return this.each(function(t){N(this).wrapAll(n?e.call(this,t):e)})},unwrap:function(){return this.parent().each(function(){N.nodeName(this,"body")||N(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=N.clean(arguments);return t.push.apply(t,this.toArray()),this.pushStack(t,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=this.pushStack(this,"after",arguments);return t.push.apply(t,N.clean(arguments)),t}},remove:function(t,e){for(var n,i=0;null!=(n=this[i]);i++)t&&!N.filter(t,[n]).length||(e||1!==n.nodeType||(N.cleanData(n.getElementsByTagName("*")),N.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&N.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return N.clone(this,t,e)})},html:function(n){if(n===O)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(z,""):null;if("string"!=typeof n||J.test(n)||!N.support.leadingWhitespace&&q.test(n)||it[(Y.exec(n)||["",""])[1].toLowerCase()])N.isFunction(n)?this.each(function(t){var e=N(this);e.html(n.call(this,t,e.html()))}):this.empty().append(n);else{n=n.replace(W,"<$1></$2>");try{for(var t=0,e=this.length;t<e;t++)1===this[t].nodeType&&(N.cleanData(this[t].getElementsByTagName("*")),this[t].innerHTML=n)}catch(t){this.empty().append(n)}}return this},replaceWith:function(i){return this[0]&&this[0].parentNode?N.isFunction(i)?this.each(function(t){var e=N(this),n=e.html();e.replaceWith(i.call(this,t,n))}):("string"!=typeof i&&(i=N(i).detach()),this.each(function(){var t=this.nextSibling,e=this.parentNode;N(this).remove(),t?N(t).before(i):N(e).append(i)})):this.length?this.pushStack(N(N.isFunction(i)?i():i),"replaceWith",i):this},detach:function(t){return this.remove(t,!0)},domManip:function(n,i,r){var t,e,o,s,a,l=n[0],c=[];if(!N.support.checkClone&&3===arguments.length&&"string"==typeof l&&tt.test(l))return this.each(function(){N(this).domManip(n,i,r,!0)});if(N.isFunction(l))return this.each(function(t){var e=N(this);n[0]=l.call(this,t,i?e.html():O),e.domManip(n,i,r)});if(this[0]){if(s=l&&l.parentNode,e=1===(o=(t=N.support.parentNode&&s&&11===s.nodeType&&s.childNodes.length===this.length?{fragment:s}:N.buildFragment(n,this,c)).fragment).childNodes.length?o=o.firstChild:o.firstChild){i=i&&N.nodeName(e,"tr");for(var u=0,h=this.length,d=h-1;u<h;u++)r.call(i?(a=this[u],e,N.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a):this[u],t.cacheable||1<h&&u<d?N.clone(o,!0,!0):o)}c.length&&N.each(c,ut)}return this}}),N.buildFragment=function(t,e,n){var i,r,o,s,a=t[0];return e&&e[0]&&(s=e[0].ownerDocument||e[0]),s.createDocumentFragment||(s=R),!(1===t.length&&"string"==typeof a&&a.length<512&&s===R&&"<"===a.charAt(0))||Q.test(a)||!N.support.checkClone&&tt.test(a)||!N.support.html5Clone&&Z.test(a)||(r=!0,(o=N.fragments[a])&&1!==o&&(i=o)),i||(i=s.createDocumentFragment(),N.clean(t,s,i,n)),r&&(N.fragments[a]=o?i:1),{fragment:i,cacheable:r}},N.fragments={},N.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,l){N.fn[a]=function(t){var e=[],n=N(t),i=1===this.length&&this[0].parentNode;if(i&&11===i.nodeType&&1===i.childNodes.length&&1===n.length)return n[l](this[0]),this;for(var r=0,o=n.length;r<o;r++){var s=(0<r?this.clone(!0):this).get();N(n[r])[l](s),e=e.concat(s)}return this.pushStack(e,a,n.selector)}}),N.extend({clone:function(t,e,n){var i,r,o,s,a,l=N.support.html5Clone||!Z.test("<"+t.nodeName)?t.cloneNode(!0):(s=t,a=R.createElement("div"),rt.appendChild(a),a.innerHTML=s.outerHTML,a.firstChild);if(!(N.support.noCloneEvent&&N.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||N.isXMLDoc(t)))for(st(t,l),i=at(t),r=at(l),o=0;i[o];++o)r[o]&&st(i[o],r[o]);if(e&&(ot(t,l),n))for(i=at(t),r=at(l),o=0;i[o];++o)ot(i[o],r[o]);return i=r=null,l},clean:function(t,e,n,i){var r;void 0===(e=e||R).createElement&&(e=e.ownerDocument||e[0]&&e[0].ownerDocument||R);for(var o,s,a=[],l=0;null!=(s=t[l]);l++)if("number"==typeof s&&(s+=""),s){if("string"==typeof s)if(K.test(s)){s=s.replace(W,"<$1></$2>");var c=(Y.exec(s)||["",""])[1].toLowerCase(),u=it[c]||it._default,h=u[0],d=e.createElement("div");for(e===R?rt.appendChild(d):H(e).appendChild(d),d.innerHTML=u[1]+s+u[2];h--;)d=d.lastChild;if(!N.support.tbody){var f=X.test(s),p="table"!==c||f?"<table>"!==u[1]||f?[]:d.childNodes:d.firstChild&&d.firstChild.childNodes;for(o=p.length-1;0<=o;--o)N.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!N.support.leadingWhitespace&&q.test(s)&&d.insertBefore(e.createTextNode(q.exec(s)[0]),d.firstChild),s=d.childNodes}else s=e.createTextNode(s);var m;if(!N.support.appendChecked)if(s[0]&&"number"==typeof(m=s.length))for(o=0;o<m;o++)ct(s[o]);else ct(s);s.nodeType?a.push(s):a=N.merge(a,s)}if(n)for(r=function(t){return!t.type||et.test(t.type)},l=0;a[l];l++)if(!i||!N.nodeName(a[l],"script")||a[l].type&&"text/javascript"!==a[l].type.toLowerCase()){if(1===a[l].nodeType){var g=N.grep(a[l].getElementsByTagName("script"),r);a.splice.apply(a,[l+1,0].concat(g))}n.appendChild(a[l])}else i.push(a[l].parentNode?a[l].parentNode.removeChild(a[l]):a[l]);return a},cleanData:function(t){for(var e,n,i,r=N.cache,o=N.event.special,s=N.support.deleteExpando,a=0;null!=(i=t[a]);a++)if((!i.nodeName||!N.noData[i.nodeName.toLowerCase()])&&(n=i[N.expando])){if((e=r[n])&&e.events){for(var l in e.events)o[l]?N.event.remove(i,l):N.removeEvent(i,l,e.handle);e.handle&&(e.handle.elem=null)}s?delete i[N.expando]:i.removeAttribute&&i.removeAttribute(N.expando),delete r[n]}}});var ht,dt,ft,pt=/alpha\([^)]*\)/i,mt=/opacity=([^)]*)/,gt=/([A-Z]|^ms)/g,yt=/^-?\d+(?:px)?$/i,vt=/^-?\d/,bt=/^([\-+])=([\-+.\de]+)/,wt={position:"absolute",visibility:"hidden",display:"block"},xt=["Left","Right"],St=["Top","Bottom"];function Et(t,e,n){var i="width"===e?t.offsetWidth:t.offsetHeight,r="width"===e?xt:St,o=0,s=r.length;if(0<i){if("border"!==n)for(;o<s;o++)n||(i-=parseFloat(N.css(t,"padding"+r[o]))||0),"margin"===n?i+=parseFloat(N.css(t,n+r[o]))||0:i-=parseFloat(N.css(t,"border"+r[o]+"Width"))||0;return i+"px"}if(((i=ht(t,e,e))<0||null==i)&&(i=t.style[e]||0),i=parseFloat(i)||0,n)for(;o<s;o++)i+=parseFloat(N.css(t,"padding"+r[o]))||0,"padding"!==n&&(i+=parseFloat(N.css(t,"border"+r[o]+"Width"))||0),"margin"===n&&(i+=parseFloat(N.css(t,n+r[o]))||0);return i+"px"}N.fn.css=function(t,e){return 2===arguments.length&&e===O?this:N.access(this,t,e,!0,function(t,e,n){return n!==O?N.style(t,e,n):N.css(t,e)})},N.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=ht(t,"opacity","opacity");return""===n?"1":n}return t.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:N.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,o,s=N.camelCase(e),a=t.style,l=N.cssHooks[s];if(e=N.cssProps[s]||s,n===O)return l&&"get"in l&&(r=l.get(t,!1,i))!==O?r:a[e];if(!("string"===(o=typeof n)&&(r=bt.exec(n))&&(n=+(r[1]+1)*+r[2]+parseFloat(N.css(t,e)),o="number"),null==n||"number"===o&&isNaN(n)||("number"!==o||N.cssNumber[s]||(n+="px"),l&&"set"in l&&(n=l.set(t,n))===O)))try{a[e]=n}catch(t){}}},css:function(t,e,n){var i,r;return e=N.camelCase(e),r=N.cssHooks[e],"cssFloat"===(e=N.cssProps[e]||e)&&(e="float"),r&&"get"in r&&(i=r.get(t,!0,n))!==O?i:ht?ht(t,e):void 0},swap:function(t,e,n){var i={};for(var r in e)i[r]=t.style[r],t.style[r]=e[r];for(r in n.call(t),e)t.style[r]=i[r]}}),N.curCSS=N.css,N.each(["height","width"],function(t,r){N.cssHooks[r]={get:function(t,e,n){var i;if(e)return 0!==t.offsetWidth?Et(t,r,n):(N.swap(t,wt,function(){i=Et(t,r,n)}),i)},set:function(t,e){return yt.test(e)?0<=(e=parseFloat(e))?e+"px":void 0:e}}}),N.support.opacity||(N.cssHooks.opacity={get:function(t,e){return mt.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100+"":e?"1":""},set:function(t,e){var n=t.style,i=t.currentStyle,r=N.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=i&&i.filter||n.filter||"";(n.zoom=1)<=e&&""===N.trim(o.replace(pt,""))&&(n.removeAttribute("filter"),i&&!i.filter)||(n.filter=pt.test(o)?o.replace(pt,r):o+" "+r)}}),N(function(){N.support.reliableMarginRight||(N.cssHooks.marginRight={get:function(t,e){var n;return N.swap(t,{display:"inline-block"},function(){n=e?ht(t,"margin-right","marginRight"):t.style.marginRight}),n}})}),R.defaultView&&R.defaultView.getComputedStyle&&(dt=function(t,e){var n,i,r;return e=e.replace(gt,"-$1").toLowerCase(),(i=t.ownerDocument.defaultView)&&(r=i.getComputedStyle(t,null))&&(""!==(n=r.getPropertyValue(e))||N.contains(t.ownerDocument.documentElement,t)||(n=N.style(t,e))),n}),R.documentElement.currentStyle&&(ft=function(t,e){var n,i,r,o=t.currentStyle&&t.currentStyle[e],s=t.style;return null===o&&s&&(r=s[e])&&(o=r),!yt.test(o)&&vt.test(o)&&(n=s.left,(i=t.runtimeStyle&&t.runtimeStyle.left)&&(t.runtimeStyle.left=t.currentStyle.left),s.left="fontSize"===e?"1em":o||0,o=s.pixelLeft+"px",s.left=n,i&&(t.runtimeStyle.left=i)),""===o?"auto":o}),ht=dt||ft,N.expr&&N.expr.filters&&(N.expr.filters.hidden=function(t){var e=t.offsetWidth,n=t.offsetHeight;return 0===e&&0===n||!N.support.reliableHiddenOffsets&&"none"===(t.style&&t.style.display||N.css(t,"display"))},N.expr.filters.visible=function(t){return!N.expr.filters.hidden(t)});var Ct,Tt,Nt=/%20/g,kt=/\[\]$/,_t=/\r?\n/g,At=/#.*$/,Bt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Mt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Pt=/^(?:GET|HEAD)$/,Ot=/^\/\//,Rt=/\?/,Dt=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Lt=/^(?:select|textarea)/i,It=/\s+/,Ut=/([?&])_=[^&]*/,$t=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Ft=N.fn.load,Vt={},Gt={},Ht=["*/"]+["*"];try{Ct=t.href}catch(t){(Ct=R.createElement("a")).href="",Ct=Ct.href}function jt(a){return function(t,e){if("string"!=typeof t&&(e=t,t="*"),N.isFunction(e))for(var n,i,r=t.toLowerCase().split(It),o=0,s=r.length;o<s;o++)n=r[o],(i=/^\+/.test(n))&&(n=n.substr(1)||"*"),(a[n]=a[n]||[])[i?"unshift":"push"](e)}}function zt(t,e,n,i,r,o){(o=o||{})[r=r||e.dataTypes[0]]=!0;for(var s,a=t[r],l=0,c=a?a.length:0,u=t===Vt;l<c&&(u||!s);l++)"string"==typeof(s=a[l](e,n,i))&&(s=!u||o[s]?O:(e.dataTypes.unshift(s),zt(t,e,n,i,s,o)));return!u&&s||o["*"]||(s=zt(t,e,n,i,"*",o)),s}function qt(t,e){var n,i,r=N.ajaxSettings.flatOptions||{};for(n in e)e[n]!==O&&((r[n]?t:i||(i={}))[n]=e[n]);i&&N.extend(!0,t,i)}function Wt(n,t,i,r){if(N.isArray(t))N.each(t,function(t,e){i||kt.test(n)?r(n,e):Wt(n+"["+("object"==typeof e||N.isArray(e)?t:"")+"]",e,i,r)});else if(i||null==t||"object"!=typeof t)r(n,t);else for(var e in t)Wt(n+"["+e+"]",t[e],i,r)}Tt=$t.exec(Ct.toLowerCase())||[],N.fn.extend({load:function(t,e,i){if("string"!=typeof t&&Ft)return Ft.apply(this,arguments);if(!this.length)return this;var n=t.indexOf(" ");if(0<=n){var r=t.slice(n,t.length);t=t.slice(0,n)}var o="GET";e&&(N.isFunction(e)?(i=e,e=O):"object"==typeof e&&(e=N.param(e,N.ajaxSettings.traditional),o="POST"));var s=this;return N.ajax({url:t,type:o,dataType:"html",data:e,complete:function(t,e,n){n=t.responseText,t.isResolved()&&(t.done(function(t){n=t}),s.html(r?N("<div>").append(n.replace(Dt,"")).find(r):n)),i&&s.each(i,[n,e,t])}}),this},serialize:function(){return N.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?N.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Lt.test(this.nodeName)||Mt.test(this.type))}).map(function(t,n){var e=N(this).val();return null==e?null:N.isArray(e)?N.map(e,function(t,e){return{name:n.name,value:t.replace(_t,"\r\n")}}):{name:n.name,value:e.replace(_t,"\r\n")}}).get()}}),N.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){N.fn[e]=function(t){return this.on(e,t)}}),N.each(["get","post"],function(t,r){N[r]=function(t,e,n,i){return N.isFunction(e)&&(i=i||n,n=e,e=O),N.ajax({type:r,url:t,data:e,success:n,dataType:i})}}),N.extend({getScript:function(t,e){return N.get(t,O,e,"script")},getJSON:function(t,e,n){return N.get(t,e,n,"json")},ajaxSetup:function(t,e){return e?qt(t,N.ajaxSettings):(e=t,t=N.ajaxSettings),qt(t,e),t},ajaxSettings:{url:Ct,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Tt[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Ht},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":P.String,"text html":!0,"text json":N.parseJSON,"text xml":N.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:jt(Vt),ajaxTransport:jt(Gt),ajax:function(t,e){"object"==typeof t&&(e=t,t=O),e=e||{};var h,d,n,f,p,i,m,r,g=N.ajaxSetup({},e),y=g.context||g,v=y!==g&&(y.nodeType||y instanceof N)?N(y):N.event,b=N.Deferred(),w=N.Callbacks("once memory"),x=g.statusCode||{},o={},s={},S=0,E={readyState:0,setRequestHeader:function(t,e){if(!S){var n=t.toLowerCase();t=s[n]=s[n]||t,o[t]=e}return this},getAllResponseHeaders:function(){return 2===S?d:null},getResponseHeader:function(t){var e;if(2===S){if(!n)for(n={};e=Bt.exec(d);)n[e[1].toLowerCase()]=e[2];e=n[t.toLowerCase()]}return e===O?null:e},overrideMimeType:function(t){return S||(g.mimeType=t),this},abort:function(t){return t=t||"abort",f&&f.abort(t),a(0,t),this}};function a(t,e,n,i){if(2!==S){S=2,p&&clearTimeout(p),f=O,d=i||"",E.readyState=0<t?4:0;var r,o,s,a,l,c=e,u=n?function(t,e,n){var i,r,o,s,a=t.contents,l=t.dataTypes,c=t.responseFields;for(r in c)r in n&&(e[c[r]]=n[r]);for(;"*"===l[0];)l.shift(),i===O&&(i=t.mimeType||e.getResponseHeader("content-type"));if(i)for(r in a)if(a[r]&&a[r].test(i)){l.unshift(r);break}if(l[0]in n)o=l[0];else{for(r in n){if(!l[0]||t.converters[r+" "+l[0]]){o=r;break}s||(s=r)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),n[o]}(g,E,n):O;if(200<=t&&t<300||304===t)if(g.ifModified&&((a=E.getResponseHeader("Last-Modified"))&&(N.lastModified[h]=a),(l=E.getResponseHeader("Etag"))&&(N.etag[h]=l)),304===t)c="notmodified",r=!0;else try{o=function(t,e){t.dataFilter&&(e=t.dataFilter(e,t.dataType));var n,i,r,o,s,a,l,c,u=t.dataTypes,h={},d=u.length,f=u[0];for(n=1;n<d;n++){if(1===n)for(i in t.converters)"string"==typeof i&&(h[i.toLowerCase()]=t.converters[i]);if(o=f,"*"===(f=u[n]))f=o;else if("*"!==o&&o!==f){if(!(a=h[s=o+" "+f]||h["* "+f]))for(l in c=O,h)if(((r=l.split(" "))[0]===o||"*"===r[0])&&(c=h[r[1]+" "+f])){!0===(l=h[l])?a=c:!0===c&&(a=l);break}a||c||N.error("No conversion from "+s.replace(" "," to ")),!0!==a&&(e=a?a(e):c(l(e)))}}return e}(g,u),c="success",r=!0}catch(t){c="parsererror",s=t}else(s=c)&&!t||(c="error",t<0&&(t=0));E.status=t,E.statusText=""+(e||c),r?b.resolveWith(y,[o,c,E]):b.rejectWith(y,[E,c,s]),E.statusCode(x),x=O,m&&v.trigger("ajax"+(r?"Success":"Error"),[E,g,r?o:s]),w.fireWith(y,[E,c]),m&&(v.trigger("ajaxComplete",[E,g]),--N.active||N.event.trigger("ajaxStop"))}}if(b.promise(E),E.success=E.done,E.error=E.fail,E.complete=w.add,E.statusCode=function(t){var e;if(t)if(S<2)for(e in t)x[e]=[x[e],t[e]];else e=t[E.status],E.then(e,e);return this},g.url=((t||g.url)+"").replace(At,"").replace(Ot,Tt[1]+"//"),g.dataTypes=N.trim(g.dataType||"*").toLowerCase().split(It),null==g.crossDomain&&(i=$t.exec(g.url.toLowerCase()),g.crossDomain=!(!i||i[1]==Tt[1]&&i[2]==Tt[2]&&(i[3]||("http:"===i[1]?80:443))==(Tt[3]||("http:"===Tt[1]?80:443)))),g.data&&g.processData&&"string"!=typeof g.data&&(g.data=N.param(g.data,g.traditional)),zt(Vt,g,e,E),2===S)return!1;if(m=g.global,g.type=g.type.toUpperCase(),g.hasContent=!Pt.test(g.type),m&&0==N.active++&&N.event.trigger("ajaxStart"),!g.hasContent&&(g.data&&(g.url+=(Rt.test(g.url)?"&":"?")+g.data,delete g.data),h=g.url,!1===g.cache)){var l=N.now(),c=g.url.replace(Ut,"$1_="+l);g.url=c+(c===g.url?(Rt.test(g.url)?"&":"?")+"_="+l:"")}for(r in(g.data&&g.hasContent&&!1!==g.contentType||e.contentType)&&E.setRequestHeader("Content-Type",g.contentType),g.ifModified&&(h=h||g.url,N.lastModified[h]&&E.setRequestHeader("If-Modified-Since",N.lastModified[h]),N.etag[h]&&E.setRequestHeader("If-None-Match",N.etag[h])),E.setRequestHeader("Accept",g.dataTypes[0]&&g.accepts[g.dataTypes[0]]?g.accepts[g.dataTypes[0]]+("*"!==g.dataTypes[0]?", "+Ht+"; q=0.01":""):g.accepts["*"]),g.headers)E.setRequestHeader(r,g.headers[r]);if(g.beforeSend&&(!1===g.beforeSend.call(y,E,g)||2===S))return E.abort(),!1;for(r in{success:1,error:1,complete:1})E[r](g[r]);if(f=zt(Gt,g,e,E)){E.readyState=1,m&&v.trigger("ajaxSend",[E,g]),g.async&&0<g.timeout&&(p=setTimeout(function(){E.abort("timeout")},g.timeout));try{S=1,f.send(o,a)}catch(t){if(!(S<2))throw t;a(-1,t)}}else a(-1,"No Transport");return E},param:function(t,e){var n=[],i=function(t,e){e=N.isFunction(e)?e():e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(e===O&&(e=N.ajaxSettings.traditional),N.isArray(t)||t.jquery&&!N.isPlainObject(t))N.each(t,function(){i(this.name,this.value)});else for(var r in t)Wt(r,t[r],e,i);return n.join("&").replace(Nt,"+")}}),N.extend({active:0,lastModified:{},etag:{}});var Yt=N.now(),Xt=/(\=)\?(&|$)|\?\?/i;N.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return N.expando+"_"+Yt++}}),N.ajaxPrefilter("json jsonp",function(t,e,n){var i="application/x-www-form-urlencoded"===t.contentType&&"string"==typeof t.data;if("jsonp"===t.dataTypes[0]||!1!==t.jsonp&&(Xt.test(t.url)||i&&Xt.test(t.data))){var r,o=t.jsonpCallback=N.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s=P[o],a=t.url,l=t.data,c="$1"+o+"$2";return!1!==t.jsonp&&(a=a.replace(Xt,c),t.url===a&&(i&&(l=l.replace(Xt,c)),t.data===l&&(a+=(/\?/.test(a)?"&":"?")+t.jsonp+"="+o))),t.url=a,t.data=l,P[o]=function(t){r=[t]},n.always(function(){P[o]=s,r&&N.isFunction(s)&&P[o](r[0])}),t.converters["script json"]=function(){return r||N.error(o+" was not called"),r[0]},t.dataTypes[0]="json","script"}}),N.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return N.globalEval(t),t}}}),N.ajaxPrefilter("script",function(t){t.cache===O&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),N.ajaxTransport("script",function(e){if(e.crossDomain){var i,r=R.head||R.getElementsByTagName("head")[0]||R.documentElement;return{send:function(t,n){(i=R.createElement("script")).async="async",e.scriptCharset&&(i.charset=e.scriptCharset),i.src=e.url,i.onload=i.onreadystatechange=function(t,e){(e||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,r&&i.parentNode&&r.removeChild(i),i=O,e||n(200,"success"))},r.insertBefore(i,r.firstChild)},abort:function(){i&&i.onload(0,1)}}}});var Kt,Jt,Qt=!!P.ActiveXObject&&function(){for(var t in Kt)Kt[t](0,1)},Zt=0;function te(){try{return new P.XMLHttpRequest}catch(t){}}N.ajaxSettings.xhr=P.ActiveXObject?function(){return!this.isLocal&&te()||function(){try{return new P.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}()}:te,Jt=N.ajaxSettings.xhr(),N.extend(N.support,{ajax:!!Jt,cors:!!Jt&&"withCredentials"in Jt}),N.support.ajax&&N.ajaxTransport(function(u){var h;if(!u.crossDomain||N.support.cors)return{send:function(t,a){var l,e,c=u.xhr();if(u.username?c.open(u.type,u.url,u.async,u.username,u.password):c.open(u.type,u.url,u.async),u.xhrFields)for(e in u.xhrFields)c[e]=u.xhrFields[e];u.mimeType&&c.overrideMimeType&&c.overrideMimeType(u.mimeType),u.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest");try{for(e in t)c.setRequestHeader(e,t[e])}catch(t){}c.send(u.hasContent&&u.data||null),h=function(t,e){var n,i,r,o,s;try{if(h&&(e||4===c.readyState))if(h=O,l&&(c.onreadystatechange=N.noop,Qt&&delete Kt[l]),e)4!==c.readyState&&c.abort();else{n=c.status,r=c.getAllResponseHeaders(),o={},(s=c.responseXML)&&s.documentElement&&(o.xml=s),o.text=c.responseText;try{i=c.statusText}catch(t){i=""}n||!u.isLocal||u.crossDomain?1223===n&&(n=204):n=o.text?200:404}}catch(t){e||a(-1,t)}o&&a(n,i,o,r)},u.async&&4!==c.readyState?(l=++Zt,Qt&&(Kt||(Kt={},N(P).unload(Qt)),Kt[l]=h),c.onreadystatechange=h):h()},abort:function(){h&&h(0,1)}}});var ee,ne,ie,re,oe={},se=/^(?:toggle|show|hide)$/,ae=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,le=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function ce(){return setTimeout(ue,0),re=N.now()}function ue(){re=O}function he(t,e){var n={};return N.each(le.concat.apply([],le.slice(0,e)),function(){n[this]=t}),n}function de(t){if(!oe[t]){var e=R.body,n=N("<"+t+">").appendTo(e),i=n.css("display");n.remove(),"none"!==i&&""!==i||(ee||((ee=R.createElement("iframe")).frameBorder=ee.width=ee.height=0),e.appendChild(ee),ne&&ee.createElement||((ne=(ee.contentWindow||ee.contentDocument).document).write(("CSS1Compat"===R.compatMode?"<!doctype html>":"")+"<html><body>"),ne.close()),n=ne.createElement(t),ne.body.appendChild(n),i=N.css(n,"display"),e.removeChild(ee)),oe[t]=i}return oe[t]}N.fn.extend({show:function(t,e,n){var i,r;if(t||0===t)return this.animate(he("show",3),t,e,n);for(var o=0,s=this.length;o<s;o++)(i=this[o]).style&&(r=i.style.display,N._data(i,"olddisplay")||"none"!==r||(r=i.style.display=""),""===r&&"none"===N.css(i,"display")&&N._data(i,"olddisplay",de(i.nodeName)));for(o=0;o<s;o++)(i=this[o]).style&&(""!==(r=i.style.display)&&"none"!==r||(i.style.display=N._data(i,"olddisplay")||""));return this},hide:function(t,e,n){if(t||0===t)return this.animate(he("hide",3),t,e,n);for(var i,r,o=0,s=this.length;o<s;o++)(i=this[o]).style&&("none"===(r=N.css(i,"display"))||N._data(i,"olddisplay")||N._data(i,"olddisplay",r));for(o=0;o<s;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:N.fn.toggle,toggle:function(e,t,n){var i="boolean"==typeof e;return N.isFunction(e)&&N.isFunction(t)?this._toggle.apply(this,arguments):null==e||i?this.each(function(){var t=i?e:N(this).is(":hidden");N(this)[t?"show":"hide"]()}):this.animate(he("toggle",3),e,t,n),this},fadeTo:function(t,e,n,i){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(d,t,e,n){var f=N.speed(t,e,n);if(N.isEmptyObject(d))return this.each(f.complete,[!1]);function i(){!1===f.queue&&N._mark(this);var t,e,n,i,r,o,s,a,l,c=N.extend({},f),u=1===this.nodeType,h=u&&N(this).is(":hidden");for(n in c.animatedProperties={},d){if(n!==(t=N.camelCase(n))&&(d[t]=d[n],delete d[n]),e=d[t],N.isArray(e)?(c.animatedProperties[t]=e[1],e=d[t]=e[0]):c.animatedProperties[t]=c.specialEasing&&c.specialEasing[t]||c.easing||"swing","hide"===e&&h||"show"===e&&!h)return c.complete.call(this);!u||"height"!==t&&"width"!==t||(c.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===N.css(this,"display")&&"none"===N.css(this,"float")&&(N.support.inlineBlockNeedsLayout&&"inline"!==de(this.nodeName)?this.style.zoom=1:this.style.display="inline-block"))}for(n in null!=c.overflow&&(this.style.overflow="hidden"),d)i=new N.fx(this,c,n),e=d[n],se.test(e)?(l=N._data(this,"toggle"+n)||("toggle"===e?h?"show":"hide":0))?(N._data(this,"toggle"+n,"show"===l?"hide":"show"),i[l]()):i[e]():(r=ae.exec(e),o=i.cur(),r?(s=parseFloat(r[2]),"px"!==(a=r[3]||(N.cssNumber[n]?"":"px"))&&(N.style(this,n,(s||1)+a),o=(s||1)/i.cur()*o,N.style(this,n,o+a)),r[1]&&(s=("-="===r[1]?-1:1)*s+o),i.custom(o,s,a)):i.custom(o,e,""));return!0}return d=N.extend({},d),!1===f.queue?this.each(i):this.queue(f.queue,i)},stop:function(o,t,s){return"string"!=typeof o&&(s=t,t=o,o=O),t&&!1!==o&&this.queue(o||"fx",[]),this.each(function(){var t,e=!1,n=N.timers,i=N._data(this);function r(t,e,n){var i=e[n];N.removeData(t,n,!0),i.stop(s)}if(s||N._unmark(!0,this),null==o)for(t in i)i[t]&&i[t].stop&&t.indexOf(".run")===t.length-4&&r(this,i,t);else i[t=o+".run"]&&i[t].stop&&r(this,i,t);for(t=n.length;t--;)n[t].elem!==this||null!=o&&n[t].queue!==o||(s?n[t](!0):n[t].saveState(),e=!0,n.splice(t,1));s&&e||N.dequeue(this,o)})}}),N.each({slideDown:he("show",1),slideUp:he("hide",1),slideToggle:he("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,i){N.fn[t]=function(t,e,n){return this.animate(i,t,e,n)}}),N.extend({speed:function(t,e,n){var i=t&&"object"==typeof t?N.extend({},t):{complete:n||!n&&e||N.isFunction(t)&&t,duration:t,easing:n&&e||e&&!N.isFunction(e)&&e};return i.duration=N.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in N.fx.speeds?N.fx.speeds[i.duration]:N.fx.speeds._default,null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(t){N.isFunction(i.old)&&i.old.call(this),i.queue?N.dequeue(this,i.queue):!1!==t&&N._unmark(this)},i},easing:{linear:function(t,e,n,i){return n+i*t},swing:function(t,e,n,i){return(-Math.cos(t*Math.PI)/2+.5)*i+n}},timers:[],fx:function(t,e,n){this.options=e,this.elem=t,this.prop=n,e.orig=e.orig||{}}}),N.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(N.fx.step[this.prop]||N.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var t,e=N.css(this.elem,this.prop);return isNaN(t=parseFloat(e))?e&&"auto"!==e?e:0:t},custom:function(t,e,n){var i=this,r=N.fx;function o(t){return i.step(t)}this.startTime=re||ce(),this.end=e,this.now=this.start=t,this.pos=this.state=0,this.unit=n||this.unit||(N.cssNumber[this.prop]?"":"px"),o.queue=this.options.queue,o.elem=this.elem,o.saveState=function(){i.options.hide&&N._data(i.elem,"fxshow"+i.prop)===O&&N._data(i.elem,"fxshow"+i.prop,i.start)},o()&&N.timers.push(o)&&!ie&&(ie=setInterval(r.tick,r.interval))},show:function(){var t=N._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=t||N.style(this.elem,this.prop),this.options.show=!0,t!==O?this.custom(this.cur(),t):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),N(this.elem).show()},hide:function(){this.options.orig[this.prop]=N._data(this.elem,"fxshow"+this.prop)||N.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e,n,i,r=re||ce(),o=!0,s=this.elem,a=this.options;if(t||r>=a.duration+this.startTime){for(e in this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0,a.animatedProperties)!0!==a.animatedProperties[e]&&(o=!1);if(o){if(null==a.overflow||N.support.shrinkWrapBlocks||N.each(["","X","Y"],function(t,e){s.style["overflow"+e]=a.overflow[t]}),a.hide&&N(s).hide(),a.hide||a.show)for(e in a.animatedProperties)N.style(s,e,a.orig[e]),N.removeData(s,"fxshow"+e,!0),N.removeData(s,"toggle"+e,!0);(i=a.complete)&&(a.complete=!1,i.call(s))}return!1}return a.duration==1/0?this.now=r:(n=r-this.startTime,this.state=n/a.duration,this.pos=N.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},N.extend(N.fx,{tick:function(){for(var t,e=N.timers,n=0;n<e.length;n++)(t=e[n])()||e[n]!==t||e.splice(n--,1);e.length||N.fx.stop()},interval:13,stop:function(){clearInterval(ie),ie=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){N.style(t.elem,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=t.now+t.unit:t.elem[t.prop]=t.now}}}),N.each(["width","height"],function(t,e){N.fx.step[e]=function(t){N.style(t.elem,e,Math.max(0,t.now)+t.unit)}}),N.expr&&N.expr.filters&&(N.expr.filters.animated=function(e){return N.grep(N.timers,function(t){return e===t.elem}).length});var fe=/^t(?:able|d|h)$/i,pe=/^(?:body|html)$/i;function me(t){return N.isWindow(t)?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}"getBoundingClientRect"in R.documentElement?N.fn.offset=function(e){var t,n=this[0];if(e)return this.each(function(t){N.offset.setOffset(this,e,t)});if(!n||!n.ownerDocument)return null;if(n===n.ownerDocument.body)return N.offset.bodyOffset(n);try{t=n.getBoundingClientRect()}catch(t){}var i=n.ownerDocument,r=i.documentElement;if(!t||!N.contains(r,n))return t?{top:t.top,left:t.left}:{top:0,left:0};var o=i.body,s=me(i),a=r.clientTop||o.clientTop||0,l=r.clientLeft||o.clientLeft||0,c=s.pageYOffset||N.support.boxModel&&r.scrollTop||o.scrollTop,u=s.pageXOffset||N.support.boxModel&&r.scrollLeft||o.scrollLeft;return{top:t.top+c-a,left:t.left+u-l}}:N.fn.offset=function(e){var t=this[0];if(e)return this.each(function(t){N.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return N.offset.bodyOffset(t);for(var n,i=t.offsetParent,r=t.ownerDocument,o=r.documentElement,s=r.body,a=r.defaultView,l=a?a.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,u=t.offsetLeft;(t=t.parentNode)&&t!==s&&t!==o&&(!N.support.fixedPosition||"fixed"!==l.position);)n=a?a.getComputedStyle(t,null):t.currentStyle,c-=t.scrollTop,u-=t.scrollLeft,t===i&&(c+=t.offsetTop,u+=t.offsetLeft,!N.support.doesNotAddBorder||N.support.doesAddBorderForTableAndCells&&fe.test(t.nodeName)||(c+=parseFloat(n.borderTopWidth)||0,u+=parseFloat(n.borderLeftWidth)||0),i,i=t.offsetParent),N.support.subtractsBorderForOverflowNotVisible&&"visible"!==n.overflow&&(c+=parseFloat(n.borderTopWidth)||0,u+=parseFloat(n.borderLeftWidth)||0),l=n;return"relative"!==l.position&&"static"!==l.position||(c+=s.offsetTop,u+=s.offsetLeft),N.support.fixedPosition&&"fixed"===l.position&&(c+=Math.max(o.scrollTop,s.scrollTop),u+=Math.max(o.scrollLeft,s.scrollLeft)),{top:c,left:u}},N.offset={bodyOffset:function(t){var e=t.offsetTop,n=t.offsetLeft;return N.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(N.css(t,"marginTop"))||0,n+=parseFloat(N.css(t,"marginLeft"))||0),{top:e,left:n}},setOffset:function(t,e,n){var i=N.css(t,"position");"static"===i&&(t.style.position="relative");var r,o,s=N(t),a=s.offset(),l=N.css(t,"top"),c=N.css(t,"left"),u={},h={};o=("absolute"===i||"fixed"===i)&&-1<N.inArray("auto",[l,c])?(r=(h=s.position()).top,h.left):(r=parseFloat(l)||0,parseFloat(c)||0),N.isFunction(e)&&(e=e.call(t,n,a)),null!=e.top&&(u.top=e.top-a.top+r),null!=e.left&&(u.left=e.left-a.left+o),"using"in e?e.using.call(t,u):s.css(u)}},N.fn.extend({position:function(){if(!this[0])return null;var t=this[0],e=this.offsetParent(),n=this.offset(),i=pe.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(N.css(t,"marginTop"))||0,n.left-=parseFloat(N.css(t,"marginLeft"))||0,i.top+=parseFloat(N.css(e[0],"borderTopWidth"))||0,i.left+=parseFloat(N.css(e[0],"borderLeftWidth"))||0,{top:n.top-i.top,left:n.left-i.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||R.body;t&&!pe.test(t.nodeName)&&"static"===N.css(t,"position");)t=t.offsetParent;return t})}}),N.each(["Left","Top"],function(i,t){var r="scroll"+t;N.fn[r]=function(t){var e,n;return t===O?(e=this[0])?(n=me(e))?"pageXOffset"in n?n[i?"pageYOffset":"pageXOffset"]:N.support.boxModel&&n.document.documentElement[r]||n.document.body[r]:e[r]:null:this.each(function(){(n=me(this))?n.scrollTo(i?N(n).scrollLeft():t,i?t:N(n).scrollTop()):this[r]=t})}}),N.each(["Height","Width"],function(t,s){var a=s.toLowerCase();N.fn["inner"+s]=function(){var t=this[0];return t?t.style?parseFloat(N.css(t,a,"padding")):this[a]():null},N.fn["outer"+s]=function(t){var e=this[0];return e?e.style?parseFloat(N.css(e,a,t?"margin":"border")):this[a]():null},N.fn[a]=function(n){var t=this[0];if(!t)return null==n?null:this;if(N.isFunction(n))return this.each(function(t){var e=N(this);e[a](n.call(this,t,e[a]()))});if(N.isWindow(t)){var e=t.document.documentElement["client"+s],i=t.document.body;return"CSS1Compat"===t.document.compatMode&&e||i&&i["client"+s]||e}if(9===t.nodeType)return Math.max(t.documentElement["client"+s],t.body["scroll"+s],t.documentElement["scroll"+s],t.body["offset"+s],t.documentElement["offset"+s]);if(n!==O)return this.css(a,"string"==typeof n?n:n+"px");var r=N.css(t,a),o=parseFloat(r);return N.isNumeric(o)?o:r}}),P.jQuery=P.$=N,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return N})}(window),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(a){if(!a.support.cors&&a.ajaxTransport&&window.XDomainRequest){var e=/^https?:\/\//i,r=/^get|post$/i,o=new RegExp("^"+location.protocol,"i");a.ajaxTransport("* text html xml json",function(n,i,t){if(n.crossDomain&&n.async&&r.test(n.type)&&e.test(n.url)&&o.test(n.url)){var s=null;return{send:function(t,r){var e="",o=(i.dataType||"").toLowerCase();s=new XDomainRequest,/^\d+$/.test(i.timeout)&&(s.timeout=i.timeout),s.ontimeout=function(){r(500,"timeout")},s.onload=function(){var t="Content-Length: "+s.responseText.length+"\r\nContent-Type: "+s.contentType,e={code:200,message:"success"},n={text:s.responseText};try{if("html"===o||/text\/html/i.test(s.contentType))n.html=s.responseText;else if("json"===o||"text"!==o&&/\/json/i.test(s.contentType))try{n.json=a.parseJSON(s.responseText)}catch(t){e.code=500,e.message="parseerror"}else if("xml"===o||"text"!==o&&/\/xml/i.test(s.contentType)){var i=new ActiveXObject("Microsoft.XMLDOM");i.async=!1;try{i.loadXML(s.responseText)}catch(t){i=void 0}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw e.code=500,e.message="parseerror","Invalid XML: "+s.responseText;n.xml=i}}catch(t){throw t}finally{r(e.code,e.message,n,t)}},s.onprogress=function(){},s.onerror=function(){r(500,"error",{text:s.responseText})},i.data&&(e="string"===a.type(i.data)?i.data:a.param(i.data)),s.open(n.type,n.url),s.send(e)},abort:function(){s&&s.abort()}}}})}}),function(l,t,c,u){var n="showAlert",i={parent:"body",width:"456px",background:"#FFFFFF",infoType:"fontSize",fontSize:14,fontFamily:"Arial",html:'<div class="font-alert-shade"><div class="font-alert-wrap" id="font_alert_wrap"><div class="alert-header">InDraw</div><div class="body-wrap"><div class="alert-body"><p>No alert information!</p></div><div class="alert-foot"><div class="foot-buttons"><button class="default">'+(t.langEn?"Yes":"æ¯(Y)")+'</button><button class="no">'+(t.langEn?"No":"å¦(N)")+"</button></div></div></div></div></div>",toInsertInfo:"ä¿®æ¹åçåå­ç»æä¸çå­ä½{{key}}ä¸º {{value}} , æ¨å¸ææ­¤æä½å½±ååç»­ç»å¶çåå­ç»æå?",callback_yes:u,callback_no:u,callback_other:!0};function e(t,e){this.element=t,this.settings=l.extend({},i,e),this._defaults=i,this._name=n,this.version="v1.0",this.init()}e.prototype={init:function(){if(l(this.settings.html).appendTo(this.settings.parent),"fontSize"==this.settings.infoType)var t=this.settings.toInsertInfo.replace("{{key}}","å¤§å°").replace("{{value}}",this.settings.fontSize+"px");else t=this.settings.toInsertInfo.replace("{{key}}","ç±»å").replace("{{value}}",this.settings.fontFamily);l("#font_alert_wrap .alert-body p").text(t),l(".font-alert-shade").css("display","block"),l("#font_alert_wrap").fadeIn(300),this.registerEvent()},registerEvent:function(){var o,s,a=!1,t="."+this._name;l(c).off(t),l(c).on("mousedown"+t,"#font_alert_wrap .alert-header",function(t){a=!0,o=t.clientX-l("#font_alert_wrap").offset().left,s=t.clientY-l("#font_alert_wrap").offset().top}),l(c).on("mousemove"+t,function(t){var e=l("#font_alert_wrap").width(),n=l("#font_alert_wrap").height();if(a&&o!==u&&s!==u){if(t.clientX-o<0)var i="0px";else if(t.clientX-o+e>l(c).width())i=l(c).width()-e+"px";else i=t.clientX-o+"px";if(t.clientY-s<0)var r="0px";else if(t.clientY-s+n>l(c).height())r=l(c).height()-n+"px";else r=t.clientY-s+"px";l("#font_alert_wrap").css("left",i).css("top",r)}}),l(c).on("mouseup"+t,function(t){a&&(a=!1)});var e=this;l(c).on("click"+t,"#font_alert_wrap .foot-buttons .default",function(t){e.settings.callback_yes!==u&&e.settings.callback_yes(),l("#font_alert_wrap").fadeOut(300,function(){l(".font-alert-shade").fadeOut(100)})}),l(c).on("click"+t,"#font_alert_wrap .foot-buttons .no",function(t){e.settings.callback_no!==u&&e.settings.callback_no(),l("#font_alert_wrap").fadeOut(300,function(){l(".font-alert-shade").fadeOut(100)})}),l(".font-alert-shade").off(t),e.settings.callback_other&&l(".font-alert-shade").on("click"+t,function(t){0===l(t.target).closest("#font_alert_wrap").length&&l(this).fadeOut("300")})}},l.fn[n]=function(t){0==l("#font_alert_wrap").length||l("#font_alert_wrap").remove(),new e(this,t)}}(jQuery,window,document),window._indraw={},function(t){var z=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],q=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function c(t,e,n,i,r,o){if(!(isNaN(o)||o<1)){o|=0;var s,a=document.getElementById(t).getContext("2d");try{try{s=a.getImageData(e,n,i,r)}catch(t){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),s=a.getImageData(e,n,i,r)}catch(t){throw alert("Cannot access local image"),new Error("unable to access local image data: "+t)}}}catch(t){throw alert("Cannot access image"),new Error("unable to access image data: "+t)}!function(t){for(var e=t.data,n=t.width*t.height*4,i=0;i<n;i+=4){var r=e[i+3]/255;e[i]*=r,e[i+1]*=r,e[i+2]*=r}}(s);var l,c,u,h,d,f,p,m,g,y,v,b,w,x,S,E,C,T,N,k,_,A,B,M,P=s.data,O=o+o+1,R=i-1,D=r-1,L=o+1,I=L*(L+1)/2,U=new W,$=U;for(u=1;u<O;u++)if($=$.next=new W,u==L)var F=$;$.next=U;var V=null,G=null;p=f=0;var H=z[o],j=q[o];for(c=0;c<r;c++){for(E=C=T=N=m=g=y=v=0,b=L*(k=P[f]),w=L*(_=P[f+1]),x=L*(A=P[f+2]),S=L*(B=P[f+3]),m+=I*k,g+=I*_,y+=I*A,v+=I*B,$=U,u=0;u<L;u++)$.r=k,$.g=_,$.b=A,$.a=B,$=$.next;for(u=1;u<L;u++)h=f+((R<u?R:u)<<2),m+=($.r=k=P[h])*(M=L-u),g+=($.g=_=P[h+1])*M,y+=($.b=A=P[h+2])*M,v+=($.a=B=P[h+3])*M,E+=k,C+=_,T+=A,N+=B,$=$.next;for(V=U,G=F,l=0;l<i;l++)P[f]=m*H>>j,P[f+1]=g*H>>j,P[f+2]=y*H>>j,P[f+3]=v*H>>j,m-=b,g-=w,y-=x,v-=S,b-=V.r,w-=V.g,x-=V.b,S-=V.a,h=p+((h=l+o+1)<R?h:R)<<2,m+=E+=V.r=P[h],g+=C+=V.g=P[h+1],y+=T+=V.b=P[h+2],v+=N+=V.a=P[h+3],V=V.next,b+=k=G.r,w+=_=G.g,x+=A=G.b,S+=B=G.a,E-=k,C-=_,T-=A,N-=B,G=G.next,f+=4;p+=i}for(l=0;l<i;l++){for(C=T=N=E=g=y=v=m=0,b=L*(k=P[f=l<<2]),w=L*(_=P[f+1]),x=L*(A=P[f+2]),S=L*(B=P[f+3]),m+=I*k,g+=I*_,y+=I*A,v+=I*B,$=U,u=0;u<L;u++)$.r=k,$.g=_,$.b=A,$.a=B,$=$.next;for(d=i,u=1;u<=o;u++)f=d+l<<2,m+=($.r=k=P[f])*(M=L-u),g+=($.g=_=P[f+1])*M,y+=($.b=A=P[f+2])*M,v+=($.a=B=P[f+3])*M,E+=k,C+=_,T+=A,N+=B,$=$.next,u<D&&(d+=i);for(f=l,V=U,G=F,c=0;c<r;c++)P[h=f<<2]=m*H>>j,P[h+1]=g*H>>j,P[h+2]=y*H>>j,P[h+3]=v*H>>j,m-=b,g-=w,y-=x,v-=S,b-=V.r,w-=V.g,x-=V.b,S-=V.a,h=l+((h=c+L)<D?h:D)*i<<2,m+=E+=V.r=P[h],g+=C+=V.g=P[h+1],y+=T+=V.b=P[h+2],v+=N+=V.a=P[h+3],V=V.next,b+=k=G.r,w+=_=G.g,x+=A=G.b,S+=B=G.a,E-=k,C-=_,T-=A,N-=B,G=G.next,f+=i}!function(t){for(var e=t.data,n=t.width*t.height*4,i=0;i<n;i+=4){var r=e[i+3];0!=r&&(r=255/r,e[i]*=r,e[i+1]*=r,e[i+2]*=r)}}(s),a.putImageData(s,e,n)}}function u(t,e,n,i,r,o){if(!(isNaN(o)||o<1)){o|=0;var s,a=document.getElementById(t).getContext("2d");try{try{s=a.getImageData(e,n,i,r)}catch(t){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),s=a.getImageData(e,n,i,r)}catch(t){throw alert("Cannot access local image"),new Error("unable to access local image data: "+t)}}}catch(t){throw alert("Cannot access image"),new Error("unable to access image data: "+t)}var l,c,u,h,d,f,p,m,g,y,v,b,w,x,S,E,C,T,N,k,_=s.data,A=o+o+1,B=i-1,M=r-1,P=o+1,O=P*(P+1)/2,R=new W,D=R;for(u=1;u<A;u++)if(D=D.next=new W,u==P)var L=D;D.next=R;var I=null,U=null;p=f=0;var $=z[o],F=q[o];for(c=0;c<r;c++){for(x=S=E=m=g=y=0,v=P*(C=_[f]),b=P*(T=_[f+1]),w=P*(N=_[f+2]),m+=O*C,g+=O*T,y+=O*N,D=R,u=0;u<P;u++)D.r=C,D.g=T,D.b=N,D=D.next;for(u=1;u<P;u++)h=f+((B<u?B:u)<<2),m+=(D.r=C=_[h])*(k=P-u),g+=(D.g=T=_[h+1])*k,y+=(D.b=N=_[h+2])*k,x+=C,S+=T,E+=N,D=D.next;for(I=R,U=L,l=0;l<i;l++)_[f]=m*$>>F,_[f+1]=g*$>>F,_[f+2]=y*$>>F,m-=v,g-=b,y-=w,v-=I.r,b-=I.g,w-=I.b,h=p+((h=l+o+1)<B?h:B)<<2,m+=x+=I.r=_[h],g+=S+=I.g=_[h+1],y+=E+=I.b=_[h+2],I=I.next,v+=C=U.r,b+=T=U.g,w+=N=U.b,x-=C,S-=T,E-=N,U=U.next,f+=4;p+=i}for(l=0;l<i;l++){for(S=E=x=g=y=m=0,v=P*(C=_[f=l<<2]),b=P*(T=_[f+1]),w=P*(N=_[f+2]),m+=O*C,g+=O*T,y+=O*N,D=R,u=0;u<P;u++)D.r=C,D.g=T,D.b=N,D=D.next;for(d=i,u=1;u<=o;u++)f=d+l<<2,m+=(D.r=C=_[f])*(k=P-u),g+=(D.g=T=_[f+1])*k,y+=(D.b=N=_[f+2])*k,x+=C,S+=T,E+=N,D=D.next,u<M&&(d+=i);for(f=l,I=R,U=L,c=0;c<r;c++)_[h=f<<2]=m*$>>F,_[h+1]=g*$>>F,_[h+2]=y*$>>F,m-=v,g-=b,y-=w,v-=I.r,b-=I.g,w-=I.b,h=l+((h=c+P)<M?h:M)*i<<2,m+=x+=I.r=_[h],g+=S+=I.g=_[h+1],y+=E+=I.b=_[h+2],I=I.next,v+=C=U.r,b+=T=U.g,w+=N=U.b,x-=C,S-=T,E-=N,U=U.next,f+=i}a.putImageData(s,e,n)}}function W(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var e={image:function(t,e,n,i){var r=document.getElementById(t),o=r.naturalWidth,s=r.naturalHeight,a=document.getElementById(e);a.style.width=o+"px",a.style.height=s+"px",a.width=o,a.height=s;var l=a.getContext("2d");l.clearRect(0,0,o,s),l.drawImage(r,0,0),isNaN(n)||n<1||(i?c(e,0,0,o,s,n):u(e,0,0,o,s,n))},canvasRGBA:c,canvasRGB:u};"undefined"!=typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports&&(module.exports=e),t.stackBlur=e}("undefined"!=typeof window?window:this),function(t){function d(t){this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase();var u={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var e in u)t==e&&(t=u[e]);for(var h=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],n=0;n<h.length;n++){var i=h[n].re,r=h[n].process,o=i.exec(t);o&&(channels=r(o),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==n.length&&(n="0"+n),"#"+t+e+n},this.getHelpXML=function(){for(var t=new Array,e=0;e<h.length;e++)for(var n=h[e].example,i=0;i<n.length;i++)t[t.length]=n[i];for(var r in u)t[t.length]=r;var o=document.createElement("ul");o.setAttribute("id","rgbcolor-examples");for(e=0;e<t.length;e++)try{var s=document.createElement("li"),a=new d(t[e]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+a.toHex()+"; color:"+a.toHex(),l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+t[e]+" -> "+a.toRGB()+" -> "+a.toHex());s.appendChild(l),s.appendChild(c),o.appendChild(s)}catch(t){}return o}}"undefined"!=typeof define&&define.amd?define(function(){return d}):"undefined"!=typeof module&&module.exports&&(module.exports=d),t.RGBColor=d}("undefined"!=typeof window?window:this),function(){var d;_indraw.canvg=function(t,e,n){if(null!=t||null!=e||null!=n){"string"==typeof t&&(t=document.getElementById(t)),null!=t.svg&&t.svg.stop();var r=function(t){var M={opts:t,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,log:function(t){}};1==M.opts.log&&"undefined"!=typeof console&&(M.log=function(t){});M.init=function(t){var e=0;M.UniqueId=function(){return"canvg"+ ++e},M.Definitions={},M.Styles={},M.StylesSpecificity={},M.Animations=[],M.Images=[],M.ctx=t,M.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},M.init(),M.ImagesLoaded=function(){for(var t=0;t<M.Images.length;t++)if(!M.Images[t].loaded)return!1;return!0},M.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},M.compressSpaces=function(t){return t.replace(/[\s\r\t\n]+/gm," ")},M.ajax=function(t){var e;return(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(e.open("GET",t,!1),e.send(null),e.responseText):null},M.parseXml=function(e){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var t=new Windows.Data.Xml.Dom.XmlDocument,n=new Windows.Data.Xml.Dom.XmlLoadSettings;return n.prohibitDtd=!1,t.loadXml(e,n),t}if(!window.DOMParser){e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{var i=new DOMParser;return i.parseFromString(e,"image/svg+xml")}catch(t){return(i=new DOMParser).parseFromString(e,"text/xml")}},M.Property=function(t,e){this.name=t,this.value=e},M.Property.prototype.getValue=function(){return this.value},M.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},M.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var t=parseFloat(this.value);return(this.value+"").match(/%$/)&&(t/=100),t},M.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},M.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():t},M.Property.prototype.addOpacity=function(t){var e=this.value;if(null!=t.value&&""!=t.value&&"string"==typeof this.value){var n=new RGBColor(this.value);n.ok&&(e="rgba("+n.r+", "+n.g+", "+n.b+", "+t.numValue()+")")}return new M.Property(this.name,e)},M.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),M.Definitions[t]},M.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},M.Property.prototype.getFillStyleDefinition=function(t,e){var n=this.getDefinition();if(null!=n&&n.createGradient)return n.createGradient(M.ctx,t,e);if(null!=n&&n.createPattern){if(n.getHrefAttribute().hasValue()){var i=n.attribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&(n.attribute("patternTransform",!0).value=i.value)}return n.createPattern(M.ctx,t)}return null},M.Property.prototype.getDPI=function(t){return 96},M.Property.prototype.getEM=function(t){var e=12,n=new M.Property("fontSize",M.Font.Parse(M.ctx.font2).fontSize);return n.hasValue()&&(e=n.toPixels(t)),e},M.Property.prototype.getUnits=function(){var t=this.value+"";return t.replace(/[0-9\.\-]/g,"")},M.Property.prototype.toPixels=function(t,e){if(!this.hasValue())return 0;var n=this.value+"";if(n.match(/em$/))return this.numValue()*this.getEM(t);if(n.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(n.match(/px$/))return this.numValue();if(n.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(n.match(/pc$/))return 15*this.numValue();if(n.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(n.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(n.match(/in$/))return this.numValue()*this.getDPI(t);if(n.match(/%$/))return this.numValue()*M.ViewPort.ComputeSize(t);var i=this.numValue();return e&&i<1?i*M.ViewPort.ComputeSize(t):i},M.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/s$/)?1e3*this.numValue():(t.match(/ms$/),this.numValue())},M.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var e={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return M.Property.prototype.toTextBaseline=function(){return this.hasValue()?e[this.value]:null},M.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,e,n,i,r,o){var s=null!=o?this.Parse(o):this.CreateFont("","","","","",M.ctx.font2);return{fontFamily:r||s.fontFamily,fontSize:i||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:n||s.fontWeight,fontVariant:e||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var s=this;this.Parse=function(t){for(var e={},n=M.trim(M.compressSpaces(t||"")).split(" "),i={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},r="",o=0;o<n.length;o++)i.fontStyle||-1==s.Styles.indexOf(n[o])?i.fontVariant||-1==s.Variants.indexOf(n[o])?i.fontWeight||-1==s.Weights.indexOf(n[o])?i.fontSize?"inherit"!=n[o]&&(r+=n[o]):("inherit"!=n[o]&&(e.fontSize=n[o].split("/")[0]),i.fontStyle=i.fontVariant=i.fontWeight=i.fontSize=!0):("inherit"!=n[o]&&(e.fontWeight=n[o]),i.fontStyle=i.fontVariant=i.fontWeight=!0):("inherit"!=n[o]&&(e.fontVariant=n[o]),i.fontStyle=i.fontVariant=!0):("inherit"!=n[o]&&(e.fontStyle=n[o]),i.fontStyle=!0);return""!=r&&(e.fontFamily=r),e}},M.ToNumberArray=function(t){for(var e=M.trim(M.compressSpaces((t||"").replace(/,/g," "))).split(" "),n=0;n<e.length;n++)e[n]=parseFloat(e[n]);return e},M.Point=function(t,e){this.x=t,this.y=e},M.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},M.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],n=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=n},M.CreatePoint=function(t){var e=M.ToNumberArray(t);return new M.Point(e[0],e[1])},M.CreatePath=function(t){for(var e=M.ToNumberArray(t),n=[],i=0;i<e.length;i+=2)n.push(new M.Point(e[i],e[i+1]));return n},M.BoundingBox=function(t,e,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,n,i,r,o){var s=t+2/3*(n-t),a=e+2/3*(i-e),l=s+1/3*(r-t),c=a+1/3*(o-e);this.addBezierCurve(t,e,s,l,a,c,r,o)},this.addBezierCurve=function(t,e,n,r,o,s,a,l){var c=[t,e],u=[n,r],h=[o,s],d=[a,l];for(this.addPoint(c[0],c[1]),this.addPoint(d[0],d[1]),i=0;i<=1;i++){var f=function(t){return Math.pow(1-t,3)*c[i]+3*Math.pow(1-t,2)*t*u[i]+3*(1-t)*Math.pow(t,2)*h[i]+Math.pow(t,3)*d[i]},p=6*c[i]-12*u[i]+6*h[i],m=-3*c[i]+9*u[i]-9*h[i]+3*d[i],g=3*u[i]-3*c[i];if(0!=m){var y=Math.pow(p,2)-4*g*m;if(!(y<0)){var v=(-p+Math.sqrt(y))/(2*m);0<v&&v<1&&(0==i&&this.addX(f(v)),1==i&&this.addY(f(v)));var b=(-p-Math.sqrt(y))/(2*m);0<b&&b<1&&(0==i&&this.addX(f(b)),1==i&&this.addY(f(b)))}}else{if(0==p)continue;var w=-g/p;0<w&&w<1&&(0==i&&this.addX(f(w)),1==i&&this.addY(f(w)))}}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(n,r)},M.Transform=function(t){var e=this;this.Type={},this.Type.translate=function(t){this.p=M.CreatePoint(t),this.apply=function(t){t.translate2(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate2(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var e=M.ToNumberArray(t);this.angle=new M.Property("angle",e[0]),this.cx=e[1]||0,this.cy=e[2]||0,this.apply=function(t){t.translate2(this.cx,this.cy),t.rotate2(this.angle.toRadians()),t.translate2(-this.cx,-this.cy)},this.unapply=function(t){t.translate2(this.cx,this.cy),t.rotate2(-1*this.angle.toRadians()),t.translate2(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=M.CreatePoint(t),this.apply=function(t){t.scale2(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale2(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=M.ToNumberArray(t),this.apply=function(t){t.transform2(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(t){var e=this.m[0],n=this.m[2],i=this.m[4],r=this.m[1],o=this.m[3],s=this.m[5],a=1/(e*(1*o-0*s)-n*(1*r-0*s)+i*(0*r-0*o));t.transform2(a*(1*o-0*s),a*(0*s-1*r),a*(0*i-1*n),a*(1*e-0*i),a*(n*s-i*o),a*(i*r-e*s))},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=e.Type.matrix,this.base(t),this.angle=new M.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;0<=e;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)};for(var n=M.trim(M.compressSpaces(t)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<n.length;i++){var r=M.trim(n[i].split("(")[0]),o=n[i].split("(")[1].replace(")",""),s=this.Type[r];if(void 0!==s){var a=new s(o);a.type=r,this.transforms.push(a)}}},M.AspectRatio=function(t,e,n,i,r,o,s,a,l,c){var u=(e=(e=M.compressSpaces(e)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",h=e.split(" ")[1]||"meet",d=n/i,f=r/o,p=Math.min(d,f),m=Math.max(d,f);"meet"==h&&(i*=p,o*=p),"slice"==h&&(i*=m,o*=m),l=new M.Property("refX",l),c=new M.Property("refY",c),l.hasValue()&&c.hasValue()?t.translate2(-p*l.toPixels("x"),-p*c.toPixels("y")):(u.match(/^xMid/)&&("meet"==h&&p==f||"slice"==h&&m==f)&&t.translate2(n/2-i/2,0),u.match(/YMid$/)&&("meet"==h&&p==d||"slice"==h&&m==d)&&t.translate2(0,r/2-o/2),u.match(/^xMax/)&&("meet"==h&&p==f||"slice"==h&&m==f)&&t.translate2(n-i,0),u.match(/YMax$/)&&("meet"==h&&p==d||"slice"==h&&m==d)&&t.translate2(0,r-o)),"none"==u?t.scale2(d,f):"meet"==h?t.scale2(p,p):"slice"==h&&t.scale2(m,m),t.translate2(null==s?0:-s,null==a?0:-a)},M.Element={},M.EmptyProperty=new M.Property("EMPTY",""),M.Element.ElementBase=function(o){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(t,e){var n=this.attributes[t];return null!=n?n:(1==e&&(n=new M.Property(t,""),this.attributes[t]=n),n||M.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if("href"==t||t.match(/:href$/))return this.attributes[t];return M.EmptyProperty},this.style=function(t,e,n){var i=this.styles[t];if(null!=i)return i;var r=this.attribute(t);if(null!=r&&r.hasValue())return this.styles[t]=r;if(1!=n){var o=this.parent;if(null!=o){var s=o.style(t);if(null!=s&&s.hasValue())return s}}return 1==e&&(i=new M.Property(t,""),this.styles[t]=i),i||M.EmptyProperty},this.render=function(t){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(t.save2(),this.style("mask").hasValue()){var e=this.style("mask").getDefinition();null!=e&&e.apply(t,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(t,this)}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore2()}},this.setContext=function(t){},this.clearContext=function(t){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(t,e){var n=t;e&&(n=M.CreateElement(t)),n.parent=this,"title"!=n.type&&this.children.push(n)},this.addStylesFromStyleDefinition=function(){for(var t in M.Styles)if("@"!=t[0]&&d(o,t)){var e=M.Styles[t],n=M.StylesSpecificity[t];if(null!=e)for(var i in e){var r=this.stylesSpecificity[i];void 0===r&&(r="000"),r<n&&(this.styles[i]=e[i],this.stylesSpecificity[i]=n)}}};var t,e=new RegExp("^[A-Z-]+$");if(null!=o&&1==o.nodeType){for(var n=0;n<o.attributes.length;n++){var i=o.attributes[n],r=(t=i.nodeName,e.test(t)?t.toLowerCase():t);this.attributes[r]=new M.Property(r,i.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var s=this.attribute("style").value.split(";");for(n=0;n<s.length;n++)if(""!=M.trim(s[n])){var a=s[n].split(":"),l=M.trim(a[0]),c=M.trim(a[1]);this.styles[l]=new M.Property(l,c)}}for(this.attribute("id").hasValue()&&null==M.Definitions[this.attribute("id").value]&&(M.Definitions[this.attribute("id").value]=this),n=0;n<o.childNodes.length;n++){var u=o.childNodes[n];if(1==u.nodeType&&this.addChild(u,!0),this.captureTextNodes&&(3==u.nodeType||4==u.nodeType)){var h=u.value||u.text||u.textContent||"";""!=M.compressSpaces(h)&&this.addChild(new M.Element.tspan(u),!1)}}}},M.Element.RenderedElementBase=function(t){this.base=M.Element.ElementBase,this.base(t),this.setContext=function(t){var e;if(this.style("fill").isUrlDefinition())null!=(e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(t.fillStyle2=e);else if(this.style("fill").hasValue()){var n;"currentColor"==(n=this.style("fill")).value&&(n.value=this.style("color").value),"inherit"!=n.value&&(t.fillStyle2="none"==n.value?"rgba(0,0,0,0)":n.value)}if(this.style("fill-opacity").hasValue()&&(n=(n=new M.Property("fill",t.fillStyle2)).addOpacity(this.style("fill-opacity")),t.fillStyle2=n.value),this.style("stroke").isUrlDefinition())null!=(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(t.strokeStyle2=e);else if(this.style("stroke").hasValue()){var i;"currentColor"==(i=this.style("stroke")).value&&(i.value=this.style("color").value),"inherit"!=i.value&&(t.strokeStyle2="none"==i.value?"rgba(0,0,0,0)":i.value)}if(this.style("stroke-opacity").hasValue()&&(i=(i=new M.Property("stroke",t.strokeStyle2)).addOpacity(this.style("stroke-opacity")),t.strokeStyle2=i.value),this.style("stroke-width").hasValue()){var r=this.style("stroke-width").toPixels();t.lineWidth2=0==r?.001:r}if(this.style("stroke-linecap").hasValue()&&(t.lineCap2=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin2=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit2=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var o=M.ToNumberArray(this.style("stroke-dasharray").value);void 0!==t.setLineDash?t.setLineDash2(o):void 0!==t.webkitLineDash?t.webkitLineDash=o:void 0===t.mozDash||1==o.length&&0==o[0]||(t.mozDash=o);var s=this.style("stroke-dashoffset").numValueOrDefault(1);void 0!==t.lineDashOffset?t.lineDashOffset=s:void 0!==t.webkitLineDashOffset?t.webkitLineDashOffset=s:void 0!==t.mozDashOffset&&(t.mozDashOffset=s)}if(void 0!==t.font2&&(t.font2=M.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()&&new M.Transform(this.style("transform",!1,!0).value).apply(t),this.style("clip-path",!1,!0).hasValue()){var a=this.style("clip-path",!1,!0).getDefinition();null!=a&&"clipPath"==a.type&&a.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha2=this.style("opacity").numValue())}},M.Element.RenderedElementBase.prototype=new M.Element.ElementBase,M.Element.PathElementBase=function(t){this.base=M.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath2(),new M.BoundingBox},this.renderChildren=function(t){this.path(t),M.Mouse.checkPath(this,t),""!=t.fillStyle2&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?t.fill2(this.style("fill-rule").value):t.fill2()),""!=t.strokeStyle2&&"rgba(0,0,0,0)"!=t.strokeStyle2&&t.stroke2();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()&&(n=this.style("marker-start").getDefinition()).render(t,e[0][0],e[0][1]),this.style("marker-mid").isUrlDefinition())for(var n=this.style("marker-mid").getDefinition(),i=1;i<e.length-1;i++)n.render(t,e[i][0],e[i][1]);this.style("marker-end").isUrlDefinition()&&(n=this.style("marker-end").getDefinition()).render(t,e[e.length-1][0],e[e.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},M.Element.PathElementBase.prototype=new M.Element.RenderedElementBase,M.Element.svg=function(t){this.base=M.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),M.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.lineCap2="butt",t.lineJoin2="miter",t.miterLimit2=4,void 0!==t.font2&&void 0!==window.getComputedStyle&&(t.font2=window.getComputedStyle(t.canvas).getPropertyValue("font")),this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate2(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var e=M.ViewPort.width(),n=M.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){if(e=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y"),this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){var i=-this.attribute("refX").toPixels("x"),r=-this.attribute("refY").toPixels("y");t.translate2(i,r)}"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(t.beginPath2(),t.moveTo2(0,0),t.lineTo2(e,0),t.lineTo2(e,n),t.lineTo2(0,n),t.closePath2(),t.clip2())}if(M.ViewPort.SetCurrent(e,n),this.attribute("viewBox").hasValue()){var o=M.ToNumberArray(this.attribute("viewBox").value),s=o[0],a=o[1];e=o[2],n=o[3],M.AspectRatio(t,this.attribute("preserveAspectRatio").value,M.ViewPort.width(),e,M.ViewPort.height(),n,s,a,this.attribute("refX").value,this.attribute("refY").value),M.ViewPort.RemoveCurrent(),M.ViewPort.SetCurrent(o[2],o[3])}}},M.Element.svg.prototype=new M.Element.RenderedElementBase,M.Element.rect=function(t){this.base=M.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y"),o=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=o),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(o=s),o=Math.min(o,i/2),s=Math.min(s,r/2),null!=t&&(t.beginPath2(),t.moveTo2(e+o,n),t.lineTo2(e+i-o,n),t.quadraticCurveTo2(e+i,n,e+i,n+s),t.lineTo2(e+i,n+r-s),t.quadraticCurveTo2(e+i,n+r,e+i-o,n+r),t.lineTo2(e+o,n+r),t.quadraticCurveTo2(e,n+r,e,n+r-s),t.lineTo2(e,n+s),t.quadraticCurveTo2(e,n,e+o,n),t.closePath2()),new M.BoundingBox(e,n,e+i,n+r)}},M.Element.rect.prototype=new M.Element.PathElementBase,M.Element.circle=function(t){this.base=M.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&(t.beginPath2(),t.arc2(e,n,i,0,2*Math.PI,!1),t.closePath2()),new M.BoundingBox(e-i,n-i,e+i,n+i)}},M.Element.circle.prototype=new M.Element.PathElementBase,M.Element.ellipse=function(t){this.base=M.Element.PathElementBase,this.base(t),this.path=function(t){var e=(Math.sqrt(2)-1)/3*4,n=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),r=this.attribute("cx").toPixels("x"),o=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath2(),t.moveTo2(r+n,o),t.bezierCurveTo2(r+n,o+e*i,r+e*n,o+i,r,o+i),t.bezierCurveTo2(r-e*n,o+i,r-n,o+e*i,r-n,o),t.bezierCurveTo2(r-n,o-e*i,r-e*n,o-i,r,o-i),t.bezierCurveTo2(r+e*n,o-i,r+n,o-e*i,r+n,o),t.closePath2()),new M.BoundingBox(r-n,o-i,r+n,o+i)}},M.Element.ellipse.prototype=new M.Element.PathElementBase,M.Element.line=function(t){this.base=M.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new M.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new M.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var e=this.getPoints();return null!=t&&(t.beginPath2(),t.moveTo2(e[0].x,e[0].y),t.lineTo2(e[1].x,e[1].y)),new M.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},M.Element.line.prototype=new M.Element.PathElementBase,M.Element.polyline=function(t){this.base=M.Element.PathElementBase,this.base(t),this.points=M.CreatePath(this.attribute("points").value),this.path=function(t){var e=new M.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath2(),t.moveTo2(this.points[0].x,this.points[0].y));for(var n=1;n<this.points.length;n++)e.addPoint(this.points[n].x,this.points[n].y),null!=t&&t.lineTo2(this.points[n].x,this.points[n].y);return e},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return 0<t.length&&t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},M.Element.polyline.prototype=new M.Element.PathElementBase,M.Element.polygon=function(t){this.base=M.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo2(this.points[0].x,this.points[0].y),t.closePath2()),e}},M.Element.polygon.prototype=new M.Element.polyline,M.Element.path=function(t){this.base=M.Element.PathElementBase,this.base(t);var e=this.attribute("d").value;e=e.replace(/,/gm," ");for(var n=0;n<2;n++)e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(e=(e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),n=0;n<2;n++)e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),e=M.compressSpaces(e),e=M.trim(e),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new M.Point(0,0),this.control=new M.Point(0,0),this.current=new M.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new M.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new M.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,n){null!=n&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(e),this.path=function(t){var e=this.PathParser;e.reset();var n=new M.BoundingBox;for(null!=t&&t.beginPath2();!e.isEnd();)switch(e.nextCommand(),e.command){case"M":case"m":var i=e.getAsCurrentPoint();for(e.addMarker(i),n.addPoint(i.x,i.y),null!=t&&t.moveTo2(i.x,i.y),e.start=e.current;!e.isCommandOrEnd();)i=e.getAsCurrentPoint(),e.addMarker(i,e.start),n.addPoint(i.x,i.y),null!=t&&t.lineTo2(i.x,i.y);break;case"L":case"l":for(;!e.isCommandOrEnd();){var r=e.current;i=e.getAsCurrentPoint(),e.addMarker(i,r),n.addPoint(i.x,i.y),null!=t&&t.lineTo2(i.x,i.y)}break;case"H":case"h":for(;!e.isCommandOrEnd();){var o=new M.Point((e.isRelativeCommand()?e.current.x:0)+e.getScalar(),e.current.y);e.addMarker(o,e.current),e.current=o,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo2(e.current.x,e.current.y)}break;case"V":case"v":for(;!e.isCommandOrEnd();)o=new M.Point(e.current.x,(e.isRelativeCommand()?e.current.y:0)+e.getScalar()),e.addMarker(o,e.current),e.current=o,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo2(e.current.x,e.current.y);break;case"C":case"c":for(;!e.isCommandOrEnd();){var s=e.current,a=e.getPoint(),l=e.getAsControlPoint(),c=e.getAsCurrentPoint();e.addMarker(c,l,a),n.addBezierCurve(s.x,s.y,a.x,a.y,l.x,l.y,c.x,c.y),null!=t&&t.bezierCurveTo2(a.x,a.y,l.x,l.y,c.x,c.y)}break;case"S":case"s":for(;!e.isCommandOrEnd();)s=e.current,a=e.getReflectedControlPoint(),l=e.getAsControlPoint(),c=e.getAsCurrentPoint(),e.addMarker(c,l,a),n.addBezierCurve(s.x,s.y,a.x,a.y,l.x,l.y,c.x,c.y),null!=t&&t.bezierCurveTo2(a.x,a.y,l.x,l.y,c.x,c.y);break;case"Q":case"q":for(;!e.isCommandOrEnd();)s=e.current,l=e.getAsControlPoint(),c=e.getAsCurrentPoint(),e.addMarker(c,l,l),n.addQuadraticCurve(s.x,s.y,l.x,l.y,c.x,c.y),null!=t&&t.quadraticCurveTo2(l.x,l.y,c.x,c.y);break;case"T":case"t":for(;!e.isCommandOrEnd();)s=e.current,l=e.getReflectedControlPoint(),e.control=l,c=e.getAsCurrentPoint(),e.addMarker(c,l,l),n.addQuadraticCurve(s.x,s.y,l.x,l.y,c.x,c.y),null!=t&&t.quadraticCurveTo2(l.x,l.y,c.x,c.y);break;case"A":case"a":for(;!e.isCommandOrEnd();){s=e.current;var u=e.getScalar(),h=e.getScalar(),d=e.getScalar()*(Math.PI/180),f=e.getScalar(),p=e.getScalar(),m=(c=e.getAsCurrentPoint(),new M.Point(Math.cos(d)*(s.x-c.x)/2+Math.sin(d)*(s.y-c.y)/2,-Math.sin(d)*(s.x-c.x)/2+Math.cos(d)*(s.y-c.y)/2)),g=Math.pow(m.x,2)/Math.pow(u,2)+Math.pow(m.y,2)/Math.pow(h,2);1<g&&(u*=Math.sqrt(g),h*=Math.sqrt(g));var y=(f==p?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(h,2)-Math.pow(u,2)*Math.pow(m.y,2)-Math.pow(h,2)*Math.pow(m.x,2))/(Math.pow(u,2)*Math.pow(m.y,2)+Math.pow(h,2)*Math.pow(m.x,2)));isNaN(y)&&(y=0);var v=new M.Point(y*u*m.y/h,y*-h*m.x/u),b=new M.Point((s.x+c.x)/2+Math.cos(d)*v.x-Math.sin(d)*v.y,(s.y+c.y)/2+Math.sin(d)*v.x+Math.cos(d)*v.y),w=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},x=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(w(t)*w(e))},S=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(x(t,e))},E=S([1,0],[(m.x-v.x)/u,(m.y-v.y)/h]),C=[(m.x-v.x)/u,(m.y-v.y)/h],T=[(-m.x-v.x)/u,(-m.y-v.y)/h],N=S(C,T);x(C,T)<=-1&&(N=Math.PI),1<=x(C,T)&&(N=0);var k=1-p?1:-1,_=E+k*(N/2),A=new M.Point(b.x+u*Math.cos(_),b.y+h*Math.sin(_));if(e.addMarkerAngle(A,_-k*Math.PI/2),e.addMarkerAngle(c,_-k*Math.PI),n.addPoint(c.x,c.y),null!=t){x=h<u?u:h;var B=h<u?1:u/h;t.arc2(b.x,b.y,B*x,E+d,E+N+d,1-p)}}break;case"Z":case"z":null!=t&&t.closePath2(),e.current=e.start}return n},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),n=[],i=0;i<t.length;i++)n.push([t[i],e[i]]);return n}},M.Element.path.prototype=new M.Element.PathElementBase,M.Element.pattern=function(t){this.base=M.Element.ElementBase,this.base(t),this.createPattern=function(t,e){var n=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),r=new M.Element.svg;r.attributes.viewBox=new M.Property("viewBox",this.attribute("viewBox").value),r.attributes.width=new M.Property("width",n+"px"),r.attributes.height=new M.Property("height",i+"px"),r.attributes.transform=new M.Property("transform",this.attribute("patternTransform").value),r.children=this.children;var o=document.createElement("canvas");o.width=n,o.height=i;var s=o.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&s.translate2(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var a=-1;a<=1;a++)for(var l=-1;l<=1;l++)s.save2(),r.attributes.x=new M.Property("x",a*o.width),r.attributes.y=new M.Property("y",l*o.height),r.render(s),s.restore2();return t.createPattern2(o,"repeat")}},M.Element.pattern.prototype=new M.Element.ElementBase,M.Element.marker=function(t){this.base=M.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,e,n){t.translate2(e.x,e.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate2(n),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale2(t.lineWidth2,t.lineWidth2),t.save2();var i=new M.Element.svg;i.attributes.viewBox=new M.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new M.Property("refX",this.attribute("refX").value),i.attributes.refY=new M.Property("refY",this.attribute("refY").value),i.attributes.width=new M.Property("width",this.attribute("markerWidth").value),i.attributes.height=new M.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new M.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new M.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore2(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale2(1/t.lineWidth2,1/t.lineWidth2),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate2(-n),t.translate2(-e.x,-e.y)}},M.Element.marker.prototype=new M.Element.ElementBase,M.Element.defs=function(t){this.base=M.Element.ElementBase,this.base(t),this.render=function(t){}},M.Element.defs.prototype=new M.Element.ElementBase,M.Element.GradientBase=function(t){this.base=M.Element.ElementBase,this.base(t),this.stops=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"stop"==n.type&&this.stops.push(n)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(t){for(var e=0;e<this.attributesToInherit.length;e++){var n=this.attributesToInherit[e];!this.attribute(n).hasValue()&&t.attribute(n).hasValue()&&(this.attribute(n,!0).value=t.attribute(n).value)}},this.createGradient=function(t,e,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var r=function(t){return n.hasValue()?new M.Property("color",t).addOpacity(n).value:t},o=this.getGradient(t,e);if(null==o)return r(i.stops[i.stops.length-1].color);for(var s=0;s<i.stops.length;s++)o.addColorStop(i.stops[s].offset,r(i.stops[s].color));return o}},M.Element.GradientBase.prototype=new M.Element.ElementBase,M.Element.linearGradient=function(t){this.base=M.Element.GradientBase,this.base(t),this.getGradient=function(t,e){var n="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var i="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),s="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return i==o&&r==s?null:t.createLinearGradient2(i,r,o,s)}},M.Element.linearGradient.prototype=new M.Element.GradientBase,M.Element.radialGradient=function(t){this.base=M.Element.GradientBase,this.base(t),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(t,e){var n=e.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var i="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=i,s=r;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(s="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var a="objectBoundingBox"==this.gradientUnits()?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return t.createRadialGradient2(o,s,0,i,r,a)}},M.Element.radialGradient.prototype=new M.Element.GradientBase,M.Element.stop=function(t){this.base=M.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var e=this.style("stop-color",!0);""===e.value&&(e.value="#000"),this.style("stop-opacity").hasValue()&&(e=e.addOpacity(this.style("stop-opacity"))),this.color=e.value},M.Element.stop.prototype=new M.Element.ElementBase,M.Element.AnimateBase=function(t){this.base=M.Element.ElementBase,this.base(t),M.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+t;var e=!1;if(this.begin<this.duration){var n=this.calcValue();this.attribute("type").hasValue()&&(n=this.attribute("type").value+"("+n+")"),this.getProperty().value=n,e=!0}return e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var e=t.progress*(this.values.value.length-1),n=Math.floor(e),i=Math.ceil(e);t.from=new M.Property("from",parseFloat(this.values.value[n])),t.to=new M.Property("to",parseFloat(this.values.value[i])),t.progress=(e-n)/(i-n)}else t.from=this.from,t.to=this.to;return t}},M.Element.AnimateBase.prototype=new M.Element.ElementBase,M.Element.animate=function(t){this.base=M.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress();return t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress+this.initialUnits}},M.Element.animate.prototype=new M.Element.AnimateBase,M.Element.animateColor=function(t){this.base=M.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress(),e=new RGBColor(t.from.value),n=new RGBColor(t.to.value);if(e.ok&&n.ok){var i=e.r+(n.r-e.r)*t.progress,r=e.g+(n.g-e.g)*t.progress,o=e.b+(n.b-e.b)*t.progress;return"rgb("+parseInt(i,10)+","+parseInt(r,10)+","+parseInt(o,10)+")"}return this.attribute("from").value}},M.Element.animateColor.prototype=new M.Element.AnimateBase,M.Element.animateTransform=function(t){this.base=M.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),e=M.ToNumberArray(t.from.value),n=M.ToNumberArray(t.to.value),i="",r=0;r<e.length;r++)i+=e[r]+(n[r]-e[r])*t.progress+" ";return i}},M.Element.animateTransform.prototype=new M.Element.animate,M.Element.font=function(t){this.base=M.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"font-face"==n.type?(this.fontFace=n).style("font-family").hasValue()&&(M.Definitions[n.style("font-family").value]=this):"missing-glyph"==n.type?this.missingGlyph=n:"glyph"==n.type&&(""!=n.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[n.unicode]&&(this.glyphs[n.unicode]=[]),this.glyphs[n.unicode][n.arabicForm]=n):this.glyphs[n.unicode]=n)}},M.Element.font.prototype=new M.Element.ElementBase,M.Element.fontface=function(t){this.base=M.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},M.Element.fontface.prototype=new M.Element.ElementBase,M.Element.missingglyph=function(t){this.base=M.Element.path,this.base(t),this.horizAdvX=0},M.Element.missingglyph.prototype=new M.Element.path,M.Element.glyph=function(t){this.base=M.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},M.Element.glyph.prototype=new M.Element.path,M.Element.text=function(t){this.captureTextNodes=!0,this.base=M.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t);var e=this.style("dominant-baseline").toTextBaseline();null==e&&(e=this.style("alignment-baseline").toTextBaseline()),null!=e&&(t.textBaseline2=e)},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),n=this.parent.style("font-size").numValueOrDefault(M.Font.Parse(M.ctx.font2).fontSize);return new M.BoundingBox(t,e-n,t+Math.floor(2*n/3)*this.children[0].getText().length,e)},this.renderChildren=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(t,this,0);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,this,e)},this.getAnchorDelta=function(t,e,n){var i=this.style("text-anchor").valueOrDefault("start");if("start"==i)return 0;for(var r=0,o=n;o<e.children.length;o++){var s=e.children[o];if(n<o&&s.attribute("x").hasValue())break;r+=s.measureTextRecursive(t)}return-1*("end"==i?r:r/2)},this.renderChild=function(t,e,n,i){var r=n.children[i];for(r.attribute("x").hasValue()?(r.x=r.attribute("x").toPixels("x")+e.getAnchorDelta(t,n,i),r.attribute("dx").hasValue()&&(r.x+=r.attribute("dx").toPixels("x"))):(r.attribute("dx").hasValue()&&(e.x+=r.attribute("dx").toPixels("x")),r.x=e.x),e.x=r.x+r.measureText(t),r.attribute("y").hasValue()?(r.y=r.attribute("y").toPixels("y"),r.attribute("dy").hasValue()&&(r.y+=r.attribute("dy").toPixels("y"))):(r.attribute("dy").hasValue()&&(e.y+=r.attribute("dy").toPixels("y")),r.y=e.y),e.y=r.y,r.render(t),i=0;i<r.children.length;i++)e.renderChild(t,e,r,i)}},M.Element.text.prototype=new M.Element.RenderedElementBase,M.Element.TextElementBase=function(t){this.base=M.Element.RenderedElementBase,this.base(t),this.getGlyph=function(t,e,n){var i=e[n],r=null;if(t.isArabic){var o="isolated";(0==n||" "==e[n-1])&&n<e.length-2&&" "!=e[n+1]&&(o="terminal"),0<n&&" "!=e[n-1]&&n<e.length-2&&" "!=e[n+1]&&(o="medial"),0<n&&" "!=e[n-1]&&(n==e.length-1||" "==e[n+1])&&(o="initial"),void 0!==t.glyphs[i]&&null==(r=t.glyphs[i][o])&&"glyph"==t.glyphs[i].type&&(r=t.glyphs[i])}else r=t.glyphs[i];return null==r&&(r=t.missingGlyph),r},this.renderChildren=function(t){var e=this.parent.style("font-family").getDefinition();if(null==e)""!=t.fillStyle2&&t.fillText2(M.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle2&&t.strokeText2(M.compressSpaces(this.getText()),this.x,this.y);else{var n=this.parent.style("font-size").numValueOrDefault(M.Font.Parse(M.ctx.font2).fontSize),i=this.parent.style("font-style").valueOrDefault(M.Font.Parse(M.ctx.font2).fontStyle),r=this.getText();e.isRTL&&(r=r.split("").reverse().join(""));for(var o=M.ToNumberArray(this.parent.attribute("dx").value),s=0;s<r.length;s++){var a=this.getGlyph(e,r,s),l=n/e.fontFace.unitsPerEm;t.translate2(this.x,this.y),t.scale2(l,-l);var c=t.lineWidth2;t.lineWidth2=t.lineWidth2*e.fontFace.unitsPerEm/n,"italic"==i&&t.transform2(1,0,.4,1,0,0),a.render(t),"italic"==i&&t.transform2(1,0,-.4,1,0,0),t.lineWidth2=c,t.scale2(1/l,-1/l),t.translate2(-this.x,-this.y),this.x+=n*(a.horizAdvX||e.horizAdvX)/e.fontFace.unitsPerEm,void 0===o[s]||isNaN(o[s])||(this.x+=o[s])}}},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),n=0;n<this.children.length;n++)e+=this.children[n].measureTextRecursive(t);return e},this.measureText=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e){var n=this.parent.style("font-size").numValueOrDefault(M.Font.Parse(M.ctx.font2).fontSize),i=0,r=this.getText();e.isRTL&&(r=r.split("").reverse().join(""));for(var o=M.ToNumberArray(this.parent.attribute("dx").value),s=0;s<r.length;s++)i+=(this.getGlyph(e,r,s).horizAdvX||e.horizAdvX)*n/e.fontFace.unitsPerEm,void 0===o[s]||isNaN(o[s])||(i+=o[s]);return i}var a=M.compressSpaces(this.getText());if(!t.measureText)return 10*a.length;t.save2(),this.setContext(t);var l=t.measureText(a).width;return t.restore2(),l}},M.Element.TextElementBase.prototype=new M.Element.RenderedElementBase,M.Element.tspan=function(t){this.captureTextNodes=!0,this.base=M.Element.TextElementBase,this.base(t),this.text=M.compressSpaces(t.value||t.text||t.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},M.Element.tspan.prototype=new M.Element.TextElementBase,M.Element.tref=function(t){this.base=M.Element.TextElementBase,this.base(t),this.getText=function(){var t=this.getHrefAttribute().getDefinition();if(null!=t)return t.children[0].getText()}},M.Element.tref.prototype=new M.Element.TextElementBase,M.Element.a=function(t){this.base=M.Element.TextElementBase,this.base(t),this.hasText=0<t.childNodes.length;for(var e=0;e<t.childNodes.length;e++)3!=t.childNodes[e].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var e=new M.Property("fontSize",M.Font.Parse(M.ctx.font2).fontSize);M.Mouse.checkBoundingBox(this,new M.BoundingBox(this.x,this.y-e.toPixels("y"),this.x+this.measureText(t),this.y))}else if(0<this.children.length){var n=new M.Element.g;n.children=this.children,n.parent=this,n.render(t)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){M.ctx.canvas.style.cursor="pointer"}},M.Element.a.prototype=new M.Element.TextElementBase,M.Element.image=function(t){this.base=M.Element.RenderedElementBase,this.base(t);var e=this.getHrefAttribute().value;if(""!=e){var o=e.match(/\.svg$/);if(M.Images.push(this),this.loaded=!1,o)this.img=M.ajax(e),this.loaded=!0;else{this.img=document.createElement("img"),1==M.opts.useCORS&&(this.img.crossOrigin="Anonymous");var n=this;this.img.onload=function(){n.loaded=!0},this.img.onerror=function(){M.log('ERROR: image "'+e+'" not found'),n.loaded=!0},this.img.src=e}this.renderChildren=function(t){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");0!=i&&0!=r&&(t.save2(),o?t.drawSvg(this.img,e,n,i,r):(t.translate2(e,n),M.AspectRatio(t,this.attribute("preserveAspectRatio").value,i,this.img.width,r,this.img.height,0,0),t.drawImage2(this.img,0,0)),t.restore2())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new M.BoundingBox(t,e,t+n,e+i)}}},M.Element.image.prototype=new M.Element.RenderedElementBase,M.Element.g=function(t){this.base=M.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new M.BoundingBox,e=0;e<this.children.length;e++)t.addBoundingBox(this.children[e].getBoundingBox());return t}},M.Element.g.prototype=new M.Element.RenderedElementBase,M.Element.symbol=function(t){this.base=M.Element.RenderedElementBase,this.base(t),this.render=function(t){}},M.Element.symbol.prototype=new M.Element.RenderedElementBase,M.Element.style=function(t){this.base=M.Element.ElementBase,this.base(t);for(var e="",n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].data;e=e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var i=(e=M.compressSpaces(e)).split("}");for(n=0;n<i.length;n++)if(""!=M.trim(i[n]))for(var r=i[n].split("{"),o=r[0].split(","),s=r[1].split(";"),a=0;a<o.length;a++){var l=M.trim(o[a]);if(""!=l){for(var c=M.Styles[l]||{},u=0;u<s.length;u++){var h=s[u].indexOf(":"),d=s[u].substr(0,h),f=s[u].substr(h+1,s[u].length-h);null!=d&&null!=f&&(c[M.trim(d)]=new M.Property(M.trim(d),M.trim(f)))}if(M.Styles[l]=c,M.StylesSpecificity[l]=x(l),"@font-face"==l)for(var p=c["font-family"].value.replace(/"/g,""),m=c.src.value.split(","),g=0;g<m.length;g++)if(0<m[g].indexOf('format("svg")')){var y=(m[g].match(/url\(['"]?([^)]*)['"?]\)/)||[])[1];if(y)for(var v=M.parseXml(M.ajax(y)).getElementsByTagName("font"),b=0;b<v.length;b++){var w=M.CreateElement(v[b]);M.Definitions[p]=w}}}}},M.Element.style.prototype=new M.Element.ElementBase,M.Element.use=function(t){this.base=M.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate2(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate2(0,this.attribute("y").toPixels("y"))};var i=this.getHrefAttribute().getDefinition();this.path=function(t){null!=i&&i.path(t)},this.getBoundingBox=function(){if(null!=i)return i.getBoundingBox()},this.renderChildren=function(t){if(null!=i){var e=i;"symbol"==i.type&&((e=new M.Element.svg).type="svg",e.attributes.viewBox=new M.Property("viewBox",i.attribute("viewBox").value),e.attributes.preserveAspectRatio=new M.Property("preserveAspectRatio",i.attribute("preserveAspectRatio").value),e.attributes.overflow=new M.Property("overflow",i.attribute("overflow").value),e.children=i.children),"svg"==e.type&&(this.attribute("width").hasValue()&&(e.attributes.width=new M.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(e.attributes.height=new M.Property("height",this.attribute("height").value)));var n=e.parent;e.parent=null,e.render(t),e.parent=n}}},M.Element.use.prototype=new M.Element.RenderedElementBase,M.Element.mask=function(t){this.base=M.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");if(0==r&&0==o){for(var s=new M.BoundingBox,a=0;a<this.children.length;a++)s.addBoundingBox(this.children[a].getBoundingBox());n=Math.floor(s.x1),i=Math.floor(s.y1),r=Math.floor(s.width()),o=Math.floor(s.height())}var l=e.attribute("mask").value;e.attribute("mask").value="";var c=document.createElement("canvas");c.width=n+r,c.height=i+o;var u=c.getContext("2d");this.renderChildren(u);var h=document.createElement("canvas");h.width=n+r,h.height=i+o;var d=h.getContext("2d");e.render(d),d.globalCompositeOperation2="destination-in",d.fillStyle2=u.createPattern2(c,"no-repeat"),d.fillRect2(0,0,n+r,i+o),t.fillStyle2=d.createPattern2(h,"no-repeat"),t.fillRect2(0,0,n+r,i+o),e.attribute("mask").value=l},this.render=function(t){}},M.Element.mask.prototype=new M.Element.ElementBase,M.Element.clipPath=function(t){this.base=M.Element.ElementBase,this.base(t),this.apply=function(t){var e=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var n=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},e.call(t);for(var i=0;i<this.children.length;i++){var r=this.children[i];if(void 0!==r.path){var o=null;r.style("transform",!1,!0).hasValue()&&(o=new M.Transform(r.style("transform",!1,!0).value)).apply(t),r.path(t),CanvasRenderingContext2D.prototype.closePath=n,o&&o.unapply(t)}}n.call(t),t.clip2(),CanvasRenderingContext2D.prototype.beginPath=e,CanvasRenderingContext2D.prototype.closePath=n},this.render=function(t){}},M.Element.clipPath.prototype=new M.Element.ElementBase,M.Element.filter=function(t){this.base=M.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=e.getBoundingBox(),i=Math.floor(n.x1),r=Math.floor(n.y1),o=Math.floor(n.width()),s=Math.floor(n.height()),a=e.style("filter").value;e.style("filter").value="";for(var l=0,c=0,u=0;u<this.children.length;u++){var h=this.children[u].extraFilterDistance||0;l=Math.max(l,h),c=Math.max(c,h)}var d=document.createElement("canvas");d.width=o+2*l,d.height=s+2*c;var f=d.getContext("2d");for(f.translate2(-i+l,-r+c),e.render(f),u=0;u<this.children.length;u++)"function"==typeof this.children[u].apply&&this.children[u].apply(f,0,0,o+2*l,s+2*c);t.drawImage2(d,0,0,o+2*l,s+2*c,i-l,r-c,o+2*l,s+2*c),e.style("filter",!0).value=a},this.render=function(t){}},M.Element.filter.prototype=new M.Element.ElementBase,M.Element.feMorphology=function(t){this.base=M.Element.ElementBase,this.base(t),this.apply=function(t,e,n,i,r){}},M.Element.feMorphology.prototype=new M.Element.ElementBase,M.Element.feComposite=function(t){this.base=M.Element.ElementBase,this.base(t),this.apply=function(t,e,n,i,r){}},M.Element.feComposite.prototype=new M.Element.ElementBase,M.Element.feColorMatrix=function(t){this.base=M.Element.ElementBase,this.base(t);var i=M.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var e=i[0];i=[.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715+.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=i[0]*Math.PI/180,n=function(t,e,n){return t+Math.cos(r)*e+Math.sin(r)*n};i=[n(.213,.787,-.213),n(.715,-.715,-.715),n(.072,-.072,.928),0,0,n(.213,-.213,.143),n(.715,.285,.14),n(.072,-.072,-.283),0,0,n(.213,-.213,-.787),n(.715,-.715,.715),n(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function u(t,e,n,i,r,o){return t[n*i*4+4*e+o]}function h(t,e,n,i,r,o,s){t[n*i*4+4*e+o]=s}function d(t,e){var n=i[t];return n*(n<0?e-255:e)}this.apply=function(t,e,n,i,r){var o=t.getImageData(0,0,i,r);for(n=0;n<r;n++)for(e=0;e<i;e++){var s=u(o.data,e,n,i,0,0),a=u(o.data,e,n,i,0,1),l=u(o.data,e,n,i,0,2),c=u(o.data,e,n,i,0,3);h(o.data,e,n,i,0,0,d(0,s)+d(1,a)+d(2,l)+d(3,c)+d(4,1)),h(o.data,e,n,i,0,1,d(5,s)+d(6,a)+d(7,l)+d(8,c)+d(9,1)),h(o.data,e,n,i,0,2,d(10,s)+d(11,a)+d(12,l)+d(13,c)+d(14,1)),h(o.data,e,n,i,0,3,d(15,s)+d(16,a)+d(17,l)+d(18,c)+d(19,1))}t.clearRect2(0,0,i,r),t.putImageData2(o,0,0)}},M.Element.feColorMatrix.prototype=new M.Element.ElementBase,M.Element.feGaussianBlur=function(t){this.base=M.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,e,n,i,r){void 0!==stackBlur.canvasRGBA?(t.canvas.id=M.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),stackBlur.canvasRGBA(t.canvas.id,e,n,i,r,this.blurRadius),document.body.removeChild(t.canvas)):M.log("ERROR: StackBlur.js must be included for blur to work")}},M.Element.feGaussianBlur.prototype=new M.Element.ElementBase,M.Element.title=function(t){},M.Element.title.prototype=new M.Element.ElementBase,M.Element.desc=function(t){},M.Element.desc.prototype=new M.Element.ElementBase,M.Element.MISSING=function(t){M.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},M.Element.MISSING.prototype=new M.Element.ElementBase,M.CreateElement=function(t){var e=t.nodeName.replace(/^[^:]+:/,"");e=e.replace(/\-/g,"");var n=null;return(n=void 0!==M.Element[e]?new M.Element[e](t):new M.Element.MISSING(t)).type=t.nodeName,n},M.load=function(t,e){M.loadXml(t,M.ajax(e))},M.loadXml=function(t,e){M.loadXmlDoc(t,M.parseXml(e))},M.loadXmlDoc=function(o,s){M.init(o);var n=function(t){for(var e=o.canvas;e;)t.x-=e.offsetLeft,t.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(t.x+=window.scrollX),window.scrollY&&(t.y+=window.scrollY),t};1!=M.opts.ignoreMouse&&(o.canvas.onclick=function(t){var e=n(new M.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));M.Mouse.onclick(e.x,e.y)},o.canvas.onmousemove=function(t){var e=n(new M.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));M.Mouse.onmousemove(e.x,e.y)});var a=M.CreateElement(s.documentElement);a.root=!0,a.addStylesFromStyleDefinition();var l=!0,i=function(){M.ViewPort.Clear(),l&&(M.ViewPort.Clear(),o.canvas.parentNode&&M.ViewPort.SetCurrent(o.canvas.parentNode.clientWidth,o.canvas.parentNode.clientHeight)),1!=M.opts.ignoreDimensions&&(a.style("width").hasValue()&&(o.canvas.width=a.style("width").toPixels("x"),o.canvas.style.width=o.canvas.width+"px"),a.style("height").hasValue()&&(o.canvas.height=a.style("height").toPixels("y"),o.canvas.style.height=o.canvas.height+"px"));var t=o.canvas.clientWidth||o.canvas.width,e=o.canvas.clientHeight||o.canvas.height;if(1==M.opts.ignoreDimensions&&a.style("width").hasValue()&&a.style("height").hasValue()&&(t=a.style("width").toPixels("x"),e=a.style("height").toPixels("y")),M.ViewPort.SetCurrent(t,e),null!=M.opts.offsetX&&(a.attribute("x",!0).value=M.opts.offsetX),null!=M.opts.offsetY&&(a.attribute("y",!0).value=M.opts.offsetY),null!=M.opts.scaleWidth||null!=M.opts.scaleHeight){var n=null,i=null,r=M.ToNumberArray(a.attribute("viewBox").value);null!=M.opts.scaleWidth&&(a.attribute("width").hasValue()?n=a.attribute("width").toPixels("x")/M.opts.scaleWidth:isNaN(r[2])||(n=r[2]/M.opts.scaleWidth)),null!=M.opts.scaleHeight&&(a.attribute("height").hasValue()?i=a.attribute("height").toPixels("y")/M.opts.scaleHeight:isNaN(r[3])||(i=r[3]/M.opts.scaleHeight)),null==n&&(n=i),null==i&&(i=n),a.attribute("width",!0).value=M.opts.scaleWidth,a.attribute("height",!0).value=M.opts.scaleHeight,a.style("transform",!0,!0).value+=" scale("+1/n+","+1/i+")"}return 1!=M.opts.ignoreClear&&o.clearRect2(0,0,t,e),a.render(o),l&&(l=!1,"function"==typeof M.opts.renderCallback&&M.opts.renderCallback(s)),{w:a.attribute("width",!0).value,h:a.attribute("height",!0).value}},r=!0;if(M.ImagesLoaded()){r=!1,h="";var t=i();window.onSVGDraw&&onSVGDraw("var ctx = arguments[0];\n"+h,t)}M.intervalID=setInterval(function(){var t=!1;if(r&&M.ImagesLoaded()&&(t=!(r=!1)),1!=M.opts.ignoreMouse&&(t|=M.Mouse.hasEvents()),1!=M.opts.ignoreAnimation)for(var e=0;e<M.Animations.length;e++)t|=M.Animations[e].update(1e3/M.FRAMERATE);if("function"==typeof M.opts.forceRedraw&&1==M.opts.forceRedraw()&&(t=!0),t){h="";var n=i();window.onSVGDraw&&onSVGDraw("var ctx = arguments[0];\n"+h,n),M.Mouse.runEvents()}},1e3/M.FRAMERATE)},M.stop=function(){M.intervalID&&clearInterval(M.intervalID)},M.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var n=0;n<this.events.length;n++){var i=this.events[n];e.isPointInPath&&e.isPointInPath2(i.x,i.y)&&(this.eventElements[n]=t)}},this.checkBoundingBox=function(t,e){for(var n=0;n<this.events.length;n++){var i=this.events[n];e.isPointInBox(i.x,i.y)&&(this.eventElements[n]=t)}},this.runEvents=function(){M.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var e=this.events[t],n=this.eventElements[t];n;)e.run(n),n=n.parent;this.events=[],this.eventElements=[]}},M}(n||{});1==t.childNodes.length&&"OBJECT"==t.childNodes[0].nodeName||(t.svg=r);var o=t.getContext("2d");void 0!==e.documentElement?r.loadXmlDoc(o,e):"<"==e.substr(0,1)?r.loadXml(o,e):r.load(o,e)}else for(var s=document.querySelectorAll("svg"),a=0;a<s.length;a++){var l=s[a],c=document.createElement("canvas");c.width=l.clientWidth||l.getBoundingClientRect().width,c.height=l.clientHeight||l.getBoundingClientRect().height,l.parentNode.insertBefore(c,l),l.parentNode.removeChild(l);var u=document.createElement("div");u.appendChild(l),canvg(c,u.innerHTML)}},void 0!==Element.prototype.matches?d=function(t,e){return t.matches(e)}:void 0!==Element.prototype.webkitMatchesSelector?d=function(t,e){return t.webkitMatchesSelector(e)}:void 0!==Element.prototype.mozMatchesSelector?d=function(t,e){return t.mozMatchesSelector(e)}:void 0!==Element.prototype.msMatchesSelector?d=function(t,e){return t.msMatchesSelector(e)}:void 0!==Element.prototype.oMatchesSelector?d=function(t,e){return t.oMatchesSelector(e)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(d=function(t,e){return $(t).is(e)}),void 0===d&&(d=Sizzle.matchesSelector));var h,s,e=/(\[[^\]]+\])/g,n=/(#[^\s\+>~\.\[:]+)/g,o=/(\.[^\s\+>~\.\[:]+)/g,a=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,l=/(:[\w-]+\([^\)]*\))/gi,c=/(:[^\s\+>~\.\[:]+)/g,u=/([^\s\+>~\.\[:]+)/g;function x(i){var r=[0,0,0],t=function(t,e){var n=i.match(t);null!=n&&(r[e]+=n.length,i=i.replace(t," "))};return i=(i=i.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),t(e,1),t(n,0),t(o,1),t(a,2),t(l,1),t(c,1),i=(i=i.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),t(u,2),r.join("")}var f=0;function p(t,e){h+=t}function r(t,e){if(t.name)f||f++;else{t.name=0==f?"ctx":"ctx"+f,f++,e&&p('var canvas = document.createElement("canvas");\ncanvas.width = '+t.canvas.width+";\ncanvas.height = "+t.canvas.height+";\nvar "+t.name+' = canvas.getContext("2d");\n');var n={webkitLineDash:!1,strokeStyle:!1,fillStyle:!1,name:!1,globalAlpha:!1,globalCompositeOperation:!1,lineWidth:!1,lineCap:!1,lineJoin:!1,miterLimit:!1,shadowOffsetX:!1,shadowOffsetY:!1,shadowBlur:!1,shadowColor:!1,lineDashOffset:!1,webkitLineDashOffset:!1,font:!1,textAlign:!1,textBaseline:!1,webkitBackingStorePixelRatio:!1,webkitImageSmoothingEnabled:!1,save:!0,restore:!0,scale:!0,rotate:!0,translate:!0,transform:!0,setTransform:!0,createLinearGradient:!0,createRadialGradient:!0,setLineDash:!0,getLineDash:!0,clearRect:!0,fillRect:!0,beginPath:!0,closePath:!0,moveTo:!0,lineTo:!0,quadraticCurveTo:!0,bezierCurveTo:!0,arcTo:!0,rect:!0,arc:!0,fill:!0,stroke:!0,clip:!0,isPointInPath:!0,isPointInStroke:!0,measureText:!0,setAlpha:!0,setCompositeOperation:!0,setLineWidth:!0,setLineCap:!0,setLineJoin:!0,setMiterLimit:!0,clearShadow:!0,fillText:!0,strokeText:!0,setStrokeColor:!0,setFillColor:!0,strokeRect:!0,drawImage:!0,drawImageFromRect:!0,setShadow:!0,putImageData:!0,webkitPutImageDataHD:!0,createPattern:!0,createImageData:!0,getImageData:!0,webkitGetImageDataHD:!0,drawFocusIfNeeded:!0};for(var i in n)if(n[i])t[i+"2"]=r(i);else try{Object.defineProperty(t,i+"2",o(i))}catch(t){}}function a(t){return"string"==typeof t?'"'+t.replace(/\"/g,"'")+'"':t instanceof CanvasGradient?"g":t instanceof CanvasPattern?"p":t instanceof HTMLCanvasElement?t.getContext("2d").name+".canvas":t instanceof HTMLImageElement?(s||(s={}),s[t.src]||((s[t.src]=t).name="img"+f++,p("var "+t.name+"= new Image();\n"+t.name+".src = "+a(t.src)+";\n")),t.name):t}function r(s){return function(){var t="";if(arguments.length)for(var e=0;e<arguments.length;)t+=a(arguments[e]),++e<arguments.length&&(t+=",");var n=this.name;if("createLinearGradient"==s||"createRadialGradient"==s){p("var g = "+n+"."+s+"("+t+");\n");var i=this[s].apply(this,arguments),r=i.addColorStop;return i.addColorStop=function(t,e){return p("g.addColorStop("+a(t)+","+a(e)+");\n"),r.apply(this,arguments)},i}if("createPattern"!=s)return("translate"!=s||arguments[0]||arguments[1])&&("scale"==s&&1==arguments[0]&&1==arguments[1]||p("setLineDash"==s?n+"."+s+"(["+t+"]);\n":n+"."+s+"("+t+");\n")),this[s].apply(this,arguments);var o=this[s].apply(this,arguments);return p("var p = "+n+"."+s+"("+t+");\n"),o}}function o(e){return{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,p(this.name+"."+e+"="+a(t)+";\n"))}}}}var m=_indraw.canvg;CanvasRenderingContext2D.prototype.drawSvg=function(t){m(this.canvas,t,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0})},_indraw.canvg=function(t,e,n){if("string"==typeof e){if(!t){var i=document.createElement("canvas"),r=document.createElement("div");r.style.display="none",r.appendChild(i),t=i}s=null,f=0;t.getContext("2d");m.apply(this,arguments)}};var g=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(t){var e=g.apply(this,arguments);return"2d"==t&&r(e,0<f),e}}(),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r}),function(t){"use strict";for(var e,n,i={},r=function(){},o="memory".split(","),s="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");e=o.pop();)t[e]=t[e]||i;for(;n=s.pop();)t[n]=t[n]||r}(this.console=this.console||{}),function(r){if(-1!==navigator.userAgent.indexOf("MSIE 9")){var o=[],s=[],a=r.createEvent("CustomEvent");a.initCustomEvent("input",!0,!0,{}),r.addEventListener("selectionchange",function(){var t,e,n=r.activeElement,i="";try{i=n.nodeName||n.tagName}catch(t){}("TEXTAREA"===i||"INPUT"===i&&"text"===n.type)&&(t=o.indexOf(n),(e=o[t]||o.push(n)).value!==s[t]&&(s[t]=e.value,e.dispatchEvent(a)))})}}(document),function(){"use strict";var t,e,n,i;for(Date.now||(Date.now=function(){return(new Date).getTime()}),t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e)n=t[e],window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"];!/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)&&window.requestAnimationFrame&&window.cancelAnimationFrame||(i=0,window.requestAnimationFrame=function(t){var e=Date.now(),n=Math.max(i+16,e);return setTimeout(function(){t(i=n)},n-e)},window.cancelAnimationFrame=clearTimeout)}(),CanvasRenderingContext2D.prototype.setLineDash||(CanvasRenderingContext2D.prototype.setLineDash=function(){});var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t="Your browser supports WebGL";return this.webgl||(t=window.WebGLRenderingContext?'Your graphics card does not seem to support <a class="link" href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>. Find out how to get it <a class="link" href="http://get.webgl.org/">here</a>.':'Your browser does not seem to support <a class="link" href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>. Find out how to get it <a class="link" href="http://get.webgl.org/">here</a>.'),t}};window.Detector=Detector,function(t){"use strict";if(t.URL=t.URL||t.webkitURL,t.Blob&&t.URL)try{return new Blob}catch(t){}var a=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||function(t){var a=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},e=function(){this.data=[]},l=function(t,e,n){this.data=t,this.size=t.length,this.type=e,this.encoding=n},n=e.prototype,i=l.prototype,c=t.FileReaderSync,u=function(t){this.code=this[this.name=t]},r="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),o=r.length,s=t.URL||t.webkitURL||t,h=s.createObjectURL,d=s.revokeObjectURL,f=s,p=t.btoa,m=t.atob,g=t.ArrayBuffer,y=t.Uint8Array,v=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(l.fake=i.fake=!0;o--;)u.prototype[r[o]]=o+1;return s.createObjectURL||(f=t.URL=function(t){var e,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=t,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(e=t.match(v),n.origin=e&&e[1])),n}),f.createObjectURL=function(t){var e,n=t.type;return null===n&&(n="application/octet-stream"),t instanceof l?(e="data:"+n,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):h?h.call(s,t):void 0},f.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&d&&d.call(s,t)},n.append=function(t){var e=this.data;if(y&&(t instanceof g||t instanceof y)){for(var n="",i=new y(t),r=0,o=i.length;r<o;r++)n+=String.fromCharCode(i[r]);e.push(n)}else if("Blob"===a(t)||"File"===a(t)){if(!c)throw new u("NOT_READABLE_ERR");var s=new c;e.push(s.readAsBinaryString(t))}else t instanceof l?"base64"===t.encoding&&m?e.push(m(t.data)):"URI"===t.encoding?e.push(decodeURIComponent(t.data)):"raw"===t.encoding&&e.push(t.data):("string"!=typeof t&&(t+=""),e.push(unescape(encodeURIComponent(t))))},n.getBlob=function(t){return arguments.length||(t=null),new l(this.data.join(""),t,"raw")},n.toString=function(){return"[object BlobBuilder]"},i.slice=function(t,e,n){var i=arguments.length;return i<3&&(n=null),new l(this.data.slice(t,1<i?e:this.data.length),n,this.encoding)},i.toString=function(){return"[object Blob]"},i.close=function(){this.size=0,delete this.data},e}(t);t.Blob=function(t,e){var n=e&&e.type||"",i=new a;if(t)for(var r=0,o=t.length;r<o;r++)Uint8Array&&t[r]instanceof Uint8Array?i.append(t[r].buffer):i.append(t[r]);var s=i.getBlob(n);return!s.slice&&s.webkitSlice&&(s.slice=s.webkitSlice),s};var e=Object.getPrototypeOf||function(t){return t.__proto__};t.Blob.prototype=e(new t.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.buffer=t()}}(function(){return function o(s,a,l){function c(n,t){if(!a[n]){if(!s[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(u)return u(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[n]={exports:{}};s[n][0].call(r.exports,function(t){var e=s[n][1][t];return c(e||t)},r,r.exports,o,s,a,l)}return a[n].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(t,e,n){!function(t){"use strict";var u="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),i="/".charCodeAt(0),r="0".charCodeAt(0),o="a".charCodeAt(0),s="A".charCodeAt(0),a="-".charCodeAt(0),l="_".charCodeAt(0);function h(t){var e=t.charCodeAt(0);return e===n||e===a?62:e===i||e===l?63:e<r?-1:e<r+10?e-r+26+26:e<s+26?e-s:e<o+26?e-o+26:void 0}t.toByteArray=function(t){var e,n,i,r,o,s;if(0<t.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var a=t.length;o="="===t.charAt(a-2)?2:"="===t.charAt(a-1)?1:0,s=new u(3*t.length/4-o),i=0<o?t.length-4:t.length;var l=0;function c(t){s[l++]=t}for(n=e=0;e<i;e+=4,n+=3)c((16711680&(r=h(t.charAt(e))<<18|h(t.charAt(e+1))<<12|h(t.charAt(e+2))<<6|h(t.charAt(e+3))))>>16),c((65280&r)>>8),c(255&r);return 2===o?c(255&(r=h(t.charAt(e))<<2|h(t.charAt(e+1))>>4)):1===o&&(c((r=h(t.charAt(e))<<10|h(t.charAt(e+1))<<4|h(t.charAt(e+2))>>2)>>8&255),c(255&r)),s},t.fromByteArray=function(t){var e,n,i,r,o=t.length%3,s="";function a(t){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)}for(e=0,i=t.length-o;e<i;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],s+=a((r=n)>>18&63)+a(r>>12&63)+a(r>>6&63)+a(63&r);switch(o){case 1:s+=a((n=t[t.length-1])>>2),s+=a(n<<4&63),s+="==";break;case 2:s+=a((n=(t[t.length-2]<<8)+t[t.length-1])>>10),s+=a(n>>4&63),s+=a(n<<2&63),s+="="}return s}}(void 0===n?this.base64js={}:n)},{}],2:[function(t,e,n){n.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,f=t[e+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=a;0<u;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;0<u;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),o-=c}return(f?-1:1)*s*Math.pow(2,o-i)},n.write=function(t,e,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,p=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),2<=(e+=1<=s+h?d/l:d*Math.pow(2,1-h))*l&&(s++,l/=2),u<=s+h?(a=0,s=u):1<=s+h?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));8<=r;t[n+f]=255&a,f+=p,a/=256,r-=8);for(s=s<<r|a,c+=r;0<c;t[n+f]=255&s,f+=p,s/=256,c-=8);t[n+f-p]|=128*m}},{}],3:[function(t,e,n){var i={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},{}],buffer:[function(O,t,R){(function(t){"use strict";var i=O("base64-js"),o=O("ieee754"),s=O("isarray");R.Buffer=a,R.SlowBuffer=function t(e,n){if(!(this instanceof t))return new t(e,n);var i=new a(e,n);delete i.parent;return i},R.INSPECT_MAX_BYTES=50,a.poolSize=8192;var n={};function e(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t){return this instanceof a?(a.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof t?function(t,e){if(t=c(t,e<0?0:0|u(e)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;n++)t[n]=0;return t}(this,t):"string"==typeof t?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");var i=0|r(e,n);return(t=c(t,i)).write(e,n),t}(this,t,1<arguments.length?arguments[1]:"utf8"):function(t,e){if(a.isBuffer(e))return n=t,i=e,r=0|u(i.length),n=c(n,r),i.copy(n,0,0,r),n;var n,i,r;if(s(e))return function(t,e){var n=0|u(e.length);t=c(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}(t,e);if(null==e)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(e.buffer instanceof ArrayBuffer)return l(t,e);if(e instanceof ArrayBuffer)return function(t,e){t=a.TYPED_ARRAY_SUPPORT?(e.byteLength,a._augment(new Uint8Array(e))):l(t,new Uint8Array(e));return t}(t,e)}return e.length?function(t,e){var n=0|u(e.length);t=c(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}(t,e):function(t,e){var n,i=0;"Buffer"===e.type&&s(e.data)&&(n=e.data,i=0|u(n.length)),t=c(t,i);for(var r=0;r<i;r+=1)t[r]=255&n[r];return t}(t,e)}(this,t)):1<arguments.length?new a(t,arguments[1]):new a(t)}function l(t,e){var n=0|u(e.length);t=c(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function c(t,e){return a.TYPED_ARRAY_SUPPORT?(t=a._augment(new Uint8Array(e))).__proto__=a.prototype:(t.length=e,t._isBuffer=!0),0!==e&&e<=a.poolSize>>>1&&(t.parent=n),t}function u(t){if(t>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|t}function r(t,e){"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case"ascii":case"binary":case"raw":case"raws":return n;case"utf8":case"utf-8":return B(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return M(t).length;default:if(i)return B(t).length;e=(""+e).toLowerCase(),i=!0}}function g(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?r<(i=Number(i))&&(i=r):i=r;var o=e.length;if(o%2!=0)throw new Error("Invalid hex string");o/2<i&&(i=o/2);for(var s=0;s<i;s++){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))throw new Error("Invalid hex string");t[n+s]=a}return s}function y(t,e,n,i){return P(function(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function h(t,e,n){return 0===e&&n===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,n))}function d(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var o,s,a,l,c=t[r],u=null,h=239<c?4:223<c?3:191<c?2:1;if(r+h<=n)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(o=t[r+1]))&&127<(l=(31&c)<<6|63&o)&&(u=l);break;case 3:o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&2047<(l=(15&c)<<12|(63&o)<<6|63&s)&&(l<55296||57343<l)&&(u=l);break;case 4:o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)&&l<1114112&&(u=l)}null===u?(u=65533,h=1):65535<u&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=h}return function(t){var e=t.length;if(e<=f)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=f));return n}(i)}(a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){function t(){}try{var e=new Uint8Array(1);return e.foo=function(){return 42},e.constructor=t,42===e.foo()&&e.constructor===t&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}())?(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array):(a.prototype.length=void 0,a.prototype.parent=void 0),a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,o=Math.min(n,i);r<o&&t[r]===e[r];)++r;return r!==o&&(n=t[r],i=e[r]),n<i?-1:i<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!s(t))throw new TypeError("list argument must be an Array of Buffers.");if(0===t.length)return new a(0);var n;if(void 0===e)for(n=e=0;n<t.length;n++)e+=t[n].length;var i=new a(e),r=0;for(n=0;n<t.length;n++){var o=t[n];o.copy(i,r),r+=o.length}return i},a.byteLength=r,a.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?d(this,0,t):function(t,e,n){var i=!1;if(t||(t="utf8"),(e|=0)<0&&(e=0),(n=void 0===n||n===1/0?this.length:0|n)>this.length&&(n=this.length),n<=e)return"";for(;;)switch(t){case"hex":return v(this,e,n);case"utf8":case"utf-8":return d(this,e,n);case"ascii":return p(this,e,n);case"binary":return m(this,e,n);case"base64":return h(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",e=R.INSPECT_MAX_BYTES;return 0<this.length&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:a.compare(this,t)},a.prototype.indexOf=function(t,e){if(2147483647<e?e=2147483647:e<-2147483648&&(e=-2147483648),e>>=0,0===this.length)return-1;if(e>=this.length)return-1;if(e<0&&(e=Math.max(this.length+e,0)),"string"==typeof t)return 0===t.length?-1:String.prototype.indexOf.call(this,t,e);if(a.isBuffer(t))return n(this,t,e);if("number"==typeof t)return a.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,t,e):n(this,[t],e);function n(t,e,n){for(var i=-1,r=0;n+r<t.length;r++)if(t[n+r]===e[-1===i?0:r-i]){if(-1===i&&(i=r),r-i+1===e.length)return n+i}else i=-1;return-1}throw new TypeError("val must be string, number or Buffer")},a.prototype.get=function(t){return this.readUInt8(t)},a.prototype.set=function(t,e){return this.writeUInt8(t,e)},a.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else if(isFinite(e))e|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else{var r=i;i=e,e=0|n,n=r}var o=this.length-e;if((void 0===n||o<n)&&(n=o),0<t.length&&(n<0||e<0)||e>this.length)throw new RangeError("attempt to write outside buffer bounds");i||(i="utf8");for(var s,a,l,c,u,h,d,f,p,m=!1;;)switch(i){case"hex":return g(this,t,e,n);case"utf8":case"utf-8":return f=e,p=n,P(B(t,(d=this).length-f),d,f,p);case"ascii":return y(this,t,e,n);case"binary":return y(this,t,e,n);case"base64":return c=this,u=e,h=n,P(M(t),c,u,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=e,l=n,P(function(t,e){for(var n,i,r,o=[],s=0;s<t.length&&!((e-=2)<0);s++)n=t.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,(s=this).length-a),s,a,l);default:if(m)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),m=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var f=4096;function p(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;r++)i+=String.fromCharCode(127&t[r]);return i}function m(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;r++)i+=String.fromCharCode(t[r]);return i}function v(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||i<n)&&(n=i);for(var r="",o=e;o<n;o++)r+=A(t[o]);return r}function b(t,e,n){for(var i=t.slice(e,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function w(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(n<t+e)throw new RangeError("Trying to access beyond buffer length")}function x(t,e,n,i,r,o){if(!a.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(r<e||e<o)throw new RangeError("value is out of bounds");if(n+i>t.length)throw new RangeError("index out of range")}function S(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-n,2);r<o;r++)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function E(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-n,4);r<o;r++)t[n+r]=e>>>8*(i?r:3-r)&255}function C(t,e,n,i,r,o){if(r<e||e<o)throw new RangeError("value is out of bounds");if(n+i>t.length)throw new RangeError("index out of range");if(n<0)throw new RangeError("index out of range")}function T(t,e,n,i,r){return r||C(t,e,n,4,34028234663852886e22,-34028234663852886e22),o.write(t,e,n,i,23,4),n+4}function N(t,e,n,i,r){return r||C(t,e,n,8,17976931348623157e292,-17976931348623157e292),o.write(t,e,n,i,52,8),n+8}a.prototype.slice=function(t,e){var n,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),e<t&&(e=t),a.TYPED_ARRAY_SUPPORT)n=a._augment(this.subarray(t,e));else{var r=e-t;n=new a(r,void 0);for(var o=0;o<r;o++)n[o]=this[o+t]}return n.length&&(n.parent=this.parent||this),n},a.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||w(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i},a.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||w(t,e,this.length);for(var i=this[t+--e],r=1;0<e&&(r*=256);)i+=this[t+--e]*r;return i},a.prototype.readUInt8=function(t,e){return e||w(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||w(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||w(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||w(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||w(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||w(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return(r*=128)<=i&&(i-=Math.pow(2,8*e)),i},a.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||w(t,e,this.length);for(var i=e,r=1,o=this[t+--i];0<i&&(r*=256);)o+=this[t+--i]*r;return(r*=128)<=o&&(o-=Math.pow(2,8*e)),o},a.prototype.readInt8=function(t,e){return e||w(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){e||w(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(t,e){e||w(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(t,e){return e||w(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||w(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||w(t,4,this.length),o.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||w(t,4,this.length),o.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||w(t,8,this.length),o.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||w(t,8,this.length),o.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,n,i){t=+t,e|=0,n|=0,i||x(this,t,e,n,Math.pow(2,8*n),0);var r=1,o=0;for(this[e]=255&t;++o<n&&(r*=256);)this[e+o]=t/r&255;return e+n},a.prototype.writeUIntBE=function(t,e,n,i){t=+t,e|=0,n|=0,i||x(this,t,e,n,Math.pow(2,8*n),0);var r=n-1,o=1;for(this[e+r]=255&t;0<=--r&&(o*=256);)this[e+r]=t/o&255;return e+n},a.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):S(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):S(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):E(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):E(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);x(this,t,e,n,r-1,-r)}var o=0,s=1,a=t<0?1:0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=(t/s>>0)-a&255;return e+n},a.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);x(this,t,e,n,r-1,-r)}var o=n-1,s=1,a=t<0?1:0;for(this[e+o]=255&t;0<=--o&&(s*=256);)this[e+o]=(t/s>>0)-a&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):S(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):S(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):E(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||x(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):E(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,n){return T(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return T(this,t,e,!1,n)},a.prototype.writeDoubleLE=function(t,e,n){return N(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return N(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),0<i&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,o=i-n;if(this===t&&n<e&&e<i)for(r=o-1;0<=r;r--)t[r+e]=this[r+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(r=0;r<o;r++)t[r+e]=this[r+n];else t._set(this.subarray(n,n+o),e);return o},a.prototype.fill=function(t,e,n){if(t||(t=0),e||(e=0),n||(n=this.length),n<e)throw new RangeError("end < start");if(n!==e&&0!==this.length){if(e<0||e>=this.length)throw new RangeError("start out of bounds");if(n<0||n>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof t)for(i=e;i<n;i++)this[i]=t;else{var r=B(t.toString()),o=r.length;for(i=e;i<n;i++)this[i]=r[i%o]}return this}},a.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw new TypeError("Buffer.toArrayBuffer not supported in this browser");if(a.TYPED_ARRAY_SUPPORT)return new a(this).buffer;for(var t=new Uint8Array(this.length),e=0,n=t.length;e<n;e+=1)t[e]=this[e];return t.buffer};var k=a.prototype;a._augment=function(t){return t.constructor=a,t._isBuffer=!0,t._set=t.set,t.get=k.get,t.set=k.set,t.write=k.write,t.toString=k.toString,t.toLocaleString=k.toString,t.toJSON=k.toJSON,t.equals=k.equals,t.compare=k.compare,t.indexOf=k.indexOf,t.copy=k.copy,t.slice=k.slice,t.readUIntLE=k.readUIntLE,t.readUIntBE=k.readUIntBE,t.readUInt8=k.readUInt8,t.readUInt16LE=k.readUInt16LE,t.readUInt16BE=k.readUInt16BE,t.readUInt32LE=k.readUInt32LE,t.readUInt32BE=k.readUInt32BE,t.readIntLE=k.readIntLE,t.readIntBE=k.readIntBE,t.readInt8=k.readInt8,t.readInt16LE=k.readInt16LE,t.readInt16BE=k.readInt16BE,t.readInt32LE=k.readInt32LE,t.readInt32BE=k.readInt32BE,t.readFloatLE=k.readFloatLE,t.readFloatBE=k.readFloatBE,t.readDoubleLE=k.readDoubleLE,t.readDoubleBE=k.readDoubleBE,t.writeUInt8=k.writeUInt8,t.writeUIntLE=k.writeUIntLE,t.writeUIntBE=k.writeUIntBE,t.writeUInt16LE=k.writeUInt16LE,t.writeUInt16BE=k.writeUInt16BE,t.writeUInt32LE=k.writeUInt32LE,t.writeUInt32BE=k.writeUInt32BE,t.writeIntLE=k.writeIntLE,t.writeIntBE=k.writeIntBE,t.writeInt8=k.writeInt8,t.writeInt16LE=k.writeInt16LE,t.writeInt16BE=k.writeInt16BE,t.writeInt32LE=k.writeInt32LE,t.writeInt32BE=k.writeInt32BE,t.writeFloatLE=k.writeFloatLE,t.writeFloatBE=k.writeFloatBE,t.writeDoubleLE=k.writeDoubleLE,t.writeDoubleBE=k.writeDoubleBE,t.fill=k.fill,t.inspect=k.inspect,t.toArrayBuffer=k.toArrayBuffer,t};var _=/[^+\/0-9A-Za-z-_]/g;function A(t){return t<16?"0"+t.toString(16):t.toString(16)}function B(t,e){var n;e=e||1/0;for(var i=t.length,r=null,o=[],s=0;s<i;s++){if(55295<(n=t.charCodeAt(s))&&n<57344){if(!r){if(56319<n){-1<(e-=3)&&o.push(239,191,189);continue}if(s+1===i){-1<(e-=3)&&o.push(239,191,189);continue}r=n;continue}if(n<56320){-1<(e-=3)&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&-1<(e-=3)&&o.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function M(t){return i.toByteArray(function(t){var e;if((t=(e=t,e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")).replace(_,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function P(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);r++)e[r+n]=t[r];return r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:2,isarray:3}]},{},[])("buffer")});var saveAs=saveAs||function(f){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=f.document,p=function(){return f.URL||f.webkitURL||f},m=t.createElementNS("http://www.w3.org/1999/xhtml","a"),g="download"in m,y=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),v=f.webkitRequestFileSystem,b=f.requestFileSystem||v||f.mozRequestFileSystem,o=function(t){(f.setImmediate||f.setTimeout)(function(){throw t},0)},w="application/octet-stream",x=0,S=function(t){var e=function(){"string"==typeof t?p().revokeObjectURL(t):t.remove()};f.chrome?e():setTimeout(e,500)},E=function(t,e,n){for(var i=(e=[].concat(e)).length;i--;){var r=t["on"+e[i]];if("function"==typeof r)try{r.call(t,n||t)}catch(t){o(t)}}},C=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t},i=function(i,n,t){t||(i=C(i));var r,o,e,s=this,a=i.type,l=!1,c=function(){E(s,"writestart progress write writeend".split(" "))},u=function(){if(o&&y&&"undefined"!=typeof FileReader){var e=new FileReader;return e.onloadend=function(){var t=e.result;o.location.href="data:attachment/file"+t.slice(t.search(/[,;]/)),s.readyState=s.DONE,c()},e.readAsDataURL(i),void(s.readyState=s.INIT)}(!l&&r||(r=p().createObjectURL(i)),o)?o.location.href=r:null==f.open(r,"_blank")&&y&&(f.location.href=r);s.readyState=s.DONE,c(),S(r)},h=function(t){return function(){if(s.readyState!==s.DONE)return t.apply(this,arguments)}},d={create:!0,exclusive:!1};if(s.readyState=s.INIT,n||(n="download"),g)return r=p().createObjectURL(i),void setTimeout(function(){var t,e;m.href=r,m.download=n,t=m,e=new MouseEvent("click"),t.dispatchEvent(e),c(),S(r),s.readyState=s.DONE});f.chrome&&a&&a!==w&&(e=i.slice||i.webkitSlice,i=e.call(i,0,i.size,w),l=!0),v&&"download"!==n&&(n+=".download"),(a===w||v)&&(o=f),b?(x+=i.size,b(f.TEMPORARY,x,h(function(t){t.root.getDirectory("saved",d,h(function(t){var e=function(){t.getFile(n,d,h(function(n){n.createWriter(h(function(e){e.onwriteend=function(t){o.location.href=n.toURL(),s.readyState=s.DONE,E(s,"writeend",t),S(n)},e.onerror=function(){var t=e.error;t.code!==t.ABORT_ERR&&u()},"writestart progress write abort".split(" ").forEach(function(t){e["on"+t]=s["on"+t]}),e.write(i),s.abort=function(){e.abort(),s.readyState=s.DONE},s.readyState=s.WRITING}),u)}),u)};t.getFile(n,{create:!1},h(function(t){t.remove(),e()}),h(function(t){t.code===t.NOT_FOUND_ERR?e():u()}))}),u)}),u)):u()},e=i.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return n||(t=C(t)),navigator.msSaveOrOpenBlob(t,e||"download")}:(e.abort=function(){this.readyState=this.DONE,E(this,"abort")},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,function(t,e,n){return new i(t,e,n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(c){function t(t){if("string"==typeof t.data&&(t.data={keys:t.data}),t.data&&t.data.keys&&"string"==typeof t.data.keys){var a=t.handler,l=t.data.keys.toLowerCase().split(" ");t.handler=function(n){if(this===n.target||!(/textarea|select/i.test(n.target.nodeName)||c.hotkeys.options.filterTextInputs&&-1<c.inArray(n.target.type,c.hotkeys.textAcceptingInputTypes))){var i="keypress"!==n.type&&c.hotkeys.specialKeys[n.which],t=String.fromCharCode(n.which).toLowerCase(),r="",e={};c.each(["alt","ctrl","shift"],function(t,e){n[e+"Key"]&&i!==e&&(r+=e+"+")}),n.metaKey&&!n.ctrlKey&&"meta"!==i&&(r+="meta+"),n.metaKey&&"meta"!==i&&-1<r.indexOf("alt+ctrl+shift+")&&(r=r.replace("alt+ctrl+shift+","hyper+")),i?e[r+i]=!0:(e[r+t]=!0,e[r+c.hotkeys.shiftNums[t]]=!0,"shift+"===r&&(e[c.hotkeys.shiftNums[t]]=!0));for(var o=0,s=l.length;o<s;o++)if(e[l[o]])return a.apply(this,arguments)}}}}c.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],options:{filterTextInputs:!0}},c.each(["keydown","keyup","keypress"],function(){c.event.special[this]={add:t}})}(jQuery||this.jQuery||window.jQuery),function(s,n,i,o,t){"use strict";var e,a="tinyscroll",l=function(t,e){this.element=t,this.$element=s(this.element),this.options=s.extend({},l.defaults,s.isPlainObject(e)?e:{}),this.init()};l.defaults={},l.prototype={Constructor:l,init:function(){var t=this.$element;this.sliderTop=0;if(this.eventName=this.isDesk?"Moz"===this.prefix?"DOMMouseScroll":"wheel":"touchend",this.$content=t.children().slice(0,1),this.$pane=s("<div class='tinyscroll-pane' ><div class='tinyscroll-pane-slider' /></div>").appendTo(t),this.$slider=this.$pane.children(),this.$content[0].style.right=this.scrollbarWidth()+"px",this.isDesk||(this.$pane[0].style.width="3px",this.$pane[0].style.opacity=0),this.sliderHeight=this.calcSliderHeight(this.$content[0],this.$slider[0]),this.sliderHeight===t[0].scrollHeight)return this.sliderHeight=0,void this.$pane.remove();this.$slider[0].style.height=this.sliderHeight+"px",this.bindEvent()},calcSliderHeight:function(t,e){return this.sliderHeight=o.pow(t.clientHeight,2)/t.scrollHeight},calcSliderTop:function(t){return this.sliderTop=(this.$content[0].clientHeight-this.sliderHeight)/(this.$content[0].scrollHeight-this.$content[0].clientHeight)*t,this.sliderTop},calcContentTop:function(t){return t*(this.$content[0].scrollHeight-this.$content[0].clientHeight)/(this.$content[0].clientHeight-this.sliderHeight)},isDesk:(e=navigator.userAgent.toLowerCase(),(-1<e.indexOf("chrome")||e.indexOf("firefox")||e.indexOf("ie"))&&(-1<e.indexOf("windows")||-1<e.indexOf("macintosh")||-1<e.indexOf("linux"))&&e.indexOf("mobile")<0&&e.indexOf("android")<0),scrollbarWidth:function(){var t,e=i.createElement("div");return e.style.width=e.style.height="100px",e.style.overflow="scroll",i.body.appendChild(e),t=e.clientWidth-e.offsetWidth,i.body.removeChild(e),t},prefix:function(){if(n.getComputedStyle){var t=n.getComputedStyle(i.documentElement,""),e=([].slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1];return"WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1]}}(),preventDefault:function(t){t.preventDefault()},fnWheel:function(t){this.getDirection(t),this.bothTip(this.direction,t),t.stopPropagation()},getDirection:function(t){var e=null;e=this.isDesk?"Moz"===this.prefix?0<t.originalEvent.detail:t.originalEvent.wheelDelta<0:t.originalEvent.changedTouches[0].clientY-this.touchStartClientY<0,this.direction=e},bothTip:function(t,e){var n=this;t?n.$content[0].scrollTop>=n.$content[0].scrollHeight-n.$content[0].clientHeight&&(n.preventDefault(e),n.$element.trigger({type:"scrollTop"})):0===n.$content[0].scrollTop&&(n.preventDefault(e),n.$element.trigge,n.$element.trigger({type:"scrollBottom"}))},calcTranslate:function(){this.$slider[0].style.transform="translate3d( 0 , "+this.calcSliderTop(this.$content[0].scrollTop)+"px , 0 )"},bindEvent:function(){var r=this;r.isDesk||r.$content.on("touchstart",function(t){var e=t.originalEvent.changedTouches[0].clientY;r.touchStartClientY=e}),r.$content.on(r.eventName,s.proxy(r.fnWheel,r)).on("scroll",s.proxy(r.calcTranslate,r)),r.$slider.on("mousedown",function(t){return r.getStartPoint(t),this.setCapture?(s(this).on("mousemove",s.proxy(r.fnMove,r)).on("mouseup",s.proxy(r.fnUp,r)),this.setCapture()):s(i).on("mousemove",s.proxy(r.fnMove,r)).on("mouseup",s.proxy(r.fnUp,r)),r.$slider[0].classList.add("show"),!1}),r.$pane.on(r.eventName,function(t){var e=r.$content[0],n=e.scrollTop;r.preventDefault(t),r.getDirection(t),r.direction?n+=100:n-=100,n=o.max(0,n),n=o.min(e.scrollHeight-e.clientHeight,n),e.scrollTop=n,r.bothTip(r.direction,t),r.calcTranslate()}).on("click",function(t){if(t.target!==r.$slider[0]){var e=r.sliderTop,n=t.pageY-s(this).offset().top,i=n-r.sliderTop;i<0?o.abs(i)<r.sliderHeight?e=n-r.sliderHeight/2:e-=70:o.abs(i)-r.sliderHeight<r.sliderHeight?e=n-r.sliderHeight/2:e+=70,e=o.max(0,e),e=o.min(r.$content[0].clientHeight-r.sliderHeight,e),r.sliderTop=e,r.$content[0].scrollTop=r.calcContentTop(r.sliderTop),r.calcTranslate()}})},addDrag:function(t){t.on("mousemove",s.proxy(this.fnMove,this)).on("mouseup",s.proxy(this.fnUp,this))},removeDrag:function(t){this.$element.off("mousemove",this.fnMove).off("mouseup",this.fnUp)},fnMove:function(t){this.sliderTop=t.pageY-this.downPointY;var e=this.sliderTop;e=o.max(0,e),e=o.min(this.$content[0].clientHeight-this.sliderHeight,e),this.$slider[0].style.transition="none",this.$slider[0].style.transform="translate3d(0 , "+e+"px ,0 )",this.$content[0].scrollTop=this.calcContentTop(e)},fnUp:function(t){this.$slider[0].style.transition=".2s",this.$slider[0].releaseCapture?(this.$slider.off("mousemove",this.fnMove).off("mouseup",this.fnUp),this.$slider[0].releaseCapture()):s(i).off("mousemove",this.fnMove).off("mouseup",this.fnUp),this.$slider[0].classList.remove("show")},getStartPoint:function(t){this.downPointY=t.pageY-this.$slider.position().top},setTop:function(t){var e=this.$content;t="number"==typeof t?t:s(t).position().top,t=e[0].scrollTop+t,e[0].scrollTop=t,e.trigger("scroll",s.proxy(this.calcTranslate,this))},reset:function(){this.sliderHeight=this.calcSliderHeight(this.$content[0],this.$slider[0]),this.$slider[0].style.height=(o.abs(this.$element[0].scrollHeight-this.sliderHeight)<5?0:this.sliderHeight)+"px",this.$content[0].scrollTop=0,this.setTop(0)}},s.fn[a]=function(n){var i=null,r=null,o=[].slice.call(arguments,1);return this.each(function(){var t=s(this),e=t.data(a);e||t.data(a,e=new l(this,n)),"string"==typeof n&&"function"==typeof(r=e[n])&&(i=r.apply(e,o))}),i||this}}(jQuery,window,document,Math),function(s,t,e,n){"use strict";var a="modalbox",l=function(t,e){this.$element=s(t),this.options=s.extend({},l.defaults,this.$element.data(),s.isPlainObject(e)?e:{}),this.init()};l.defaults={container:"body",template:'<div class="modalbox"><div class="modalbox-main"><div class="modalbox-content"><div class="modalbox-header"><h4> {%TITLE%}<a href="javascript:;" class="modalbox-close"><svg width="1024" height="1024" viewBox="0 0 1024 1024"><g class="transform-group"><g transform="translate(0, 25.375) scale(1, -1) scale(0.03125, 0.03125)"><path d="M573.989475 312.942837l288.898365 279.702021c14.022629 13.587739 14.022629 35.617094 0 49.206846-14.020551 13.587739-36.757056 13.587739-50.780724 0L523.185891 362.128539 234.265705 641.852712c-14.023668 13.587739-36.760173 13.587739-50.780724 0-14.022629-13.589753-14.022629-35.620114 0-49.206846l288.898365-279.702021L183.484981 33.240816c-14.022629-13.587739-14.022629-35.617094 0-49.206846 14.020551-13.587739 36.757056-13.587739 50.780724 0l288.920186 279.724172 288.920186-279.724172c14.023668-13.587739 36.760173-13.587739 50.780724 0 14.022629 13.589753 14.022629 35.620114 0 49.206846L573.989475 312.942837z" fill="#737383"/></g></g></svg></a></h4></div><div class="modalbox-body">{%CONTENT%}</div></div></div></div>',title:"æ¨¡ææ¡",controlWidth:!0,content:"",width:550,class:"",draggable:!0,dragHeader:!0,top:"0",left:"0",marginTop:"-200px",in:"zoomIn",out:"zoomOut"},l.prototype={Constructor:l,init:function(){var t=this,e=t.options,n=e.class,i=e.template.replace("{%TITLE%}",e.title).replace("{%CONTENT%}",e.content);t.$tmpl=s(i),t.$main=s("."+a+"-main",t.$tmpl),t.$mainBody=s("."+a+"-body",t.$tmpl),t.$close=s("."+a+"-close",t.$main),n&&(t.$tmpl[0].classList?t.$tmpl[0].classList.add(e.class):t.$tmpl[0].className+=" "+t.$tmpl[0].className),t.$tmpl.appendTo(e.container),t.$element.trigger({type:"show",modalBody:t.$mainBody}),t.$main.addClass(e.in+" animated"),e.draggable&&t.$main.myDrag(e.dragHeader&&{handler:".modalbox-header"}),setTimeout(function(){t.$element.trigger({type:"shown",modalBody:t.$mainBody})},100),t.$main.css({width:e.controlWidth?e.width<550?550:e.width+40:e.width,marginLeft:e.marginLeft||-(e.width>>>1)+"px",marginTop:e.marginTop}),t.bindEvent()},bindEvent:function(){var i=this;i.$close.add("[data-name=modalbox-close]").on("click",function(){i.$element.trigger({type:"close"}),i.$main.removeClass(i.options.in).addClass(i.options.out),setTimeout(function(){i.$tmpl.fadeOut(200,function(){s(this).remove(),i.$element.data(a,null)})},300)}),i.$tmpl.on("click","[data-name=save]",function(t){i.$element.trigger({type:"save"})}),i.$tmpl.on("click","[data-name=svgSave]",function(t){var e=window.Blob,n=i.options.content.replace('<div style="background-color:white;" data-name=svgSave>',"").replace("</div>","");saveAs(new e(['<?xml version="1.0" encoding="utf-8"?>'+n],{type:"text/plain; charset=utf-8"}),"InDraw"+((new Date).getTime()+"").slice(-5)+".svg")})},close:function(){this.$close.trigger("click")}},s.fn[a]=function(n){var i=null,r=null,o=[].slice.call(arguments,1);return this.each(function(){var t=s(this),e=t.data(a);e||t.data(a,e=new l(this,n)),"string"==typeof n&&"function"==typeof(r=e[n])&&(i=r.apply(e,o))}),i||this}}(jQuery,window,document),function(a,s,l){var d,f,p=a.SVGAngle||s.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",c=15,m=['<div class="picker-wrapper">','<div class="picker"></div>','<div class="picker-indicator"></div>',"</div>",'<div class="slide-wrapper">','<div class="slide"></div>','<div class="slide-indicator"></div>',"</div>"].join("");function u(t){if(a.event&&a.event.contentOverflow!==l)return{x:a.event.offsetX,y:a.event.offsetY};if(t.offsetX!==l&&t.offsetY!==l)return{x:t.offsetX,y:t.offsetY};var e=t.target.parentNode.parentNode;return{x:t.layerX-e.offsetLeft,y:t.layerY-e.offsetTop}}function t(t,e,n){for(var i in t=s.createElementNS("http://www.w3.org/2000/svg",t),e)t.setAttribute(i,e[i]);"[object Array]"!=Object.prototype.toString.call(n)&&(n=[n]);for(var r=0,o=n[0]&&n.length||0;r<o;r++)t.appendChild(n[r]);return t}function h(t){var e,n,i,r,o,s=t.h%360/60;r=(o=t.v*t.s)*(1-Math.abs(s%2-1)),e=n=i=t.v-o,e+=[o,r,0,0,r,o][s=~~s],n+=[r,o,o,r,0,0][s],i+=[0,0,r,o,o,r][s];var a=Math.floor(255*e),l=Math.floor(255*n),c=Math.floor(255*i);return{r:a,g:l,b:c,hex:"#"+(16777216|c|l<<8|a<<16).toString(16).slice(1)}}function e(t){var e,n,i=t.r,r=t.g,o=t.b;return(1<t.r||1<t.g||1<t.b)&&(i/=255,r/=255,o/=255),{h:(0==(n=(e=Math.max(i,r,o))-Math.min(i,r,o))?null:e==i?(r-o)/n+(r<o?6:0):e==r?(o-i)/n+2:(i-r)/n+4)%6*60,s:0==n?0:n/e,v:e}}function g(r,o,s){return function(t){(t=t||a.event).cancelBubble=!0,t.stopPropagation&&t.stopPropagation();var e=u(t);r.h=e.y/o.offsetHeight*360+c;var n=h({h:r.h,s:1,v:1}),i=h({h:r.h,s:r.s,v:r.v});s.style.backgroundColor=n.hex,r.callback&&r.callback(i.hex,{h:r.h-c,s:r.s,v:r.v},{r:i.r,g:i.g,b:i.b},l,e)}}function y(o,s){return function(t){(t=t||a.event).cancelBubble=!0,t.stopPropagation&&t.stopPropagation();var e=u(t),n=s.offsetWidth,i=s.offsetHeight;o.s=e.x/n,o.v=(i-e.y)/i;var r=h(o);return o.callback&&o.callback(r.hex,{h:o.h-c,s:o.s,v:o.v},{r:r.r,g:r.g,b:r.b},e),!1}}"SVG"==p?(f=t("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[t("defs",{},t("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[t("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),t("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),t("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),t("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),t("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),t("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),t("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),t("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),t("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),t("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]),d=t("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[t("defs",{},[t("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[t("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),t("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),t("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[t("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),t("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),t("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),t("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})])):"VML"==p&&(f=['<DIV style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill>',"</v:rect>","</DIV>"].join(""),d=['<DIV style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>",'<v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>","</DIV>"].join(""),s.namespaces.v||s.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"));var v=0;function b(t,o,e){if(!(this instanceof b))return new b(t,o,e);if(this.h=0,this.s=1,this.v=1,e)this.callback=e,this.pickerElement=o,this.slideElement=t;else{var n=t;n.innerHTML=m,this.slideElement=n.getElementsByClassName("slide")[0],this.pickerElement=n.getElementsByClassName("picker")[0];var s=n.getElementsByClassName("slide-indicator")[0],a=n.getElementsByClassName("picker-indicator")[0];b.fixIndicators(s,a),this.callback=function(t,e,n,i,r){b.positionIndicators(s,a,r,i),o(t,e,n)}}if("SVG"==p){if(!f)return;var i=f.cloneNode(!0),r=d.cloneNode(!0),l=i.getElementById("gradient-hsv"),c=i.getElementsByTagName("rect")[0];try{l.id="gradient-hsv-"+v,c.setAttribute("fill","url(#"+l.id+")");var u=[r.getElementById("gradient-black"),r.getElementById("gradient-white")],h=r.getElementsByTagName("rect");u[0].id="gradient-black-"+v,u[1].id="gradient-white-"+v,h[0].setAttribute("fill","url(#"+u[1].id+")"),h[1].setAttribute("fill","url(#"+u[0].id+")"),this.slideElement.appendChild(i),this.pickerElement.appendChild(r),v++}catch(t){}}else this.slideElement.innerHTML=f,this.pickerElement.innerHTML=d;w(this.slideElement,"click",g(this,this.slideElement,this.pickerElement)),w(this.pickerElement,"click",y(this,this.pickerElement)),x(this,this.slideElement,g(this,this.slideElement,this.pickerElement)),x(this,this.pickerElement,y(this,this.pickerElement))}function w(t,e,n){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,!1)}function x(t,e,n){var i=!1;w(e,"mousedown",function(t){i=!0}),w(e,"mouseup",function(t){i=!1}),w(e,"mouseout",function(t){i=!1}),w(e,"mousemove",function(t){i&&n(t)})}function n(t,e,n,i){t.h=e.h%360,t.s=e.s,t.v=e.v;var r=h(t),o={y:t.h*t.slideElement.offsetHeight/360,x:0},s=t.pickerElement.offsetHeight,a={x:t.s*t.pickerElement.offsetWidth,y:s-t.v*s};return t.pickerElement.style.backgroundColor=h({h:t.h,s:1,v:1}).hex,t.callback&&t.callback(i||r.hex,{h:t.h,s:t.s,v:t.v},n||{r:r.r,g:r.g,b:r.b},a,o),t}b.hsv2rgb=function(t){var e=h(t);return delete e.hex,e},b.hsv2hex=function(t){return h(t).hex},b.rgb2hsv=e,b.rgb2hex=function(t){return h(e(t)).hex},b.hex2hsv=function(t){return e(b.hex2rgb(t))},b.hex2rgb=function(t){return{r:parseInt(t.substr(1,2),16),g:parseInt(t.substr(3,2),16),b:parseInt(t.substr(5,2),16)}},b.prototype.setHsv=function(t){return n(this,t)},b.prototype.setRgb=function(t){return n(this,e(t),t)},b.prototype.setHex=function(t){return n(this,b.hex2hsv(t),l,t)},b.positionIndicators=function(t,e,n,i){n&&(t.style.top=n.y-t.offsetHeight/2+"px"),i&&(e.style.top=i.y-e.offsetHeight/2+"px",e.style.left=i.x-e.offsetWidth/2+"px")},b.fixIndicators=function(t,e){e.style.pointerEvents="none",t.style.pointerEvents="none"},a.selectColor=b}(window,window.document),function(l){var t,e,c=!1,n="[object OperaMini]"===Object.prototype.toString.call(window.operamini),i="placeholder"in document.createElement("input")&&!n&&!c,r="placeholder"in document.createElement("textarea")&&!n&&!c,o=l.valHooks,s=l.propHooks,u={};function h(t,e){var n=l(this);if(this.value===n.attr(c?"placeholder-x":"placeholder")&&n.hasClass(u.customClass))if(this.value="",n.removeClass(u.customClass),n.data("placeholder-password")){if(n=n.hide().nextAll('input[type="password"]:first').show().attr("id",n.removeAttr("id").data("placeholder-id")),!0===t)return n[0].value=e;n.focus()}else this==d()&&this.select()}function a(t){var e,n,i,r,o=l(this),s=this.id;if(!t||"blur"!==t.type||!o.hasClass(u.customClass))if(""===this.value){if("password"===this.type){if(!o.data("placeholder-textinput")){try{e=o.clone().prop({type:"text"})}catch(t){e=l("<input>").attr(l.extend((n=this,i={},r=/^jQuery\d+$/,l.each(n.attributes,function(t,e){e.specified&&!r.test(e.name)&&(i[e.name]=e.value)}),i),{type:"text"}))}e.removeAttr("name").data({"placeholder-enabled":!0,"placeholder-password":o,"placeholder-id":s}).bind("focus.placeholder",h),o.data({"placeholder-textinput":e,"placeholder-id":s}).before(e)}this.value="",o=o.removeAttr("id").hide().prevAll('input[type="text"]:first').attr("id",o.data("placeholder-id")).show()}else{var a=o.data("placeholder-password");a&&(a[0].value="",o.attr("id",o.data("placeholder-id")).show().nextAll('input[type="password"]:last').hide().removeAttr("id"))}o.addClass(u.customClass),o[0].value=o.attr(c?"placeholder-x":"placeholder")}else o.removeClass(u.customClass)}function d(){try{return document.activeElement}catch(t){}}i&&r?((e=l.fn.placeholder=function(){return this}).input=!0,e.textarea=!0):((e=l.fn.placeholder=function(t){return u=l.extend({},{customClass:"placeholder"},t),this.filter((i?"textarea":":input")+"["+(c?"placeholder-x":"placeholder")+"]").not("."+u.customClass).not(":radio, :checkbox, [type=hidden]").bind({"focus.placeholder":h,"blur.placeholder":a}).data("placeholder-enabled",!0).trigger("blur.placeholder")}).input=i,e.textarea=r,t={get:function(t){var e=l(t),n=e.data("placeholder-password");return n?n[0].value:e.data("placeholder-enabled")&&e.hasClass(u.customClass)?"":t.value},set:function(t,e){var n,i,r=l(t);return""!==e&&(n=r.data("placeholder-textinput"),i=r.data("placeholder-password"),n?(h.call(n[0],!0,e)||(t.value=e),n[0].value=e):i&&(h.call(t,!0,e)||(i[0].value=e),t.value=e)),r.data("placeholder-enabled")?""===e?(t.value=e,t!=d()&&a.call(t)):(r.hasClass(u.customClass)&&h.call(t),t.value=e):t.value=e,r}},i||(o.input=t,s.value=t),r||(o.textarea=t,s.value=t),l(function(){l(document).delegate("form","submit.placeholder",function(){var t=l("."+u.customClass,this).each(function(){h.call(this,!0,"")});setTimeout(function(){t.each(a)},10)})}),l(window).bind("beforeunload.placeholder",function(){var t=!0;try{"javascript:void(0)"===document.activeElement.toString()&&(t=!1)}catch(t){}t&&l("."+u.customClass).each(function(){this.value=""})}))}(jQuery),function(){"use strict";var d,w,f,p,a;function m(t,e){var n,i=Object.keys(e);for(n=0;n<i.length;n++)t=t.replace(new RegExp("\\{"+i[n]+"\\}","gi"),e[i[n]]);return t}function l(t){var e,n,i;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",i=0;i<12;i++)n+=e[Math.floor(Math.random()*e.length)]}while(t[n]);return n}a=function(t,e){var n,i,r,o={};for(t=t.split(","),e=e||10,n=0;n<t.length;n+=2)i="&"+t[n+1]+";",r=parseInt(t[n],e),o[i]="&#"+r+";";return o["\\xa0"]="&#160;",o}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),d={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(f=function(t,e){this.__root=t,this.__ctx=e}).prototype.addColorStop=function(t,e){var n,i=this.__ctx.__createElement("stop");i.setAttribute("offset",t),-1!==e.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e),i.setAttribute("stop-color",m("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),i.setAttribute("stop-opacity",n[4])):i.setAttribute("stop-color",e),this.__root.appendChild(i)},p=function(t,e){this.__root=t,this.__ctx=e},(w=function(t){var e,n={width:500,height:500,enableMirroring:!1};if(1<arguments.length?((e=n).width=t,e.height=arguments[1]):e=t||n,!(this instanceof w))return new w(e);this.width=e.width||n.width,this.height=e.height||n.height,this.enableMirroring=void 0!==e.enableMirroring?e.enableMirroring:n.enableMirroring,(this.canvas=this).__document=e.document||document,e.ctx?this.__ctx=e.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(t,e,n){void 0===e&&(e={});var i,r,o=this.__document.createElementNS("http://www.w3.org/2000/svg",t),s=Object.keys(e);for(n&&(o.setAttribute("fill","none"),o.setAttribute("stroke","none")),i=0;i<s.length;i++)r=s[i],o.setAttribute(r,e[r]);return o},w.prototype.__setDefaultStyles=function(){var t,e,n=Object.keys(d);for(t=0;t<n.length;t++)this[e=n[t]]=d[e].canvas},w.prototype.__applyStyleState=function(t){var e,n,i=Object.keys(t);for(e=0;e<i.length;e++)this[n=i[e]]=t[n]},w.prototype.__getStyleState=function(){var t,e,n={},i=Object.keys(d);for(t=0;t<i.length;t++)n[e=i[t]]=this[e];return n},w.prototype.__applyStyleToCurrentElement=function(e){var t=this.__currentElement,n=this.__currentElementsToStyle;n&&(t.setAttribute(e,""),t=n.element,n.children.forEach(function(t){t.setAttribute(e,"")}));var i,r,o,s,a,l=Object.keys(d);for(i=0;i<l.length;i++)if(r=d[l[i]],o=this[l[i]],r.apply)if(o instanceof p){if(o.__ctx)for(;o.__ctx.__defs.childNodes.length;)s=o.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[s]=s,this.__defs.appendChild(o.__ctx.__defs.childNodes[0]);t.setAttribute(r.apply,m("url(#{id})",{id:o.__root.getAttribute("id")}))}else if(o instanceof f)t.setAttribute(r.apply,m("url(#{id})",{id:o.__root.getAttribute("id")}));else if(-1!==r.apply.indexOf(e)&&r.svg!==o)if(("stroke"===r.svgAttr||"fill"===r.svgAttr)&&o&&o.indexOf&&-1!==o.indexOf("rgba")){a=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(o),t.setAttribute(r.svgAttr,m("rgb({r},{g},{b})",{r:a[1],g:a[2],b:a[3]}));var c=a[4],u=this.globalAlpha;null!=u&&(c*=u),t.setAttribute(r.svgAttr+"-opacity",c)}else{var h=r.svgAttr;if("globalAlpha"===l[i]&&(h=e+"-"+r.svgAttr,t.getAttribute(h)))continue;t.setAttribute(h,o)}},w.prototype.__closestGroupOrSvg=function(t){return"g"===(t=t||this.__currentElement).nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},w.prototype.getSerializedSvg=function(t){var e,n,i,r,o,s=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(s)&&(s=s.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(a),n=0;n<e.length;n++)i=e[n],r=a[i],(o=new RegExp(i,"gi")).test(s)&&(s=s.replace(o,r));return s},w.prototype.getSvg=function(){return this.__root},w.prototype.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},w.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},w.prototype.__addTransform=function(t){var e=this.__closestGroupOrSvg();if(0<e.childNodes.length){var n=this.__createElement("g");e.appendChild(n),this.__currentElement=n}var i=this.__currentElement.getAttribute("transform");i?i+=" ":i="",i+=t,this.__currentElement.setAttribute("transform",i)},w.prototype.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(m("scale({x},{y})",{x:t,y:e}))},w.prototype.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(m("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},w.prototype.translate=function(t,e){this.__addTransform(m("translate({x},{y})",{x:t,y:e}))},w.prototype.transform=function(t,e,n,i,r,o){this.__addTransform(m("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:n,d:i,e:r,f:o}))},w.prototype.beginPath=function(){var t;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(t),this.__currentElement=t},w.prototype.__applyCurrentDefaultPath=function(){if("path"!==this.__currentElement.nodeName)throw new Error("Attempted to apply path command to node "+this.__currentElement.nodeName);var t=this.__currentDefaultPath;this.__currentElement.setAttribute("d",t)},w.prototype.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},w.prototype.moveTo=function(t,e){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(m("M {x} {y}",{x:t,y:e}))},w.prototype.closePath=function(){this.__addPathCommand("Z")},w.prototype.lineTo=function(t,e){this.__currentPosition={x:t,y:e},-1<this.__currentDefaultPath.indexOf("M")?this.__addPathCommand(m("L {x} {y}",{x:t,y:e})):this.__addPathCommand(m("M {x} {y}",{x:t,y:e}))},w.prototype.bezierCurveTo=function(t,e,n,i,r,o){this.__currentPosition={x:r,y:o},this.__addPathCommand(m("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:n,cp2y:i,x:r,y:o}))},w.prototype.quadraticCurveTo=function(t,e,n,i){this.__currentPosition={x:n,y:i},this.__addPathCommand(m("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:n,y:i}))};var x=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]};w.prototype.arcTo=function(t,e,n,i,r){var o=this.__currentPosition&&this.__currentPosition.x,s=this.__currentPosition&&this.__currentPosition.y;if(void 0!==o&&void 0!==s){if(r<0)throw new Error("IndexSizeError: The radius provided ("+r+") is negative.");if(o===t&&s===e||t===n&&e===i||0===r)this.lineTo(t,e);else{var a=x([o-t,s-e]),l=x([n-t,i-e]);if(a[0]*l[1]!=a[1]*l[0]){var c=a[0]*l[0]+a[1]*l[1],u=Math.acos(Math.abs(c)),h=x([a[0]+l[0],a[1]+l[1]]),d=r/Math.sin(u/2),f=t+d*h[0],p=e+d*h[1],m=[-a[1],a[0]],g=[l[1],-l[0]],y=function(t){var e=t[0];return 0<=t[1]?Math.acos(e):-Math.acos(e)},v=y(m),b=y(g);this.lineTo(f+m[0]*r,p+m[1]*r),this.arc(f,p,r,v,b)}else this.lineTo(t,e)}}},w.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},w.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},w.prototype.rect=function(t,e,n,i){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.lineTo(t,e),this.closePath()},w.prototype.fillRect=function(t,e,n,i){var r;r=this.__createElement("rect",{x:t,y:e,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(r),this.__currentElement=r,this.__applyStyleToCurrentElement("fill")},w.prototype.strokeRect=function(t,e,n,i){var r;r=this.__createElement("rect",{x:t,y:e,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(r),this.__currentElement=r,this.__applyStyleToCurrentElement("stroke")},w.prototype.__clearCanvas=function(){for(var t=this.__closestGroupOrSvg().getAttribute("transform"),e=this.__root.childNodes[1],n=e.childNodes,i=n.length-1;0<=i;i--)n[i]&&e.removeChild(n[i]);this.__currentElement=e,this.__groupStack=[],t&&this.__addTransform(t)},w.prototype.clearRect=function(t,e,n,i){if(0!==t||0!==e||n!==this.width||i!==this.height){var r,o=this.__closestGroupOrSvg();r=this.__createElement("rect",{x:t,y:e,width:n,height:i,fill:"#FFFFFF"},!0),o.appendChild(r)}else this.__clearCanvas()},w.prototype.createLinearGradient=function(t,e,n,i){var r=this.__createElement("linearGradient",{id:l(this.__ids),x1:t+"px",x2:n+"px",y1:e+"px",y2:i+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(r),new f(r,this)},w.prototype.createRadialGradient=function(t,e,n,i,r,o){var s=this.__createElement("radialGradient",{id:l(this.__ids),cx:i+"px",cy:r+"px",r:o+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(s),new f(s,this)},w.prototype.__parseFont=function(){if(/[\u4e00-\u9fa5]+/.test(this.font)){var t=this.font.match(/[\u4e00-\u9fa5]+/g)[0];this.font=this.font.replace(/[\u4e00-\u9fa5]+/g,"chinese")}var e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z]+?)\s*$/i.exec(this.font);e[6]&&"chinese"===e[6]&&t&&(e[6]=t),e[6]&&(e[6]=e[6].replace(/\"/g,""));var n={style:e[1]||"normal",size:e[4]||"10px",family:e[6]||"sans-serif",weight:e[3]||"normal",decoration:e[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(n.decoration="underline"),this.__fontHref&&(n.href=this.__fontHref),n},w.prototype.__wrapTextLink=function(t,e){if(t.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),n.appendChild(e),n}return e},w.prototype.__applyText=function(t,e,n,i){var r,o,s,a,l=this.__parseFont(),c=this.__closestGroupOrSvg(),u=this.__createElement("text",{"font-family":l.family,"font-size":l.size,"font-style":l.style,"font-weight":l.weight,"text-decoration":l.decoration,x:e,y:n,"text-anchor":(s=this.textAlign,a={left:"start",right:"end",center:"middle",start:"start",end:"end"},a[s]||a.start),"dominant-baseline":(r=this.textBaseline,o={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"},o[r]||o.alphabetic)},!0);u.appendChild(this.__document.createTextNode(t)),this.__currentElement=u,this.__applyStyleToCurrentElement(i),c.appendChild(this.__wrapTextLink(l,u))},w.prototype.fillText=function(t,e,n){this.__applyText(t,e,n,"fill")},w.prototype.strokeText=function(t,e,n){this.__applyText(t,e,n,"stroke")},w.prototype.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},w.prototype.arc=function(t,e,n,i,r,o){if(i!==r){(i%=2*Math.PI)===(r%=2*Math.PI)&&(r=(r+2*Math.PI-.001*(o?-1:1))%(2*Math.PI));var s=t+n*Math.cos(r),a=e+n*Math.sin(r),l=t+n*Math.cos(i),c=e+n*Math.sin(i),u=o?0:1,h=0,d=r-i;d<0&&(d+=2*Math.PI),h=o?d>Math.PI?0:1:d>Math.PI?1:0,this.lineTo(l,c),this.__addPathCommand(m("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:h,sweepFlag:u,endX:s,endY:a})),this.__currentPosition={x:s,y:a}}},w.prototype.ellipse=function(t,e,n,i,r,o,s,a){if(o!==s){(o%=2*Math.PI)===(s%=2*Math.PI)&&(s=(s+2*Math.PI-.001*(a?-1:1))%(2*Math.PI));var l=t+n*Math.cos(s),c=e+i*Math.sin(s),u=t+n*Math.cos(o),h=e+i*Math.sin(o),d=a?0:1,f=0,p=s-o;p<0&&(p+=2*Math.PI),f=a?p>Math.PI?0:1:p>Math.PI?1:0,this.lineTo(u,h),this.__addPathCommand(m("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:i,xAxisRotation:0,largeArcFlag:f,sweepFlag:d,endX:l,endY:c})),this.__currentPosition={x:l,y:c}}},w.prototype.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),n=l(this.__ids),i=this.__createElement("g");this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),e.setAttribute("id",n),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",m("url(#{id})",{id:n})),t.appendChild(i),this.__currentElement=i},w.prototype.drawImage=function(){var t,e,n,i,r,o,s,a,l,c,u,h,d,f=Array.prototype.slice.call(arguments),p=f[0],m=0,g=0;if(3===f.length)t=f[1],e=f[2],n=r=p.width,i=o=p.height;else if(5===f.length)t=f[1],e=f[2],n=f[3],i=f[4],r=p.width,o=p.height;else{if(9!==f.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);m=f[1],g=f[2],r=f[3],o=f[4],t=f[5],e=f[6],n=f[7],i=f[8]}s=this.__closestGroupOrSvg(),this.__currentElement;var y="translate("+t+", "+e+")";if(p instanceof w){if((a=p.getSvg().cloneNode(!0)).childNodes&&1<a.childNodes.length){for(l=a.childNodes[0];l.childNodes.length;)d=l.childNodes[0].getAttribute("id"),this.__ids[d]=d,this.__defs.appendChild(l.childNodes[0]);if(c=a.childNodes[1]){var v,b=c.getAttribute("transform");v=b?b+" "+y:y,c.setAttribute("transform",v),s.appendChild(c)}}}else"CANVAS"!==p.nodeName&&"IMG"!==p.nodeName||((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",i),u.setAttribute("preserveAspectRatio","none"),(m||g||r!==p.width||o!==p.height)&&((h=this.__document.createElement("canvas")).width=n,h.height=i,h.getContext("2d").drawImage(p,m,g,r,o,0,0,n,i),p=h),u.setAttribute("transform",y),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===p.nodeName?p.toDataURL():p.getAttribute("src")),s.appendChild(u))},w.prototype.createPattern=function(t,e){var n,i=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),r=l(this.__ids);return i.setAttribute("id",r),i.setAttribute("width",t.width),i.setAttribute("height",t.height),"CANVAS"===t.nodeName||"IMG"===t.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),n.setAttribute("height",t.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===t.nodeName?t.toDataURL():t.getAttribute("src")),i.appendChild(n),this.__defs.appendChild(i)):t instanceof w&&(i.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(i)),new p(i,this)},w.prototype.setLineDash=function(t){t&&0<t.length?this.lineDash=t.join(","):this.lineDash=null},w.prototype.drawFocusRing=function(){},w.prototype.createImageData=function(){},w.prototype.getImageData=function(){},w.prototype.putImageData=function(){},w.prototype.globalCompositeOperation=function(){},w.prototype.setTransform=function(){},"object"==typeof window&&(window.C2S=w),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=w)}(),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=t()}}(function(){return function o(s,a,l){function c(e,t){if(!a[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[e]={exports:{}};s[e][0].call(r.exports,function(t){return c(s[e][1][t]||t)},r,r.exports,o,s,a,l)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(t,e,n){if("undefined"!=typeof Element&&!Element.prototype.matches){var i=Element.prototype;i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector}e.exports=function(t,e){for(;t&&9!==t.nodeType;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}},{}],2:[function(t,e,n){var s=t("./closest");e.exports=function(t,e,n,i,r){var o=function(e,n,t,i){return function(t){t.delegateTarget=s(t.target,n),t.delegateTarget&&i.call(e,t)}}.apply(this,arguments);return t.addEventListener(n,o,r),{destroy:function(){t.removeEventListener(n,o,r)}}}},{"./closest":1}],3:[function(t,e,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},{}],4:[function(t,e,n){var d=t("./is"),f=t("delegate");e.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!d.string(e))throw new TypeError("Second argument must be a String");if(!d.fn(n))throw new TypeError("Third argument must be a Function");if(d.node(t))return r=e,o=n,(i=t).addEventListener(r,o),{destroy:function(){i.removeEventListener(r,o)}};var i,r,o,s,a,l,c,u,h;if(d.nodeList(t))return s=t,a=e,l=n,Array.prototype.forEach.call(s,function(t){t.addEventListener(a,l)}),{destroy:function(){Array.prototype.forEach.call(s,function(t){t.removeEventListener(a,l)})}};if(d.string(t))return c=t,u=e,h=n,f(document.body,c,u,h);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},{"./is":3,delegate:2}],5:[function(t,e,n){e.exports=function(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=t.hasAttribute("readonly");n||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var i=window.getSelection(),r=document.createRange();r.selectNodeContents(t),i.removeAllRanges(),i.addRange(r),e=i.toString()}return e}},{}],6:[function(t,e,n){function i(){}i.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function i(){r.off(t,i),e.apply(n,arguments)}var r=this;return i._=e,this.on(t,i,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],r=[];if(i&&e)for(var o=0,s=i.length;o<s;o++)i[o].fn!==e&&i[o].fn._!==e&&r.push(i[o]);return r.length?n[t]=r:delete n[t],this}},e.exports=i},{}],7:[function(i,r,o){!function(t,e){if(void 0!==o)e(r,i("select"));else{var n={exports:{}};e(n,t.select),t.clipboardAction=n.exports}}(this,function(t,e){"use strict";var n,i=(n=e)&&n.__esModule?n:{default:n},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),s=function(){function e(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),this.resolveOptions(t),this.initSelection()}return o(e,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.container=t.container,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[e?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,i.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==(void 0===t?"undefined":r(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),e}();t.exports=s})},{select:5}],8:[function(i,r,o){!function(t,e){if(void 0!==o)e(r,i("./clipboard-action"),i("tiny-emitter"),i("good-listener"));else{var n={exports:{}};e(n,t.clipboardAction,t.tinyEmitter,t.goodListener),t.clipboard=n.exports}}(this,function(t,e,n,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var s=r(e),a=r(n),l=r(i),c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),h=function(t){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n.resolveOptions(e),n.listenClick(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,a.default),u(i,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===c(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=(0,l.default)(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new s.default({action:this.action(e),target:this.target(e),text:this.text(e),container:this.container,trigger:e,emitter:this})}},{key:"defaultAction",value:function(t){return o("action",t)}},{key:"defaultTarget",value:function(t){var e=o("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return o("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],e="string"==typeof t?[t]:t,n=!!document.queryCommandSupported;return e.forEach(function(t){n=n&&!!document.queryCommandSupported(t)}),n}}]),i}();t.exports=h})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),window.util||(window.util={});var EventMap={mousemove:"mousemove",mousedown:"mousedown",mouseup:"mouseup"};if(Array.prototype.swap=function(t,e){var n=this[t];this[t]=this[e],this[e]=n},util.each=function(t,e,n){util.assert(!util.isNullOrUndefined(t),"array must be defined");for(var i=0;i<t.length;++i)e.call(n,t[i],i)},util.map_each=function(t,e,n){for(var i in util.assert(!util.isNullOrUndefined(t),"map must be defined"),t)e.call(n,i,t[i])},util.find=function(t,e,n){for(var i=0;i<t.length;++i)if(e.call(n,t[i],i))return i;return-1},util.findAll=function(t,e,n){for(var i=[],r=0;r<t.length;++r)e.call(n,t[r],r)&&i.push(t[r]);return i},util.array=function(t){for(var e=[],n=t.length;0<=--n;)e[n]=t[n];return e},util.isEmpty=function(t){for(var e in t)return!1;return!0},util.stopEventPropagation=function(t){if("stopPropagation"in t)t.stopPropagation();else{if(!("cancelBubble"in t))throw Error("Browser unrecognized");t.cancelBubble=!0}},util.preventDefault=function(t){return"preventDefault"in t&&t.preventDefault(),Prototype.Browser.IE&&(t.returnValue=!1,t.keyCode=0),!1},util.setElementTextContent=function(t,e){if("textContent"in t)t.textContent=e;else{if(!("innerText"in t))throw Error("Browser unrecognized");t.innerText=e}},util.getElementTextContent=function(t){if("textContent"in t)return t.textContent;if("innerText"in t)return t.innerText;throw Error("Browser unrecognized")},util.stringPadded=function(t,e,n){t+="";for(var i="";t.length+i.length<e;)i+=" ";return n?t+i:i+t},util.idList=function(t){var e=[];for(var n in t)e.push(n);return e},util.mapArray=function(t,e){for(var n=[],i=0;i<t.length;++i)n.push(e[t[i]]);return n},util.arrayMax=function(t){return Math.max.apply(Math,t)},util.arrayMin=function(t){return Math.min.apply(Math,t)},util.map=function(t,e,n){for(var i=[],r=0;r<t.length;++r)i.push(e.call(n,t[r]));return i},util.apply=function(t,e){for(var n=0;n<t.length;++n)t[n]=e(t[n])},util.isUndefined=function(t){return void 0===t},util.ifDef=function(t,e,n,i){t[n]=util.isUndefined(e[n])?i:e[n]},util.ifDefList=function(t,e,n,i){t[n]=util.isUndefined(e[n])||null===e[n]?i:util.array(e[n])},util.identityMap=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=t[n];return e},util.strip=function(t){return t.replace(/\s*$/,"").replace(/^\s*/,"")},util.stripRight=function(t){return t.replace(/\s*$/,"")},util.stripQuotes=function(t){return'"'===t[0]&&'"'===t[t.length-1]?t.substr(1,t.length-2):t},util.paddedFloat=function(t,e,n){var i=t.toFixed(n).replace(",",".");if(i.length>e)throw new Error("number does not fit");return util.stringPadded(i,e)},util.paddedInt=function(t,e){var n=t.toFixed(0);if(n.length>e)throw new Error("number does not fit");return util.stringPadded(n,e)},util.arrayAddIfMissing=function(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return!1;return t.push(e),!0},util.assert=function(t,e){if(!t)throw new Error(e?"Assertion failed: "+e:"Assertion failed")},util.isNull=function(t){return null===t},util.isNullOrUndefined=function(t){return util.isUndefined(t)||util.isNull(t)},util.arrayRemoveByValue=function(t,e){util.assert(!util.isUndefined(t)&&!util.isNull(t),"array must be defined");for(var n=t.indexOf(e),i=0;0<=n;)t.splice(n,1),i+=1,n=t.indexOf(e);return i},util.listNextRotate=function(t,e){return t[(t.indexOf(e)+1)%t.length]},util.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},Array.prototype.each=function(t,e){for(var n=0,i=this.length>>>0;n<i;n++)if(n in this&&!1===t.call(e,this[n],n,this))return},Array.prototype.clone=function(){return Array.prototype.slice.call(this,0)},Array.prototype.findAll=function(){var n=[];return this.each(function(t,e){iterator.call(context,t,e,this)&&n.push(t)},this),n},Number.prototype.toPaddedString=function(t){var e=this+"";return t<=e.length?e:new Array(t-e.length+1).join("0")+e},window.util||(util={}),util.assertDefined=function(t){util.assert(!util.isNullOrUndefined(t))},util.Vec2=function(t,e,n){if(0==arguments.length)this.x=0,this.y=0,this.z=0;else if(1==arguments.length)this.x=parseFloat(t.x),this.y=parseFloat(t.y),this.z=isNaN(parseFloat(t.z))?0:parseFloat(t.z);else{if(!(2<=arguments.length))throw new Error("util.Vec2(): invalid arguments");this.x=parseFloat(t),this.y=parseFloat(e),this.z=isNaN(parseFloat(n))?0:parseFloat(n)}},util.Vec2.ZERO=new util.Vec2(0,0),util.Vec2.UNIT=new util.Vec2(1,1),util.Vec2.segmentIntersection=function(t,e,n,i){var r=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x),o=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),s=(n.x-t.x)*(i.y-t.y)-(n.y-t.y)*(i.x-t.x),a=(n.x-e.x)*(i.y-e.y)-(n.y-e.y)*(i.x-e.x);return r*o<=0&&s*a<=0},util.Vec2.prototype.length=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t=isNaN(t)||!isFinite(t)?Math.sqrt(this.x*this.x+this.y*this.y):t},util.Vec2.prototype.equals=function(t){return util.assertDefined(t),this.x==t.x&&this.y==t.y},util.Vec2.prototype.add=function(t){return util.assertDefined(t),new util.Vec2(this.x+t.x,this.y+t.y,this.z)},util.Vec2.prototype.add_=function(t){util.assertDefined(t),this.x+=t.x,this.y+=t.y},util.Vec2.prototype.sub=function(t){return new util.Vec2(this.x-t.x,this.y-t.y,this.z)},util.Vec2.prototype.scaled=function(t){return new util.Vec2(this.x*t,this.y*t,this.z*t)},util.Vec2.prototype.negated=function(){return new util.Vec2(-this.x,-this.y,this.z)},util.Vec2.prototype.yComplement=function(t){return t=t||0,new util.Vec2(this.x,t-this.y,this.z)},util.Vec2.prototype.addScaled=function(t,e){return new util.Vec2(this.x+t.x*e,this.y+t.y*e,this.z)},util.Vec2.prototype.normalized=function(){return this.scaled(1/this.length())},util.Vec2.prototype.normalize=function(){var t=this.length();return!(t<1e-6)&&(this.x/=t,this.y/=t,this.z/=t,!0)},util.Vec2.prototype.turnLeft=function(){return new util.Vec2(-this.y,this.x,this.z)},util.Vec2.prototype.coordStr=function(){return this.x.toString()+" , "+this.y.toString()},util.Vec2.prototype.toString=function(){return"("+this.x.toFixed(2)+","+this.y.toFixed(2)+")"},util.Vec2.dist=function(t,e){return util.Vec2.diff(t,e).length()},util.Vec2.max=function(t,e){return new util.Vec2(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},util.Vec2.min=function(t,e){return new util.Vec2(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},util.Vec2.prototype.max=function(t){return new util.Vec2.max(this,t)},util.Vec2.prototype.min=function(t){return new util.Vec2.min(this,t)},util.Vec2.prototype.ceil=function(){return new util.Vec2(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},util.Vec2.prototype.floor=function(){return new util.Vec2(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},util.Vec2.sum=function(t,e){return new util.Vec2(t.x+e.x,t.y+e.y,t.z+e.z)},util.Vec2.dot=function(t,e){return t.x*e.x+t.y*e.y},util.Vec2.cross=function(t,e){return t.x*e.y-t.y*e.x},util.Vec2.prototype.rotate=function(t){var e=Math.sin(t),n=Math.cos(t);return this.rotateSC(e,n)},util.Vec2.prototype.rotateSC=function(t,e){return new util.Vec2(this.x*e-this.y*t,this.x*t+this.y*e,this.z)},util.Vec2.angle=function(t,e){return Math.atan2(util.Vec2.cross(t,e),util.Vec2.dot(t,e))},util.Vec2.prototype.oxAngle=function(){return Math.atan2(this.y,this.x)},util.Vec2.diff=function(t,e){return new util.Vec2(t.x-e.x,t.y-e.y,t.z-e.z)},util.Vec2.lc=function(){for(var t=new util.Vec2,e=0;e<arguments.length/2;++e)t=t.addScaled(arguments[2*e],arguments[2*e+1]);return t},util.Vec2.lc2=function(t,e,n,i){return new util.Vec2(t.x*e+n.x*i,t.y*e+n.y*i,t.z*e+n.z*i)},util.Vec2.centre=function(t,e){return new util.Vec2.lc2(t,.5,e,.5)},util.Box2Abs=function(){1==arguments.length&&"min"in arguments[0]&&"max"in arguments[0]&&(this.p0=arguments[0].min,this.p1=arguments[0].max),2==arguments.length&&arguments[0]instanceof util.Vec2&&arguments[1]instanceof util.Vec2?(this.p0=arguments[0],this.p1=arguments[1]):4==arguments.length?(this.p0=new util.Vec2(arguments[0],arguments[1]),this.p1=new util.Vec2(arguments[2],arguments[3])):0==arguments.length?(this.p0=new util.Vec2,this.p1=new util.Vec2):new Error("util.Box2Abs constructor only accepts 4 numbers or 2 vectors or no arguments!")},util.Box2Abs.prototype.toString=function(){return this.p0.toString()+" "+this.p1.toString()},util.Box2Abs.fromRelBox=function(t){return new util.Box2Abs(t.x,t.y,t.x+t.width,t.y+t.height)},util.Box2Abs.prototype.clone=function(){return new util.Box2Abs(this.p0,this.p1)},util.Box2Abs.union=function(t,e){return new util.Box2Abs(util.Vec2.min(t.p0,e.p0),util.Vec2.max(t.p1,e.p1))},util.Box2Abs.prototype.extend=function(t,e){return e=e||t,new util.Box2Abs(this.p0.sub(t),this.p1.add(e))},util.Box2Abs.prototype.include=function(t){return new util.Box2Abs(this.p0.min(t),this.p1.max(t))},util.Box2Abs.prototype.contains=function(t,e){return e=(e||0)-0,t.x>=this.p0.x-e&&t.x<=this.p1.x+e&&t.y>=this.p0.y-e&&t.y<=this.p1.y+e},util.Box2Abs.prototype.translate=function(t){return new util.Box2Abs(this.p0.add(t),this.p1.add(t))},util.Box2Abs.prototype.transform=function(t,e){return util.assert(!util.isNullOrUndefined(t)),new util.Box2Abs(t.call(e,this.p0),t.call(e,this.p1))},util.Box2Abs.prototype.sz=function(){return this.p1.sub(this.p0)},util.Box2Abs.prototype.centre=function(){return util.Vec2.centre(this.p0,this.p1)},util.Box2Abs.prototype.pos=function(){return this.p0},util.Vec2.shiftRayBox=function(e,n,t){var i=[t.p0,new util.Vec2(t.p1.x,t.p0.y),t.p1,new util.Vec2(t.p0.x,t.p1.y)].map(function(t){return t.sub(e)});n=n.normalized();for(var r,o,s=i.map(function(t){return util.Vec2.cross(t,n)}),a=i.map(function(t){return util.Vec2.dot(t,n)}),l=-1,c=-1,u=0;u<4;++u)0<s[u]?(l<0||a[l]<a[u])&&(l=u):(c<0||a[c]<a[u])&&(c=u);return c<0||l<0?0:(o=a[l]>a[c]?(r=c,l):(r=l,c),a[r]+Math.abs(s[r])*(a[o]-a[r])/(Math.abs(s[r])+Math.abs(s[o])))},window.util||(util={}),util.Set={empty:function(){return{}},single:function(t){var e={};return util.Set.add(e,t),e},size:function(t){var e=0;for(var n in t)t[n]!==Object.prototype[n]&&e++;return e},contains:function(t,e){return void 0!==t[e]&&t[e]!==Object.prototype[e]},subset:function(t,e){for(var n in t)if(t[n]!==Object.prototype[n]&&e[n]!==t[n])return!1;return!0},intersection:function(t,e){var n={};for(var i in t)t[i]!==Object.prototype[i]&&e[i]===t[i]&&util.Set.add(n,i);return n},disjoint:function(t,e){for(var n in t)if(t[n]!==Object.prototype[n]&&e[n]===t[n])return!1;return!0},eq:function(t,e){return util.Set.subset(t,e)&&util.Set.subset(e,t)},each:function(t,e,n){for(var i in t)t[i]!==Object.prototype[i]&&e.call(n,t[i])},filter:function(t,e,n){var i={};for(var r in t)t[r]!==Object.prototype[r]&&e.call(n,t[r])&&(i[t[r]]=t[r]);return i},pick:function(t){for(var e in t)if(t[e]!==Object.prototype[e])return t[e];return null},list:function(t){var e=[];for(var n in t)t[n]!==Object.prototype[n]&&e.push(t[n]);return e},add:function(t,e){t[e]=e},mergeIn:function(e,t){util.Set.each(t,function(t){util.Set.add(e,t)})},remove:function(t,e){var n=t[e];return delete t[e],n},clone:function(t){var e={};return util.Set.mergeIn(e,t),e},fromList:function(t){var e={};if(t)for(var n=0;n<t.length;++n)e[t[n]-0]=t[n]-0;return e},keySetInt:function(t){var e={};return t.each(function(t){e[t-0]=t-0}),e},find:function(t,e,n){for(var i in t)if(t[i]!==Object.prototype[i]&&e.call(n,t[i]))return i;return null}},window.util||(util={}),util.Map=function(t){if(void 0!==t&&t.constructor!==Object)throw Error("Passed object is not an instance of 'Object'!");this._obj=t||{},this._count=0},util.Map.prototype.each=function(t,e){for(var n in this._obj){var i=parseInt(n),r=this._obj[n];isNaN(i)||(n=i),t.call(e,n,r)}},util.Map.prototype.map=function(n,i){var r=new util.Map;return this.each(function(t,e){r.set(t,n.call(i,t,e))},this),r},util.Map.prototype.find=function(t,e){for(var n in this._obj){var i=parseInt(n),r=this._obj[n];if(isNaN(i)||(n=i),t.call(e,n,r))return n}},util.Map.prototype.findAll=function(t,e){var n=[];for(var i in this._obj){var r=parseInt(i),o=this._obj[i];isNaN(r)||(i=r),t.call(e,i,o)&&n.push(i)}return n},util.Map.prototype.keys=function(){var t=[];for(var e in this._obj)t.push(e);return t},util.Map.prototype.ikeys=function(){var t=[];for(var e in this._obj)t.push(e-0);return t},util.Map.prototype.set=function(t,e){if(this._count+=(void 0!==e?1:0)-(void 0!==this._obj[t]?1:0),void 0!==e)return this._obj[t]=e;var n=this._obj[t];return delete this._obj[t],n},util.Map.prototype.get=function(t){if(this._obj[t]!==Object.prototype[t])return this._obj[t]},util.Map.prototype.has=function(t){return this._obj[t]!==Object.prototype[t]},util.Map.prototype.unset=function(t){return this.set(t,void 0)},util.Map.prototype.update=function(t){for(var e in t)this.set(e,t[e])},util.Map.prototype.clear=function(){this._obj={},this._count=0},util.Map.prototype.count=function(){return this._count},util.Map.prototype.idList=function(){return util.idList(this._obj)},util.Map.prototype.keyOf=function(t){for(var e in this._obj)if(this._obj[e]===t)return e},!window.util||!util.Map)throw new Error("Map should be defined first");if(util.Pool=function(){this._map=new util.Map,this._nextId=0},util.Pool.prototype.newId=function(){return this._nextId++},util.Pool.prototype.add=function(t){var e=this._nextId++;return this._map.set(e,t),e},util.Pool.prototype.set=function(t,e){this._map.set(t,e)},util.Pool.prototype.get=function(t){return this._map.get(t)},util.Pool.prototype.has=function(t){return this._map.has(t)},util.Pool.prototype.remove=function(t){return this._map.unset(t)},util.Pool.prototype.clear=function(){this._map.clear()},util.Pool.prototype.keys=function(){return this._map.keys()},util.Pool.prototype.ikeys=function(){return this._map.ikeys()},util.Pool.prototype.each=function(t,e){this._map.each(t,e)},util.Pool.prototype.map=function(t,e){return this._map.map(t,e)},util.Pool.prototype.find=function(t,e){return this._map.find(t,e)},util.Pool.prototype.count=function(){return this._map.count()},util.Pool.prototype.keyOf=function(t){return this._map.keyOf(t)},!window.util||!util.Vec2)throw new Error("Vec2 should be defined first");function hexToRGB(t){return{r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)}}function rgbCompToHex(t){t=t.toFixed();var e=(t=Math.max(Math.min(t,255),0)).toString(16);return e.length<2&&(e="0"+e),e}function rgbToHex(t){return"#"+rgbCompToHex(t.r)+rgbCompToHex(t.g)+rgbCompToHex(t.b)}function rgbRescale(t,e){var n=.21*t.r+.72*t.g+.07*t.b;return n<=e?t:{r:(t.r*e/n).toFixed()-0,g:(t.g*e/n).toFixed()-0,b:(t.b*e/n).toFixed()-0}}if(window.chem||(chem={}),chem.Element=function(t,e,n,i,r,o,s){this.label=t,this.period=e,this.group=n,this.putHydrogenOnTheLeft=i,this.color=r||"#000000",this.labelColor=rgbToHex(rgbRescale(hexToRGB(this.color),150)),this.xpos=s||n,this.ypos=o||e;var a=("0x"+this.color.substring(1,3)-0)/255,l=("0x"+this.color.substring(3,5)-0)/255,c=("0x"+this.color.substring(5,7)-0)/255,u=.299*a+.587*l+.114*c;.6<u&&(a*=.6/u,l*=.6/u,c*=.6/u),a=Math.ceil(Math.min(255*a,255)).toString(16),l=Math.ceil(Math.min(255*l,255)).toString(16),c=Math.ceil(Math.min(255*c,255)).toString(16),a=1==a.length?"0"+a:a,l=1==l.length?"0"+l:l,c=1==c.length?"0"+c:c,this.color="#"+a+l+c},chem.Element.elements=new util.Map({1:new chem.Element("H",1,1,!1,"#000000",1,1),2:new chem.Element("He",1,8,!1,"#d9ffff",1,18),3:new chem.Element("Li",2,1,!1,"#cc80ff",2,1),4:new chem.Element("Be",2,2,!1,"#c2ff00",2,2),5:new chem.Element("B",2,3,!1,"#ffb5b5",2,13),6:new chem.Element("C",2,4,!1,"#000000",2,14),7:new chem.Element("N",2,5,!1,"#304ff7",2,15),8:new chem.Element("O",2,6,!0,"#ff0d0d",2,16),9:new chem.Element("F",2,7,!0,"#8fe04f",2,17),10:new chem.Element("Ne",2,8,!1,"#b3e3f5",2,18),11:new chem.Element("Na",3,1,!1,"#ab5cf2",3,1),12:new chem.Element("Mg",3,2,!1,"#8aff00",3,2),13:new chem.Element("Al",3,3,!1,"#bfa6a6",3,13),14:new chem.Element("Si",3,4,!1,"#f0c7a1",3,14),15:new chem.Element("P",3,5,!1,"#ff8000",3,15),16:new chem.Element("S",3,6,!0,"#d9a61a",3,16),17:new chem.Element("Cl",3,7,!0,"#1fd01f",3,17),18:new chem.Element("Ar",3,8,!1,"#80d1e3",3,18),19:new chem.Element("K",4,1,!1,"#8f40d4",4,1),20:new chem.Element("Ca",4,2,!1,"#3dff00",4,2),21:new chem.Element("Sc",4,3,!1,"#e6e6e6",4,3),22:new chem.Element("Ti",4,4,!1,"#bfc2c7",4,4),23:new chem.Element("V",4,5,!1,"#a6a6ab",4,5),24:new chem.Element("Cr",4,6,!1,"#8a99c7",4,6),25:new chem.Element("Mn",4,7,!1,"#9c7ac7",4,7),26:new chem.Element("Fe",4,8,!1,"#e06633",4,8),27:new chem.Element("Co",4,8,!1,"#f08fa1",4,9),28:new chem.Element("Ni",4,8,!1,"#4fd14f",4,10),29:new chem.Element("Cu",4,1,!1,"#c78033",4,11),30:new chem.Element("Zn",4,2,!1,"#7d80b0",4,12),31:new chem.Element("Ga",4,3,!1,"#c28f8f",4,13),32:new chem.Element("Ge",4,4,!1,"#668f8f",4,14),33:new chem.Element("As",4,5,!1,"#bd80e3",4,15),34:new chem.Element("Se",4,6,!0,"#ffa100",4,16),35:new chem.Element("Br",4,7,!0,"#a62929",4,17),36:new chem.Element("Kr",4,8,!1,"#5cb8d1",4,18),37:new chem.Element("Rb",5,1,!1,"#702eb0",5,1),38:new chem.Element("Sr",5,2,!1,"#00ff00",5,2),39:new chem.Element("Y",5,3,!1,"#94ffff",5,3),40:new chem.Element("Zr",5,4,!1,"#94e0e0",5,4),41:new chem.Element("Nb",5,5,!1,"#73c2c9",5,5),42:new chem.Element("Mo",5,6,!1,"#54b5b5",5,6),43:new chem.Element("Tc",5,7,!1,"#3b9e9e",5,7),44:new chem.Element("Ru",5,8,!1,"#248f8f",5,8),45:new chem.Element("Rh",5,8,!1,"#0a7d8c",5,9),46:new chem.Element("Pd",5,8,!1,"#006985",5,10),47:new chem.Element("Ag",5,1,!1,"#bfbfbf",5,11),48:new chem.Element("Cd",5,2,!1,"#ffd98f",5,12),49:new chem.Element("In",5,3,!1,"#a67573",5,13),50:new chem.Element("Sn",5,4,!1,"#668080",5,14),51:new chem.Element("Sb",5,5,!1,"#9e63b5",5,15),52:new chem.Element("Te",5,6,!1,"#d47a00",5,16),53:new chem.Element("I",5,7,!0,"#940094",5,17),54:new chem.Element("Xe",5,8,!1,"#429eb0",5,18),55:new chem.Element("Cs",6,1,!1,"#57178f",6,1),56:new chem.Element("Ba",6,2,!1,"#00c900",6,2),57:new chem.Element("La",6,3,!1,"#70d4ff",6,3),58:new chem.Element("Ce",6,3,!1,"#ffffc7",8,4),59:new chem.Element("Pr",6,3,!1,"#d9ffc7",8,5),60:new chem.Element("Nd",6,3,!1,"#c7ffc7",8,6),61:new chem.Element("Pm",6,3,!1,"#a3ffc7",8,7),62:new chem.Element("Sm",6,3,!1,"#8fffc7",8,8),63:new chem.Element("Eu",6,3,!1,"#61ffc7",8,9),64:new chem.Element("Gd",6,3,!1,"#45ffc7",8,10),65:new chem.Element("Tb",6,3,!1,"#30ffc7",8,11),66:new chem.Element("Dy",6,3,!1,"#1fffc7",8,12),67:new chem.Element("Ho",6,3,!1,"#00ff9c",8,13),68:new chem.Element("Er",6,3,!1,"#00e675",8,14),69:new chem.Element("Tm",6,3,!1,"#00d452",8,15),70:new chem.Element("Yb",6,3,!1,"#00bf38",8,16),71:new chem.Element("Lu",6,3,!1,"#00ab24",8,17),72:new chem.Element("Hf",6,4,!1,"#4dc2ff",6,4),73:new chem.Element("Ta",6,5,!1,"#4da6ff",6,5),74:new chem.Element("W",6,6,!1,"#2194d6",6,6),75:new chem.Element("Re",6,7,!1,"#267dab",6,7),76:new chem.Element("Os",6,8,!1,"#266696",6,8),77:new chem.Element("Ir",6,8,!1,"#175487",6,9),78:new chem.Element("Pt",6,8,!1,"#d1d1e0",6,10),79:new chem.Element("Au",6,1,!1,"#ffd124",6,11),80:new chem.Element("Hg",6,2,!1,"#b8b8d1",6,12),81:new chem.Element("Tl",6,3,!1,"#a6544d",6,13),82:new chem.Element("Pb",6,4,!1,"#575961",6,14),83:new chem.Element("Bi",6,5,!1,"#9e4fb5",6,15),84:new chem.Element("Po",6,6,!1,"#ab5c00",6,16),85:new chem.Element("At",6,7,!1,"#754f45",6,17),86:new chem.Element("Rn",6,8,!1,"#428296",6,18),87:new chem.Element("Fr",7,1,!1,"#420066",7,1),88:new chem.Element("Ra",7,2,!1,"#007d00",7,2),89:new chem.Element("Ac",7,3,!1,"#70abfa",7,3),90:new chem.Element("Th",7,3,!1,"#00baff",9,4),91:new chem.Element("Pa",7,3,!1,"#00a1ff",9,5),92:new chem.Element("U",7,3,!1,"#008fff",9,6),93:new chem.Element("Np",7,3,!1,"#0080ff",9,7),94:new chem.Element("Pu",7,3,!1,"#006bff",9,8),95:new chem.Element("Am",7,3,!1,"#545cf2",9,9),96:new chem.Element("Cm",7,3,!1,"#785ce3",9,10),97:new chem.Element("Bk",7,3,!1,"#8a4fe3",9,11),98:new chem.Element("Cf",7,3,!1,"#a136d4",9,12),99:new chem.Element("Es",7,3,!1,"#b31fd4",9,13),100:new chem.Element("Fm",7,3,!1,"#B31FBA",9,14),101:new chem.Element("Md",7,3,!1,"#B30DA6",9,15),102:new chem.Element("No",7,3,!1,"#BD0D87",9,16),103:new chem.Element("Lr",7,3,!1,"#C70066",9,17),104:new chem.Element("Rf",7,4,!1,"#CC0059",7,4),105:new chem.Element("Db",7,5,!1,"#D1004F",7,5),106:new chem.Element("Sg",7,6,!1,"#D90045",7,6),107:new chem.Element("Bh",7,7,!1,"#E00038",7,7),108:new chem.Element("Hs",7,8,!1,"#E6002E",7,8),109:new chem.Element("Mt",7,8,!1,"#EB0026",7,9),110:new chem.Element("Ds",7,8,!1,"#9595a0",7,10),111:new chem.Element("Rg",7,1,!1,"#b9981a",7,11),112:new chem.Element("Cn",7,2,!1,"#9595a9",7,12),113:new chem.Element("D",1,1,!1,"#000000",1,1)}),chem.Element.labelMap=null,chem.Element.getElementByLabel=function(t){return this.labelMap||(this.labelMap={},this.elements.each(function(t,e){this.labelMap[e.label]=t-0},this)),this.labelMap.hasOwnProperty(t)?this.labelMap[t]:null},!window.chem||!util.Vec2||!util.Pool)throw new Error("Vec2, Pool should be defined first");if(chem.Struct=function(){this.atoms=new util.Pool,this.bonds=new util.Pool,this.sgroups=new util.Pool,this.halfBonds=new util.Map,this.loops=new util.Pool,this.isChiral=!1,this.isReaction=!1,this.rgroups=new util.Map,this.rxnArrows=new util.Pool,this.rxnPluses=new util.Pool,this.frags=new util.Pool,this.name="",this.sGroupForest=new chem.SGroupForest(this)},chem.Struct.prototype.hasRxnProps=function(){return 0<=this.atoms.find(function(t,e){return e.hasRxnProps()},this)||0<=this.bonds.find(function(t,e){return e.hasRxnProps()},this)},chem.Struct.prototype.hasRxnArrow=function(){return 0<this.rxnArrows.count()},chem.Struct.prototype.addRxnArrowIfNecessary=function(){var t=!this.hasRxnArrow()&&this.hasRxnProps();return t&&this.rxnArrows.add(new chem.Struct.RxnArrow),t},chem.Struct.prototype.getSGroupsInAtomSet=function(t){var n=new Hash;util.each(t,function(t){util.Set.list(this.atoms.get(t).sgs).each(function(t){var e=n.get(t);Object.isUndefined(e)?e=1:e++,n.set(t,e)},this)},this);var r=[];return n.each(function(t){var e=parseInt(t.key),n=this.sgroups.get(e),i=chem.SGroup.getAtoms(this,n);t.value==i.length&&r.push(e)},this),r},chem.Struct.prototype.isBlank=function(){return 0==this.atoms.count()&&0==this.rxnArrows.count()&&0==this.rxnPluses.count()&&!this.isChiral},chem.Struct.prototype.toLists=function(){var i={},n=[];this.atoms.each(function(t,e){i[t]=n.length,n.push(e)});var r=[];return this.bonds.each(function(t,e){var n=new chem.Struct.Bond(e);n.begin=i[e.begin],n.end=i[e.end],r.push(n)}),{atoms:n,bonds:r}},chem.Struct.prototype.clone=function(t,e,n,i){var r=new chem.Struct;return this.mergeInto(r,t,e,n,!1,i)},chem.Struct.prototype.getScaffold=function(){var e=util.Set.empty();return this.atoms.each(function(t){util.Set.add(e,t)},this),this.clone(e)},chem.Struct.prototype.getFragmentIds=function(n){var i=util.Set.empty();return this.atoms.each(function(t,e){e.fragment==n&&util.Set.add(i,t)},this),i},chem.Struct.prototype.getFragment=function(t){return this.clone(this.getFragmentIds(t))},chem.Struct.prototype.mergeInto=function(r,o,n,t,s,a){o=o||util.Set.keySetInt(this.atoms),n=n||util.Set.keySetInt(this.bonds),n=util.Set.filter(n,function(t){var e=this.bonds.get(t);return util.Set.contains(o,e.begin)&&util.Set.contains(o,e.end)},this);var l={};this.atoms.each(function(t,e){util.Set.contains(o,t)&&(l[e.fragment]=1)});var c={};this.frags.each(function(t,e){l[t]&&(c[t]=r.frags.add(e.clone()))}),this.rgroups.each(function(t,e){var n=s;if(n||(e.frags.each(function(t,e){l[e]&&(n=!0)}),n)){var i=r.rgroups.get(t);i?e.frags.each(function(t,e){l[e]&&i.frags.add(c[e])}):r.rgroups.set(t,e.clone(c))}}),null==a&&(a={}),this.atoms.each(function(t,e){util.Set.contains(o,t)&&(a[t]=r.atoms.add(e.clone(c)))});var u={};return this.bonds.each(function(t,e){util.Set.contains(n,t)&&(u[t]=r.bonds.add(e.clone(a)))}),this.sgroups.each(function(t,e){var n;for(n=0;n<e.atoms.length;++n)if(!util.Set.contains(o,e.atoms[n]))return;e=chem.SGroup.clone(e,a,u);var i=r.sgroups.add(e);for(e.id=i,n=0;n<e.atoms.length;++n)util.Set.add(r.atoms.get(e.atoms[n]).sgs,i);r.sGroupForest.insert(e.id)}),r.isChiral=this.isChiral,t||(r.isReaction=this.isReaction,this.rxnArrows.each(function(t,e){r.rxnArrows.add(e.clone())}),this.rxnPluses.each(function(t,e){r.rxnPluses.add(e.clone())})),r},chem.Struct.prototype.findBondId=function(n,i){var r=-1;return this.bonds.find(function(t,e){return(e.begin==n&&e.end==i||e.begin==i&&e.end==n)&&(r=t,!0)},this),r},chem.Struct.ATOM={RADICAL:{NONE:0,SINGLET:1,DOUPLET:2,TRIPLET:3}},chem.Struct.radicalElectrons=function(t){if(4!==t&&5!==t?t-=0:t=2,t==chem.Struct.ATOM.RADICAL.NONE)return 0;if(t==chem.Struct.ATOM.RADICAL.DOUPLET)return 1;if(t==chem.Struct.ATOM.RADICAL.SINGLET||t==chem.Struct.ATOM.RADICAL.TRIPLET)return 2;throw new Error("Unknown radical value")},chem.Struct.BOND={TYPE:{SINGLE:1,DOUBLE:2,TRIPLE:3,AROMATIC:4,SINGLE_OR_DOUBLE:5,SINGLE_OR_AROMATIC:6,DOUBLE_OR_AROMATIC:7,ANY:8,COORDINATION:9,HYDROGEN:10},STEREO:{NONE:0,UP:1,EITHER:4,DOWN:6,CIS_TRANS:3,UP2:5,DOWN2:7,WEDGE2:8,DOWN3:9},TOPOLOGY:{EITHER:0,RING:1,CHAIN:2},REACTING_CENTER:{NOT_CENTER:-1,UNMARKED:0,CENTER:1,UNCHANGED:2,MADE_OR_BROKEN:4,ORDER_CHANGED:8,MADE_OR_BROKEN_AND_CHANGED:12}},chem.Struct.FRAGMENT={NONE:0,REACTANT:1,PRODUCT:2,AGENT:3},chem.Struct.Atom=function(t){var e=chem.Struct.Atom.attrGetDefault;if(!(t&&"label"in t))throw new Error("Label must be specified!");this.label=t.label,this.fragment=util.isUndefined(t.fragment)?-1:t.fragment,util.ifDef(this,t,"isotope",e("isotope")),util.ifDef(this,t,"radical",e("radical")),util.ifDef(this,t,"charge",e("charge")),util.ifDef(this,t,"rglabel",e("rglabel")),util.ifDef(this,t,"attpnt",e("attpnt")),util.ifDef(this,t,"explicitValence",e("explicitValence")),util.ifDef(this,t,"color",e("color")),util.ifDef(this,t,"hideH",e("hideH")),util.ifDef(this,t,"fontContent",e("fontContent")),util.ifDef(this,t,"breakBond",e("breakBond")),util.ifDef(this,t,"groupFlag",e("groupFlag")),util.ifDef(this,t,"mutiChargeCenter",e("mutiChargeCenter")),util.ifDef(this,t,"mutiAttachments",e("mutiAttachments")),util.ifDef(this,t,"smilesCpSign",e("smilesCpSign")),this.valence=0,this.implicitH=0,util.isUndefined(t.pp)?this.pp=new util.Vec2:this.pp=new util.Vec2(t.pp),this.sgs={},util.ifDef(this,t,"ringBondCount",e("ringBondCount")),util.ifDef(this,t,"substitutionCount",e("substitutionCount")),util.ifDef(this,t,"unsaturatedAtom",e("unsaturatedAtom")),util.ifDef(this,t,"hCount",e("hCount")),util.ifDef(this,t,"aam",e("aam")),util.ifDef(this,t,"invRet",e("invRet")),util.ifDef(this,t,"exactChangeFlag",e("exactChangeFlag")),util.ifDef(this,t,"rxnFragmentType",-1),this.atomList=util.isUndefined(t.atomList)||null==t.atomList?null:new chem.Struct.AtomList(t.atomList),this.neighbors=[],this.badConn=!1},chem.Struct.Atom.getAttrHash=function(t){var e=new Hash;for(var n in chem.Struct.Atom.attrlist)void 0!==t[n]&&e.set(n,t[n]);return e},chem.Struct.Atom.attrGetDefault=function(t){if(t in chem.Struct.Atom.attrlist)return chem.Struct.Atom.attrlist[t];throw new Error("Attribute unknown")},chem.Struct.Atom.attrlist={label:"C",isotope:0,radical:0,charge:0,explicitValence:-1,ringBondCount:0,substitutionCount:0,unsaturatedAtom:0,hCount:0,color:"#000000",atomList:null,invRet:0,exactChangeFlag:0,rglabel:null,attpnt:null,aam:0,hideH:!1,breakBond:0,groupFlag:!1,fontContent:{},mutiChargeCenter:!1,mutiAttachments:[],smilesCpSign:!1},chem.Struct.Atom.prototype.clone=function(t){var e=new chem.Struct.Atom(this);return t&&this.fragment in t&&(e.fragment=t[this.fragment]),e},chem.Struct.Atom.prototype.isQuery=function(){return null!=this.atomList||"A"==this.label||this.attpnt||this.hCount},chem.Struct.Atom.prototype.pureHydrogen=function(){return"H"==this.label&&0==this.isotope},chem.Struct.Atom.prototype.isPlainCarbon=function(){return"C"==this.label&&0==this.isotope&&0==this.radical&&0==this.charge&&this.explicitValence<0&&0==this.ringBondCount&&0==this.substitutionCount&&0==this.unsaturatedAtom&&0==this.hCount&&!this.atomList},chem.Struct.Atom.prototype.isPseudo=function(){return!this.atomList&&!this.rglabel&&!chem.Element.getElementByLabel(this.label)},chem.Struct.Atom.prototype.hasRxnProps=function(){return!(!this.invRet&&!this.exactChangeFlag&&util.isNull(this.attpnt)&&!this.aam)},chem.Struct.AtomList=function(t){if(!(t&&"notList"in t&&"ids"in t))throw new Error("'notList' and 'ids' must be specified!");this.notList=t.notList,this.ids=t.ids},chem.Struct.AtomList.prototype.labelList=function(){for(var t=[],e=0;e<this.ids.length;++e)t.push(chem.Element.elements.get(this.ids[e]).label);return t},chem.Struct.AtomList.prototype.label=function(){var t="["+this.labelList().join(",")+"]";return this.notList&&(t="!"+t),t},chem.Struct.AtomList.prototype.equals=function(t){return this.notList==t.notList&&(this.ids||[]).sort().toString()==(t.ids||[]).sort().toString()},chem.Struct.Bond=function(t){if(!(t&&"begin"in t&&"end"in t&&"type"in t))throw new Error("'begin', 'end' and 'type' properties must be specified!");this.begin=t.begin,this.end=t.end,this.type=t.type,util.ifDef(this,t,"stereo",chem.Struct.BOND.STEREO.NONE),util.ifDef(this,t,"topology",chem.Struct.BOND.TOPOLOGY.EITHER),util.ifDef(this,t,"reactingCenterStatus",0),util.ifDef(this,t,"color","#000000"),util.ifDef(this,t,"posValue","0"),util.ifDef(this,t,"bondWidth",""),util.ifDef(this,t,"bondLength",""),this.hb1=null,this.hb2=null,this.len=0,this.center=new util.Vec2,this.sb=0,this.sa=0,this.angle=0},chem.Struct.Bond.attrlist={type:chem.Struct.BOND.TYPE.SINGLE,stereo:chem.Struct.BOND.STEREO.NONE,topology:chem.Struct.BOND.TOPOLOGY.EITHER,reactingCenterStatus:0,color:"#000000"},chem.Struct.Bond.getAttrHash=function(t){var e=new Hash;for(var n in chem.Struct.Bond.attrlist)void 0!==t[n]&&e.set(n,t[n]);return e},chem.Struct.Bond.attrGetDefault=function(t){if(t in chem.Struct.Bond.attrlist)return chem.Struct.Bond.attrlist[t];throw new Error("Attribute unknown")},chem.Struct.Bond.prototype.hasRxnProps=function(){return!!this.reactingCenterStatus},chem.Struct.Bond.prototype.getCenter=function(t){var e=t.atoms.get(this.begin).pp,n=t.atoms.get(this.end).pp;return util.Vec2.lc2(e,.5,n,.5)},chem.Struct.Bond.prototype.getDir=function(t){var e=t.atoms.get(this.begin).pp;return t.atoms.get(this.end).pp.sub(e).normalized()},chem.Struct.Bond.prototype.clone=function(t){var e=new chem.Struct.Bond(this);return t&&(e.begin=t[e.begin],e.end=t[e.end]),e},chem.Struct.Bond.prototype.findOtherEnd=function(t){if(t==this.begin)return this.end;if(t==this.end)return this.begin;throw new Error("Bond end not found")},chem.HalfBond=function(t,e,n){if(3!=arguments.length)throw new Error("Invalid parameter number!");this.begin=t-0,this.end=e-0,this.bid=n-0,this.dir=new util.Vec2,this.norm=new util.Vec2,this.ang=0,this.p=new util.Vec2,this.loop=-1,this.contra=-1,this.next=-1,this.leftSin=0,this.leftCos=0,this.leftNeighbor=0,this.rightSin=0,this.rightCos=0,this.rightNeighbor=0},chem.Struct.prototype.initNeighbors=function(){this.atoms.each(function(t,e){e.neighbors=[]}),this.bonds.each(function(t,e){var n=this.atoms.get(e.begin),i=this.atoms.get(e.end);n.neighbors.push(e.hb1),i.neighbors.push(e.hb2)},this)},chem.Struct.prototype.bondInitHalfBonds=function(t,e){(e=e||this.bonds.get(t)).hb1=2*t,e.hb2=2*t+1,this.halfBonds.set(e.hb1,new chem.HalfBond(e.begin,e.end,t)),this.halfBonds.set(e.hb2,new chem.HalfBond(e.end,e.begin,t));var n=this.halfBonds.get(e.hb1),i=this.halfBonds.get(e.hb2);n.contra=e.hb2,i.contra=e.hb1},chem.Struct.prototype.halfBondUpdate=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin).pp,i=this.atoms.get(e.end).pp,r=util.Vec2.diff(i,n).normalized();e.dir=1e-4<util.Vec2.dist(i,n)?r:new util.Vec2(1,0),e.norm=e.dir.turnLeft(),e.ang=e.dir.oxAngle(),e.loop<0&&(e.loop=-1)},chem.Struct.prototype.initHalfBonds=function(){this.halfBonds.clear(),this.bonds.each(this.bondInitHalfBonds,this)},chem.Struct.prototype.setHbNext=function(t,e){this.halfBonds.get(this.halfBonds.get(t).contra).next=e},chem.Struct.prototype.halfBondSetAngle=function(t,e){var n=this.halfBonds.get(t),i=this.halfBonds.get(e);i.rightCos=n.leftCos=util.Vec2.dot(i.dir,n.dir),i.rightSin=n.leftSin=util.Vec2.cross(i.dir,n.dir),n.leftNeighbor=e,i.rightNeighbor=t},chem.Struct.prototype.atomAddNeighbor=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin),i=0;for(i=0;i<n.neighbors.length&&!(this.halfBonds.get(n.neighbors[i]).ang>e.ang);++i);n.neighbors.splice(i,0,t);var r=n.neighbors[(i+1)%n.neighbors.length],o=n.neighbors[(i+n.neighbors.length-1)%n.neighbors.length];this.setHbNext(o,t),this.setHbNext(t,r),this.halfBondSetAngle(t,o),this.halfBondSetAngle(r,t)},chem.Struct.prototype.atomSortNeighbors=function(t){var e,n=this.atoms.get(t),i=this;for(n.neighbors=n.neighbors.sort(function(t,e){return i.halfBonds.get(t).ang-i.halfBonds.get(e).ang},this),e=0;e<n.neighbors.length;++e)this.halfBonds.get(this.halfBonds.get(n.neighbors[e]).contra).next=n.neighbors[(e+1)%n.neighbors.length];for(e=0;e<n.neighbors.length;++e)this.halfBondSetAngle(n.neighbors[(e+1)%n.neighbors.length],n.neighbors[e])},chem.Struct.prototype.sortNeighbors=function(t){util.each(t,function(t){this.atomSortNeighbors(t)},this)},chem.Struct.prototype.atomUpdateHalfBonds=function(t){for(var e=this.atoms.get(t).neighbors,n=0;n<e.length;++n){var i=e[n];this.halfBondUpdate(i),this.halfBondUpdate(this.halfBonds.get(i).contra)}},chem.Struct.prototype.updateHalfBonds=function(t){util.each(t,function(t){this.atomUpdateHalfBonds(t)},this)},chem.Struct.prototype.sGroupsRecalcCrossBonds=function(){this.sgroups.each(function(t,e){e.xBonds=[],e.neiAtoms=[]},this),this.bonds.each(function(n,i){var r=this.atoms.get(i.begin),o=this.atoms.get(i.end);util.Set.each(r.sgs,function(t){if(!util.Set.contains(o.sgs,t)){var e=this.sgroups.get(t);e.xBonds.push(n),util.arrayAddIfMissing(e.neiAtoms,i.end)}},this),util.Set.each(o.sgs,function(t){if(!util.Set.contains(r.sgs,t)){var e=this.sgroups.get(t);e.xBonds.push(n),util.arrayAddIfMissing(e.neiAtoms,i.begin)}},this)},this)},chem.Struct.prototype.sGroupDelete=function(t){for(var e=this.sgroups.get(t),n=0;n<e.atoms.length;++n)util.Set.remove(this.atoms.get(e.atoms[n]).sgs,t);this.sGroupForest.remove(t),this.sgroups.remove(t)},chem.Struct.itemSetPos=function(t,e){t.pp=e},chem.Struct.prototype._itemSetPos=function(t,e,n,i){chem.Struct.itemSetPos(this[t].get(e),n,i)},chem.Struct.prototype._atomSetPos=function(t,e,n){this._itemSetPos("atoms",t,e,n)},chem.Struct.prototype._rxnPlusSetPos=function(t,e,n){this._itemSetPos("rxnPluses",t,e,n)},chem.Struct.prototype._rxnArrowSetPos=function(t,e,n){this._itemSetPos("rxnArrows",t,e,n)},chem.Struct.prototype.getCoordBoundingBox=function(n){var e=null,i=function(t){e?(e.min=util.Vec2.min(e.min,t),e.max=util.Vec2.max(e.max,t)):e={min:t,max:t}},r=void 0===n;return this.atoms.each(function(t,e){(r||util.Set.contains(n,t))&&i(e.pp)}),r&&(this.rxnPluses.each(function(t,e){i(e.pp)}),this.rxnArrows.each(function(t,e){i(e.pp)})),!e&&r&&(e={min:new util.Vec2(0,0),max:new util.Vec2(1,1)}),e},chem.Struct.prototype.getCoordBoundingBoxObj=function(){var i=null;return this.atoms.each(function(t,e){var n;n=e.pp,i?(i.min=util.Vec2.min(i.min,n),i.max=util.Vec2.max(i.max,n)):i={min:new util.Vec2(n),max:new util.Vec2(n)}}),i},chem.Struct.prototype.getBondLengthData=function(){var n=0,i=0;return this.bonds.each(function(t,e){n+=util.Vec2.dist(this.atoms.get(e.begin).pp,this.atoms.get(e.end).pp),i++},this),{cnt:i,totalLength:n}},chem.Struct.prototype.getAvgBondLength=function(){var t=this.getBondLengthData();return 0<t.cnt?t.totalLength/t.cnt:-1},chem.Struct.prototype.getAvgClosestAtomDistance=function(){var t,e,n,i=0,r=0,o=this.atoms.keys();for(e=0;e<o.length;++e){for(t=-1,n=0;n<o.length;++n)n!=e&&(r=util.Vec2.dist(this.atoms.get(o[n]).pp,this.atoms.get(o[e]).pp),(t<0||r<t)&&(t=r));i+=t}return 0<o.length?i/o.length:-1},chem.Struct.prototype.checkBondExists=function(n,i){var r=!1;return this.bonds.each(function(t,e){(e.begin==n&&e.end==i||e.end==n&&e.begin==i)&&(r=!0)},this),r},chem.Loop=function(t,n,e){this.hbs=t,this.dblBonds=0,this.aromatic=!0,this.convex=e||!1,util.each(t,function(t){var e=n.bonds.get(n.halfBonds.get(t).bid);e.type!=chem.Struct.BOND.TYPE.AROMATIC&&(this.aromatic=!1),e.type==chem.Struct.BOND.TYPE.DOUBLE&&this.dblBonds++},this)},chem.Struct.RxnPlus=function(t){t=t||{},this.pp=t.pp?new util.Vec2(t.pp):new util.Vec2},chem.Struct.RxnPlus.prototype.clone=function(){return new chem.Struct.RxnPlus(this)},chem.Struct.RxnArrow=function(t){t=t||{},this.pp=t.pp?new util.Vec2(t.pp):new util.Vec2},chem.Struct.RxnArrow.prototype.clone=function(){return new chem.Struct.RxnArrow(this)},chem.Struct.prototype.findConnectedComponent=function(t){for(var r={},o=[t],s=util.Set.empty();0<o.length;)(function(){var t=o.pop();r[t]=1,util.Set.add(s,t);for(var e=this.atoms.get(t),n=0;n<e.neighbors.length;++n){var i=this.halfBonds.get(e.neighbors[n]).end;util.Set.contains(s,i)||o.push(i)}}).apply(this);return s},chem.Struct.prototype.findConnectedComponents=function(i){this.halfBonds.count()||(this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(this.atoms.keys()),this.sortNeighbors(this.atoms.keys()));var r={};this.atoms.each(function(t,e){r[t]=-1},this);var o=[];return this.atoms.each(function(t,e){if((i||e.fragment<0)&&r[t]<0){var n=this.findConnectedComponent(t);o.push(n),util.Set.each(n,function(t){r[t]=1},this)}},this),o},chem.Struct.prototype.markFragment=function(t){var e=this.frags.add(new chem.Struct.Fragment);util.Set.each(t,function(t){this.atoms.get(t).fragment=e},this)},chem.Struct.prototype.markFragmentByAtomId=function(t){this.markFragment(this.findConnectedComponent(t))},chem.Struct.prototype.markFragments=function(){for(var t=this.findConnectedComponents(),e=0;e<t.length;++e)this.markFragment(t[e])},chem.Struct.Fragment=function(){},chem.Struct.Fragment.prototype.clone=function(){return new chem.Struct.Fragment},chem.Struct.Fragment.getAtoms=function(t,n){var i=[];return t.atoms.each(function(t,e){e.fragment==n&&i.push(t)},this),i},chem.Struct.prototype.scale=function(n){1!=n&&(this.atoms.each(function(t,e){e.pp=e.pp.scaled(n)},this),this.rxnPluses.each(function(t,e){e.pp=e.pp.scaled(n)},this),this.rxnArrows.each(function(t,e){e.pp=e.pp.scaled(n)},this))},chem.Struct.prototype.rescale=function(){var t=this.getAvgBondLength();t<0&&!this.isReaction&&(t=this.getAvgClosestAtomDistance()),t<.001&&(t=1);var e=1/t;this.scale(e)},chem.Struct.prototype.loopHasSelfIntersections=function(t){for(var e=0;e<t.length;++e)for(var n=this.halfBonds.get(t[e]),i=this.atoms.get(n.begin).pp,r=this.atoms.get(n.end).pp,o=util.Set.fromList([n.begin,n.end]),s=e+2;s<t.length;++s){var a=this.halfBonds.get(t[s]);if(!util.Set.contains(o,a.begin)&&!util.Set.contains(o,a.end)){var l=this.atoms.get(a.begin).pp,c=this.atoms.get(a.end).pp;if(util.Vec2.segmentIntersection(i,r,l,c))return!0}}return!1},chem.Struct.prototype.partitionLoop=function(t){var e=[],n=!0;t:for(;n;){for(var i={},r=0;r<t.length;++r){var o=t[r],s=this.halfBonds.get(o).begin,a=this.halfBonds.get(o).end;if(a in i){var l=i[a],c=t.slice(l,r+1);e.push(c),r<t.length&&t.splice(l,r-l+1);continue t}i[s]=r}n=!1,e.push(t)}return e},chem.Struct.prototype.halfBondAngle=function(t,e){var n=this.halfBonds.get(t),i=this.halfBonds.get(e);return Math.atan2(util.Vec2.cross(n.dir,i.dir),util.Vec2.dot(n.dir,i.dir))},chem.Struct.prototype.loopIsConvex=function(t){for(var e=0;e<t.length;++e){if(0<this.halfBondAngle(t[e],t[(e+1)%t.length]))return!1}return!0},chem.Struct.prototype.loopIsInner=function(t){for(var e=2*Math.PI,n=0;n<t.length;++n){var i=t[n],r=t[(n+1)%t.length],o=this.halfBonds.get(r),s=this.halfBondAngle(i,r);o.contra==t[n]?e+=Math.PI:e+=s}return Math.abs(e)<Math.PI},chem.Struct.prototype.findLoops=function(){var i,r,o,s,a=[],l=util.Set.empty();return this.halfBonds.each(function(t,e){if(-1==e.loop)for(i=t,r=0,o=[];r<=this.halfBonds.count();i=this.halfBonds.get(i).next,++r){if(0<r&&i==t){var n=this.partitionLoop(o);util.each(n,function(t){this.loopIsInner(t)&&!this.loopHasSelfIntersections(t)?(s=util.arrayMin(t),this.loops.set(s,new chem.Loop(t,this,this.loopIsConvex(t)))):s=-2,util.each(t,function(t){this.halfBonds.get(t).loop=s,util.Set.add(l,this.halfBonds.get(t).bid)},this),0<=s&&a.push(s)},this);break}o.push(i)}},this),{newLoops:a,bondsToMark:util.Set.list(l)}},chem.Struct.prototype.prepareLoopStructure=function(){this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(this.atoms.keys()),this.sortNeighbors(this.atoms.keys()),this.findLoops()},chem.Struct.prototype.atomAddToSGroup=function(t,e){chem.SGroup.addAtom(this.sgroups.get(t),e),util.Set.add(this.atoms.get(e).sgs,t)},!window.chem||!util.Vec2||!util.Pool)throw new Error("Vec2, Pool should be defined first");if(chem.SGroupForest=function(t){this.parent=new util.Map,this.children=new util.Map,this.children.set(-1,[]),this.molecule=t},chem.SGroup=function(t){if(!(t&&t in chem.SGroup.TYPES))throw new Error("Invalid or unsupported s-group type");this.type=t,this.id=-1,chem.SGroup.equip(this),this.label=-1,this.bracketBox=null,this.bracketDir=new util.Vec2(1,0),this.areas=[],this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null,this.atoms=[],this.patoms=[],this.bonds=[],this.xBonds=[],this.neiAtoms=[],this.pp=null,this.data={mul:1,connectivity:"ht",name:"",subscript:"n",copSubtype:"COP",attached:!1,absolute:!0,showUnits:!1,nCharsToDisplay:-1,tagChar:"",daspPos:1,fieldType:"F",fieldName:"",fieldValue:"",units:"",query:"",queryOp:"",color:""}},chem.SGroup.GroupMul={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);return this.areas=[o],chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,this.data.mul),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,util.idList(this.atomSet),n))).concat(chem.SGroup.makeAtomBondLines("SPA",r,util.idList(this.parentAtomSet),n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i));var s="M  SMT "+r+" "+this.data.mul;return o.push(s),(o=o.concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(i){var t;this.atoms.sort(),this.atomSet=util.Set.fromList(this.atoms),this.parentAtomSet=util.Set.clone(this.atomSet);var n=[],r=[];if(i.bonds.each(function(t,e){util.Set.contains(this.parentAtomSet,e.begin)&&util.Set.contains(this.parentAtomSet,e.end)?n.push(t):(util.Set.contains(this.parentAtomSet,e.begin)||util.Set.contains(this.parentAtomSet,e.end))&&r.push(t)},this),0!=r.length&&2!=r.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};var e=-1,o=-1,s=null;if(2==r.length){var a=i.bonds.get(r[0]);e=util.Set.contains(this.parentAtomSet,a.begin)?a.begin:a.end;var l=i.bonds.get(r[1]);o=util.Set.contains(this.parentAtomSet,l.begin)?l.begin:l.end,s=l}var c=null,u=e,h=[];for(t=0;t<this.data.mul-1;++t)if(c={},util.each(this.atoms,function(t){var e=i.atoms.get(t),n=i.atoms.add(new chem.Struct.Atom(e));h.push(n),this.atomSet[n]=1,c[t]=n},this),util.each(n,function(t){var e=i.bonds.get(t),n=new chem.Struct.Bond(e);n.begin=c[n.begin],n.end=c[n.end],i.bonds.add(n)},this),null!=s){var d=new chem.Struct.Bond(s);d.begin=u,d.end=c[o],i.bonds.add(d),u=c[e]}if(util.each(h,function(e){util.each(i.sGroupForest.getPathToRoot(this.id).reverse(),function(t){i.atomAddToSGroup(t,e)},this)},this),0<=u){var f=i.bonds.get(r[0]);f.begin==e?f.begin=u:f.end=u}this.bonds=r},postLoad:function(t,e){this.data.mul=this.data.subscript-0;var r={};this.atoms=chem.SGroup.filterAtoms(this.atoms,e),this.patoms=chem.SGroup.filterAtoms(this.patoms,e);for(var n=1;n<this.data.mul;++n)for(var i=0;i<this.patoms.length;++i){var o=this.atoms[n*this.patoms.length+i];if(!(o<0)){if(this.patoms[i]<0)throw new Error("parent atom missing");r[o]=this.patoms[i]}}this.patoms=chem.SGroup.removeNegative(this.patoms);var s=util.identityMap(this.patoms),a=[];t.bonds.each(function(t,e){var n=e.begin in r,i=e.end in r;n&&i||n&&e.end in s||i&&e.begin in s?a.push(t):n?e.begin=r[e.begin]:i&&(e.end=r[e.end])},this);for(var l=0;l<a.length;++l)t.bonds.remove(a[l]);for(var c in r)t.atoms.remove(c),e[c]=-1;this.atoms=this.patoms,this.patoms=null}},chem.SGroup.GroupSru={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);this.areas=[o];var l=this.data.connectivity||"eu";"ht"==l&&(l="");var c=this.data.subscript||"n";return chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,c,l),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(r){var o=[];if(r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),0!=o.length&&2!=o.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};this.bonds=o},postLoad:function(t,e){this.data.connectivity=(this.data.connectivity||"EU").trim().toLowerCase()}},chem.SGroup.GroupMon={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);this.areas=[o];var l=this.data.connectivity||"eu";"ht"==l&&(l="");var c=this.data.subscript||"n";return chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,c,l),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(t){},postLoad:function(t,e){}},chem.SGroup.GroupAny={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);this.areas=[o];var l=this.data.connectivity||"eu";"ht"==l&&(l="");var c=this.data.subscript||"n";return chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,c,l),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(t){},postLoad:function(t,e){}},chem.SGroup.GroupSup={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);return this.areas=[o],chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,this.data.name,null,{"font-style":"italic"}),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i)),this.data.name&&""!=this.data.name&&o.push("M  SMT "+r+" "+this.data.name),o.join("\n")},prepareForSaving:function(r){var o=[];r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),this.bonds=o},postLoad:function(t,e){this.data.name=this.data.subscript||"",this.data.subscript=""}},chem.SGroup.GroupGen={draw:function(t){var e=t.render,n=(e.settings,e.styles,e.paper.set()),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);return this.areas=[o],chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(t){},postLoad:function(t,e){}},chem.SGroup.GroupMer={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);this.areas=[o];var l=this.data.connectivity||"eu";"ht"==l&&(l="");var c=this.data.subscript||"n";return chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,c,l),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(t){},postLoad:function(t,e){}},chem.SGroup.GroupMod={draw:function(t){var e=t.render,n=e.paper.set(),i=[],r=util.Set.fromList(this.atoms);chem.SGroup.getCrossBonds([],i,t.molecule,r),chem.SGroup.bracketPos(this,e,t.molecule,i);var o=this.bracketBox,s=this.bracketDir,a=s.rotateSC(1,0);this.areas=[o];var l=this.data.connectivity||"eu";"ht"==l&&(l="");var c=this.data.subscript||"n";return chem.SGroup.drawBrackets(n,e,this,i,r,o,s,a,c,l),n},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(r){var o=[];if(r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),0!=o.length&&2!=o.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};this.bonds=o},postLoad:function(t,e){this.data.connectivity=(this.data.connectivity||"EU").trim().toLowerCase()}},chem.SGroup.GroupGra={saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(r){var o=[];if(r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),0!=o.length&&2!=o.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};this.bonds=o},postLoad:function(t,e){this.data.connectivity=(this.data.connectivity||"EU").trim().toLowerCase()}},chem.SGroup.GroupCom={saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(r){var o=[];if(r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),0!=o.length&&2!=o.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};this.bonds=o},postLoad:function(t,e){this.data.connectivity=(this.data.connectivity||"EU").trim().toLowerCase()}},chem.SGroup.GroupCro={saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(r){var o=[];if(r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),0!=o.length&&2!=o.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};this.bonds=o},postLoad:function(t,e){this.data.connectivity=(this.data.connectivity||"EU").trim().toLowerCase()}},chem.SGroup.GroupCop={saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(r){var o=[];if(r.bonds.each(function(t,e){var n=r.atoms.get(e.begin),i=r.atoms.get(e.end);(util.Set.contains(n.sgs,this.id)&&!util.Set.contains(i.sgs,this.id)||util.Set.contains(i.sgs,this.id)&&!util.Set.contains(n.sgs,this.id))&&o.push(t)},this),0!=o.length&&2!=o.length)throw{id:this.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};this.bonds=o},postLoad:function(t,e){this.data.connectivity=(this.data.connectivity||"EU").trim().toLowerCase()}},chem.SGroup.GroupFor={saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(t){},postLoad:function(t,e){}},chem.SGroup.GroupMix={saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=[];return(o=(o=(o=o.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n))).concat(chem.SGroup.makeAtomBondLines("SBL",r,this.bonds,i))).concat(chem.SGroup.bracketsToMolfile(t,this,r))).join("\n")},prepareForSaving:function(t){},postLoad:function(t,e){}},chem.SGroup.GroupDat={showValue:function(t,e,n,i){return t.text(e.x,e.y,n.data.fieldValue).attr({font:i.font,"font-size":i.fontsz})},draw:function(t){var e,n=t.render,i=n.settings,r=n.paper,o=r.set(),s=chem.SGroup.getAtoms(t,this);chem.SGroup.bracketPos(this,n,t.molecule),this.areas=this.bracketBox?[this.bracketBox]:[],null==this.pp&&chem.SGroup.setPos(t,this,this.bracketBox.p1.add(new util.Vec2(.5,.5)));var a=this.pp.scaled(i.scaleFactor);if(this.data.attached)for(e=0;e<s.length;++e){var l=t.atoms.get(s[e]),c=n.ps(l.a.pp),u=l.visel.boundingBox;null!=u&&(c.x=Math.max(c.x,u.p1.x)),c.x+=i.lineWidth;var h=this.showValue(r,c,this,i),d=rnd.relBox(h.getBBox());h.translateAbs(.5*d.width,-.3*d.height),o.push(h);var f=util.Box2Abs.fromRelBox(rnd.relBox(h.getBBox()));f=f.transform(n.scaled2obj,n),this.areas.push(f)}else{var p=this.showValue(r,a,this,i),m=rnd.relBox(p.getBBox());p.translateAbs(.5*m.width,-.5*m.height),o.push(p);var g=util.Box2Abs.fromRelBox(rnd.relBox(p.getBBox()));this.dataArea=g.transform(n.scaled2obj,n),t.sgroupData.has(this.id)||t.sgroupData.set(this.id,new rnd.ReDataSGroupData(this))}return o},saveToMolfile:function(t,e,n,i){var r=util.stringPadded(e[this.id],3),o=this.data,s=this.pp;o.absolute||(s=s.sub(chem.SGroup.getMassCentre(t,this.atoms)));var a=[];a=a.concat(chem.SGroup.makeAtomBondLines("SAL",r,this.atoms,n));var l="M  SDT "+r+" "+util.stringPadded(o.fieldName,30,!0)+util.stringPadded(o.fieldType,2)+util.stringPadded(o.units,20,!0)+util.stringPadded(o.query,2)+util.stringPadded(o.queryOp,3);a.push(l);var c="M  SDD "+r+" "+util.paddedFloat(s.x,10,4)+util.paddedFloat(-s.y,10,4)+"    "+(o.attached?"A":"D")+(o.absolute?"A":"R")+(o.showUnits?"U":" ")+"   "+(0<=o.nCharnCharsToDisplay?util.paddedInt(o.nCharnCharsToDisplay,3):"ALL")+"  1   "+util.stringPadded(o.tagChar,1)+"  "+util.paddedInt(o.daspPos,1)+"  ";return a.push(c),o.fieldValue.replace(/[\r\n|\n|\r]*$/,"").split(/\r\n|\n|\r/).each(function(t){for(;69<t.length;)a.push("M  SCD "+r+" "+t.slice(0,69)),t=t.slice(69);a.push("M  SED "+r+" "+util.stringPadded(t,69,!0))},this),a.join("\n")},prepareForSaving:function(t){this.atoms=chem.SGroup.getAtoms(t,this)},postLoad:function(t,e){var n=this.atoms.length==t.atoms.count();this.data.absolute||(this.pp=this.pp.add(chem.SGroup.getMassCentre(t,this.atoms))),!n||"MDLBG_FRAGMENT_STEREO"!=this.data.fieldName&&"MDLBG_FRAGMENT_COEFFICIENT"!=this.data.fieldName&&"MDLBG_FRAGMENT_CHARGE"!=this.data.fieldName||(this.atoms=[],this.allAtoms=!0)}},chem.SGroup.TYPES={MUL:chem.SGroup.GroupMul,SRU:chem.SGroup.GroupSru,SUP:chem.SGroup.GroupSup,DAT:chem.SGroup.GroupDat,GEN:chem.SGroup.GroupGen,MON:chem.SGroup.GroupMon,MER:chem.SGroup.GroupMer,MOD:chem.SGroup.GroupMod,COM:chem.SGroup.GroupCom,COP:chem.SGroup.GroupCop,ANY:chem.SGroup.GroupAny,GRA:chem.SGroup.GroupGra,CRO:chem.SGroup.GroupCro,MIX:chem.SGroup.GroupMix,FOR:chem.SGroup.GroupFor},chem.SGroupForest=function(t){this.parent=new util.Map,this.children=new util.Map,this.children.set(-1,[]),this.molecule=t},chem.SGroup.prototype.getAttr=function(t){return this.data[t]},chem.SGroup.prototype.getAttrs=function(){var t={};for(var e in this.data)t[e]=this.data[e];return t},chem.SGroup.prototype.setAttr=function(t,e){var n=this.data[t];return this.data[t]=e,n},chem.SGroup.prototype.checkAttr=function(t,e){return this.data[t]==e},chem.SGroup.equip=function(t){var e=chem.SGroup.TYPES[t.type];for(var n in e)t[n]=e[n]},chem.SGroup.numberArrayToString=function(t,e){for(var n=util.stringPadded(t.length,3),i=0;i<t.length;++i)n+=" "+util.stringPadded(e[t[i]],3);return n},chem.SGroup.addGroup=function(t,e,n){null==t.sgroups&&(t.sgroups=new util.Pool),e.id=t.sgroups.add(e),e.postLoad(t,n);for(var i=0;i<e.atoms.length;++i)t.atoms.has(e.atoms[i])&&util.Set.add(t.atoms.get(e.atoms[i]).sgs,e.id);return t.sGroupForest.insert(e.id),e.id},chem.SGroup.bracketsToMolfile=function(t,e,n){var i=[],r=util.Set.fromList(e.atoms);chem.SGroup.getCrossBonds([],i,t,r),chem.SGroup.bracketPos(e,null,t,i);for(var o=e.bracketBox,s=e.bracketDir,a=s.rotateSC(1,0),l=chem.SGroup.getBracketParameters(t,i,r,o,s,a,null,e.id),c=[],u=0;u<l.length;++u){for(var h=l[u],d=h.c.addScaled(h.n,-.5*h.h).yComplement(),f=h.c.addScaled(h.n,.5*h.h).yComplement(),p="M  SDI "+n+util.paddedInt(4,3),m=[d.x,d.y,f.x,f.y],g=0;g<m.length;++g)p+=util.paddedFloat(m[g],10,4);c.push(p)}return c},chem.SGroup.filterAtoms=function(t,e){for(var n=[],i=0;i<t.length;++i){var r=t[i];"number"!=typeof e[r]?n.push(r):0<=e[r]?n.push(e[r]):n.push(-1)}return n},chem.SGroup.removeNegative=function(t){for(var e=[],n=0;n<t.length;++n)0<=t[n]&&e.push(t[n]);return e},chem.SGroup.filter=function(t,e,n){e.atoms=chem.SGroup.removeNegative(chem.SGroup.filterAtoms(e.atoms,n))},chem.SGroup.clone=function(t,e,n){var i=new chem.SGroup(t.type);for(var r in t.data)i.data[r]=t.data[r];return i.atoms=util.mapArray(t.atoms,e),i.pp=t.pp,i.bracketBox=t.bracketBox,i.patoms=null,i.bonds=null,i.allAtoms=t.allAtoms,i},chem.SGroup.addAtom=function(t,e){t.atoms.push(e)},chem.SGroup.removeAtom=function(t,e){for(var n=0;n<t.atoms.length;++n)if(t.atoms[n]===e)return void t.atoms.splice(n,1);throw new Error("The atom is not found in the given s-group")},chem.SGroup.getCrossBonds=function(n,i,t,r){t.bonds.each(function(t,e){util.Set.contains(r,e.begin)&&util.Set.contains(r,e.end)?util.isNull(n)||n.push(t):(util.Set.contains(r,e.begin)||util.Set.contains(r,e.end))&&(util.isNull(i)||i.push(t))},this)},chem.SGroup.bracketPos=function(t,o,s,e){var n=t.atoms;if(e&&2===e.length){var i=s.bonds.get(e[0]),r=s.bonds.get(e[1]),a=i.getCenter(s),l=r.getCenter(s);t.bracketDir=util.Vec2.diff(l,a).normalized()}else t.bracketDir=new util.Vec2(1,0);var c=t.bracketDir,u=c.rotateSC(1,0),h=null,d=[];util.each(n,function(t){var e=s.atoms.get(t),n=o?o.ctab.atoms.get(t).visel.boundingBox:null,i=new util.Vec2(e.pp);if(util.isNull(n)){n=new util.Box2Abs(i,i);var r=new util.Vec2(.05*3,.05*3);n=n.extend(r,r)}else n=n.translate((o.offset||new util.Vec2).negated()).transform(o.scaled2obj,o);d.push(n)},this),util.each(s.sGroupForest.children.get(t.id),function(t){var e=o?o.ctab.sgroups.get(t).visel.boundingBox:null;util.isNull(e)||(e=e.translate((o.offset||new util.Vec2).negated()).transform(o.scaled2obj,o),d.push(e))},this),util.each(d,function(t){var r=null;util.each([t.p0.x,t.p1.x],function(i){util.each([t.p0.y,t.p1.y],function(t){var e=new util.Vec2(i,t),n=new util.Vec2(util.Vec2.dot(e,c),util.Vec2.dot(e,u));r=util.isNull(r)?new util.Box2Abs(n,n):r.include(n)},this)},this),h=util.isNull(h)?r:util.Box2Abs.union(h,r)},this);var f=new util.Vec2(.2,.4);util.isNull(h)||(h=h.extend(f,f)),t.bracketBox=h},chem.SGroup.drawBrackets=function(s,a,t,e,n,i,r,o,l,c,u){for(var h=chem.SGroup.getBracketParameters(a.ctab.molecule,e,n,i,r,o,a,t.id),d=-1,f=0;f<h.length;++f){var p=h[f],m=chem.SGroup.drawBracket(a,a.paper,a.styles,p.d,p.n,p.c,p.w,p.h);s.push(m),(d<0||h[d].d.x<p.d.x||h[d].d.x==p.d.x&&h[d].d.y>p.d.y)&&(d=f)}var g=h[d],y=function(t,e){var n=a.ps(g.c.addScaled(g.n,e*g.h)),i=a.paper.text(n.x,n.y,t).attr({font:a.settings.font,"font-size":a.settings.fontszsub});u&&i.attr(u);var r=util.Box2Abs.fromRelBox(rnd.relBox(i.getBBox())),o=Math.max(util.Vec2.shiftRayBox(n,g.d.negated(),r),3)+2;i.translateAbs(o*g.d.x,o*g.d.y),s.push(i)};l&&y(l,.5),c&&y(c,-.5)},chem.SGroup.drawBracket=function(t,e,n,i,r,o,s,a){s=s||.25,a=a||1;var l=o.addScaled(r,-.5*a),c=o.addScaled(r,.5*a),u=l.addScaled(i,-s),h=c.addScaled(i,-s);return l=t.obj2scaled(l),c=t.obj2scaled(c),u=t.obj2scaled(u),h=t.obj2scaled(h),e.path("M {0}, {1} L {2} , {3} L {4} , {5} L {6} , {7}",u.x,u.y,l.x,l.y,c.x,c.y,h.x,h.y).attr(n.sgroupBracketStyle)},chem.SGroup.getBracketParameters=function(p,m,r,o,s,a,g,y){var v=function(t,e,n,i){this.c=t,this.d=e,this.n=e.rotateSC(1,0),this.w=n,this.h=i},b=[];return m.length<2?function(){s=s||new util.Vec2(1,0),a=a||s.rotateSC(1,0);var t=Math.min(.25,.3*o.sz().x),e=util.Vec2.lc2(s,o.p0.x,a,.5*(o.p0.y+o.p1.y)),n=util.Vec2.lc2(s,o.p1.x,a,.5*(o.p0.y+o.p1.y)),i=o.sz().y;b.push(new v(e,s.negated(),t,i),new v(n,s,t,i))}():2===m.length?function(){var t=p.bonds.get(m[0]),e=p.bonds.get(m[1]),n=t.getCenter(p),i=e.getCenter(p),r=-1,o=-1,s=-1,a=-1,l=util.Vec2.centre(n,i),c=util.Vec2.diff(i,n).normalized(),u=c.negated(),h=c.rotateSC(1,0),d=h.negated();util.each(p.sGroupForest.children.get(y),function(t){var e=g?g.ctab.sgroups.get(t).visel.boundingBox:null;util.isNull(e)||(e=e.translate((g.offset||new util.Vec2).negated()).transform(g.scaled2obj,g),r=Math.max(r,util.Vec2.shiftRayBox(n,u,e)),o=Math.max(o,util.Vec2.shiftRayBox(i,c,e)),s=Math.max(s,util.Vec2.shiftRayBox(l,h,e)),a=Math.max(a,util.Vec2.shiftRayBox(l,d,e)))},this),r=Math.max(r+.2,0),o=Math.max(o+.2,0);var f=1.5+(s=Math.max(Math.max(s,a)+.1,0));b.push(new v(n.addScaled(u,r),u,.25,f),new v(i.addScaled(c,o),c,.25,f))}():function(){for(var t=0;t<m.length;++t){var e=p.bonds.get(m[t]),n=e.getCenter(p),i=util.Set.contains(r,e.begin)?e.getDir(p):e.getDir(p).negated();b.push(new v(n,i,.2,1))}}(),b},chem.SGroup.getObjBBox=function(t,e){if(0==t.length)throw new Error("Atom list is empty");for(var n=e.atoms.get(t[0]).pp,i=new util.Box2Abs(n,n),r=1;r<t.length;++r){var o=t[r],s=e.atoms.get(o).pp;i=i.include(s)}return i},chem.SGroup.makeAtomBondLines=function(t,e,n,i){if(!n)return[];for(var r=[],o=0;o<Math.floor((n.length+14)/15);++o){for(var s=Math.min(n.length-15*o,15),a="M  "+t+" "+e+" "+util.paddedInt(s,2),l=0;l<s;++l)a+=" "+util.paddedInt(i[n[15*o+l]],3);r.push(a)}return r},chem.SGroup.getAtoms=function(t,e){if(!e.allAtoms)return e.atoms;var n=[];return t.atoms.each(function(t){n.push(t)}),n},chem.SGroup.getBonds=function(t,e){var n=chem.SGroup.getAtoms(t,e),i=[];return t.bonds.each(function(t,e){0<=n.indexOf(e.begin)&&0<=n.indexOf(e.end)&&i.push(t)}),i},chem.SGroup.getMassCentre=function(t,e){for(var n=new util.Vec2,i=0;i<e.length;++i)n=n.addScaled(t.atoms.get(e[i]).pp,1/e.length);return n},chem.SGroup.setPos=function(t,e,n){e.pp=n},chem.SGroupForest.prototype.insert=function(e,t,n){util.assert(!this.parent.has(e),"sgid already present in the forest"),util.assert(!this.children.has(e),"sgid already present in the forest"),util.assert(this.validate(),"s-group forest invalid");var i=this.getAtomSets(),r=util.Set.fromList(this.molecule.sgroups.get(e).atoms);if(util.isUndefined(t)||util.isUndefined(n)){var o=this.getAtomSetRelations(e,r,i);t=o.parent,n=o.children}return util.each(n,function(t){util.assert(1===util.arrayRemoveByValue(this.children.get(this.parent.get(t)),t)),this.parent.set(t,e)},this),this.children.set(e,n),this.parent.set(e,t),this.children.get(t).push(e),util.assert(this.validate(),"s-group forest invalid"),{parent:t,children:n}},chem.SGroupForest.prototype.getSGroupsBFS=function(){var t=[],e=[],n=-1;for(e=util.array(this.children.get(-1));0<e.length;){n=e.shift();e=e.concat(this.children.get(n)),t.push(n)}return t},chem.SGroupForest.prototype.getAtomSets=function(){return this.molecule.sgroups.map(function(t,e){return util.Set.fromList(e.atoms)})},chem.SGroupForest.prototype.getAtomSetRelations=function(t,n,e){var i=new util.Map,r=new util.Map;(e=this.getAtomSets()).unset(t),e.each(function(t,e){r.set(t,util.Set.subset(n,e)),i.set(t,util.Set.subset(e,n)&&!util.Set.eq(e,n))},this);var o=e.findAll(function(t){return!!r.get(t)&&!(0<=util.find(this.children.get(t),function(t){return r.get(t)},this))},this);return{children:e.findAll(function(t,e){return i.get(t)&&!i.get(this.parent.get(t))},this),parent:0===o.length?-1:o[0]}},chem.SGroupForest.prototype.getPathToRoot=function(t){for(var e=[],n=t;0<=n;n=this.parent.get(n))util.assert(e.indexOf(n)<0,"SGroupForest: loop detected"),e.push(n);return e},chem.SGroupForest.prototype.validate=function(){var r=this.getAtomSets();this.molecule.sgroups.each(function(t){this.getPathToRoot(t)},this);var o=!0;return this.parent.each(function(t,e){0<=e&&!util.Set.subset(r.get(t),r.get(e))&&(o=!1)},this),this.children.each(function(t){for(var e=this.children.get(t),n=0;n<e.length;++n)for(var i=n+1;i<e.length;++i)util.Set.disjoint(r.get(e[n]),r.get(e[i]))||(o=!1)},this),o},chem.SGroupForest.prototype.remove=function(t){util.assert(this.parent.has(t),"sgid is not in the forest"),util.assert(this.children.has(t),"sgid is not in the forest"),util.assert(this.validate(),"s-group forest invalid");var e=this.parent.get(t);util.each(this.children.get(t),function(t){this.parent.set(t,e),this.children.get(e).push(t)},this),util.assert(1===util.arrayRemoveByValue(this.children.get(e),t)),this.children.unset(t),this.parent.unset(t),util.assert(this.validate(),"s-group forest invalid")},!(window.chem&&util.Vec2&&chem.Struct&&chem.SGroup))throw new Error("Vec2 and Molecule should be defined first");if(void 0===String.prototype.strip&&(String.prototype.strip=function(){return String(this).replace(/^\s+|\s+$/g,"")}),isUndefined=function(t){return util.isUndefined(t)},chem.Molfile=function(){},chem.Molfile.loadRGroupFragments=!0,chem.Molfile.parseDecimalInt=function(t){var e=parseInt(t,10);return isNaN(e)?0:e},chem.Molfile.partitionLine=function(t,e,n){for(var i=[],r=0,o=0;r<e.length;++r)i.push(t.slice(o,o+e[r])),n&&o++,o+=e[r];return i},chem.Molfile.partitionLineFixed=function(t,e,n){for(var i=[],r=0;r<t.length;r+=e)i.push(t.slice(r,r+e)),n&&r++;return i},chem.Molfile.parseCTFile=function(t,e){var n=null;return(n=0==t[0].search("\\$RXN")?chem.Molfile.parseRxn(t):chem.Molfile.parseMol(t,e)).initHalfBonds(),n.initNeighbors(),n.markFragments(),n},chem.Molfile.fmtInfo={bondTypeMap:{1:chem.Struct.BOND.TYPE.SINGLE,2:chem.Struct.BOND.TYPE.DOUBLE,3:chem.Struct.BOND.TYPE.TRIPLE,4:chem.Struct.BOND.TYPE.AROMATIC,5:chem.Struct.BOND.TYPE.SINGLE_OR_DOUBLE,6:chem.Struct.BOND.TYPE.SINGLE_OR_AROMATIC,7:chem.Struct.BOND.TYPE.DOUBLE_OR_AROMATIC,8:chem.Struct.BOND.TYPE.ANY,9:chem.Struct.BOND.TYPE.COORDINATION,10:chem.Struct.BOND.TYPE.HYDROGEN},bondStereoMap:{0:chem.Struct.BOND.STEREO.NONE,1:chem.Struct.BOND.STEREO.UP,4:chem.Struct.BOND.STEREO.EITHER,6:chem.Struct.BOND.STEREO.DOWN,3:chem.Struct.BOND.STEREO.CIS_TRANS,5:chem.Struct.BOND.STEREO.UP2,7:chem.Struct.BOND.STEREO.DOWN2,8:chem.Struct.BOND.STEREO.WEDGE2,9:chem.Struct.BOND.STEREO.DOWN3},v30bondStereoMap:{0:chem.Struct.BOND.STEREO.NONE,1:chem.Struct.BOND.STEREO.UP,2:chem.Struct.BOND.STEREO.EITHER,3:chem.Struct.BOND.STEREO.DOWN},bondTopologyMap:{0:chem.Struct.BOND.TOPOLOGY.EITHER,1:chem.Struct.BOND.TOPOLOGY.RING,2:chem.Struct.BOND.TOPOLOGY.CHAIN},countsLinePartition:[3,3,3,3,3,3,3,3,3,3,3,6],atomLinePartition:[10,10,10,1,3,2,3,3,3,3,3,3,3,3,3,3,3,8,6,3,26,1e3],bondLinePartition:[3,3,3,3,3,3,3,8,3,8,8],atomListHeaderPartition:[3,1,1,4,1,1],atomListHeaderLength:11,atomListHeaderItemLength:4,chargeMap:[0,3,2,1,0,-1,-2,-3],valenceMap:[void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,0],implicitHydrogenMap:[void 0,0,1,2,3,4],v30atomPropMap:{CHG:"charge",RAD:"radical",MASS:"isotope",VAL:"explicitValence",HCOUNT:"hCount",INVRET:"invRet",SUBST:"substitutionCount",UNSAT:"unsaturatedAtom",RBCNT:"ringBondCount"},rxnItemsPartition:[3,3,3]},chem.Molfile.parseAtomLine=function(t){var e,n,i=chem.Molfile,r=i.partitionLine(t,i.fmtInfo.atomLinePartition);if("{}"!==r[21].strip()&&""!==r[21].strip()){var o=JSON.parse(r[21].strip());e=o.mcc?(n=o.mcc,delete o.mcc,JSON.stringify(o)):r[21].strip()}else e=r[21].strip();var s={pp:new util.Vec2(parseFloat(r[0]),-parseFloat(r[1]),parseFloat(r[2])),label:r[4].strip(),explicitValence:i.fmtInfo.valenceMap[i.parseDecimalInt(r[10])],massDifference:i.parseDecimalInt(r[5]),charge:i.fmtInfo.chargeMap[i.parseDecimalInt(r[6])],hCount:i.parseDecimalInt(i.parseDecimalInt(r[8])),stereoCare:0!=i.parseDecimalInt(r[9]),aam:i.parseDecimalInt(r[14]),invRet:i.parseDecimalInt(r[15]),exactChangeFlag:0!=i.parseDecimalInt(r[16]),color:r[17].strip(),hideH:r[18].strip(),breakBond:i.parseDecimalInt(i.parseDecimalInt(r[19])),groupFlag:r[20].strip(),fontContent:e,mutiChargeCenter:!!n&&n.icc,mutiAttachments:n?n.mas:[]};return new chem.Struct.Atom(s)},chem.Molfile.stripV30=function(t){if("M  V30 "!=t.slice(0,7))throw Error("Prefix invalid");return t.slice(7)},chem.Molfile.parseAtomLineV3000=function(t){var e,n,i,r,o,s=chem.Molfile;e=s.spaceparsplit(t);var a={pp:new util.Vec2(parseFloat(e[2]),-parseFloat(e[3])),aam:e[5].strip()},l=e[1].strip();if('"'==l.charAt(0)&&'"'==l.charAt(l.length-1)&&(l=l.substr(1,l.length-2)),"]"==l.charAt(l.length-1)){var c={notList:!1};if("NOT ["==(l=l.substr(0,l.length-1)).substr(0,5))c.notList=!0,l=l.substr(5);else{if("["!=l.charAt(0))throw"Error: atom list expected, found '"+l+"'";l=l.substr(1)}c.ids=s.labelsListToIds(l.split(",")),a.atomList=new chem.Struct.AtomList(c),a.label="L#"}else a.label=l;for(e.splice(0,6),o=0;o<e.length;++o)if(i=(n=s.splitonce(e[o],"="))[0],r=n[1],i in s.fmtInfo.v30atomPropMap){var u=s.parseDecimalInt(r);if("VAL"==i){if(0==u)continue;-1==u&&(u=0)}a[s.fmtInfo.v30atomPropMap[i]]=u}else if("RGROUPS"==i)for(var h=(r=r.strip().substr(1,r.length-2)).split(" ").slice(1),d=a.rglabel=0;d<h.length;++d)a.rglabel|=1<<h[d]-1;else"ATTCHPT"==i&&(a.attpnt=r.strip()-0);return new chem.Struct.Atom(a)},chem.Molfile.parseBondLineV3000=function(t){var e,n,i,r,o,s=chem.Molfile;e=s.spaceparsplit(t);var a={begin:s.parseDecimalInt(e[2])-1,end:s.parseDecimalInt(e[3])-1,type:s.fmtInfo.bondTypeMap[s.parseDecimalInt(e[1])]};for(e.splice(0,4),o=0;o<e.length;++o)i=(n=s.splitonce(e[o],"="))[0],r=n[1],"CFG"==i?(a.stereo=s.fmtInfo.v30bondStereoMap[s.parseDecimalInt(r)],a.type==chem.Struct.BOND.TYPE.DOUBLE&&a.stereo==chem.Struct.BOND.STEREO.EITHER&&(a.stereo=chem.Struct.BOND.STEREO.CIS_TRANS)):"TOPO"==i?a.topology=s.fmtInfo.bondTopologyMap[s.parseDecimalInt(r)]:"RXCTR"==i?a.reactingCenterStatus=s.parseDecimalInt(r):"STBOX"==i&&(a.stereoCare=s.parseDecimalInt(r));return new chem.Struct.Bond(a)},chem.Molfile.parseBondLine=function(t){var e=chem.Molfile,n=e.partitionLine(t,e.fmtInfo.bondLinePartition),i={begin:e.parseDecimalInt(n[0])-1,end:e.parseDecimalInt(n[1])-1,type:e.fmtInfo.bondTypeMap[e.parseDecimalInt(n[2])],stereo:e.fmtInfo.bondStereoMap[e.parseDecimalInt(n[3])],topology:e.fmtInfo.bondTopologyMap[e.parseDecimalInt(n[5])],reactingCenterStatus:e.parseDecimalInt(n[6]),color:n[7].strip(),posValue:parseInt(n[8].strip()),bondWidth:parseFloat(n[9].strip()),bondLength:parseFloat(n[10].strip())};return new chem.Struct.Bond(i)},chem.Molfile.parseAtomListLine=function(t){for(var e=chem.Molfile,n=e.partitionLine(t,e.fmtInfo.atomListHeaderPartition),i=e.parseDecimalInt(n[0])-1,r="T"==n[2].strip(),o=e.parseDecimalInt(n[4].strip()),s=t.slice(e.fmtInfo.atomListHeaderLength),a=[],l=e.fmtInfo.atomListHeaderItemLength,c=0;c<o;++c)a[c]=e.parseDecimalInt(s.slice(c*l,(c+1)*l-1));return{aid:i,atomList:new chem.Struct.AtomList({notList:r,ids:a})}},chem.Molfile.readKeyValuePairs=function(t,e){for(var n=chem.Molfile,i={},r=n.partitionLineFixed(t,3,!0),o=n.parseDecimalInt(r[0]),s=0;s<o;++s)i[n.parseDecimalInt(r[2*s+1])-1]=e?r[2*s+2].strip():n.parseDecimalInt(r[2*s+2]);return i},chem.Molfile.readKeyMultiValuePairs=function(t,e){for(var n=chem.Molfile,i=[],r=n.partitionLineFixed(t,3,!0),o=n.parseDecimalInt(r[0]),s=0;s<o;++s)i.push([n.parseDecimalInt(r[2*s+1])-1,e?r[2*s+2].strip():n.parseDecimalInt(r[2*s+2])]);return i},chem.Molfile.labelsListToIds=function(t){for(var e=[],n=0;n<t.length;++n)e.push(chem.Element.getElementByLabel(t[n].strip()));return e},chem.Molfile.parsePropertyLineAtomList=function(t,e){var n=chem.Molfile,i=n.parseDecimalInt(t[1])-1,r=n.parseDecimalInt(t[2]),o="T"==t[4].strip(),s=n.labelsListToIds(e.slice(0,r)),a={};return a[i]=new chem.Struct.AtomList({notList:o,ids:s}),a},chem.Molfile.initSGroup=function(t,e){var n,i=chem.Molfile.readKeyValuePairs(e,!0);for(var r in n=1<e.split("#").length?"#"+e.split("#")[1]:"#000000",i){var o=i[r];if(!(o in chem.SGroup.TYPES))throw new Error("Unsupported S-group type");var s=new chem.SGroup(o);(t[s.number=r]=s).data.color=n}},chem.Molfile.applySGroupProp=function(t,e,n,i,r){var o=chem.Molfile.readKeyValuePairs(n,!i);for(var s in o)(r?t[s]:t[s].data)[e]=o[s]},chem.Molfile.toIntArray=function(t){for(var e=chem.Molfile,n=[],i=0;i<t.length;++i)n[i]=e.parseDecimalInt(t[i]);return n},chem.Molfile.applySGroupArrayProp=function(t,e,n,i){var r=chem.Molfile,o=r.parseDecimalInt(n.slice(1,4))-1,s=r.parseDecimalInt(n.slice(4,8)),a=r.toIntArray(r.partitionLineFixed(n.slice(8),3,!0));if(a.length!=s)throw new Error("File format invalid");i&&util.apply(a,function(t){return t+i}),t[o][e]=t[o][e].concat(a)},chem.Molfile.applyDataSGroupName=function(t,e){t.data.fieldName=e},chem.Molfile.applyDataSGroupQuery=function(t,e){t.data.query=e},chem.Molfile.applyDataSGroupQueryOp=function(t,e){t.data.queryOp=e},chem.Molfile.applyDataSGroupDesc=function(t,e){var n=chem.Molfile,i=n.partitionLine(e,[4,31,2,20,2,3],!1),r=n.parseDecimalInt(i[0])-1,o=i[1].strip(),s=i[2].strip(),a=i[3].strip(),l=i[4].strip(),c=i[5].strip(),u=t[r];u.data.fieldType=s,u.data.fieldName=o,u.data.units=a,u.data.query=l,u.data.queryOp=c},chem.Molfile.applyDataSGroupInfo=function(t,e){var n=chem.Molfile,i=n.partitionLine(e,[10,10,4,1,1,1,3,3,3,3,2,3,2],!1),r=parseFloat(i[0]),o=parseFloat(i[1]),s="A"==i[3].strip(),a="A"==i[4].strip(),l="U"==i[5].strip(),c=i[7].strip();c="ALL"==c?-1:n.parseDecimalInt(c);var u=i[10].strip(),h=n.parseDecimalInt(i[11].strip());t.pp=new util.Vec2(r,-o),t.data.attached=s,t.data.absolute=a,t.data.showUnits=l,t.data.nCharsToDisplay=c,t.data.tagChar=u,t.data.daspPos=h},chem.Molfile.applyDataSGroupInfoLine=function(t,e){var n=chem.Molfile,i=t[n.parseDecimalInt(e.substr(0,4))-1];n.applyDataSGroupInfo(i,e.substr(5))},chem.Molfile.applyDataSGroupData=function(t,e,n){t.data.fieldValue=(t.data.fieldValue||"")+e,n&&(t.data.fieldValue=util.stripRight(t.data.fieldValue),t.data.fieldValue.startsWith('"')&&t.data.fieldValue.endsWith('"')&&(t.data.fieldValue=t.data.fieldValue.substr(1,t.data.fieldValue.length-2)),t.data.fieldValue+="\n")},chem.Molfile.applyDataSGroupDataLine=function(t,e,n){var i=chem.Molfile,r=i.parseDecimalInt(e.substr(0,5))-1,o=e.substr(5),s=t[r];i.applyDataSGroupData(s,o,n)},chem.Molfile.parsePropertyLines=function(t,e,n,i,r,o){for(var s=chem.Molfile,a=new util.Map;n<i;){var l=e[n];if("A"==l.charAt(0))a.get("label")||a.set("label",new util.Map),a.get("label").set(s.parseDecimalInt(l.slice(3,6))-1,e[++n]);else if("M"==l.charAt(0)){var c=l.slice(3,6),u=l.slice(6);if("END"==c)break;if("CHG"==c)a.get("charge")||a.set("charge",new util.Map),a.get("charge").update(s.readKeyValuePairs(u));else if("RAD"==c)a.get("radical")||a.set("radical",new util.Map),a.get("radical").update(s.readKeyValuePairs(u));else if("ISO"==c)a.get("isotope")||a.set("isotope",new util.Map),a.get("isotope").update(s.readKeyValuePairs(u));else if("RBC"==c)a.get("ringBondCount")||a.set("ringBondCount",new util.Map),a.get("ringBondCount").update(s.readKeyValuePairs(u));else if("SUB"==c)a.get("substitutionCount")||a.set("substitutionCount",new util.Map),a.get("substitutionCount").update(s.readKeyValuePairs(u));else if("UNS"==c)a.get("unsaturatedAtom")||a.set("unsaturatedAtom",new util.Map),a.get("unsaturatedAtom").update(s.readKeyValuePairs(u));else if("RGP"==c){a.get("rglabel")||a.set("rglabel",new util.Map);for(var h=a.get("rglabel"),d=s.readKeyMultiValuePairs(u),f=0;f<d.length;f++){var p=d[f];h.set(p[0],(h.get(p[0])||0)|1<<p[1]-1)}}else if("LOG"==c){u=u.slice(4);var m=s.parseDecimalInt(u.slice(0,3).strip()),g=s.parseDecimalInt(u.slice(4,7).strip()),y=s.parseDecimalInt(u.slice(8,11).strip()),v=u.slice(12).strip(),b={};0<g&&(b.ifthen=g),b.resth=1==y,b.range=v,o[m]=b}else if("APO"==c)a.get("attpnt")||a.set("attpnt",new util.Map),a.get("attpnt").update(s.readKeyValuePairs(u));else if("ALS"==c){a.get("atomList")||a.set("atomList",new util.Map);var w=s.parsePropertyLineAtomList(s.partitionLine(u,[1,3,3,1,1,1]),s.partitionLineFixed(u.slice(10),4,!1));for(var x in a.get("atomList").update(w),a.get("label")||a.set("label",new util.Map),w)a.get("label").set(x,"L#")}else if("STY"==c)s.initSGroup(r,u);else if("SST"==c)s.applySGroupProp(r,"copSubtype",u);else if("SLB"==c)s.applySGroupProp(r,"label",u,!0);else if("SPL"==c)s.applySGroupProp(r,"parent",u,!0,!0);else if("SCN"==c)s.applySGroupProp(r,"connectivity",u);else if("SAL"==c)s.applySGroupArrayProp(r,"atoms",u,-1);else if("SBL"==c)s.applySGroupArrayProp(r,"bonds",u,-1);else if("SPA"==c)s.applySGroupArrayProp(r,"patoms",u,-1);else if("SMT"==c){r[s.parseDecimalInt(u.slice(0,4))-1].data.subscript=u.slice(4).strip()}else if("SNC"==c){r[s.parseDecimalInt(u.slice(0,4))-1].data.subscript=u.slice(4).strip()}else"SDT"==c?s.applyDataSGroupDesc(r,u):"SDD"==c?s.applyDataSGroupInfoLine(r,u):"SCD"==c?s.applyDataSGroupDataLine(r,u,!1):"SED"==c&&s.applyDataSGroupDataLine(r,u,!0)}++n}return a},chem.Molfile.applyAtomProp=function(n,t,i,e){t.each(function(t,e){n.get(t)[i]=e})},chem.Molfile.parseCTabV2000=function(t,e,n){var i,r=new chem.Struct,o=chem.Molfile,s=o.parseDecimalInt(e[0]),a=o.parseDecimalInt(e[1]),l=o.parseDecimalInt(e[2]);r.isChiral=0!=o.parseDecimalInt(e[4]);var c=o.parseDecimalInt(e[5]),u=o.parseDecimalInt(999),h=0,d=t.slice(h,h+s);h+=s;var f=t.slice(h,h+a);h+=a;var p=t.slice(h,h+l);h+=l+c;var m=d.map(o.parseAtomLine);for(i=0;i<m.length;++i)r.atoms.add(m[i]);var g=f.map(o.parseBondLine);for(i=0;i<g.length;++i)r.bonds.add(g[i]);p.map(o.parseAtomListLine).each(function(t){r.atoms.get(t.aid).atomList=t.atomList,r.atoms.get(t.aid).label="L#"});var y={},v={};o.parsePropertyLines(r,t,h,Math.min(t.length,h+u),y,v).each(function(t,e){o.applyAtomProp(r.atoms,e,t)});var b,w={};for(b in y){var x=y[b];if("DAT"===x.type&&0===x.atoms.length){var S=y[b].parent;if(0<=S){var E=y[S-1];"GEN"===E.type&&(x.atoms=util.array(E.atoms))}}}for(b in y)n&&y[b].data.mul||chem.SGroup.addGroup(r,y[b],w);for(var C in v)r.rgroups.set(C,new chem.Struct.RGroup(v[C]));return r},chem.Molfile.spaceparsplit=function(t){var e,n,i=[],r=0,o=-1,s=t.split(""),a=!1;for(n=0;n<t.length;++n)"("==(e=s[n])?r++:")"==e&&r--,'"'==e&&(a=!a),a||" "!=s[n]||0!=r||(o+1<n&&i.push(t.slice(o+1,n)),o=n);return o+1<n&&i.push(t.slice(o+1,n)),o=n,i},chem.Molfile.splitonce=function(t,e){var n=t.indexOf(e);return[t.slice(0,n),t.slice(n+1)]},chem.Molfile.splitSGroupDef=function(t){for(var e=[],n=0,i=!1,r=0;r<t.length;++r){var o=t.charAt(r);'"'==o?i=!i:i||("("==o?n++:")"==o?n--:" "==o&&0==n&&(e.push(t.slice(0,r)),t=t.slice(r+1).strip(),r=0))}if(0!=n)throw"Brace balance broken. S-group properies invalid!";return 0<t.length&&e.push(t.strip()),e},chem.Molfile.parseBracedNumberList=function(t,e){if(!t)return null;var n=[],i=(t=(t=t.strip()).substr(1,t.length-2)).split(" ");e=e||0;for(var r=1;r<i.length;++r)n.push(i[r]-0+e);return n},chem.Molfile.v3000parseCollection=function(t,e,n){for(n++;"M  V30 END COLLECTION"!=e[n].strip();)n++;return++n},chem.Molfile.v3000parseSGroup=function(t,e,n,i,r){var o=chem.Molfile,s="";for(r++;r<e.length;){if("END SGROUP"==(s=o.stripV30(e[r++]).strip()).strip())return r;for(;"-"==s.charAt(s.length-1);)s=(s.substr(0,s.length-1)+o.stripV30(e[r++])).strip();var a=o.splitSGroupDef(s),l=a[1],c=new chem.SGroup(l);c.number=a[0]-0,c.type=l,c.label=a[2]-0,n[c.number]=c;for(var u={},h=3;h<a.length;++h){var d=o.splitonce(a[h],"=");if(2!=d.length)throw"A record of form AAA=BBB or AAA=(...) expected, got '"+a[h]+"'";var f=d[0];f in u||(u[f]=[]),u[f].push(d[1])}c.atoms=o.parseBracedNumberList(u.ATOMS[0],-1),u.PATOMS&&(c.patoms=o.parseBracedNumberList(u.PATOMS[0],-1)),c.bonds=u.BONDS?o.parseBracedNumberList(u.BONDS[0],-1):[];var p=u.BRKXYZ;if(c.brkxyz=[],p)for(var m=0;m<p.length;++m)c.brkxyz.push(o.parseBracedNumberList(p[m]));u.MULT&&(c.data.subscript=u.MULT[0]-0),u.LABEL&&(c.data.subscript=u.LABEL[0].strip()),u.CONNECT&&(c.data.connectivity=u.CONNECT[0].toLowerCase()),u.FIELDDISP&&o.applyDataSGroupInfo(c,util.stripQuotes(u.FIELDDISP[0])),u.FIELDDATA&&o.applyDataSGroupData(c,u.FIELDDATA[0],!0),u.FIELDNAME&&o.applyDataSGroupName(c,u.FIELDNAME[0]),u.QUERYTYPE&&o.applyDataSGroupQuery(c,u.QUERYTYPE[0]),u.QUERYOP&&o.applyDataSGroupQueryOp(c,u.QUERYOP[0]),chem.SGroup.addGroup(t,c,i)}throw new Error("S-group declaration incomplete.")},chem.Molfile.parseCTabV3000=function(t,e){var n=new chem.Struct,i=chem.Molfile,r=0;if("M  V30 BEGIN CTAB"!=t[r++].strip())throw Error("CTAB V3000 invalid");if("M  V30 COUNTS"!=t[r].slice(0,13))throw Error("CTAB V3000 invalid");var o=t[r].slice(14).split(" ");if(n.isChiral=1==i.parseDecimalInt(o[4]),"M  V30 BEGIN ATOM"==t[++r].strip()){var s;for(r++;r<t.length&&"END ATOM"!=(s=i.stripV30(t[r++]).strip());){for(;"-"==s.charAt(s.length-1);)s=(s.substring(0,s.length-1)+i.stripV30(t[r++])).strip();n.atoms.add(i.parseAtomLineV3000(s))}if("M  V30 BEGIN BOND"==t[r].strip())for(r++;r<t.length&&"END BOND"!=(s=i.stripV30(t[r++]).strip());){for(;"-"==s.charAt(s.length-1);)s=(s.substring(0,s.length-1)+i.stripV30(t[r++])).strip();n.bonds.add(i.parseBondLineV3000(s))}for(var a={},l={};"M  V30 END CTAB"!=t[r].strip();)if("M  V30 BEGIN COLLECTION"==t[r].strip())r=i.v3000parseCollection(n,t,r);else{if("M  V30 BEGIN SGROUP"!=t[r].strip())throw Error("CTAB V3000 invalid");r=i.v3000parseSGroup(n,t,a,l,r)}}if("M  V30 END CTAB"!=t[r++].strip())throw Error("CTAB V3000 invalid");return e||i.readRGroups3000(n,t.slice(r)),n},chem.Molfile.readRGroups3000=function(t,e){for(var n={},i={},r=0,o=chem.Molfile;r<e.length&&0==e[r].search("M  V30 BEGIN RGROUP");){var s=e[r++].split(" ").pop();for(n[s]=[],i[s]={};;){var a=e[r].strip();if(0!=a.search("M  V30 RLOGIC")){if("M  V30 BEGIN CTAB"!=a)throw Error("CTAB V3000 invalid");for(var l=0;l<e.length&&"M  V30 END CTAB"!=e[r+l].strip();++l);var c=e.slice(r,r+l+1),u=this.parseCTabV3000(c,!0);if(n[s].push(u),"M  V30 END RGROUP"==e[r=r+l+1].strip()){r++;break}}else{var h=(a=a.slice(13)).strip().split(/\s+/g),d=o.parseDecimalInt(h[0]),f=o.parseDecimalInt(h[1]),p=h.slice(2).join(" "),m={};0<d&&(m.ifthen=d),m.resth=1==f,m.range=p,i[s]=m,r++}}}for(var g in n)for(var y=0;y<n[g].length;++y){var v=n[g][y];v.rgroups.set(g,new chem.Struct.RGroup(i[g]));var b=v.frags.add(new chem.Struct.Fragment);v.rgroups.get(g).frags.add(b),v.atoms.each(function(t,e){e.fragment=b}),v.mergeInto(t)}},chem.Molfile.parseMol=function(t,e){if(0==t[0].search("\\$MDL"))return this.parseRg2000(t);var n=this.parseCTab(t.slice(3),e);return n.name=t[0].strip(),n},chem.Molfile.parseCTab=function(t,e){var n=chem.Molfile,i=n.partitionLine(t[0],n.fmtInfo.countsLinePartition),r=i[11].strip();if(t=t.slice(1),"V2000"==r)return this.parseCTabV2000(t,i,e);if("V3000"==r)return this.parseCTabV3000(t,!chem.Molfile.loadRGroupFragments);throw Error("Molfile version unknown: "+r)},chem.MolfileSaver=function(t){this.molecule=null,this.molfile=null,this.v3000=t||!1},chem.MolfileSaver.prototype.prepareSGroups=function(n){var i=this.molecule,r=(i.sgroups,[]);util.each(this.molecule.sGroupForest.getSGroupsBFS().reverse(),function(t){var e=i.sgroups.get(t);try{e.prepareForSaving(i)}catch(t){if(ui.forwardExceptions)throw t;if(!n||"number"!=typeof t.id)throw t;r.push(t.id)}},this),0<r.length&&alert("WARNING: "+r.length.toString()+" invalid S-groups were detected. They will be omitted.");for(var t=0;t<r.length;++t)i.sGroupDelete(r[t]);return i},chem.MolfileSaver.getComponents=function(t){var e=t.findConnectedComponents(!0),n=[],i=null;t.rxnArrows.each(function(t,e){i=e.pp.x}),t.rxnPluses.each(function(t,e){n.push(e.pp.x)}),null!=i&&n.push(i),n.sort(function(t,e){return t-e});var r,o=[];for(r=0;r<e.length;++r){for(var s=t.getCoordBoundingBox(e[r]),a=util.Vec2.lc2(s.min,.5,s.max,.5),l=0;a.x>n[l];)++l;o[l]=o[l]||{},util.Set.mergeIn(o[l],e[r])}var c=[],u=[],h=[];for(r=0;r<o.length;++r)o[r]?(s=t.getCoordBoundingBox(o[r]),(a=util.Vec2.lc2(s.min,.5,s.max,.5)).x<i?u.push(o[r]):h.push(o[r])):c.push("");return{reactants:u,products:h}},chem.MolfileSaver.prototype.getCTab=function(t,e){return this.molecule=t.clone(),this.molfile="",this.writeCTab2000(e),this.molfile},chem.MolfileSaver.prototype.saveMolecule=function(i,t,e,n){if(this.reaction=0<i.rxnArrows.count(),1<i.rxnArrows.count())throw new Error("Reaction may not contain more than one arrow");if(this.molfile="",this.reaction){if(0<i.rgroups.count())throw new Error("Unable to save the structure - reactions with r-groups are not supported at the moment");var r=chem.MolfileSaver.getComponents(i),o=r.reactants,s=r.products,a=o.concat(s);this.molfile="$RXN\n\n\n\n"+util.paddedInt(o.length,3)+util.paddedInt(s.length,3)+util.paddedInt(0,3)+"\n";for(var l=0;l<a.length;++l){var c=new chem.MolfileSaver(!1),u=i.clone(a[l],null,!0),h=c.saveMolecule(u,!1,!0);this.molfile+="$MOL\n"+h}return this.molfile}if(0<i.rgroups.count()){if(!e){var d=new chem.MolfileSaver(!1).getCTab(i.getScaffold(),i.rgroups);return this.molfile="$MDL  REV  1\n$MOL\n$HDR\n\n\n\n$END HDR\n",this.molfile+="$CTAB\n"+d+"$END CTAB\n",i.rgroups.each(function(t,e){this.molfile+="$RGP\n",this.writePaddedNumber(t,3),this.molfile+="\n",e.frags.each(function(t,e){var n=new chem.MolfileSaver(!1).getCTab(i.getFragment(e));this.molfile+="$CTAB\n"+n+"$END CTAB\n"},this),this.molfile+="$END RGP\n"},this),this.molfile+="$END MOL\n",this.molfile}i=i.getScaffold()}return this.molecule=i.clone(),this.prepareSGroups(t),this.writeHeader(),this.writeCTab2000(!1,n),this.molfile},chem.MolfileSaver.prototype.writeHeader=function(){var t=new Date;this.writeCR(),this.writeWhiteSpace(2),this.write("InDraw"),this.writeWhiteSpace(),this.writeCR((t.getMonth()+1).toPaddedString(2)+t.getDate().toPaddedString(2)+(t.getFullYear()%100).toPaddedString(2)+t.getHours().toPaddedString(2)+t.getMinutes().toPaddedString(2)+"2D 1   1.00000     0.00000     0"),this.writeCR()},chem.MolfileSaver.prototype.write=function(t){this.molfile+=t},chem.MolfileSaver.prototype.writeCR=function(t){0==arguments.length&&(t=""),this.molfile+=t+"\n"},chem.MolfileSaver.prototype.writeWhiteSpace=function(t){0==arguments.length&&(t=1);for(var e=0;e<t;e++)this.write(" ")},chem.MolfileSaver.prototype.writePadded=function(t,e){this.write(t),this.writeWhiteSpace(e-t.length)},chem.MolfileSaver.prototype.writePaddedRight=function(t,e){this.writeWhiteSpace(e-t.length),this.write(t)},chem.MolfileSaver.prototype.writePaddedNumber=function(t,e){var n=(t-0).toString();this.writeWhiteSpace(e-n.length),this.write(n)},chem.MolfileSaver.prototype.writePaddedFloat=function(t,e,n){this.write(util.paddedFloat(t,e,n))},chem.MolfileSaver.prototype.writeCTab2000Header=function(){this.writePaddedNumber(this.molecule.atoms.count(),3),this.writePaddedNumber(this.molecule.bonds.count(),3),this.writePaddedNumber(0,3),this.writeWhiteSpace(3),this.writePaddedNumber(this.molecule.isChiral?1:0,3),this.writePaddedNumber(0,3),this.writeWhiteSpace(12),this.writePaddedNumber(999,3),this.writeCR(" V2000")},chem.MolfileSaver.prototype.writeCTab2000=function(t,r){this.writeCTab2000Header(),this.mapping={};var o=1,s=[],a=[];for(this.molecule.atoms.each(function(t,e){this.writePaddedFloat(e.pp.x,10,4),this.writePaddedFloat(-e.pp.y,10,4),this.writePaddedFloat(e.pp.z,10,4),this.writeWhiteSpace();var n=e.label;null!=e.atomList?(n="L",s.push(t)):null==chem.Element.getElementByLabel(n)&&-1==["A","Q","X","*","R#"].indexOf(n)&&(n="C",a.push(t)),this.writePadded(n,3),this.writePaddedNumber(0,2),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),isUndefined(e.hCount)&&(e.hCount=0),this.writePaddedNumber(e.hCount,3),isUndefined(e.stereoCare)&&(e.stereoCare=0),this.writePaddedNumber(e.stereoCare,3),this.writePaddedNumber(e.explicitValence<0?0:0==e.explicitValence?15:e.explicitValence,3),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),isUndefined(e.aam)&&(e.aam=0),this.writePaddedNumber(e.aam,3),isUndefined(e.invRet)&&(e.invRet=0),this.writePaddedNumber(e.invRet,3),isUndefined(e.exactChangeFlag)&&(e.exactChangeFlag=0),this.writePaddedNumber(e.exactChangeFlag,3),!r&&this.writePaddedRight(e.color,8),!r&&this.writePaddedRight(e.hideH.toString(),6),isUndefined(e.breakBond)&&(e.breakBond=0),!r&&this.writePaddedNumber(e.breakBond,3),this.writeWhiteSpace(),(isUndefined(e.groupFlag)||!1===e.groupFlag)&&(e.groupFlag="                   false"),!r&&this.writePadded(e.groupFlag,26),this.writeWhiteSpace(),e.mutiChargeCenter&&(e.fontContent.mcc={icc:e.mutiChargeCenter||!1,mas:e.mutiAttachments?e.mutiAttachments.slice():[]});var i="object"==typeof e.fontContent?JSON.stringify(e.fontContent):e.fontContent;!r&&this.writePadded(i,JSON.stringify(e.fontContent).length),this.writeCR(),this.mapping[t]=o,o++},this),this.bondMapping={},o=1,this.molecule.bonds.each(function(t,e){this.bondMapping[t]=o++,this.writePaddedNumber(this.mapping[e.begin],3),this.writePaddedNumber(this.mapping[e.end],3),this.writePaddedNumber(e.type,3),isUndefined(e.stereo)&&(e.stereo=0),r&&9==e.stereo&&(e.stereo=6),this.writePaddedNumber(e.stereo,3),this.writeWhiteSpace(3),isUndefined(e.topology)&&(e.topology=0),this.writePaddedNumber(e.topology,3),isUndefined(e.reactingCenterStatus)&&(e.reactingCenterStatus=0),this.writePaddedNumber(e.reactingCenterStatus,3),!r&&this.writePaddedRight(e.color,8),!r&&this.writePaddedNumber(e.posValue,3),!r&&this.writePaddedNumber(e.bondWidth,8),!r&&this.writePaddedNumber(e.bondLength,8),this.writeCR()},this);0<a.length;)this.write("A  "),this.writePaddedNumber(a[0]+1,3),this.writeCR(),this.writeCR(this.molecule.atoms.get(a[0]).label),a.splice(0,1);var i=new Array,l=new Array,c=new Array,u=new Array,h=new Array,d=new Array,f=new Array,p=new Array,m=new Array;this.molecule.atoms.each(function(t,e){if(0!=e.charge&&i.push([t,e.charge]),0!=e.isotope&&l.push([t,e.isotope]),0!=e.radical&&c.push([t,e.radical]),null!=e.rglabel&&"R#"==e.label)for(var n=0;n<32;n++)e.rglabel&1<<n&&u.push([t,n+1]);null!=e.attpnt&&d.push([t,e.attpnt]),0!=e.ringBondCount&&f.push([t,e.ringBondCount]),0!=e.substitutionCount&&m.push([t,e.substitutionCount]),0!=e.unsaturatedAtom&&p.push([t,e.unsaturatedAtom])}),t&&t.each(function(t,e){if(e.resth||0<e.ifthen||0<e.range.length){var n="  1 "+util.paddedInt(t,3)+" "+util.paddedInt(e.ifthen,3)+" "+util.paddedInt(e.resth?1:0,3)+"   "+e.range;h.push(n)}});var e=function(t,e){for(;0<e.length;){for(var n=new Array;0<e.length&&n.length<8;)n.push(e[0]),e.splice(0,1);this.write(t),this.writePaddedNumber(n.length,3),n.each(function(t){this.writeWhiteSpace(),this.writePaddedNumber(this.mapping[t[0]],3),this.writeWhiteSpace(),this.writePaddedNumber(t[1],3)},this),this.writeCR()}};e.call(this,"M  CHG",i),e.call(this,"M  ISO",l),e.call(this,"M  RAD",c),e.call(this,"M  RGP",u);for(var n=0;n<h.length;++n)this.write("M  LOG"+h[n]+"\n");if(e.call(this,"M  APO",d),e.call(this,"M  RBC",f),e.call(this,"M  SUB",m),e.call(this,"M  UNS",p),0<s.length)for(n=0;n<s.length;++n){var g=s[n],y=this.molecule.atoms.get(g).atomList;this.write("M  ALS"),this.writePaddedNumber(g+1,4),this.writePaddedNumber(y.ids.length,3),this.writeWhiteSpace(),this.write(y.notList?"T":"F");for(var v=y.labelList(),b=0;b<v.length;++b)this.writeWhiteSpace(),this.writePadded(v[b],3);this.writeCR()}var w={},x=1,S={},E=this.molecule.sGroupForest.getSGroupsBFS();util.each(E,function(t){S[x]=t,w[t]=x++},this);for(var C=1;C<x;++C){var T=S[C],N=this.molecule.sgroups.get(T);this.write("M  STY"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(C,3),this.writeWhiteSpace(1),this.writePadded(N.type,3),!r&&this.writePaddedRight(N.data.color,8),this.writeCR(),this.write("M  SLB"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(C,3),this.writeWhiteSpace(1),this.writePaddedNumber(C,3),this.writeCR();var k=this.molecule.sGroupForest.parent.get(T);if(0<=k&&(this.write("M  SPL"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(C,3),this.writeWhiteSpace(1),this.writePaddedNumber(w[k],3),this.writeCR()),"COP"==N.type&&"COP"!==N.data.copSubtype&&(this.write("M  SST"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(C,3),this.writeWhiteSpace(),this.write(N.data.copSubtype),this.writeCR()),("SRU"==N.type||"MOD"==N.type||"COM"==N.type||"ANY"==N.type||"GRA"==N.type||"CRO"==N.type||"COP"==N.type)&&N.data.connectivity){var _="";_+=" ",_+=util.stringPadded(C.toString(),3),_+=" ",_+=util.stringPadded(N.data.connectivity,3,!0),this.write("M  SCN"),this.writePaddedNumber(1,3),this.write(_.toUpperCase()),this.writeCR()}"COM"==N.type&&(this.write("M  SNC"),this.writePaddedNumber(C,3),this.writeWhiteSpace(),this.write(N.data.subscript||"1"),this.writeCR()),"SRU"==N.type&&(this.write("M  SMT "),this.writePaddedNumber(C,3),this.writeWhiteSpace(),this.write(N.data.subscript||"n"),this.writeCR()),this.writeCR(N.saveToMolfile(this.molecule,w,this.mapping,this.bondMapping))}this.writeCR("M  END")},chem.Molfile.parseRxn=function(t){var e=chem.Molfile,n=t[0].strip().split(" ");return 1<n.length&&"V3000"==n[1]?e.parseRxn3000(t):e.parseRxn2000(t)},chem.Molfile.parseRxn2000=function(t){var e=chem.Molfile;t=t.slice(4);var n=e.partitionLine(t[0],e.fmtInfo.rxnItemsPartition),i=n[0]-0,r=n[1]-0,o=n[2]-0;t=t.slice(1);for(var s=[];0<t.length&&"$MOL"==t[0].substr(0,4);){t=t.slice(1);for(var a=0;a<t.length&&"$MOL"!=t[a].substr(0,4);)a++;s.push(chem.Molfile.parseMol(t.slice(0,a))),t=t.slice(a)}return e.rxnMerge(s,i,r,o)},chem.Molfile.parseRxn3000=function(n){for(var t=chem.Molfile,e=(n=n.slice(4))[0].split(/\s+/g).slice(3),i=e[0]-0,r=e[1]-0,o=2<e.length?e[2]-0:0,s=function(t){util.assert(t,"CTab format invalid")},a=function(t){for(var e=t;e<n.length;++e)if("M  V30 END CTAB"==n[e].strip())return e;s(!1)},l=function(t){for(var e=t;e<n.length;++e)if("M  V30 END RGROUP"==n[e].strip())return e;s(!1)},c=[],u=[],h=null,d=[],f=0;f<n.length;++f){var p=n[f].strip();if(p.startsWith("M  V30 COUNTS"));else{if("M  END"==p)break;if("M  V30 BEGIN PRODUCT"==p)s(null==h),h=u;else if("M  V30 END PRODUCT"==p)s(h===u),h=null;else if("M  V30 BEGIN REACTANT"==p)s(null==h),h=c;else if("M  V30 END REACTANT"==p)s(h===c),h=null;else if(p.startsWith("M  V30 BEGIN RGROUP")){s(null==h);var m=l(f);d.push(n.slice(f,m+1)),f=m}else{if("M  V30 BEGIN CTAB"!=p)throw new Error("line unrecognized: "+p);m=a(f);h.push(n.slice(f,m+1)),f=m}}}var g=[],y=c.concat(u);for(m=0;m<y.length;++m){var v=chem.Molfile.parseCTabV3000(y[m],e);g.push(v)}var b=t.rxnMerge(g,i,r,o);return t.readRGroups3000(b,function(t){for(var e=[],n=0;n<t.length;++n)e=e.concat(t[n]);return e}(d)),b},chem.Molfile.rxnMerge=function(t,e,n,i){chem.Molfile;var r,o=new chem.Struct,s=[],a=[],l=[],c=[],u=[],h=[],d={cnt:0,totalLength:0};for(r=0;r<t.length;++r){var f=t[r],p=f.getBondLengthData();d.cnt+=p.cnt,d.totalLength+=p.totalLength}var m=1/(0==d.cnt?1:d.totalLength/d.cnt);for(r=0;r<t.length;++r)(f=t[r]).scale(m);for(r=0;r<t.length;++r){var g=(f=t[r]).getCoordBoundingBoxObj();if(g){var y=r<e?chem.Struct.FRAGMENT.REACTANT:r<e+n?chem.Struct.FRAGMENT.PRODUCT:chem.Struct.FRAGMENT.AGENT;y==chem.Struct.FRAGMENT.REACTANT?(s.push(g),c.push(f)):y==chem.Struct.FRAGMENT.AGENT?(a.push(g),u.push(f)):y==chem.Struct.FRAGMENT.PRODUCT&&(l.push(g),h.push(f)),f.atoms.each(function(t,e){e.rxnFragmentType=y})}}var v=0,b=function(t,e,n,i,r){var o=new util.Vec2(i-n.min.x,r?1-n.min.y:-(n.min.y+n.max.y)/2);return e.atoms.each(function(t,e){e.pp.add_(o)}),e.sgroups.each(function(t,e){e.pp&&e.pp.add_(o)}),n.min.add_(o),n.max.add_(o),e.mergeInto(t),n.max.x-n.min.x};for(r=0;r<c.length;++r)v+=b(o,c[r],s[r],v,!1)+2;for(v+=2,r=0;r<u.length;++r)v+=b(o,u[r],a[r],v,!0)+2;for(v+=2,r=0;r<h.length;++r)v+=b(o,h[r],l[r],v,!1)+2;var w,x,S,E,C=null,T=null;for(r=0;r<s.length-1;++r)w=s[r],x=s[r+1],S=(w.max.x+x.min.x)/2,E=(w.max.y+w.min.y+x.max.y+x.min.y)/4,o.rxnPluses.add(new chem.Struct.RxnPlus({pp:new util.Vec2(S,E)}));for(r=0;r<s.length;++r)C.min=0==r?((C={}).max=new util.Vec2(s[r].max),new util.Vec2(s[r].min)):(C.max=util.Vec2.max(C.max,s[r].max),util.Vec2.min(C.min,s[r].min));for(r=0;r<l.length-1;++r)w=l[r],x=l[r+1],S=(w.max.x+x.min.x)/2,E=(w.max.y+w.min.y+x.max.y+x.min.y)/4,o.rxnPluses.add(new chem.Struct.RxnPlus({pp:new util.Vec2(S,E)}));for(r=0;r<l.length;++r)T.min=0==r?((T={}).max=new util.Vec2(l[r].max),new util.Vec2(l[r].min)):(T.max=util.Vec2.max(T.max,l[r].max),util.Vec2.min(T.min,l[r].min));if(x=T,(w=C)||x){var N=w?new util.Vec2(w.max.x,(w.max.y+w.min.y)/2):null,k=x?new util.Vec2(x.min.x,(x.max.y+x.min.y)/2):null;N||(N=new util.Vec2(k.x-3,k.y)),k||(k=new util.Vec2(N.x+3,N.y)),o.rxnArrows.add(new chem.Struct.RxnArrow({pp:util.Vec2.lc2(N,.5,k,.5)}))}else o.rxnArrows.add(new chem.Struct.RxnArrow({pp:new util.Vec2(0,0)}));return o.isReaction=!0,o},chem.Molfile.rgMerge=function(t,e){var n=new chem.Struct;for(var i in t.mergeInto(n,null,null,!1,!0),e)for(var r=0;r<e[i].length;++r){var o=e[i][r];o.rgroups.set(i,new chem.Struct.RGroup);var s=o.frags.add(new chem.Struct.Fragment);o.rgroups.get(i).frags.add(s),o.atoms.each(function(t,e){e.fragment=s}),o.mergeInto(n)}return n},chem.Molfile.parseRg2000=function(t){var e=chem.Molfile;if("$CTAB"!=(t=t.slice(7))[0].strip())throw new Error("RGFile format invalid");for(var n=1;"$"!=t[n].charAt(0);)n++;if("$END CTAB"!=t[n].strip())throw new Error("RGFile format invalid");var i=t.slice(1,n);t=t.slice(n+1);for(var r={};;){if(0==t.length)throw new Error("Unexpected end of file");var o=t[0].strip();if("$END MOL"==o){t=t.slice(1);break}if("$RGP"!=o)throw new Error("RGFile format invalid");var s=t[1].strip()-0;for(r[s]=[],t=t.slice(2);;){if(0==t.length)throw new Error("Unexpected end of file");if("$END RGP"==(o=t[0].strip())){t=t.slice(1);break}if("$CTAB"!=o)throw new Error("RGFile format invalid");for(n=1;"$"!=t[n].charAt(0);)n++;if("$END CTAB"!=t[n].strip())throw new Error("RGFile format invalid");r[s].push(t.slice(1,n)),t=t.slice(n+1)}}var a=chem.Molfile.parseCTab(i),l={};if(chem.Molfile.loadRGroupFragments)for(var c in r){l[c]=[];for(var u=0;u<r[c].length;++u)l[c].push(chem.Molfile.parseCTab(r[c][u]))}return e.rgMerge(a,l)},!window.chem||!chem.Struct)throw new Error("Include MolData.js first");if(chem.Struct.prototype.calcConn=function(t){for(var e=0,n=this.atoms.get(t),i=!1,r=0;r<n.neighbors.length;++r){var o=this.halfBonds.get(n.neighbors[r]);switch(this.bonds.get(o.bid).type){case chem.Struct.BOND.TYPE.SINGLE:e+=1;break;case chem.Struct.BOND.TYPE.DOUBLE:e+=2;break;case chem.Struct.BOND.TYPE.TRIPLE:e+=3;break;case chem.Struct.BOND.TYPE.AROMATIC:e+=1,i=!0;break;default:return-1}}return i&&(e+=1),e},chem.Struct.Atom.prototype.calcValence=function(t){var e=this.charge,n=this.label;if(this.isQuery())return!(this.implicitH=0);var i=chem.Element.getElementByLabel(n);if(null==i)return!(this.implicitH=0);var r=chem.Element.elements.get(i).group,o=chem.Struct.radicalElectrons(this.radical),s=t,a=0,l=Math.abs(e);return 1==r?"H"!=n&&"Li"!=n&&"Na"!=n&&"K"!=n&&"Rb"!=n&&"Cs"!=n&&"Fr"!=n||(a=(s=1)-o-t-l):3==r?"B"==n||"Al"==n||"Ga"==n||"In"==n?a=-1==e?(s=4)-o-t:(s=3)-o-t-l:"Tl"==n&&(a=-1==e?o+t<=2?(s=2)-o-t:(s=4)-o-t:-2==e?o+t<=3?(s=3)-o-t:(s=5)-o-t:o+t+l<=1?(s=1)-o-t-l:(s=3)-o-t-l):4==r?"C"==n||"Si"==n||"Ge"==n?a=(s=4)-o-t-l:"Sn"!=n&&"Pb"!=n||(a=t+o+l<=2?(s=2)-o-t-l:(s=4)-o-t-l):5==r?"N"==n||"P"==n?a=1==e?(s=4)-o-t:2==e?(s=3)-o-t:"N"==n||o+t+l<=3?(s=3)-o-t-l:(s=5)-o-t-l:"Bi"!=n&&"Sb"!=n&&"As"!=n||(a=1==e?o+t<=2&&"As"!=n?(s=2)-o-t:(s=4)-o-t:2==e?(s=3)-o-t:o+t<=3?(s=3)-o-t-l:(s=5)-o-t-l):6==r?"O"==n?a=1<=e?(s=3)-o-t:(s=2)-o-t-l:"S"==n||"Se"==n||"Po"==n?a=1==e?t<=3?(s=3)-o-t:(s=5)-o-t:t+o+l<=2?(s=2)-o-t-l:t+o+l<=4?(s=4)-o-t-l:(s=6)-o-t-l:"Te"==n&&(-1==e?t<=2&&(a=(s=2)-o-t-l):0!=e&&2!=e||(a=t<=2?(s=2)-o-t-l:t<=4?(s=4)-o-t-l:0==e&&t<=6?(s=6)-o-t-l:-1)):7==r&&("F"==n?a=(s=1)-o-t-l:"Cl"!=n&&"Br"!=n&&"I"!=n&&"At"!=n||(1==e?t<=2?a=(s=2)-o-t:(3==t||5==t||7<=t)&&(a=-1):0==e&&(t<=1?a=(s=1)-o-t:2==t||4==t||6==t?a=1==o?(s=t,0):-1:7<t&&(a=-1)))),this.valence=s,this.implicitH=a,!(this.implicitH<0)||(this.valence=t,this.implicitH=0,!(this.badConn=!0))},chem.Struct.Atom.prototype.calcValenceMinusHyd=function(t){var e=this.charge,n=this.label,i=chem.Element.getElementByLabel(n);if(null==i)throw new Error("Element "+n+" unknown");if(i<0)return this.implicitH=0,null;var r=chem.Element.elements.get(i).group,o=chem.Struct.radicalElectrons(this.radical);if(3==r){if(("B"==n||"Al"==n||"Ga"==n||"In"==n)&&-1==e&&o+t<=4)return o+t}else if(5==r){if("N"==n||"P"==n){if(1==e)return o+t;if(2==e)return o+t}else if("Sb"==n||"Bi"==n||"As"==n){if(1==e)return o+t;if(2==e)return o+t}}else if(6==r){if("O"==n){if(1<=e)return o+t}else if(("S"==n||"Se"==n||"Po"==n)&&1==e)return o+t}else if(7==r&&("Cl"==n||"Br"==n||"I"==n||"At"==n)&&1==e)return o+t;return o+t+Math.abs(e)},chem.Struct.prototype.calcImplicitHydrogen=function(t){var e=this.calcConn(t),n=this.atoms.get(t);if(n.badConn=!1,e<0||n.isQuery())n.implicitH=0;else if(0<=n.explicitValence){var i=chem.Element.getElementByLabel(n.label);n.implicitH=0,null!=i&&(n.implicitH=n.explicitValence-n.calcValenceMinusHyd(e),n.implicitH<0&&(n.implicitH=0,n.badConn=!0))}else n.calcValence(e)},!window.chem||!chem.Struct)throw new Error("Molecule should be defined first");if(chem.Dfs=function(t,e,n,i){this.molecule=t,this.atom_data=e,this.components=n,this.nComponentsInReactants=-1,this.nReactants=i,this.vertices=new Array(this.molecule.atoms.count()),this.molecule.atoms.each(function(t){this.vertices[t]=new chem.Dfs.VertexDesc},this),this.edges=new Array(this.molecule.bonds.count()),this.molecule.bonds.each(function(t){this.edges[t]=new chem.Dfs.EdgeDesc},this),this.v_seq=new Array},chem.Dfs.VertexDesc=function(){this.dfs_state=0,this.parent_vertex=0,this.parent_edge=0,this.branches=0},chem.Dfs.EdgeDesc=function(){this.opening_cycles=0,this.closing_cycle=0},chem.Dfs.SeqElem=function(t,e,n){this.idx=t,this.parent_vertex=e,this.parent_edge=n},chem.Dfs.prototype.walk=function(){for(var t,e,n=new Array,i=0,r=0;;){if(n.length<1){for(var o=-1,s=function(t){return 0==this.vertices[t].dfs_state&&(o=t,!0)};i<this.components.length&&-1==o;)null===(o=util.Set.find(this.components[i],s,this))&&(o=-1,++i==this.nReactants&&(this.nComponentsInReactants=r));if(o<-1&&this.molecule.atoms.find(s,this),-1==o)break;this.vertices[o].parent_vertex=-1,this.vertices[o].parent_edge=-1,n.push(o),r++}var a=n.pop(),l=this.vertices[a].parent_vertex,c=new chem.Dfs.SeqElem(a,l,this.vertices[a].parent_edge);this.v_seq.push(c),this.vertices[a].dfs_state=2;var u=this.atom_data[a];for(t=0;t<u.neighbours.length;t++){var h=u.neighbours[t].aid,d=u.neighbours[t].bid;if(h!=l)if(2==this.vertices[h].dfs_state){for(this.edges[d].closing_cycle=1,e=a;-1!=e&&this.vertices[e].parent_vertex!=h;)e=this.vertices[e].parent_vertex;if(-1==e)throw new Error("Cycle unwind error");this.edges[this.vertices[e].parent_edge].opening_cycles++,this.vertices[a].branches++,c=new chem.Dfs.SeqElem(h,a,d),this.v_seq.push(c)}else{if(1==this.vertices[h].dfs_state){if(-1==(e=n.indexOf(h)))throw new Error("Internal: removing vertex from stack");n.splice(e,1);var f=this.vertices[h].parent_vertex;0<=f&&this.vertices[f].branches--}this.vertices[a].branches++,this.vertices[h].parent_vertex=a,this.vertices[h].parent_edge=d,this.vertices[h].dfs_state=1,n.push(h)}}}},chem.Dfs.prototype.edgeClosingCycle=function(t){return 0!=this.edges[t].closing_cycle},chem.Dfs.prototype.numBranches=function(t){return this.vertices[t].branches},chem.Dfs.prototype.numOpeningCycles=function(t){return this.edges[t].opening_cycles},chem.Dfs.prototype.toString=function(){var e="";return this.v_seq.each(function(t){e+=t.idx+" -> "}),e+="*"},!window.chem||!chem.Struct)throw new Error("Vec2 and Molecule should be defined first");if(chem.CisTrans=function(t,e,n){this.molecule=t,this.bonds=new util.Map,this.getNeighbors=e,this.context=n},chem.CisTrans.PARITY={NONE:0,CIS:1,TRANS:2},chem.CisTrans.prototype.each=function(t,e){this.bonds.each(t,e)},chem.CisTrans.prototype.getParity=function(t){return this.bonds.get(t).parity},chem.CisTrans.prototype.getSubstituents=function(t){return this.bonds.get(t).substituents},chem.CisTrans.prototype.sameside=function(t,e,n,i){var r=util.Vec2.diff(t,e),o=new util.Vec2(-r.y,r.x);if(!o.normalize())return 0;var s=util.Vec2.diff(n,t),a=util.Vec2.diff(i,e);if(!s.normalize())return 0;if(!a.normalize())return 0;var l=util.Vec2.dot(s,o),c=util.Vec2.dot(a,o);return Math.abs(l)<.001||Math.abs(c)<.001?0:0<l*c?1:-1},chem.CisTrans.prototype._sameside=function(t,e,n,i){return this.sameside(this.molecule.atoms.get(t).pp,this.molecule.atoms.get(e).pp,this.molecule.atoms.get(n).pp,this.molecule.atoms.get(i).pp)},chem.CisTrans.prototype._sortSubstituents=function(t){var e=this.molecule.atoms.get(t[0]).pureHydrogen(),n=t[1]<0||this.molecule.atoms.get(t[1]).pureHydrogen(),i=this.molecule.atoms.get(t[2]).pureHydrogen(),r=t[3]<0||this.molecule.atoms.get(t[3]).pureHydrogen();return(!e||!n)&&((!i||!r)&&(n?t[1]=-1:e?(t[0]=t[1],t[1]=-1):t[0]>t[1]&&t.swap(0,1),r?t[3]=-1:i?(t[2]=t[3],t[3]=-1):t[2]>t[3]&&t.swap(2,3),!0))},chem.CisTrans.prototype.isGeomStereoBond=function(t,e){var n=this.molecule.bonds.get(t);if(n.type!=chem.Struct.BOND.TYPE.DOUBLE)return!1;var i=this.molecule.atoms.get(n.begin).label,r=this.molecule.atoms.get(n.end).label;if("C"!=i&&"N"!=i&&"Si"!=i&&"Ge"!=i)return!1;if("C"!=r&&"N"!=r&&"Si"!=r&&"Ge"!=r)return!1;var o,s,a=this.getNeighbors.call(this.context,n.begin),l=this.getNeighbors.call(this.context,n.end);if(a.length<2||3<a.length||l.length<2||3<l.length)return!1;for(e[0]=-1,e[1]=-1,e[2]=-1,e[3]=-1,o=0;o<a.length;o++)if((s=a[o]).bid!=t){if(this.molecule.bonds.get(s.bid).type!=chem.Struct.BOND.TYPE.SINGLE)return!1;-1==e[0]?e[0]=s.aid:e[1]=s.aid}for(o=0;o<l.length;o++)if((s=l[o]).bid!=t){if(this.molecule.bonds.get(s.bid).type!=chem.Struct.BOND.TYPE.SINGLE)return!1;-1==e[2]?e[2]=s.aid:e[3]=s.aid}return(-1==e[1]||-1==this._sameside(n.begin,n.end,e[0],e[1]))&&(-1==e[3]||-1==this._sameside(n.begin,n.end,e[2],e[3]))},chem.CisTrans.prototype.build=function(r){this.molecule.bonds.each(function(t,e){var n=this.bonds.set(t,{parity:0,substituents:new Array(4)});if((!util.isArray(r)||!r[t])&&this.isGeomStereoBond(t,n.substituents)&&this._sortSubstituents(n.substituents)){var i=this._sameside(e.begin,e.end,n.substituents[0],n.substituents[2]);1==i?n.parity=chem.CisTrans.PARITY.CIS:-1==i&&(n.parity=chem.CisTrans.PARITY.TRANS)}},this)},!window.chem||!chem.Struct)throw new Error("Vec2 and Molecule should be defined first");if(chem.Stereocenters=function(t,e,n){this.molecule=t,this.atoms=new util.Map,this.getNeighbors=e,this.context=n},chem.Stereocenters.prototype.each=function(t,e){this.atoms.each(t,e)},chem.Stereocenters.prototype.buildFromBonds=function(t){var a=this.molecule.atoms,l=this.molecule.bonds,g=util.Set.empty();if(a.each(function(e,t){var n=this.getNeighbors.call(this.context,e);if(2!=n.length)return!1;var i=n[0],r=n[1];if(0<=util.find([e,i.aid,r.aid],function(t){return["C","Si"].indexOf(a.get(t).label)<0},this))return!1;if(0<=util.find([i.bid,r.bid],function(t){return l.get(t).type!=chem.Struct.BOND.TYPE.DOUBLE},this))return!1;var o=util.findAll(this.getNeighbors.call(this.context,i.aid),function(t){return t.aid!=e},this),s=util.findAll(this.getNeighbors.call(this.context,r.aid),function(t){return t.aid!=e},this);return!(o.length<1||2<o.length||s.length<1||2<s.length)&&(!(0<=util.find(o.concat(s),function(t){return l.get(t.bid).type!=chem.Struct.BOND.TYPE.SINGLE},this))&&(!(0<=util.find(o.concat(s),function(t){return l.get(t.bid).stereo==chem.Struct.BOND.STEREO.EITHER},this))&&(util.Set.add(g,i.aid),void util.Set.add(g,r.aid))))},this),0<util.Set.size(g))throw new Error("This structure may contain allenes, which cannot be represented in the SMILES notation. Relevant stereo-information will be discarded.");a.each(function(n){if(!util.Set.contains(g,n)){var t=this.getNeighbors.call(this.context,n),i=!1;if(util.find(t,function(t){var e=this.molecule.bonds.get(t.bid);return e.type==chem.Struct.BOND.TYPE.SINGLE&&e.begin==n&&(e.stereo==chem.Struct.BOND.STEREO.UP||e.stereo==chem.Struct.BOND.STEREO.DOWN)&&(i=!0)},this),i)try{this._buildOneCenter(n)}catch(t){var e=JSON.parse(t.message);if("Stereo types of the opposite bonds mismatch"==e.type){for(var r=parseInt(JSON.parse(t.message).atomId),o=e.bondId,s=new Array(o.length),a=0;a<s.length;a++)s[a]=this.molecule.atoms._map._obj[o[a].nei_idx].pp;var l=new Array,c=new Array,u=this.molecule.atoms._map._obj[r].pp,h=new Array;for(a=0;a<s.length;a++){var d={};d.i=a,d.angle=Math.atan2(s[a].y-u.y,s[a].x-u.x),d.angle=d.angle<0?d.angle+2*Math.PI:d.angle,d.stereo=this.molecule.bonds._map._obj[o[a].edge_idx].stereo,d.vec={x:s[a].x-u.x,y:s[a].y-u.y},0==d.stereo?l.push(d):c.push(d),h.push(d.angle)}var f=function(t,e,n){return Math.abs(t-e)};if(f(l[0].angle,l[1].angle)==Math.PI);else{var p=f(l[0].angle,c[0].angle)+f(l[1].angle,c[0].angle),m=f(l[0].angle,c[1].angle)+f(l[1].angle,c[1].angle);s[l[1].i].y=p<m?(s[l[1].i].x=c[0].vec.x+l[0].vec.x+u.x,c[0].vec.y+l[0].vec.y+u.y):(s[l[1].i].x=c[1].vec.x+l[0].vec.x+u.x,c[1].vec.y+l[0].vec.y+u.y),this._buildOneCenter(n)}}}}},this)},chem.Stereocenters.allowed_stereocenters=[{elem:"C",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"C",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"S",charge:0,degree:4,n_double_bonds:2,implicit_degree:4},{elem:"S",charge:1,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:3,n_double_bonds:1,implicit_degree:3},{elem:"P",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"P",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"P",charge:0,degree:4,n_double_bonds:1,implicit_degree:4}],chem.Stereocenters.prototype._buildOneCenter=function(i){var r=this.molecule.atoms.get(i),t=this.getNeighbors.call(this.context,i),e=t.length,n=-1,o={group:0,type:0,pyramid:new Array(4)},s=0,a=new Array(4),l=0,c=0;o.pyramid[0]=-1,o.pyramid[1]=-1,o.pyramid[2]=-1,o.pyramid[3]=-1;var u=0;if(4<e)throw new Error(JSON.stringify({type:"Stereocenter with "+e+" bonds are not supported",atomId:i}));if(t.each(function(t){var e=this.molecule.atoms.get(t.aid),n=this.molecule.bonds.get(t.bid);if(a[s]={edge_idx:t.bid,nei_idx:t.aid,rank:t.aid,vec:util.Vec2.diff(e.pp,r.pp).yComplement()},e.pureHydrogen()?(u++,a[s].rank=1e4):"H"==e.label&&(a[s].rank=5e3),!a[s].vec.normalize())throw new Error(JSON.stringify({type:"Zero bond length",atomId:i}));if(n.type==chem.Struct.BOND.TYPE.TRIPLE)throw new Error(JSON.stringify({type:"Non-single bonds not allowed near stereocenter",atomId:i}));if(n.type==chem.Struct.BOND.TYPE.AROMATIC)throw new Error(JSON.stringify({type:"Aromatic bonds not allowed near stereocenter",atomId:i}));n.type==chem.Struct.BOND.TYPE.DOUBLE&&c++,s++},this),util.find(chem.Stereocenters.allowed_stereocenters,function(t){return t.elem==r.label&&t.charge==r.charge&&t.degree==e&&t.n_double_bonds==c&&(n=t.implicit_degree,!0)},this),-1==n)throw new Error(JSON.stringify({type:"Unknown stereocenter configuration: "+r.label+", charge "+r.charge+", "+e+" bonds ("+c+" double)",atomId:i}));if(4==e&&1<u)throw new Error(JSON.stringify({type:u+" hydrogens near stereocenter",atomId:i}));if(3==e&&4==n&&0<u)throw new Error(JSON.stringify({type:"Has hydrogen(s) besides implicit hydrogen near stereocenter",atomId:i}));if(4==e){a[0].rank>a[1].rank&&a.swap(0,1),a[1].rank>a[2].rank&&a.swap(1,2),a[2].rank>a[3].rank&&a.swap(2,3),a[1].rank>a[2].rank&&a.swap(1,2),a[0].rank>a[1].rank&&a.swap(0,1),a[1].rank>a[2].rank&&a.swap(1,2);var h,d,f=-1,p=-1,m=-1,g=-1,y=0;for(s=0;s<4;s++){var v=this._getBondStereo(i,a[s].edge_idx);if(v==chem.Struct.BOND.STEREO.UP||v==chem.Struct.BOND.STEREO.DOWN){f=s,y=v;break}}if(-1==f)throw new Error(JSON.stringify({type:"None of 4 bonds going from stereocenter is stereobond",atomId:i}));if(-1==p&&((h=chem.Stereocenters._xyzzy(a[f].vec,a[(f+1)%4].vec,a[(f+2)%4].vec))+(d=chem.Stereocenters._xyzzy(a[f].vec,a[(f+1)%4].vec,a[(f+3)%4].vec))!=3&&h+d!=12||(p=(f+1)%4,m=(f+2)%4,g=(f+3)%4)),-1==p&&((h=chem.Stereocenters._xyzzy(a[f].vec,a[(f+2)%4].vec,a[(f+1)%4].vec))+(d=chem.Stereocenters._xyzzy(a[f].vec,a[(f+2)%4].vec,a[(f+3)%4].vec))!=3&&h+d!=12||(p=(f+2)%4,m=(f+1)%4,g=(f+3)%4)),-1==p&&((h=chem.Stereocenters._xyzzy(a[f].vec,a[(f+3)%4].vec,a[(f+1)%4].vec))+(d=chem.Stereocenters._xyzzy(a[f].vec,a[(f+3)%4].vec,a[(f+2)%4].vec))!=3&&h+d!=12||(p=(f+3)%4,m=(f+2)%4,g=(f+1)%4)),-1==p)throw new Error(JSON.stringify({type:"Internal error: can not find opposite bond",atomId:i}));if(y==chem.Struct.BOND.STEREO.UP&&this._getBondStereo(i,a[p].edge_idx)==chem.Struct.BOND.STEREO.DOWN)throw new Error(JSON.stringify({type:"Stereo types of the opposite bonds mismatch",atomId:i,bondId:a.slice()}));if(y==chem.Struct.BOND.STEREO.DOWN&&this._getBondStereo(i,a[p].edge_idx)==chem.Struct.BOND.STEREO.UP)throw new Error(JSON.stringify({type:"Stereo types of the opposite bonds mismatch",atomId:i,bondId:a.slice()}));if(y==this._getBondStereo(i,a[m].edge_idx))throw new Error(JSON.stringify({type:"Stereo types of non-opposite bonds match",atomId:i}));if(y==this._getBondStereo(i,a[g].edge_idx))throw new Error(JSON.stringify({type:"Stereo types of non-opposite bonds match",atomId:i}));l=3==f||3==p?y:y==chem.Struct.BOND.STEREO.UP?chem.Struct.BOND.STEREO.DOWN:chem.Struct.BOND.STEREO.UP,T=chem.Stereocenters._sign(a[0].vec,a[1].vec,a[2].vec),l==chem.Struct.BOND.STEREO.UP&&0<T||l==chem.Struct.BOND.STEREO.DOWN&&T<0?(o.pyramid[0]=a[0].nei_idx,o.pyramid[1]=a[1].nei_idx,o.pyramid[2]=a[2].nei_idx):(o.pyramid[0]=a[0].nei_idx,o.pyramid[1]=a[2].nei_idx,o.pyramid[2]=a[1].nei_idx),o.pyramid[3]=a[3].nei_idx}else if(3==e){a[0].rank>a[1].rank&&a.swap(0,1),a[1].rank>a[2].rank&&a.swap(1,2),a[0].rank>a[1].rank&&a.swap(0,1);var b=this._getBondStereo(i,a[0].edge_idx),w=this._getBondStereo(i,a[1].edge_idx),x=this._getBondStereo(i,a[2].edge_idx),S=0,E=0;if(S+=b==chem.Struct.BOND.STEREO.UP?1:0,S+=w==chem.Struct.BOND.STEREO.UP?1:0,S+=x==chem.Struct.BOND.STEREO.UP?1:0,E+=b==chem.Struct.BOND.STEREO.DOWN?1:0,E+=w==chem.Struct.BOND.STEREO.DOWN?1:0,E+=x==chem.Struct.BOND.STEREO.DOWN?1:0,4==n){if(3==S)throw new Error(JSON.stringify({type:"All 3 bonds up near stereoatom",atomId:i}));if(3==E)throw new Error(JSON.stringify({type:"All 3 bonds down near stereoatom",atomId:i}));if(0==S&&0==E)throw new Error(JSON.stringify({type:"No up/down bonds near stereoatom -- indefinite case",atomId:i}));if(1==S&&1==E)throw new Error(JSON.stringify({type:"One bond up, one bond down -- indefinite case",atomId:i}));if(y=0,2==S)l=chem.Struct.BOND.STEREO.DOWN;else if(2==E)l=chem.Struct.BOND.STEREO.UP;else{for(g=m=f=-1,s=0;s<3;s++)if((N=this._getBondStereo(i,a[s].edge_idx))==chem.Struct.BOND.STEREO.UP||N==chem.Struct.BOND.STEREO.DOWN){y=N,m=((f=s)+1)%3,g=(s+2)%3;break}if(-1==f)throw new Error(JSON.stringify({type:"Internal error: can not find up or down bond",atomId:i}));var C=chem.Stereocenters._xyzzy(a[m].vec,a[g].vec,a[f].vec);if(3==C||4==C)throw new Error(JSON.stringify({type:"Degenerate case for 3 bonds near stereoatom",atomId:i}));l=1==C?y:y==chem.Struct.BOND.STEREO.UP?chem.Struct.BOND.STEREO.DOWN:chem.Struct.BOND.STEREO.UP}var T=chem.Stereocenters._sign(a[0].vec,a[1].vec,a[2].vec);l==chem.Struct.BOND.STEREO.UP&&0<T||l==chem.Struct.BOND.STEREO.DOWN&&T<0?(o.pyramid[0]=a[0].nei_idx,o.pyramid[1]=a[1].nei_idx,o.pyramid[2]=a[2].nei_idx):(o.pyramid[0]=a[0].nei_idx,o.pyramid[1]=a[2].nei_idx,o.pyramid[2]=a[1].nei_idx),o.pyramid[3]=-1}else{var N;if(0<E&&0<S)throw new Error(JSON.stringify({type:"One bond up, one bond down -- indefinite case",atomId:i}));if(0==E&&0==S)throw new Error(JSON.stringify({type:"No up-down bonds attached to stereocenter",atomId:i}));N=0<S?1:-1,1!=chem.Stereocenters._xyzzy(a[0].vec,a[1].vec,a[2].vec)&&1!=chem.Stereocenters._xyzzy(a[0].vec,a[2].vec,a[1].vec)&&1!=chem.Stereocenters._xyzzy(a[2].vec,a[1].vec,a[0].vec)||(N=-N),T=chem.Stereocenters._sign(a[0].vec,a[1].vec,a[2].vec),o.pyramid[2]=T==N?(o.pyramid[0]=a[0].nei_idx,o.pyramid[1]=a[2].nei_idx,a[1].nei_idx):(o.pyramid[0]=a[0].nei_idx,o.pyramid[1]=a[1].nei_idx,a[2].nei_idx),o.pyramid[3]=-1}}this.atoms.set(i,o)},chem.Stereocenters.prototype._getBondStereo=function(t,e){var n=this.molecule.bonds.get(e);return t!=n.begin?0:n.stereo},chem.Stereocenters._xyzzy=function(t,e,n){var i=util.Vec2.cross(t,e),r=util.Vec2.dot(t,e),o=util.Vec2.cross(t,n),s=util.Vec2.dot(t,n);if(Math.abs(i)<.001){if(Math.abs(o)<.001)throw new Error("Degenerate case -- bonds overlap");return 0<o?4:8}return i*o<-1e-6?2:s<r?2:1},chem.Stereocenters._sign=function(t,e,n){var i=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x);if(.001<i)return 1;if(i<-.001)return-1;throw new Error("Degenerate triangle")},chem.Stereocenters.isPyramidMappingRigid=function(t){var e=t.clone(),n=!0;return e[0]>e[1]&&(e.swap(0,1),n=!n),e[1]>e[2]&&(e.swap(1,2),n=!n),e[2]>e[3]&&(e.swap(2,3),n=!n),e[1]>e[2]&&(e.swap(1,2),n=!n),e[0]>e[1]&&(e.swap(0,1),n=!n),e[1]>e[2]&&(e.swap(1,2),n=!n),n},!window.chem||!chem.Struct)throw new Error("Vec2 and Molecule should be defined first");chem.SmilesSaver=function(){this.smiles="",this._written_atoms=new Array,this._written_components=0,this.ignore_errors=!1},chem.SmilesSaver._Atom=function(t){this.neighbours=new Array,this.aromatic=!1,this.lowercase=!1,this.chirality=0,this.branch_cnt=0,this.paren_written=!1,this.h_count=t,this.parent=-1},chem.SmilesSaver.prototype.isBondInRing=function(t){if(util.isUndefined(this.inLoop)||util.isNull(this.inLoop))throw new Error("Init this.inLoop prior to calling this method");return this.inLoop[t]},chem.SmilesSaver.prototype.saveMolecule=function(i,t,e){var n,s,a;util.isUndefined(t)||(this.ignore_errors=t),i.initHalfBonds(),i.initNeighbors(),this.atoms=new Array(i.atoms.count()),i.atoms.each(function(t,e){var n=i.calcConn(t);e.calcValence(n),this.atoms[t]=new chem.SmilesSaver._Atom(e.implicitH)},this);var r=["B","C","N","O","P","S","Se","As"];i.bonds.each(function(t,e){e.type==chem.Struct.BOND.TYPE.AROMATIC&&(this.atoms[e.begin].aromatic=!0,-1!=r.indexOf(i.atoms.get(e.begin).label)&&(this.atoms[e.begin].lowercase=!0),this.atoms[e.end].aromatic=!0,-1!=r.indexOf(i.atoms.get(e.end).label)&&(this.atoms[e.end].lowercase=!0)),this.atoms[e.begin].neighbours.push({aid:e.end,bid:t}),this.atoms[e.end].neighbours.push({aid:e.begin,bid:t})},this),this.inLoop=function(){i.prepareLoopStructure();var n=util.Set.empty();i.loops.each(function(t,e){e.hbs.length<=6&&util.Set.mergeIn(n,util.Set.fromList(util.map(e.hbs,function(t){return i.halfBonds.get(t).bid},this)))},this);var e={};return util.Set.each(n,function(t){e[t]=1},this),e}(),this._touched_cistransbonds=0,this._markCisTrans(i);var o=chem.MolfileSaver.getComponents(i),l=o.reactants.concat(o.products),c=new chem.Dfs(i,this.atoms,l,o.reactants.length);for(c.walk(),util.each(this.atoms,function(t){t.neighbours=[]},this),n=0;n<c.v_seq.length;n++){var u=c.v_seq[n],h=u.idx,d=u.parent_edge,f=u.parent_vertex;if(0<=d){var p=this.atoms[h],m=c.numOpeningCycles(d);for(s=0;s<m;s++)this.atoms[f].neighbours.push({aid:-1,bid:-1});if(c.edgeClosingCycle(d)){for(a=0;a<p.neighbours.length;a++)if(-1==p.neighbours[a].aid){p.neighbours[a].aid=f,p.neighbours[a].bid=d;break}if(a==p.neighbours.length)throw new Error("Internal: can not put closing bond to its place")}else p.neighbours.push({aid:f,bid:d}),p.parent=f;this.atoms[f].neighbours.push({aid:h,bid:d})}}try{var g=new chem.Stereocenters(i,function(t){return this.atoms[t].neighbours},this);g.buildFromBonds(this.ignore_errors),g.each(function(t,e){var n=-1;-1==e.pyramid[3]&&(n=3);var i=new Array(4),r=0,o=this.atoms[t];if(-1!=o.parent)for(a=0;a<4;a++)if(e.pyramid[a]==o.parent){i[r++]=a;break}for(-1!=n&&(i[r++]=n),s=0;s!=o.neighbours.length;s++)if(o.neighbours[s].aid!=o.parent)for(a=0;a<4;a++)if(o.neighbours[s].aid==e.pyramid[a]){if(4<=r)throw new Error("Internal: pyramid overflow");i[r++]=a;break}if(4==r)r=i[0],i[0]=i[1],i[1]=i[2],i[2]=i[3],i[3]=r;else if(3!=r)throw new Error("Cannot calculate chirality");chem.Stereocenters.isPyramidMappingRigid(i)?this.atoms[t].chirality=1:this.atoms[t].chirality=2},this)}catch(t){var y=parseInt(JSON.parse(t.message).atomId);this.atoms[y].chirality=0}var v=new Array;v.push(0);var b=!0,w=!1;for(n=0;n<c.v_seq.length;n++){h=(u=c.v_seq[n]).idx,d=u.parent_edge;var x=!0;if(0<=(f=u.parent_vertex)){for(1<c.numBranches(f)&&0<this.atoms[f].branch_cnt&&this.atoms[f].paren_written&&(this.smiles+=")"),m=c.numOpeningCycles(d),s=0;s<m;s++){for(a=1;a<v.length&&-1!=v[a];a++);a==v.length?v.push(f):v[a]=f,this._writeCycleNumber(a)}if(0<=f){var S=c.numBranches(f);if(1<S&&this.atoms[f].branch_cnt<S-1&&(c.edgeClosingCycle(d)?this.atoms[f].paren_written=!1:(this.smiles+="(",this.atoms[f].paren_written=!0)),this.atoms[f].branch_cnt++,this.atoms[f].branch_cnt>S)throw new Error("Unexpected branch")}var E=i.bonds.get(d),C=0;if(E.type==chem.Struct.BOND.TYPE.SINGLE&&(C=this._calcBondDirection(i,d,f)),222===C&&(w=!0),1==C&&h==E.end||2==C&&h==E.begin?this.smiles+="/":2==C&&h==E.end||1==C&&h==E.begin?this.smiles+="\\":E.type==chem.Struct.BOND.TYPE.ANY?this.smiles+="~":E.type==chem.Struct.BOND.TYPE.DOUBLE?this.smiles+="=":E.type==chem.Struct.BOND.TYPE.TRIPLE?this.smiles+="#":E.type!=chem.Struct.BOND.TYPE.AROMATIC||this.atoms[E.begin].lowercase&&this.atoms[E.end].lowercase&&this.isBondInRing(d)?E.type==chem.Struct.BOND.TYPE.SINGLE&&this.atoms[E.begin].aromatic&&this.atoms[E.end].aromatic?this.smiles+="-":!1:this.smiles+=":",c.edgeClosingCycle(d)){for(s=1;s<v.length&&v[s]!=h;s++);if(s==v.length)throw new Error("Cycle number not found");this._writeCycleNumber(s),x=!(v[s]=-1)}}else b||(this.smiles+=this._written_components==c.nComponentsInReactants?">>":"."),b=!1,this._written_components++;x&&(this._writeAtom(i,h,this.atoms[h].aromatic,this.atoms[h].lowercase,this.atoms[h].chirality),this._written_atoms.push(u.idx))}return!(this.comma=!1)===e&&this._writeStereogroups(i),this._writeRadicals(i),this.comma&&(this.smiles+="|"),w&&(this.smiles=this.smiles.replace(/["\\" | "/"]/g,"")),this.smiles},chem.SmilesSaver.prototype._writeCycleNumber=function(t){if(0<t&&t<10)this.smiles+=t;else if(10<=t&&t<100)this.smiles+="%"+t;else{if(!(100<=t&&t<1e3))throw new Error("Bad cycle number: "+t);this.smiles+="%%"+t}},chem.SmilesSaver.prototype._writeAtom=function(t,e,n,i,r){var o=t.atoms.get(e);t.sgroups.each(function(){},t.sgroups);var s,a=!1,l=-1;if(1!=o.breakBond){if(o.smilesCpSign&&window.getsmilesForRdkit)return 2<o.neighbors.length?this.smiles+="[c-]":this.smiles+="[cH-]",void(window.countCpNegativeCharge+=1);if(o.mutiChargeCenter&&window.getsmilesForRdkit)this.smiles+="";else if("A"!=o.label)if("R"!=o.label&&"R#"!=o.label){s=o.aam,"C"!=o.label&&"P"!=o.label&&"N"!=o.label&&"S"!=o.label&&"O"!=o.label&&"Cl"!=o.label&&"F"!=o.label&&"Br"!=o.label&&"B"!=o.label&&"I"!=o.label&&(a=!0),(0<=o.explicitValence||0!=o.radical||0<r||n&&"C"!=o.label&&"O"!=o.label||n&&"C"==o.label&&this.atoms[e].neighbours.length<3&&0==this.atoms[e].h_count)&&(l=this.atoms[e].h_count);var c=o.label;if(o.atomList&&!o.atomList.notList?(c=o.atomList.label(),a=!1):o.isPseudo()||o.atomList&&o.atomList.notList?(c="*",a=!0):(r||0!=o.charge||0<o.isotope||0<=l||0<s)&&(a=!0),a&&(-1==l&&(l=this.atoms[e].h_count),this.smiles+="["),0<o.isotope&&(this.smiles+=o.isotope),this.smiles+=i?c.toLowerCase():c,0<r&&(this.smiles+=1==r?"@":"@@",1<o.implicitH))throw new Error(o.implicitH+" implicit H near stereocenter");"H"!=o.label&&(1<l||0==l&&!a?this.smiles+="H"+l:1==l&&(this.smiles+="H")),1<o.charge?this.smiles+="+"+o.charge:o.charge<-1?this.smiles+=o.charge:1==o.charge?this.smiles+="+":-1==o.charge&&(this.smiles+="-"),0<s&&(this.smiles+=":"+s),a&&(this.smiles+="]")}else this.smiles+="[*]";else this.smiles+="*"}else this.smiles+="[*]"},chem.SmilesSaver.prototype._markCisTrans=function(a){this.cis_trans=new chem.CisTrans(a,function(t){return this.atoms[t].neighbours},this),this.cis_trans.build(),this._dbonds=new Array(a.bonds.count()),a.bonds.each(function(t){this._dbonds[t]={ctbond_beg:-1,ctbond_end:-1,saved:0}},this),this.cis_trans.each(function(e,t){var n=a.bonds.get(e);if(0!=t.parity&&!this.isBondInRing(e)){var i=this.atoms[n.begin].neighbours,r=this.atoms[n.end].neighbours,o=!0,s=!0;if(util.each(i,function(t){t.bid!=e&&a.bonds.get(t.bid).type==chem.Struct.BOND.TYPE.SINGLE&&(o=!1)},this),util.each(r,function(t){t.bid!=e&&a.bonds.get(t.bid).type==chem.Struct.BOND.TYPE.SINGLE&&(s=!1)},this),o||s)return;util.each(i,function(t){t.bid!=e&&(a.bonds.get(t.bid).begin==n.begin?this._dbonds[t.bid].ctbond_beg=e:this._dbonds[t.bid].ctbond_end=e)},this),util.each(r,function(t){t.bid!=e&&(a.bonds.get(t.bid).begin==n.end?this._dbonds[t.bid].ctbond_beg=e:this._dbonds[t.bid].ctbond_end=e)},this)}},this)},chem.SmilesSaver.prototype._updateSideBonds=function(t,e){var n=t.bonds.get(e),i=this.cis_trans.getSubstituents(e),r=this.cis_trans.getParity(e),o=[-1,-1,-1,-1];o[0]=t.findBondId(i[0],n.begin),-1!=i[1]&&(o[1]=t.findBondId(i[1],n.begin)),o[2]=t.findBondId(i[2],n.end),-1!=i[3]&&(o[3]=t.findBondId(i[3],n.end));var s=0,a=0,l=0,c=0;if(0!=this._dbonds[o[0]].saved&&(1==this._dbonds[o[0]].saved&&t.bonds.get(o[0]).begin==n.begin||2==this._dbonds[o[0]].saved&&t.bonds.get(o[0]).end==n.begin?s++:a++),-1!=o[1]&&0!=this._dbonds[o[1]].saved&&(2==this._dbonds[o[1]].saved&&t.bonds.get(o[1]).begin==n.begin||1==this._dbonds[o[1]].saved&&t.bonds.get(o[1]).end==n.begin?s++:a++),0!=this._dbonds[o[2]].saved&&(1==this._dbonds[o[2]].saved&&t.bonds.get(o[2]).begin==n.end||2==this._dbonds[o[2]].saved&&t.bonds.get(o[2]).end==n.end?l++:c++),-1!=o[3]&&0!=this._dbonds[o[3]].saved&&(2==this._dbonds[o[3]].saved&&t.bonds.get(o[3]).begin==n.end||1==this._dbonds[o[3]].saved&&t.bonds.get(o[3]).end==n.end?l++:c++),r==chem.CisTrans.PARITY.CIS?(s+=l,a+=c):(s+=c,a+=l),0<s&&0<a)throw new Error("Incompatible cis-trans configuration");return(0!=s||0!=a)&&(0<s&&(this._dbonds[o[0]].saved=t.bonds.get(o[0]).begin==n.begin?1:2,-1!=o[1]&&(this._dbonds[o[1]].saved=t.bonds.get(o[1]).begin==n.begin?2:1),this._dbonds[o[2]].saved=t.bonds.get(o[2]).begin==n.end==(r==chem.CisTrans.PARITY.CIS)?1:2,-1!=o[3]&&(this._dbonds[o[3]].saved=t.bonds.get(o[3]).begin==n.end==(r==chem.CisTrans.PARITY.CIS)?2:1)),0<a&&(this._dbonds[o[0]].saved=t.bonds.get(o[0]).begin==n.begin?2:1,-1!=o[1]&&(this._dbonds[o[1]].saved=t.bonds.get(o[1]).begin==n.begin?1:2),this._dbonds[o[2]].saved=t.bonds.get(o[2]).begin==n.end==(r==chem.CisTrans.PARITY.CIS)?2:1,-1!=o[3]&&(this._dbonds[o[3]].saved=t.bonds.get(o[3]).begin==n.end==(r==chem.CisTrans.PARITY.CIS)?1:2)),!0)},chem.SmilesSaver.prototype._calcBondDirection=function(n,t,e){var i;if(-1==this._dbonds[t].ctbond_beg&&-1==this._dbonds[t].ctbond_end)return 0;if(n.bonds.get(t).type!=chem.Struct.BOND.TYPE.SINGLE)throw new Error("Internal: directed bond type "+n.bonds.get(t).type);try{for(;i=0,this.cis_trans.each(function(t,e){0==e.parity||this.isBondInRing(t)||this._updateSideBonds(n,t)&&i++},this),i!=this._touched_cistransbonds;)this._touched_cistransbonds=i}catch(t){return 222}return 0==this._dbonds[t].saved&&(e==n.bonds.get(t).begin?this._dbonds[t].saved=1:this._dbonds[t].saved=2),this._dbonds[t].saved},chem.SmilesSaver.prototype._writeRadicals=function(t){var e,n,i=new Array(this._written_atoms.length);for(e=0;e<this._written_atoms.length;e++)if(!i[e]){var r=t.atoms.get(this._written_atoms[e]).radical;if(0!=r)for(this.comma?this.smiles+=",":(this.smiles+=" |",this.comma=!0),r==chem.Struct.ATOM.RADICAL.SINGLET?this.smiles+="^3:":r==chem.Struct.ATOM.RADICAL.DOUPLET?this.smiles+="^1:":this.smiles+="^4:",this.smiles+=e,n=e+1;n<this._written_atoms.length;n++)t.atoms.get(this._written_atoms[n]).radical==r&&(i[n]=!0,this.smiles+=","+n)}},chem.SmilesSaver.prototype._writeStereogroups=function(t){var e,n,i=new Array(this._written_atoms.length);for(ATOM_ANY=1,ATOM_AND=2,ATOM_OR=3,ATOM_ABS=4,e=0;e<this._written_atoms.length;e++)if(!i[e]){var r=this.atoms[this._written_atoms[e]].chirality;if(1===r||2===r){this.comma?this.smiles+=",":(this.smiles+=" |",this.comma=!0);var o=1;for(this.smiles+="&"+o+":"+e,o+=1,n=e+1;n<this._written_atoms.length;n++){var s=this.atoms[this._written_atoms[n]].chirality;1!==s&&2!==s||(i[n]=1,this.smiles+=","+n)}}}},function(t){function r(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function d(){this.raw=[],this.length=0}function e(){return"___"+k++}function i(t,e){var n=t.prototype,i=new Function;i.prototype=e.prototype,t.prototype=new i,r((t.prototype.constructor=t).prototype,n)}function n(t){return _[t]}function b(t){return'"'+t.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function o(t){return t.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(t){return"\\"+t})}function w(t){var n=arguments;return t.replace(/\{([0-9]+)\}/g,function(t,e){return n[e-0+1]})}function x(t,e,n,i,r,o){for(var s=n.length,a=t.split(e),l=0,c=[],u=0,h=a.length;u<h;u++){var d=a[u];if(u){var f=1;for(l++;;){var p=d.indexOf(n);if(p<0){c.push(1<l&&f?e:"",d);break}if(l=i?l-1:0,c.push(0<l&&f?e:"",d.slice(0,p),0<l?n:""),d=d.slice(p+s),(f=0)===l)break}0===l&&(r(c.join("")),o(d),c=[])}else d&&o(d)}0<l&&0<c.length&&(o(e),o(c.join("")))}function S(t,h,d){var f,p=[],e=h.options,m="",g="",y="",v="";return d&&(m="ts(",g=")",y=M,v=P,f=e.defaultFilter),x(t,e.variableOpen,e.variableClose,1,function(t){d&&t.indexOf("|")<0&&f&&(t+="|"+f);var e,n=t.indexOf("|"),i=(0<n?t.slice(0,n):t).replace(/^\s+/,"").replace(/\s+$/,""),r=0<n?t.slice(n+1):"",o=0===i.indexOf("*"),s=[o?"":m,(e=i,w('gv({0},["{1}"])',b(e=e.replace(/^\s*\*/,"")),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(t,e){return"."+e}).split(".").join('","'))),o?"":g];if(r)for(var a=(r=S(r,h)).split("|"),l=0,c=a.length;l<c;l++){var u=a[l].match(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i);u&&(s.unshift('fs["'+u[1]+'"]('),u[3]&&s.push(",",u[3]),s.push(")"))}p.push(y,s.join(""),v)},function(t){p.push(y,d?b(t):t,v)}),p.join("")}function f(t,e){this.value=t,this.engine=e}function p(t,e){this.value=t,this.engine=e,this.children=[],this.cloneProps=[]}function m(t,e){var n=t.stack,i=e?n.find(function(t){return t instanceof e}):n.bottom();if(i){for(var r;(r=n.top())!==i;){if(!r.autoClose)throw new Error(r.type+" must be closed manually: "+r.value);r.autoClose(t)}i.close(t)}return i}function s(t,e){var n=t.match(/^\s*([a-z0-9\/\._-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/\._-]+)\s*\))?\s*/i);if(!n)throw new Error("Invalid "+this.type+" syntax: "+t);this.master=n[3],this.name=n[1],p.call(this,t,e),this.blocks={}}function a(t,e){var n=t.match(/^\s*([a-z0-9\/\._-]+)\s*$/i);if(!n)throw new Error("Invalid "+this.type+" syntax: "+t);this.name=n[1],p.call(this,t,e),this.cloneProps=["name"]}function c(t,e){var n=t.match(/^\s*([a-z0-9\/\._-]+)\s*$/i);if(!n)throw new Error("Invalid "+this.type+" syntax: "+t);this.name=n[1],p.call(this,t,e),this.cloneProps=["name","state","blocks","target"],this.blocks={}}function l(t,e){var n=t.match(/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i);if(!n)throw new Error("Invalid "+this.type+" syntax: "+t);this.name=n[1],this.expr=n[2],p.call(this,t,e),this.cloneProps=["name","expr"]}function u(t,e){var n=t.match(/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i);if(!n)throw new Error("Invalid "+this.type+" syntax: "+t);this.name=n[1],this.args=n[3],p.call(this,t,e),this.cloneProps=["name","args"]}function h(t,e){var n=t.match(/^\s*([a-z0-9\/\._-]+)\s*(\(([\s\S]*)\))?\s*$/i);if(!n)throw new Error("Invalid "+this.type+" syntax: "+t);this.name=n[1],this.args=n[3],p.call(this,t,e),this.cloneProps=["name","args"]}function g(t,e){var n=new RegExp(w("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",o(e.options.variableOpen),o(e.options.variableClose)),"i"),i=t.match(n);if(!i)throw new Error("Invalid "+this.type+" syntax: "+t);this.list=i[1],this.item=i[2],this.index=i[4],p.call(this,t,e),this.cloneProps=["list","item","index"]}function y(t,e){p.call(this,t,e)}function v(t,e){y.call(this,t,e)}function E(t,e){p.call(this,t,e)}function C(t,e,n){(t.commandTypes[e]=n).prototype.type=e}function T(t){this.options={commandOpen:"\x3c!--",commandClose:"--\x3e",commandSyntax:/^\s*(\/)?([a-z]*)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.commandTypes={},C(this,"target",s),C(this,"block",a),C(this,"import",c),C(this,"use",h),C(this,"var",l),C(this,"for",g),C(this,"if",y),C(this,"elif",v),C(this,"else",E),C(this,"filter",u),this.config(t),this.targets={},this.filters=r({},A)}function N(t,r){function o(){var t;if(0<h.length&&(t=h.join(""))){var e=new f(t,r);e.beforeAdd(u),n.top().addChild(e),h=[],r.options.strip&&u.current instanceof p&&(e.value=t.replace(/^[\x20\t\r]*\n/,"")),u.current=e}}var s,a=r.options.commandOpen,l=r.options.commandClose,c=r.options.commandSyntax,n=new d,u={engine:r,targets:[],stack:n,target:null,deps:{}},h=[];x(t,a,l,0,function(t){var e,n=c.exec(t);if(n&&(e=n[2]||"target")&&(s=r.commandTypes[e.toLowerCase()])&&"function"==typeof s){o();var i=u.current;r.options.strip&&i instanceof f&&(i.value=i.value.replace(/\r?\n[\x20\t]*$/,"\n")),n[1]?i=m(u,s):("function"==typeof(i=new s(n[3],r)).init&&i.init(u),i.beforeOpen(u),i.open(u)),u.current=i}else/ ^ \s * \/\//.test(t)||h.push(a,t,l);s=null},function(t){h.push(t)}),o(),m(u);var e=[];for(var i in u.deps)e.push(i);return{targets:u.targets,deps:e}}d.prototype={push:function(t){this.raw[this.length++]=t},pop:function(){if(0<this.length){var t=this.raw[--this.length];return this.raw.length=this.length,t}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(t){for(var e=this.length;e--;){var n=this.raw[e];if(t(n))return n}}};var k=178245,_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},A={html:function(t){return t.replace(/[&<>"']/g,n)},url:encodeURIComponent,raw:function(t){return t}},B='var r="";',M="r+=",P=";",O="return r;",R="undefined"!=typeof navigator&&navigator.userAgent.match(/msie\s*([0-9]+)/i);R&&R[1]-0<8&&(B="var r=[],ri=0;",M="r[ri++]=",O='return r.join("");'),f.prototype={getRendererBody:function(){var t=this.value,e=this.engine.options;return!t||e.strip&&/^\s*$/.test(t)?"":S(t,this.engine,1)},clone:function(){return this}},p.prototype={addChild:function(t){this.children.push(t)},open:function(t){var e=t.stack.top();e&&e.addChild(this),t.stack.push(this)},close:function(t){t.stack.top()===this&&t.stack.pop()},getRendererBody:function(){for(var t=[],e=this.children,n=0;n<e.length;n++)t.push(e[n].getRendererBody());return t.join("")},clone:function(){for(var t=new this.constructor(this.value,this.engine),e=0,n=this.children.length;e<n;e++)t.addChild(this.children[e].clone());for(e=0,n=this.cloneProps.length;e<n;e++){var i=this.cloneProps[e];t[i]=this[i]}return t}};var D='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';i(s,p),i(a,p),i(c,p),i(l,p),i(u,p),i(h,p),i(g,p),i(y,p),i(v,y),i(E,y),s.prototype.init=function(t){this.master&&(t.deps[this.master]=!0)},h.prototype.init=c.prototype.init=function(t){t.deps[this.name]=!0};var L=1,I=2,U=3,$=4;c.prototype.applyMaster=s.prototype.applyMaster=function(t){if(this.state>=U)return 1;var s=this.blocks,e=this.engine.targets[t];if(e){if(e.applyMaster(e.master))return this.children=e.clone().children,function t(e){var n=e.children;if(n instanceof Array)for(var i=0,r=n.length;i<r;i++){var o=n[i];o instanceof a&&s[o.name]&&(o=n[i]=s[o.name]),t(o)}}(this),this.state=U,1}else if("error"===this.engine.options.missTarget)throw new Error("[ETPL_MISS_TARGET]"+t+", when extended by "+(this.target?this.target.name:this.name))},s.prototype.isReady=function(){if(this.state>=$)return 1;var s=this.engine,a=this.name,l=1;return this.applyMaster(this.master)?(function t(e){for(var n=0,i=e.children.length;n<i;n++){var r=e.children[n];if(r instanceof c){var o=s.targets[r.name];if(!o&&"error"===s.options.missTarget)throw new Error("[ETPL_MISS_TARGET]"+r.name+", when imported by "+a);l=l&&o&&o.isReady(s)}else r instanceof p&&t(r)}}(this),l&&(this.state=$),l):void 0},s.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[D,B,this.getRendererBody(),O].join("\n")),n=this.engine;return this.renderer=function(t){return e(t,n)},this.renderer}return null},s.prototype.open=function(t){m(t),p.prototype.open.call(this,t),this.state=L,function(t,e){e.target=t;var n=e.engine,i=t.name;if(n.targets[i])switch(n.options.namingConflict){case"override":n.targets[i]=t,e.targets.push(i);case"ignore":break;default:throw new Error("[ETPL_TARGET_EXISTS]"+i)}else n.targets[i]=t,e.targets.push(i)}(this,t)},l.prototype.open=h.prototype.open=function(t){t.stack.top().addChild(this)},a.prototype.open=function(t){p.prototype.open.call(this,t),t.stack.find(function(t){return t.blocks}).blocks[this.name]=this},v.prototype.open=function(t){(new E).open(t),m(t,y).addChild(this),t.stack.push(this)},E.prototype.open=function(t){m(t,y).addChild(this),t.stack.push(this)},c.prototype.open=function(t){this.parent=t.stack.top(),this.target=t.target,p.prototype.open.call(this,t),this.state=L},h.prototype.close=l.prototype.close=function(){},c.prototype.close=function(t){p.prototype.close.call(this,t),this.state=I},s.prototype.close=function(t){p.prototype.close.call(this,t),this.state=this.master?I:U,t.target=null},c.prototype.autoClose=function(t){var e=this.parent.children;for(var n in e.push.apply(e,this.children),this.children.length=0,this.blocks)this.target.blocks[n]=this.blocks[n];this.blocks={},this.close(t)},p.prototype.beforeOpen=f.prototype.beforeAdd=function(t){t.stack.bottom()||new s(e(),t.engine).open(t)},s.prototype.beforeOpen=function(){},c.prototype.getRendererBody=function(){return this.applyMaster(this.name),p.prototype.getRendererBody.call(this)},h.prototype.getRendererBody=function(){return w("{0}engine.render({2},{{3}}){1}",M,P,b(this.name),S(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(t,e,n){return(e||"")+b(n)+":"}))},l.prototype.getRendererBody=function(){return this.expr?w("v[{0}]={1};",b(this.name),S(this.expr,this.engine)):""},y.prototype.getRendererBody=function(){return w("if({0}){{1}}",S(this.value,this.engine),p.prototype.getRendererBody.call(this))},E.prototype.getRendererBody=function(){return w("}else{{0}",p.prototype.getRendererBody.call(this))},g.prototype.getRendererBody=function(){return w('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',e(),S(this.list,this.engine),b(this.index||e()),b(this.item),e(),e(),p.prototype.getRendererBody.call(this))},u.prototype.getRendererBody=function(){var t=this.args;return w("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",B,O,M,P,p.prototype.getRendererBody.call(this),b(this.name),t?","+S(t,this.engine):"")},T.prototype.config=function(t){r(this.options,t)},T.prototype.compile=T.prototype.parse=function(t){var e=new Function('return ""');if(t){var n=N(t,this).targets;n.length&&(e=this.targets[n[0]].getRenderer())}return e},T.prototype.getRenderer=function(t){var e=this.targets[t];return e?e.getRenderer():void 0},T.prototype.render=function(t,e){var n=this.getRenderer(t);return n?n(e):""},T.prototype.addCommand=function(t,e){var n=e;"function"!=typeof n&&((n=function(t,e){p.call(this,t,e)}).prototype=e),i(n,p),C(this,t,n)},T.prototype.addFilter=function(t,e){"function"==typeof e&&(this.filters[t]=e)};var F=new T;F.Engine=T,F.version="3.2.0",F.Command=p,F.util={inherits:i,stringFormat:w,stringLiteralize:b,compileVariable:S,parseSource:N},"object"==typeof exports&&"object"==typeof module?exports=module.exports=F:"function"==typeof define&&define.amd?define(F):t.etpl=F}(this),etpl.config({commandOpen:"<%",commandClose:"%>"}),function(){var t=window.UMEDITOR_HOME_URL||function(){function o(){this.documentURL=self.document.URL||self.location.href,this.separator="/",this.separatorPattern=/\\|\//g,this.currentDir="./",this.currentDirPattern=/^[.]\/]/,this.path=this.documentURL,this.stack=[],this.push(this.documentURL)}o.isParentPath=function(t){return".."===t},o.hasProtocol=function(t){return!!o.getProtocol(t)},o.getProtocol=function(t){var e=/^[^:]*:\/*/.exec(t);return e?e[0]:null},o.prototype={push:function(t){return this.path=t,function(){var t=o.getProtocol(this.path||"");t?(this.protocol=t,this.localSeparator=/\\|\//.exec(this.path.replace(t,""))[0],this.stack=[]):(t=/\\|\//.exec(this.path))&&(this.localSeparator=t[0])}.call(this),function(){var t=this.path.replace(this.currentDirPattern,"");o.hasProtocol(this.path)&&(t=t.replace(this.protocol,""));(t=t.split(this.localSeparator)).length=t.length-1;for(var e,n=0,i=t.length,r=this.stack;n<i;n++)(e=t[n])&&(o.isParentPath(e)?r.pop():r.push(e))}.call(this),this},getPath:function(){return this+""},toString:function(){return this.protocol+this.stack.concat([""]).join(this.separator)}};var t=document.getElementsByTagName("script");return t=t[t.length-1].src,(new o).push(t)+""}();window.UMEDITOR_CONFIG={pasteplain:!0,UMEDITOR_HOME_URL:t,imageUrl:t+"php/imageUp.php",imagePath:t+"php/",imageFieldName:"upfile",toolbar:["source bold italic underline strikethrough | superscript subscript | forecolor  | removeformat |"," selectall cleardoc | fontfamily fontsize","| justifyleft justifycenter justifyright justifyjustify |","formula"],focus:!0,autoSyncData:!1,imageScaleEnabled:!1,dropFileEnabled:!1,pasteImageEnabled:!1,autoFloatEnabled:!1,topOffset:30,filterRules:{},filterTxtRules:function(){function t(t){t.tagName="p",t.setStyle()}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:{$:{}},li:{$:{}},caption:t,th:t,tr:t,h1:t,h2:t,h3:t,h4:t,h5:t,h6:t,td:function(t){!!t.innerText()&&t.parentNode.insertAfter(UE.uNode.createText("    "),t),t.parentNode.removeChild(t,t.innerText())}}}(),xssFilterRules:!0,inputXssFilter:!0,outputXssFilter:!0,whiteList:{a:["target","href","title","style","class","id"],abbr:["title","style","class","id"],address:["style","class","id"],area:["shape","coords","href","alt","style","class","id"],article:["style","class","id"],aside:["style","class","id"],audio:["autoplay","controls","loop","preload","src","style","class","id"],b:["style","class","id"],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite","style","class","id"],br:[],caption:["style","class","id"],center:[],cite:[],code:["style","class","id"],col:["align","valign","span","width","style","class","id"],colgroup:["align","valign","span","width","style","class","id"],dd:["style","class","id"],del:["datetime","style","class","id"],details:["open","style","class","id"],div:["style","class","id"],dl:["style","class","id"],dt:["style","class","id"],em:["style","class","id"],embed:["style","class","id","_url","type","pluginspage","src","width","height","wmode","play","loop","menu","allowscriptaccess","allowfullscreen"],font:["color","size","face","style","class","id"],footer:["style","class","id"],h1:["style","class","id"],h2:["style","class","id"],h3:["style","class","id"],h4:["style","class","id"],h5:["style","class","id"],h6:["style","class","id"],header:["style","class","id"],hr:["style","class","id"],i:["style","class","id"],iframe:["style","class","id","src","frameborder","data-latex"],img:["src","alt","title","width","height","style","class","id","_url"],ins:["datetime","style","class","id"],li:["style","class","id"],mark:[],nav:[],ol:["style","class","id"],p:["style","class","id"],pre:["style","class","id"],s:[],section:[],small:["style","class","id"],span:["style","class","id"],sub:["style","class","id"],sup:["style","class","id"],strong:["style","class","id"],table:["width","border","align","valign","style","class","id"],tbody:["align","valign","style","class","id"],td:["width","rowspan","colspan","align","valign","style","class","id"],tfoot:["align","valign","style","class","id"],th:["width","rowspan","colspan","align","valign","style","class","id"],thead:["align","valign","style","class","id"],tr:["rowspan","align","valign","style","class","id"],tt:["style","class","id"],u:[],ul:["style","class","id"],svg:["style","class","id","width","height","xmlns","fill","viewBox"],video:["autoplay","controls","loop","preload","src","height","width","style","class","id"]}}}(),function($){UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},id:"#textEditor",version:"1.2.2"},UM.I18N.en={labelMap:{anchor:"Anchor",undo:"Undo",redo:"Redo",bold:"Bold",indent:"Indent",snapscreen:"SnapScreen",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"SubScript",fontborder:"text border",superscript:"SuperScript",formatmatch:"Format Match",source:"Source",blockquote:"BlockQuote",pasteplain:"PastePlain",selectall:"SelectAll",print:"Print",preview:"Preview",horizontal:"Horizontal",removeformat:"RemoveFormat",time:"Time",date:"Date",unlink:"Unlink",insertrow:"InsertRow",insertcol:"InsertCol",mergeright:"MergeRight",mergedown:"MergeDown",deleterow:"DeleteRow",deletecol:"DeleteCol",splittorows:"SplitToRows",insertcode:"insert code",splittocols:"SplitToCols",splittocells:"SplitToCells",deletecaption:"DeleteCaption",inserttitle:"InsertTitle",mergecells:"MergeCells",deletetable:"DeleteTable",cleardoc:"Clear",insertparagraphbeforetable:"InsertParagraphBeforeTable",fontfamily:"FontFamily",fontsize:"FontSize",paragraph:"Paragraph",image:"Image",edittable:"Edit Table",edittd:"Edit Td",link:"Link",emotion:"Emotion",spechars:"Spechars",searchreplace:"SearchReplace",map:"BaiduMap",gmap:"GoogleMap",video:"Video",help:"Help",justifyleft:"JustifyLeft",justifyright:"JustifyRight",justifycenter:"JustifyCenter",justifyjustify:"Justify",forecolor:"FontColor",backcolor:"BackColor",insertorderedlist:"OL",insertunorderedlist:"UL",fullscreen:"FullScreen",directionalityltr:"EnterFromLeft",directionalityrtl:"EnterFromRight",rowspacingtop:"RowSpacingTop",rowspacingbottom:"RowSpacingBottom",highlightcode:"Code",pagebreak:"PageBreak",insertframe:"Iframe",imagenone:"Default",imageleft:"ImageLeft",imageright:"ImageRight",attachment:"Attachment",imagecenter:"ImageCenter",wordimage:"WordImage",lineheight:"LineHeight",edittip:"EditTip",customstyle:"CustomStyle",scrawl:"Scrawl",autotypeset:"AutoTypeset",webapp:"WebAPP",touppercase:"UpperCase",tolowercase:"LowerCase",template:"Template",background:"Background",inserttable:"InsertTable",drafts:"drafts",formula:"formula"},paragraph:{p:"Paragraph",h1:"Title 1",h2:"Title 2",h3:"Title 3",h4:"Title 4",h5:"Title 5",h6:"Title 6"},fontfamily:{songti:"Sim sun",kaiti:"Sim kai",heiti:"Sim hei",lishu:"Sim li",yahei:"Microsoft yahei",andaleMono:"Andale mono",arial:"Arial",arialBlack:"Arial black",comicSansMs:"Comic sans ms",impact:"Impact",timesNewRoman:"Times new roman"},ok:"OK",cancel:"Cancel",closeDialog:"closeDialog",tableDrag:"You must import the file uiUtils.js before drag! ",autofloatMsg:"The plugin AutoFloat depends on EditorUI!",anthorMsg:"Link",clearColor:"Clear",standardColor:"Standard color",themeColor:"Theme color",property:"Property",default:"Default",modify:"Modify",justifyleft:"Justify Left",justifyright:"Justify Right",justifycenter:"Justify Center",justify:"Default",clear:"Clear",anchorMsg:"Anchor",delete:"Delete",clickToUpload:"Click to upload",unset:"Language hasn't been set!",t_row:"row",t_col:"col",more:"More",pasteOpt:"Paste Option",pasteSourceFormat:"Keep Source Formatting",tagFormat:"Keep tag",pasteTextFormat:"Keep Text only",image:{static:{lang_tab_local:"Local Upload",lang_tab_imgSearch:"Network Pictures",lang_input_dragTip:"Support drag upload",lang_btn_add:"Add"},uploadError:"Upload Error"},emotion:{static:{lang_input_choice:"Choice",lang_input_Tuzki:"Tuzki",lang_input_lvdouwa:"LvDouWa",lang_input_BOBO:"BOBO",lang_input_babyCat:"BabyCat",lang_input_bubble:"Bubble",lang_input_youa:"YouA"}},gmap:{static:{lang_input_address:"Address:",lang_input_search:"Search",address:{value:"Beijing"}},searchError:"Unable to locate the address!"},link:{static:{lang_input_text:"Textï¼",lang_input_url:"URLï¼",lang_input_title:"Titleï¼",lang_input_target:"open in new windowï¼"},validLink:"Supports only effective when a link is selected",httpPrompt:'The hyperlink you enter should start with "http|https|ftp://"!'},map:{static:{lang_city:"City",lang_address:"Address",city:{value:"Beijing"},lang_search:"Search",lang_dynamicmap:"Dynamic map"},cityMsg:"Please enter the city name!",errorMsg:"Can't find the place!"},video:{static:{lang_tab_insertV:"Video",lang_video_url:" URL ",lang_video_size:"Video Size",lang_videoW:"Width",lang_videoH:"Height",lang_alignment:"Alignment",videoSearchTxt:{value:"Enter the search keyword!"},videoType:{options:["All","Hot","Entertainment","Funny","Sports","Science","variety"]},videoSearchBtn:{value:"Search in Baidu"},videoSearchReset:{value:"Clear result"}},numError:"Please enter the correct Num. e.g 123,400",floatLeft:"Float left",floatRight:"Float right",default:"Default",block:"Display in block",urlError:"The video url format may be wrong!",loading:" &nbsp;The video is loading, please waitâ¦",clickToSelect:"Click to select",goToSource:"Visit source video ",noVideo:" &nbsp; &nbsp;Sorry,can't find the video,please try again!"},formula:{static:{lang_tab_common:"Common",lang_tab_symbol:"Symbol",lang_tab_letter:"Letter"}}};var dom=UM.dom={},browser=UM.browser=function(){var t=navigator.userAgent.toLowerCase(),e=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(t),opera:!!e&&e.version,webkit:-1<t.indexOf(" applewebkit/"),mac:-1<t.indexOf("macintosh"),quirks:"BackCompat"==document.compatMode};n.gecko="Gecko"==navigator.product&&!n.webkit&&!n.opera&&!n.ie;var i=0;if(n.ie){var r=t.match(/(?:msie\s([\w.]+))/),o=t.match(/(?:trident.*rv:([\w.]+))/);i=r&&o&&r[1]&&o[1]?Math.max(1*r[1],1*o[1]):r&&r[1]?1*r[1]:o&&o[1]?1*o[1]:0,n.ie11Compat=11==document.documentMode,n.ie9Compat=9==document.documentMode,n.ie8=!!document.documentMode,n.ie8Compat=8==document.documentMode,n.ie7Compat=7==i&&!document.documentMode||7==document.documentMode,n.ie6Compat=i<7||n.quirks,n.ie9above=8<i,n.ie9below=i<9}if(n.gecko){var s=t.match(/rv:([\d\.]+)/);s&&(i=1e4*(s=s[1].split("."))[0]+100*(s[1]||0)+1*(s[2]||0))}return/chrome\/(\d+\.\d)/i.test(t)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(t)&&!/chrome/i.test(t)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(i=parseFloat(e.version())),n.webkit&&(i=parseFloat(t.match(/ applewebkit\/(\d+)/)[1])),n.version=i,n.isCompatible=!n.mobile&&(n.ie&&6<=i||n.gecko&&10801<=i||n.opera&&9.5<=i||n.air&&1<=i||n.webkit&&522<=i||!1),n}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UM.utils={each:function(t,e,n){if(null!=t)if(t.length===+t.length){for(var i=0,r=t.length;i<r;i++)if(!1===e.call(n,t[i],i,t))return!1}else for(var o in t)if(t.hasOwnProperty(o)&&!1===e.call(n,t[o],o,t))return!1},makeInstance:function(t){var e=new Function;return e.prototype=t,t=new e,e.prototype=null,t},extend:function(t,e,n){if(e)for(var i in e)n&&t.hasOwnProperty(i)||(t[i]=e[i]);return t},extend2:function(t){for(var e=arguments,n=1;n<e.length;n++){var i=e[n];for(var r in i)t.hasOwnProperty(r)||(t[r]=i[r])}return t},inherits:function(t,e){var n=t.prototype,i=utils.makeInstance(e.prototype);return utils.extend(i,n,!0),(t.prototype=i).constructor=t},bind:function(t,e){return function(){return t.apply(e,arguments)}},defer:function(t,e,n){var i;return function(){n&&clearTimeout(i),i=setTimeout(t,e)}},indexOf:function(t,n,i){var r=-1;return i=this.isNumber(i)?i:0,this.each(t,function(t,e){if(i<=e&&t===n)return r=e,!1}),r},removeItem:function(t,e){for(var n=0,i=t.length;n<i;n++)t[n]===e&&(t.splice(n,1),n--)},trim:function(t){return t.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(t){if(!t)return{};t=utils.isArray(t)?t:t.split(",");for(var e,n=0,i={};e=t[n++];)i[e.toUpperCase()]=i[e]=1;return i},unhtml:function(t,e){return t?t.replace(e||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(t,e){return e?t:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[t]}):""},html:function(t){return t?t.replace(/&((g|l|quo)t|amp|#39);/g,function(t){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[t]}):""},cssStyleToDomStyle:(c1a=document.createElement("div").style,d1a={float:null!=c1a.cssFloat?"cssFloat":null!=c1a.styleFloat?"styleFloat":"float"},function(t){return d1a[t]||(d1a[t]=t.toLowerCase().replace(/-./g,function(t){return t.charAt(1).toUpperCase()}))}),isEmptyObject:function(t){if(null==t)return!0;if(this.isArray(t)||this.isString(t))return 0===t.length;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},fixColor:function(t,e){if(/color/i.test(t)&&/rgba?/.test(e)){var n=e.split(",");if(3<n.length)return"";e="#";for(var i,r=0;i=n[r++];)e+=1==(i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16)).length?"0"+i:i;e=e.toUpperCase()}return e},clone:function(t,e){var n;for(var i in e=e||{},t)t.hasOwnProperty(i)&&("object"==typeof(n=t[i])?(e[i]=utils.isArray(n)?[]:{},utils.clone(t[i],e[i])):e[i]=n);return e},transUnitToPx:function(i){if(!/(pt|cm)/.test(i))return i;var r;switch(i.replace(/([\d.]+)(\w+)/,function(t,e,n){i=e,r=n}),r){case"cm":i=25*parseFloat(i);break;case"pt":i=Math.round(96*parseFloat(i)/72)}return i+(i?"px":"")},cssRule:browser.ie&&11!=browser.version?function(t,e,n){var i,r,o;if((i=(n=n||document).indexList?n.indexList:n.indexList={})[t])o=n.styleSheets[i[t]];else{if(void 0===e)return"";o=n.createStyleSheet("",r=n.styleSheets.length),i[t]=r}if(void 0===e)return o.cssText;o.cssText=e||""}:function(t,e,n){var i,r=(n=n||document).getElementsByTagName("head")[0];if(!(i=n.getElementById(t))){if(void 0===e)return"";(i=n.createElement("style")).id=t,r.appendChild(i)}if(void 0===e)return i.innerHTML;""!==e?i.innerHTML=e:r.removeChild(i)},render:function(t,e){return etpl.compile(t)(e)}},c1a,d1a;utils.each(["String","Function","Array","Number","RegExp","Object"],function(e){UM.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var EventBase=UM.EventBase=function(){};function getListener(t,e,n){var i;return e=e.toLowerCase(),(i=t.__allListeners||n&&(t.__allListeners={}))&&(i[e]||n&&(i[e]=[]))}EventBase.prototype={addListener:function(t,e){t=utils.trim(t).split(" ");for(var n,i=0;n=t[i++];)getListener(this,n,!0).push(e)},removeListener:function(t,e){t=utils.trim(t).split(" ");for(var n,i=0;n=t[i++];)utils.removeItem(getListener(this,n)||[],e)},fireEvent:function(){var t=arguments[0];t=utils.trim(t).split(" ");for(var e,n=0;e=t[n++];){var i,r,o,s=getListener(this,e);if(s)for(o=s.length;o--;)if(s[o]){if(!0===(r=s[o].apply(this,arguments)))return r;void 0!==r&&(i=r)}(r=this["on"+e.toLowerCase()])&&(i=r.apply(this,arguments))}return i}};var dtd=dom.dtd=function(){function t(t){for(var e in t)t[e.toUpperCase()]=t[e];return t}var e=utils.extend2,n=t({isindex:1,fieldset:1}),i=t({input:1,button:1,select:1,textarea:1,label:1}),r=e(t({a:1}),i),o=e({iframe:1},r),s=t({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),a=t({ins:1,del:1,script:1,style:1}),l=e(t({b:1,acronym:1,bdo:1,var:1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),a),c=e(t({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),l),u=e(t({p:1}),c),h=e(t({iframe:1}),c,i),d=t({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,var:1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),f=e(t({a:0}),h),p=t({tr:1}),m=t({"#":1}),g=e(t({param:1}),d),y=e(t({form:1}),n,o,s,u),v=t({li:1,ol:1,ul:1}),b=t({style:1,script:1}),w=t({base:1,link:1,meta:1,title:1}),x=e(w,b),S=t({head:1,body:1}),E=t({html:1}),C=t({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),T=t({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return t({$nonBodyContent:e(E,S,w),$block:C,$inline:f,$inlineWithA:e(t({a:1}),f),$body:e(t({script:1,style:1}),C),$cdata:t({script:1,style:1}),$empty:T,$nonChild:t({iframe:1,textarea:1}),$listItem:t({dd:1,dt:1,li:1}),$list:t({ul:1,ol:1,dl:1}),$isNotEmpty:t({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:t({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1}),$removeEmptyBlock:t({p:1,div:1}),$tableContent:t({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:t({pre:1,script:1,style:1,textarea:1}),html:S,head:x,style:m,script:m,body:y,base:{},link:{},meta:{},title:m,col:{},tr:t({td:1,th:1}),img:{},embed:{},colgroup:t({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:y,td:y,br:{},th:y,center:y,kbd:f,button:e(u,s),basefont:{},h5:f,h4:f,samp:f,h6:f,ol:v,h1:f,h3:f,option:m,h2:f,form:e(n,o,s,u),select:t({optgroup:1,option:1}),font:f,ins:f,menu:v,abbr:f,label:f,table:t({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:f,tfoot:p,cite:f,li:y,input:{},iframe:y,strong:f,textarea:m,noframes:y,big:f,small:f,span:t({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:f,dt:f,sub:f,optgroup:t({option:1}),param:{},bdo:f,var:f,div:y,object:g,sup:f,dd:y,strike:f,area:{},dir:v,map:e(t({area:1,form:1,p:1}),n,a,s),applet:g,dl:t({dt:1,dd:1}),del:f,isindex:{},fieldset:e(t({legend:1}),d),thead:p,ul:v,acronym:f,b:f,a:e(t({a:1}),h),blockquote:e(t({td:1,tr:1,tbody:1,li:1}),y),caption:f,i:f,u:f,tbody:p,s:f,address:e(o,u),tt:f,legend:f,q:f,pre:e(l,r),p:e(t({a:1}),f),em:f,dfn:f})}();function getDomNode(t,e,n,i,r,o){var s,a=i&&t[e];for(!a&&(a=t[n]);!a&&(s=(s||t).parentNode);){if("BODY"==s.tagName||o&&!o(s))return null;a=s[n]}return a&&r&&!r(a)?getDomNode(a,e,n,!1,r):a}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"\ufeff":"â",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(t,e){if(t===e)return 0;var n,i=[t],r=[e];for(n=t;n=n.parentNode;){if(n===e)return 10;i.push(n)}for(n=e;n=n.parentNode;){if(n===t)return 20;r.push(n)}if(i.reverse(),r.reverse(),i[0]!==r[0])return 1;for(var o=-1;i[++o]===r[o];);for(t=i[o],e=r[o];t=t.nextSibling;)if(t===e)return 4;return 2},getNodeIndex:function(t,e){for(var n=t,i=0;n=n.previousSibling;)e&&3==n.nodeType?n.nodeType!=n.nextSibling.nodeType&&i++:i++;return i},inDoc:function(t,e){return 10==domUtils.getPosition(t,e)},findParent:function(t,e,n){if(t&&!domUtils.isBody(t))for(t=n?t:t.parentNode;t;){if(!e||e(t)||domUtils.isBody(t))return e&&!e(t)&&domUtils.isBody(t)?null:t;t=t.parentNode}return null},findParentByTagName:function(t,e,n,i){return e=utils.listToMap(utils.isArray(e)?e:[e]),domUtils.findParent(t,function(t){return e[t.tagName]&&!(i&&i(t))},n)},findParents:function(t,e,n,i){for(var r=e&&(n&&n(t)||!n)?[t]:[];t=domUtils.findParent(t,n);)r.push(t);return i?r:r.reverse()},insertAfter:function(t,e){return t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},remove:function(t,e){var n,i=t.parentNode;if(i){if(e&&t.hasChildNodes())for(;n=t.firstChild;)i.insertBefore(n,t);i.removeChild(t)}return t},getNextDomNode:function(t,e,n,i){return getDomNode(t,"firstChild","nextSibling",e,n,i)},getPreDomNode:function(t,e,n,i){return getDomNode(t,"lastChild","previousSibling",e,n,i)},isBookmarkNode:function(t){return 1==t.nodeType&&t.id&&/^_baidu_bookmark_/i.test(t.id)},getWindow:function(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow},getCommonAncestor:function(t,e){if(t===e)return t;for(var n=[t],i=[e],r=t,o=-1;r=r.parentNode;){if(r===e)return r;n.push(r)}for(r=e;r=r.parentNode;){if(r===t)return r;i.push(r)}for(n.reverse(),i.reverse();n[++o]===i[o];);return 0==o?null:n[o-1]},clearEmptySibling:function(t,e,n){function i(t,e){for(var n;t&&!domUtils.isBookmarkNode(t)&&(domUtils.isEmptyInlineElement(t)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(t.nodeValue));)n=t[e],domUtils.remove(t),t=n}!e&&i(t.nextSibling,"nextSibling"),!n&&i(t.previousSibling,"previousSibling")},split:function(t,e){var n=t.ownerDocument;if(browser.ie&&e==t.nodeValue.length){var i=n.createTextNode("");return domUtils.insertAfter(t,i)}var r=t.splitText(e);if(browser.ie8){var o=n.createTextNode("");domUtils.insertAfter(r,o),domUtils.remove(o)}return r},isWhitespace:function(t){return!new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(t.nodeValue)},getXY:function(t){for(var e=0,n=0;t.offsetParent;)n+=t.offsetTop,e+=t.offsetLeft,t=t.offsetParent;return{x:e,y:n}},on:function(t,e,n){var i=utils.isArray(e)?e:utils.trim(e).split(/\s+/),r=i.length;if(r)for(;r--;)if(e=i[r],t.addEventListener)t.addEventListener(e,n,!1);else{n._d||(n._d={els:[]});var o=e+n.toString(),s=utils.indexOf(n._d.els,t);n._d[o]&&-1!=s||(-1==s&&n._d.els.push(t),n._d[o]||(n._d[o]=function(t){return n.call(t.srcElement,t||window.event)}),t.attachEvent("on"+e,n._d[o]))}t=null},un:function(t,e,n){var i=utils.isArray(e)?e:utils.trim(e).split(/\s+/),r=i.length;if(r)for(;r--;)if(e=i[r],t.removeEventListener)t.removeEventListener(e,n,!1);else{var o=e+n.toString();try{t.detachEvent("on"+e,n._d?n._d[o]:n)}catch(t){}if(n._d&&n._d[o]){var s=utils.indexOf(n._d.els,t);-1!=s&&n._d.els.splice(s,1),0==n._d.els.length&&delete n._d[o]}}},isSameElement:function(t,e){if(t.tagName!=e.tagName)return!1;var n=t.attributes,i=e.attributes;if(!ie&&n.length!=i.length)return!1;for(var r,o,s=0,a=0,l=0;r=n[l++];){if("style"==r.nodeName){if(r.specified&&s++,domUtils.isSameStyle(t,e))continue;return!1}if(ie){if(!r.specified)continue;s++,o=i.getNamedItem(r.nodeName)}else o=e.attributes[r.nodeName];if(!o.specified||r.nodeValue!=o.nodeValue)return!1}if(ie){for(l=0;o=i[l++];)o.specified&&a++;if(s!=a)return!1}return!0},isSameStyle:function(t,e){var n=t.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),i=e.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){if(n=t.style,i=e.style,n.length!=i.length)return!1;for(var r in n)if(!/^(\d+|csstext)$/i.test(r)&&n[r]!=i[r])return!1;return!0}if(!n||!i)return n==i;if(n=n.split(";"),i=i.split(";"),n.length!=i.length)return!1;for(var o,s=0;o=n[s++];)if(-1==utils.indexOf(i,o))return!1;return!0},isBlockElm:function(t){return 1==t.nodeType&&(dtd.$block[t.tagName]||styleBlock[domUtils.getComputedStyle(t,"display")])&&!dtd.$nonChild[t.tagName]},isBody:function(t){return t&&1==t.nodeType&&"body"==t.tagName.toLowerCase()},breakParent:function(t,e){var n,i,r,o=t,s=t;do{for(o=o.parentNode,r=i?((n=o.cloneNode(!1)).appendChild(i),i=n,(n=o.cloneNode(!1)).appendChild(r),n):(i=o.cloneNode(!1)).cloneNode(!1);n=s.previousSibling;)i.insertBefore(n,i.firstChild);for(;n=s.nextSibling;)r.appendChild(n);s=o}while(e!==o);return(n=e.parentNode).insertBefore(i,e),n.insertBefore(r,e),n.insertBefore(t,r),domUtils.remove(e),t},isEmptyInlineElement:function(t){if(1!=t.nodeType||!dtd.$removeEmpty[t.tagName])return 0;for(t=t.firstChild;t;){if(domUtils.isBookmarkNode(t))return 0;if(1==t.nodeType&&!domUtils.isEmptyInlineElement(t)||3==t.nodeType&&!domUtils.isWhitespace(t))return 0;t=t.nextSibling}return 1},trimWhiteTextNode:function(n){function t(t){for(var e;(e=n[t])&&3==e.nodeType&&domUtils.isWhitespace(e);)n.removeChild(e)}t("firstChild"),t("lastChild")},mergeChild:function(t,e,n){for(var i,r=domUtils.getElementsByTagName(t,t.tagName.toLowerCase()),o=0;i=r[o++];)if(i.parentNode&&!domUtils.isBookmarkNode(i))if("span"!=i.tagName.toLowerCase())domUtils.isSameElement(t,i)&&domUtils.remove(i,!0);else{if(t===i.parentNode&&(domUtils.trimWhiteTextNode(t),1==t.childNodes.length)){t.style.cssText=i.style.cssText+";"+t.style.cssText,domUtils.remove(i,!0);continue}if(i.style.cssText=t.style.cssText+";"+i.style.cssText,n){var s=n.style;if(s){s=s.split(";");for(var a,l=0;a=s[l++];)i.style[utils.cssStyleToDomStyle(a.split(":")[0])]=a.split(":")[1]}}domUtils.isSameStyle(i,t)&&domUtils.remove(i,!0)}},getElementsByTagName:function(t,e,n){if(n&&utils.isString(n)){var i=n;n=function(t){return domUtils.hasClass(t,i)}}e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var r,o=[],s=0;r=e[s++];)for(var a,l=t.getElementsByTagName(r),c=0;a=l[c++];)n&&!n(a)||o.push(a);return o},mergeToParent:function(t){for(var e=t.parentNode;e&&dtd.$removeEmpty[e.tagName];){if(e.tagName==t.tagName||"A"==e.tagName){if(domUtils.trimWhiteTextNode(e),"SPAN"==e.tagName&&!domUtils.isSameStyle(e,t)||"A"==e.tagName&&"SPAN"==t.tagName){if(1<e.childNodes.length||e!==t.parentNode){t.style.cssText=e.style.cssText+";"+t.style.cssText,e=e.parentNode;continue}e.style.cssText+=";"+t.style.cssText,"A"==e.tagName&&(e.style.textDecoration="underline")}if("A"!=e.tagName){e===t.parentNode&&domUtils.remove(t,!0);break}}e=e.parentNode}},mergeSibling:function(t,e,n){function i(t,e,n){var i;if((i=n[t])&&!domUtils.isBookmarkNode(i)&&1==i.nodeType&&domUtils.isSameElement(n,i)){for(;i.firstChild;)"firstChild"==e?n.insertBefore(i.lastChild,n.firstChild):n.appendChild(i.firstChild);domUtils.remove(i)}}!e&&i("previousSibling","firstChild",t),!n&&i("nextSibling","lastChild",t)},unSelectable:ie&&browser.ie9below||browser.opera?function(t){t.onselectstart=function(){return!1},t.onclick=t.onkeyup=t.onkeydown=function(){return!1},t.unselectable="on",t.setAttribute("unselectable","on");for(var e,n=0;e=t.all[n++];)switch(e.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:e.unselectable="on",t.setAttribute("unselectable","on")}}:function(t){t.style.MozUserSelect=t.style.webkitUserSelect=t.style.msUserSelect=t.style.KhtmlUserSelect="none"},removeAttributes:function(t,e){e=utils.isArray(e)?e:utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var n,i=0;n=e[i++];){switch(n=attrFix[n]||n){case"className":t[n]="";break;case"style":t.style.cssText="";var r=t.getAttributeNode("style");!browser.ie&&r&&t.removeAttributeNode(r)}t.removeAttribute(n)}},createElement:function(t,e,n){return domUtils.setAttributes(t.createElement(e),n)},setAttributes:function(t,e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];switch(n){case"class":t.className=i;break;case"style":t.style.cssText=t.style.cssText+";"+i;break;case"innerHTML":t[n]=i;break;case"value":t.value=i;break;default:t.setAttribute(attrFix[n]||n,i)}}return t},getComputedStyle:function(t,e){if(-1<"width height top left".indexOf(e))return t["offset"+e.replace(/^\w/,function(t){return t.toUpperCase()})]+"px";if(3==t.nodeType&&(t=t.parentNode),browser.ie&&browser.version<9&&"font-size"==e&&!t.style.fontSize&&!dtd.$empty[t.tagName]&&!dtd.$nonChild[t.tagName]){var n=t.ownerDocument.createElement("span");n.style.cssText="padding:0;border:0;font-family:simsun;",n.innerHTML=".",t.appendChild(n);var i=n.offsetHeight;return t.removeChild(n),n=null,i+"px"}try{var r=domUtils.getStyle(t,e)||(window.getComputedStyle?domUtils.getWindow(t).getComputedStyle(t,"").getPropertyValue(e):(t.currentStyle||t.style)[utils.cssStyleToDomStyle(e)])}catch(t){return""}return utils.transUnitToPx(utils.fixColor(e,r))},removeClasses:function(t,e){e=utils.isArray(e)?e:utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var n,i=0,r=t.className;n=e[i++];)r=r.replace(new RegExp("\\b"+n+"\\b"),"");(r=utils.trim(r).replace(/[ ]{2,}/g," "))?t.className=r:domUtils.removeAttributes(t,["class"])},addClass:function(t,e){if(t){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var n,i=0,r=t.className;n=e[i++];)new RegExp("\\b"+n+"\\b").test(r)||(r+=" "+n);t.className=utils.trim(r)}},hasClass:function(t,e){if(utils.isRegExp(e))return e.test(t.className);e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var n,i=0,r=t.className;n=e[i++];)if(!new RegExp("\\b"+n+"\\b","i").test(r))return!1;return i-1==e.length},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},removeStyle:function(t,e){browser.ie?("color"==e&&(e="(^|;)"+e),t.style.cssText=t.style.cssText.replace(new RegExp(e+"[^:]*:[^;]+;?","ig"),"")):t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(utils.cssStyleToDomStyle(e)),t.style.cssText||domUtils.removeAttributes(t,["style"])},getStyle:function(t,e){var n=t.style[utils.cssStyleToDomStyle(e)];return utils.fixColor(e,n)},setStyle:function(t,e,n){t.style[utils.cssStyleToDomStyle(e)]=n,utils.trim(t.style.cssText)||this.removeAttributes(t,"style")},setStyles:function(t,e){for(var n in e)e.hasOwnProperty(n)&&domUtils.setStyle(t,n,e[n])},removeDirtyAttr:function(t){for(var e,n=0,i=t.getElementsByTagName("*");e=i[n++];)e.removeAttribute("_moz_dirty");t.removeAttribute("_moz_dirty")},getChildCount:function(t,e){var n=0,i=t.firstChild;for(e=e||function(){return 1};i;)e(i)&&n++,i=i.nextSibling;return n},isEmptyNode:function(t){return!t.firstChild||0==domUtils.getChildCount(t,function(t){return!domUtils.isBr(t)&&!domUtils.isBookmarkNode(t)&&!domUtils.isWhitespace(t)})},clearSelectedArr:function(t){for(var e;e=t.pop();)domUtils.removeAttributes(e,["class"])},scrollToView:function(t,e,n){var i,r,o=(i=e.document,r="CSS1Compat"==i.compatMode,{width:(r?i.documentElement.clientWidth:i.body.clientWidth)||0,height:(r?i.documentElement.clientHeight:i.body.clientHeight)||0}).height,s=-1*o+n;s+=t.offsetHeight||0,s+=domUtils.getXY(t).y;var a=function(t){if("pageXOffset"in t)return{x:t.pageXOffset||0,y:t.pageYOffset||0};var e=t.document;return{x:e.documentElement.scrollLeft||e.body.scrollLeft||0,y:e.documentElement.scrollTop||e.body.scrollTop||0}}(e).y;(a<s||s<a-o)&&e.scrollTo(0,s+(s<0?-20:20))},isBr:function(t){return 1==t.nodeType&&"BR"==t.tagName},isFillChar:function(t,e){if(3!=t.nodeType)return!1;var n=t.nodeValue;return e?new RegExp("^"+domUtils.fillChar).test(n):!n.replace(new RegExp(domUtils.fillChar,"g"),"").length},isStartInblock:function(t){var e,n=t.cloneRange(),i=0,r=n.startContainer;if(1==r.nodeType&&r.childNodes[n.startOffset])for(var o=(r=r.childNodes[n.startOffset]).previousSibling;o&&domUtils.isFillChar(o);)o=(r=o).previousSibling;for(this.isFillChar(r,!0)&&1==n.startOffset&&(n.setStartBefore(r),r=n.startContainer);r&&domUtils.isFillChar(r);)r=(e=r).previousSibling;for(e&&(n.setStartBefore(e),r=n.startContainer),1==r.nodeType&&domUtils.isEmptyNode(r)&&1==n.startOffset&&n.setStart(r,0).collapse(!0);!n.startOffset;){if(r=n.startContainer,domUtils.isBlockElm(r)||domUtils.isBody(r)){i=1;break}var s;if(o=n.startContainer.previousSibling){for(;o&&domUtils.isFillChar(o);)o=(s=o).previousSibling;s?n.setStartBefore(s):n.setStartBefore(n.startContainer)}else n.setStartBefore(n.startContainer)}return i&&!domUtils.isBody(n.startContainer)?1:0},isEmptyBlock:function(t,e){if(1!=t.nodeType)return 0;if(e=e||new RegExp("[ Â \t\r\n"+domUtils.fillChar+"]","g"),0<t[browser.ie?"innerText":"textContent"].replace(e,"").length)return 0;for(var n in dtd.$isNotEmpty)if(t.getElementsByTagName(n).length)return 0;return 1},setViewportOffset:function(t,e){var n=0|parseInt(t.style.left),i=0|parseInt(t.style.top),r=t.getBoundingClientRect(),o=e.left-r.left,s=e.top-r.top;o&&(t.style.left=n+o+"px"),s&&(t.style.top=i+s+"px")},fillNode:function(t,e){var n=browser.ie?t.createTextNode(domUtils.fillChar):t.createElement("br");e.innerHTML="",e.appendChild(n)},moveChild:function(t,e,n){for(;t.firstChild;)n&&e.firstChild?e.insertBefore(t.lastChild,e.firstChild):e.appendChild(t.firstChild)},hasNoAttributes:function(t){return browser.ie?/^<\w+\s*?>/.test(t.outerHTML):0==t.attributes.length},isCustomeNode:function(t){return 1==t.nodeType&&t.getAttribute("_ue_custom_node_")},isTagNode:function(t,e){return 1==t.nodeType&&new RegExp("\\b"+t.tagName+"\\b","i").test(e)},filterNodeList:function(t,e,n){var i=[];if(!utils.isFunction(e)){var r=e;e=function(t){return-1!=utils.indexOf(utils.isArray(r)?r:r.split(" "),t.tagName.toLowerCase())}}return utils.each(t,function(t){e(t)&&i.push(t)}),0==i.length?null:1!=i.length&&n?i:i[0]},isInNodeEndBoundary:function(t,e){var n=t.startContainer;if(3==n.nodeType&&t.startOffset!=n.nodeValue.length)return 0;if(1==n.nodeType&&t.startOffset!=n.childNodes.length)return 0;for(;n!==e;){if(n.nextSibling)return 0;n=n.parentNode}return 1},isBoundaryNode:function(t,e){for(;!domUtils.isBody(t);)if(t!==(t=t.parentNode)[e])return!1;return!0},fillHtml:browser.ie11below?"&nbsp;":"<br/>"},fillCharReg=new RegExp(domUtils.fillChar,"g");!function(){var u,r=0,h=domUtils.fillChar;function o(t){return!t.collapsed&&1==t.startContainer.nodeType&&t.startContainer===t.endContainer&&t.endOffset-t.startOffset==1}function n(t,e,n,i){var r;return 1==e.nodeType&&(dtd.$empty[e.tagName]||dtd.$nonChild[e.tagName])&&(n=domUtils.getNodeIndex(e)+(t?0:1),e=e.parentNode),t?(i.startContainer=e,i.startOffset=n,i.endContainer||i.collapse(!0)):(i.endContainer=e,i.endOffset=n,i.startContainer||i.collapse(!1)),(r=i).collapsed=r.startContainer&&r.endContainer&&r.startContainer===r.endContainer&&r.startOffset==r.endOffset,i}var t=dom.Range=function(t,e){this.startContainer=this.startOffset=this.endContainer=this.endOffset=null,this.document=t,this.collapsed=!0,this.body=e};function d(t,e){try{if(u&&domUtils.inDoc(u,t))if(u.nodeValue.replace(fillCharReg,"").length)u.nodeValue=u.nodeValue.replace(fillCharReg,"");else{var n=u.parentNode;for(domUtils.remove(u);n&&domUtils.isEmptyInlineElement(n)&&(browser.safari?!(domUtils.getPosition(n,e)&domUtils.POSITION_CONTAINS):!n.contains(e));)u=n.parentNode,domUtils.remove(n),n=u}}catch(t){}}function f(t,e){var n;for(t=t[e];t&&domUtils.isFillChar(t);)n=t[e],domUtils.remove(t),t=n}function e(t,e){var n,i,r=t.startContainer,o=t.endContainer,s=t.startOffset,a=t.endOffset,l=t.document,c=l.createDocumentFragment();if(1==r.nodeType&&(r=r.childNodes[s]||(n=r.appendChild(l.createTextNode("")))),1==o.nodeType&&(o=o.childNodes[a]||(i=o.appendChild(l.createTextNode("")))),r===o&&3==r.nodeType)return c.appendChild(l.createTextNode(r.substringData(s,a-s))),e&&(r.deleteData(s,a-s),t.collapse(!0)),c;for(var u,h,d=c,f=domUtils.findParents(r,!0),p=domUtils.findParents(o,!0),m=0;f[m]==p[m];)m++;for(var g,y=m;g=f[y];y++){for(u=g.nextSibling,g==r?n||(3==t.startContainer.nodeType?(d.appendChild(l.createTextNode(r.nodeValue.slice(s))),e&&r.deleteData(s,r.nodeValue.length-s)):d.appendChild(e?r:r.cloneNode(!0))):(h=g.cloneNode(!1),d.appendChild(h));u&&u!==o&&u!==p[y];)g=u.nextSibling,d.appendChild(e?u:u.cloneNode(!0)),u=g;d=h}d=c,f[m]||(d.appendChild(f[m-1].cloneNode(!1)),d=d.firstChild);var v;for(y=m;v=p[y];y++){if(u=v.previousSibling,v==o?i||3!=t.endContainer.nodeType||(d.appendChild(l.createTextNode(o.substringData(0,a))),e&&o.deleteData(0,a)):(h=v.cloneNode(!1),d.appendChild(h)),y!=m||!f[m])for(;u&&u!==r;)v=u.previousSibling,d.insertBefore(e?u:u.cloneNode(!0),d.firstChild),u=v;d=h}return e&&t.setStartBefore(p[m]?f[m]?p[m]:f[m-1]:p[m-1]).collapse(!0),n&&domUtils.remove(n),i&&domUtils.remove(i),c}t.prototype={cloneContents:function(){return this.collapsed?null:e(this,0)},deleteContents:function(){var t;return this.collapsed||e(this,1),browser.webkit&&(3!=(t=this.startContainer).nodeType||t.nodeValue.length||(this.setStartBefore(t).collapse(!0),domUtils.remove(t))),this},extractContents:function(){return this.collapsed?null:e(this,2)},setStart:function(t,e){return n(!0,t,e,this)},setEnd:function(t,e){return n(!1,t,e,this)},setStartAfter:function(t){return this.setStart(t.parentNode,domUtils.getNodeIndex(t)+1)},setStartBefore:function(t){return this.setStart(t.parentNode,domUtils.getNodeIndex(t))},setEndAfter:function(t){return this.setEnd(t.parentNode,domUtils.getNodeIndex(t)+1)},setEndBefore:function(t){return this.setEnd(t.parentNode,domUtils.getNodeIndex(t))},setStartAtFirst:function(t){return this.setStart(t,0)},setStartAtLast:function(t){return this.setStart(t,3==t.nodeType?t.nodeValue.length:t.childNodes.length)},setEndAtFirst:function(t){return this.setEnd(t,0)},setEndAtLast:function(t){return this.setEnd(t,3==t.nodeType?t.nodeValue.length:t.childNodes.length)},selectNode:function(t){return this.setStartBefore(t).setEndAfter(t)},selectNodeContents:function(t){return this.setStart(t,0).setEndAtLast(t)},cloneRange:function(){return new t(this.document).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},collapse:function(t){var e=this;return t?(e.endContainer=e.startContainer,e.endOffset=e.startOffset):(e.startContainer=e.endContainer,e.startOffset=e.endOffset),e.collapsed=!0,e},shrinkBoundary:function(t){var e,n=this,i=n.collapsed;function r(t){return 1==t.nodeType&&!domUtils.isBookmarkNode(t)&&!dtd.$empty[t.tagName]&&!dtd.$nonChild[t.tagName]}for(;1==n.startContainer.nodeType&&(e=n.startContainer.childNodes[n.startOffset])&&r(e);)n.setStart(e,0);if(i)return n.collapse(!0);if(!t)for(;1==n.endContainer.nodeType&&0<n.endOffset&&(e=n.endContainer.childNodes[n.endOffset-1])&&r(e);)n.setEnd(e,e.childNodes.length);return n},getCommonAncestor:function(t,e){var n=this.startContainer,i=this.endContainer;return n===i?t&&o(this)&&1==(n=n.childNodes[this.startOffset]).nodeType?n:e&&3==n.nodeType?n.parentNode:n:domUtils.getCommonAncestor(n,i)},trimBoundary:function(t){this.txtToElmBoundary();var e=this.startContainer,n=this.startOffset,i=this.collapsed,r=this.endContainer;if(3==e.nodeType){if(0==n)this.setStartBefore(e);else if(n>=e.nodeValue.length)this.setStartAfter(e);else{var o=domUtils.split(e,n);e===r?this.setEnd(o,this.endOffset-n):e.parentNode===r&&(this.endOffset+=1),this.setStartBefore(o)}if(i)return this.collapse(!0)}return t||(n=this.endOffset,3==(r=this.endContainer).nodeType&&(0==n?this.setEndBefore(r):(n<r.nodeValue.length&&domUtils.split(r,n),this.setEndAfter(r)))),this},txtToElmBoundary:function(t){function e(t,e){var n=t[e+"Container"],i=t[e+"Offset"];3==n.nodeType&&(i?i>=n.nodeValue.length&&t["set"+e.replace(/(\w)/,function(t){return t.toUpperCase()})+"After"](n):t["set"+e.replace(/(\w)/,function(t){return t.toUpperCase()})+"Before"](n))}return!t&&this.collapsed||(e(this,"start"),e(this,"end")),this},insertNode:function(t){var e=t,n=1;11==t.nodeType&&(e=t.firstChild,n=t.childNodes.length),this.trimBoundary(!0);var i=this.startContainer,r=this.startOffset,o=i.childNodes[r];return o?i.insertBefore(t,o):i.appendChild(t),e.parentNode===this.endContainer&&(this.endOffset=this.endOffset+n),this.setStartBefore(e)},setCursor:function(t,e){return this.collapse(!t).select(e)},createBookmark:function(t,e){var n,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("â")),i.id="_baidu_bookmark_start_"+(e?"":r++),this.collapsed||((n=i.cloneNode(!0)).id="_baidu_bookmark_end_"+(e?"":r++)),this.insertNode(i),n&&this.collapse().insertNode(n).setEndBefore(n),this.setStartAfter(i),{start:t?i.id:i,end:n?t?n.id:n:null,id:t}},moveToBookmark:function(t){var e=t.id?this.document.getElementById(t.start):t.start,n=t.end&&t.id?this.document.getElementById(t.end):t.end;return this.setStartBefore(e),domUtils.remove(e),n?(this.setEndBefore(n),domUtils.remove(n)):this.collapse(!0),this},enlarge:function(t,e){var n,i,r=domUtils.isBody,o=this.document.createTextNode("");if(t){for(n=1==(i=this.startContainer).nodeType?i=i.childNodes[this.startOffset]?i.childNodes[this.startOffset]:(i.appendChild(o),o):i;;){if(domUtils.isBlockElm(i)){for(i=n;(n=i.previousSibling)&&!domUtils.isBlockElm(n);)i=n;this.setStartBefore(i);break}i=(n=i).parentNode}for(n=1==(i=this.endContainer).nodeType?((n=i.childNodes[this.endOffset])?i.insertBefore(o,n):i.appendChild(o),i=o):i;;){if(domUtils.isBlockElm(i)){for(i=n;(n=i.nextSibling)&&!domUtils.isBlockElm(n);)i=n;this.setEndAfter(i);break}i=(n=i).parentNode}o.parentNode===this.endContainer&&this.endOffset--,domUtils.remove(o)}if(!this.collapsed){for(;!(0!=this.startOffset||e&&e(this.startContainer)||r(this.startContainer));)this.setStartBefore(this.startContainer);for(;!(this.endOffset!=(1==this.endContainer.nodeType?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)||e&&e(this.endContainer)||r(this.endContainer));)this.setEndAfter(this.endContainer)}return this},enlargeToBlockElm:function(t){for(;!domUtils.isBlockElm(this.startContainer);)this.setStartBefore(this.startContainer);if(!t)for(;!domUtils.isBlockElm(this.endContainer);)this.setEndAfter(this.endContainer);return this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(e,t,n){if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(t){return 1==t.nodeType&&domUtils.isBlockElm(t)}).adjustmentBoundary();for(var i,r,o=this.createBookmark(),s=o.end,a=function(t){return 1==t.nodeType?"br"!=t.tagName.toLowerCase():!domUtils.isWhitespace(t)},l=domUtils.getNextDomNode(o.start,!1,a),c=this.cloneRange();l&&domUtils.getPosition(l,s)&domUtils.POSITION_PRECEDING;)if(3==l.nodeType||dtd[e][l.tagName]){for(c.setStartBefore(l),i=l;i&&(3==i.nodeType||dtd[e][i.tagName])&&i!==s;)r=i,i=domUtils.getNextDomNode(i,1==i.nodeType,null,function(t){return dtd[e][t.tagName]});var u,h,d=c.setEndAfter(r).extractContents();if(n&&0<n.length){var f,p;p=f=n[0].cloneNode(!1);for(var m,g=1;m=n[g++];)f.appendChild(m.cloneNode(!1)),f=f.firstChild;u=f}else u=c.document.createElement(e);if(t&&domUtils.setAttributes(u,t),u.appendChild(d),c.insertNode(n?p:u),"span"==e&&t.style&&/text\-decoration/.test(t.style)&&(h=domUtils.findParentByTagName(u,"a",!0))?(domUtils.setAttributes(h,t),domUtils.remove(u,!0),u=h):(domUtils.mergeSibling(u),domUtils.clearEmptySibling(u)),domUtils.mergeChild(u,t),l=domUtils.getNextDomNode(u,!1,a),domUtils.mergeToParent(u),i===s)break}else l=domUtils.getNextDomNode(l,!0,a);return this.moveToBookmark(o)},removeInlineStyle:function(t){if(this.collapsed)return this;t=utils.isArray(t)?t:[t],this.shrinkBoundary().adjustmentBoundary();for(var e=this.startContainer,n=this.endContainer;;){if(1==e.nodeType){if(-1<utils.indexOf(t,e.tagName.toLowerCase()))break;if("body"==e.tagName.toLowerCase()){e=null;break}}e=e.parentNode}for(;;){if(1==n.nodeType){if(-1<utils.indexOf(t,n.tagName.toLowerCase()))break;if("body"==n.tagName.toLowerCase()){n=null;break}}n=n.parentNode}var i,r,o=this.createBookmark();e&&(i=(r=this.cloneRange().setEndBefore(o.start).setStartBefore(e)).extractContents(),r.insertNode(i),domUtils.clearEmptySibling(e,!0),e.parentNode.insertBefore(o.start,e)),n&&(i=(r=this.cloneRange().setStartAfter(o.end).setEndAfter(n)).extractContents(),r.insertNode(i),domUtils.clearEmptySibling(n,!1,!0),n.parentNode.insertBefore(o.end,n.nextSibling));for(var s,a=domUtils.getNextDomNode(o.start,!1,function(t){return 1==t.nodeType});a&&a!==o.end;)s=domUtils.getNextDomNode(a,!0,function(t){return 1==t.nodeType}),-1<utils.indexOf(t,a.tagName.toLowerCase())&&domUtils.remove(a,!0),a=s;return this.moveToBookmark(o)},getClosedNode:function(){var t;if(!this.collapsed){var e=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(o(e)){var n=e.startContainer.childNodes[e.startOffset];n&&1==n.nodeType&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])&&(t=n)}}return t},select:browser.ie?function(t,e){var n;this.collapsed||this.shrinkBoundary();var i=this.getClosedNode();if(i&&!e){try{(n=this.document.body.createControlRange()).addElement(i),n.select()}catch(t){}return this}var r,o=this.createBookmark(),s=o.start;if((n=this.document.body.createTextRange()).moveToElementText(s),n.moveStart("character",1),this.collapsed){if(!t&&3!=this.startContainer.nodeType){var a=this.document.createTextNode(h),l=this.document.createElement("span");l.appendChild(this.document.createTextNode(h)),s.parentNode.insertBefore(l,s),s.parentNode.insertBefore(a,s),d(this.document,a),u=a,f(l,"previousSibling"),f(s,"nextSibling"),n.moveStart("character",-1),n.collapse(!0)}}else{var c=this.document.body.createTextRange();r=o.end,c.moveToElementText(r),n.setEndPoint("EndToEnd",c)}this.moveToBookmark(o),l&&domUtils.remove(l);try{n.select()}catch(t){}return this}:function(t){var e,n=domUtils.getWindow(this.document),i=n.getSelection();if(browser.gecko?this.document.body.focus():n.focus(),i){if(i.removeAllRanges(),this.collapsed&&!t){var r=this.startContainer,o=r;1==r.nodeType&&(o=r.childNodes[this.startOffset]),3==r.nodeType&&this.startOffset||(o?o.previousSibling&&3==o.previousSibling.nodeType:r.lastChild&&3==r.lastChild.nodeType)||(e=this.document.createTextNode(h),this.insertNode(e),d(this.document,e),f(e,"previousSibling"),f(e,"nextSibling"),u=e,this.setStart(e,browser.webkit?1:0).collapse(!0))}var s=this.document.createRange();if(this.collapsed&&browser.opera&&1==this.startContainer.nodeType)if(o=this.startContainer.childNodes[this.startOffset]){for(;o&&domUtils.isBlockElm(o)&&1==o.nodeType&&o.childNodes[0];)o=o.childNodes[0];o&&this.setStartBefore(o).collapse(!0)}else(o=this.startContainer.lastChild)&&domUtils.isBr(o)&&this.setStartBefore(o).collapse(!0);!function(i){function t(t,e,n){3==t.nodeType&&t.nodeValue.length<e&&(i[n+"Offset"]=t.nodeValue.length)}t(i.startContainer,i.startOffset,"start"),t(i.endContainer,i.endOffset,"end")}(this),s.setStart(this.startContainer,this.startOffset),s.setEnd(this.endContainer,this.endOffset),i.addRange(s)}return this},scrollToView:function(t,e){t=t?window:domUtils.getWindow(this.document);var n=this.document.createElement("span");return n.innerHTML="&nbsp;",this.cloneRange().insertNode(n),domUtils.scrollToView(n,t,e),domUtils.remove(n),this},inFillChar:function(){var t=this.startContainer;return!(!this.collapsed||3!=t.nodeType||t.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1!=t.nodeValue.length)},createAddress:function(t,c){var e={},u=this;function n(t){for(var e,n=t?u.startContainer:u.endContainer,i=domUtils.findParents(n,!0,function(t){return!domUtils.isBody(t)}),r=[],o=0;e=i[o++];)r.push(domUtils.getNodeIndex(e,c));var s=0;if(c)if(3==n.nodeType){for(var a=n.previousSibling;a&&3==a.nodeType;)s+=a.nodeValue.replace(fillCharReg,"").length,a=a.previousSibling;s+=t?u.startOffset:u.endOffset}else if(n=n.childNodes[t?u.startOffset:u.endOffset])s=domUtils.getNodeIndex(n,c);else for(var l=(n=t?u.startContainer:u.endContainer).firstChild;l;)if(domUtils.isFillChar(l))l=l.nextSibling;else if(s++,3==l.nodeType)for(;l&&3==l.nodeType;)l=l.nextSibling;else l=l.nextSibling;else s=t?domUtils.isFillChar(n)?0:u.startOffset:u.endOffset;return s<0&&(s=0),r.push(s),r}return e.startAddress=n(!0),t||(e.endAddress=u.collapsed?[].concat(e.startAddress):n()),e},moveToAddress:function(t,e){var l=this;function n(t,e){for(var n,i,r,o=l.document.body,s=0,a=t.length;s<a;s++)if(r=t[s],!(o=(n=o).childNodes[r])){i=r;break}e?o?l.setStartBefore(o):l.setStart(n,i):o?l.setEndBefore(o):l.setEnd(n,i)}return n(t.startAddress,!0),!e&&t.endAddress&&n(t.endAddress),l},equals:function(t){for(var e in this)if(this.hasOwnProperty(e)&&this[e]!==t[e])return!1;return!0},traversal:function(t,e){if(this.collapsed)return this;for(var n=this.createBookmark(),i=n.end,r=domUtils.getNextDomNode(n.start,!1,e);r&&r!==i&&domUtils.getPosition(r,i)&domUtils.POSITION_PRECEDING;){var o=domUtils.getNextDomNode(r,!1,e);t(r),r=o}return this.moveToBookmark(n)},scrollIntoView:function(){var t=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(t.get(0));var e=$(window).scrollTop(),n=$(window).height(),i=t.offset().top;(i<e-n||e+n<i)&&(e+n<i?window.scrollTo(0,i-n+t.height()):window.scrollTo(0,e-i)),t.remove()}}}(),function(){function a(t,e){var n=domUtils.getNodeIndex;(t=t.duplicate()).collapse(e);var i=t.parentElement();if(!i.hasChildNodes())return{container:i,offset:0};for(var r,o,s=i.children,a=t.duplicate(),l=0,c=s.length-1,u=-1;l<=c;){r=s[u=Math.floor((l+c)/2)],a.moveToElementText(r);var h=a.compareEndPoints("StartToStart",t);if(0<h)c=u-1;else{if(!(h<0))return{container:i,offset:n(r)};l=u+1}}if(-1==u){if(a.moveToElementText(i),a.setEndPoint("StartToStart",t),o=a.text.replace(/(\r\n|\r)/g,"\n").length,s=i.childNodes,!o)return{container:r=s[s.length-1],offset:r.nodeValue.length};for(var d=s.length;0<o;)o-=s[--d].nodeValue.length;return{container:s[d],offset:-o}}if(a.collapse(0<h),a.setEndPoint(0<h?"StartToStart":"EndToStart",t),!(o=a.text.replace(/(\r\n|\r)/g,"\n").length))return dtd.$empty[r.tagName]||dtd.$nonChild[r.tagName]?{container:i,offset:n(r)+(0<h?0:1)}:{container:r,offset:0<h?0:r.childNodes.length};for(;0<o;)try{var f=r;o-=(r=r[0<h?"previousSibling":"nextSibling"]).nodeValue.length}catch(t){return{container:i,offset:n(f)}}return{container:r,offset:0<h?-o:r.nodeValue.length+o}}function i(t,e){var n;try{n=t.getNative(e).createRange()}catch(t){return null}var i=n.item?n.item(0):n.parentElement();return(i.ownerDocument||i)===t.document?n:null}(dom.Selection=function(t,e){var n=this;n.document=t,n.body=e,browser.ie9below&&$(e).on("beforedeactivate",function(){n._bakIERange=n.getIERange()}).on("activate",function(){try{var t=i(n);t&&n.rangeInBody(t)||!n._bakIERange||n._bakIERange.select()}catch(t){}n._bakIERange=null})}).prototype={hasNativeRange:function(){var t;if(!browser.ie||browser.ie9above){var e=this.getNative();if(!e.rangeCount)return!1;t=e.getRangeAt(0)}else t=i(this);return this.rangeInBody(t)},getNative:function(t){var e=this.document;try{return e?browser.ie9below||t?e.selection:domUtils.getWindow(e).getSelection():null}catch(t){return null}},getIERange:function(t){var e=i(this,t);return e&&this.rangeInBody(e,t)||!this._bakIERange?e:this._bakIERange},rangeInBody:function(t,e){var n=browser.ie9below||e?t.item?t.item():t.parentElement():t.startContainer;return n===this.body||domUtils.inDoc(n,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var t=this.getStart();return t?domUtils.findParents(t,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){var i=this;function e(t){for(var e=i.body.firstChild,n=t.collapsed;e&&e.firstChild;)t.setStart(e,0),e=e.firstChild;t.startContainer||t.setStart(i.body,0),n&&t.collapse(!0)}if(null!=i._cachedRange)return this._cachedRange;var n=new dom.Range(i.document,i.body);if(browser.ie9below){var t=i.getIERange();if(t&&this.rangeInBody(t))try{!function(t,e){if(t.item)e.selectNode(t.item(0));else{var n=a(t,!0);e.setStart(n.container,n.offset),0!=t.compareEndPoints("StartToEnd",t)&&(n=a(t,!1),e.setEnd(n.container,n.offset))}}(t,n)}catch(t){e(n)}else e(n)}else{var r=i.getNative();if(r&&r.rangeCount&&i.rangeInBody(r.getRangeAt(0))){var o=r.getRangeAt(0),s=r.getRangeAt(r.rangeCount-1);n.setStart(o.startContainer,o.startOffset).setEnd(s.endContainer,s.endOffset),n.collapsed&&domUtils.isBody(n.startContainer)&&!n.startOffset&&e(n)}else{if(this._bakRange&&(this._bakRange.startContainer===this.body||domUtils.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;e(n)}}return this._bakRange=n},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var t,e,n,i,r=browser.ie9below?this.getIERange():this.getRange();if(browser.ie9below){if(!r)return this.document.body.firstChild;if(r.item)return r.item(0);for(0<(t=r.duplicate()).text.length&&t.moveStart("character",1),t.collapse(1),e=t.parentElement(),i=n=r.parentElement();n=n.parentNode;)if(n==e){e=i;break}}else if(1==(e=r.startContainer).nodeType&&e.hasChildNodes()&&(e=e.childNodes[Math.min(e.childNodes.length-1,r.startOffset)]),3==e.nodeType)return e.parentNode;return e},getText:function(){var t,e;return this.isFocus()&&(t=this.getNative())?(e=browser.ie9below?t.createRange():t.getRangeAt(0),browser.ie9below?e.text:e.toString()):""},clearRange:function(){this.getNative()[browser.ie9below?"empty":"removeAllRanges"]()}}}(),function(){var e,n=0;function u(t,e){var n;if(e.textarea)if(utils.isString(e.textarea)){for(var i,r=0,o=domUtils.getElementsByTagName(t,"textarea");i=o[r++];)if(i.id=="umeditor_textarea_"+e.options.textarea){n=i;break}}else n=e.textarea;n||(t.appendChild(n=domUtils.createElement(document,"textarea",{name:e.options.textarea,id:"umeditor_textarea_"+e.options.textarea,style:"display:none"})),e.textarea=n),n.value=e.hasContents()?e.options.allHtmlEnabled?e.getAllHtml():e.getContent(null,null,!0):""}var t=UM.Editor=function(t){var e=this;e.uid=n++,EventBase.call(e),e.commands={},e.options=utils.extend(utils.clone(t||{}),UMEDITOR_CONFIG,!0),e.shortcutkeys={},e.inputRules=[],e.outputRules=[],e.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!0,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:e.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:e.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),e.plugins={},utils.isEmptyObject(UM.I18N)||(e.options.lang=function(t){for(var e in t)return e}(UM.I18N),function(t){for(var e in UM.plugins)-1==t.options.excludePlugins.indexOf(e)&&(UM.plugins[e].call(t),t.plugins[e]=1);t.langIsReady=!0,t.fireEvent("langReady")}(e))};t.prototype={registerCommand:function(t,e){this.commands[t]=e},ready:function(t){t&&(this.isReady?t.apply(this):this.addListener("ready",t))},setOpt:function(t,e){var n={};utils.isString(t)?n[t]=e:n=t,utils.extend(this.options,n,!0)},getOpt:function(t){return this.options[t]||""},destroy:function(){var t=this;t.fireEvent("destroy");var e=t.container.parentNode;e===document.body&&(e=t.container);var n=t.textarea;for(var i in n?n.style.display="":(n=document.createElement("textarea"),e.parentNode.insertBefore(n,e)),n.style.width=t.body.offsetWidth+"px",n.style.height=t.body.offsetHeight+"px",n.value=t.getContent(),n.id=t.key,e.contains(n)&&$(n).insertBefore(e),e.innerHTML="",domUtils.remove(e),domUtils.remove(n),UM.clearCache(t.id),t)t.hasOwnProperty(i)&&delete this[i]},initialCont:function(t){if(t){if(t.getAttribute("name")&&(this.options.textarea=t.getAttribute("name")),t&&/script|textarea/gi.test(t.tagName)){var e=document.createElement("div");t.parentNode.insertBefore(e,t),this.options.initialContent=UM.htmlparser(t.value||t.innerHTML||this.options.initialContent).toHtml(),t.className&&(e.className=t.className),t.style.cssText&&(e.style.cssText=t.style.cssText),/textarea/i.test(t.tagName)?(this.textarea=t,this.textarea.style.display="none"):(t.parentNode.removeChild(t),t.id&&(e.id=t.id)),(t=e).innerHTML=""}return t}return null},render:function(e){var t=this.options,n=function(t){return parseInt($(e).css(t))};if(utils.isString(e)&&(e=document.getElementById(e)),e){this.id=e.getAttribute("id"),UM.setEditor(this),utils.cssRule("edui-style-body",this.options.initialStyle,document),(e=this.initialCont(e)).className+=" textfield-body-container",t.initialFrameWidth?t.minFrameWidth=t.initialFrameWidth:t.minFrameWidth=t.initialFrameWidth=$(e).width()||UM.defaultWidth,t.initialFrameHeight?t.minFrameHeight=t.initialFrameHeight:t.initialFrameHeight=t.minFrameHeight=$(e).height()||UM.defaultHeight,e.style.width=/%$/.test(t.initialFrameWidth)?"100%":t.initialFrameWidth-n("padding-left")-n("padding-right")+"px";var i=/%$/.test(t.initialFrameHeight)?"100%":t.initialFrameHeight-n("padding-top")-n("padding-bottom");this.options.autoHeightEnabled?(e.style.minHeight=i+"px",e.style.height="",browser.ie&&browser.version<=6&&(e.style.height=i,e.style.setExpression("height","this.scrollHeight <= "+i+' ? "'+i+'px" : "auto"'))):$(e).height(i),e.style.zIndex=t.zIndex,this._setup(e)}},_setup:function(t){var e,n=this,i=n.options;t.contentEditable=!0,document.body.spellcheck=!1,n.document=document,n.window=document.defaultView||document.parentWindow,n.body=t,n.$body=$(t),n.selection=new dom.Selection(document,n.body),n._isEnabled=!1,browser.gecko&&(e=this.selection.getNative())&&e.removeAllRanges(),this._initEvents();for(var r=t.parentNode;r&&!domUtils.isBody(r);r=r.parentNode)if("FORM"==r.tagName){n.form=r,n.options.autoSyncData?$(t).on("blur",function(){u(r,n)}):$(r).on("submit",function(){u(this,n)});break}if(i.initialContent)if(i.autoClearinitialContent){var o=n.execCommand;n.execCommand=function(){return n.fireEvent("firstBeforeExecCommand"),o.apply(n,arguments)},this._setDefaultContent(i.initialContent)}else this.setContent(i.initialContent,!1,!0);domUtils.isEmptyNode(n.body)&&(n.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),i.focus&&setTimeout(function(){try{n.focus(n.options.focusInEnd),!n.options.autoClearinitialContent&&n._selectionChange()}catch(t){}},0),n.container||(n.container=t.parentNode),n._bindshortcutKeys(),n.isReady=1,n.fireEvent("ready"),i.onready&&i.onready.call(n),browser.ie&&!browser.ie9above||$(n.body).on("blur focus",function(t){var e=n.selection.getNative();if("blur"==t.type)0<e.rangeCount&&(n._bakRange=e.getRangeAt(0));else{try{n._bakRange&&e.addRange(n._bakRange)}catch(t){}n._bakRange=null}}),!i.isShow&&n.setHide(),i.readonly&&n.setDisabled()},sync:function(t){var e=t?document.getElementById(t):domUtils.findParent(this.body.parentNode,function(t){return"FORM"==t.tagName},!0);e&&u(e,this)},setHeight:function(t,e){!e&&(this.options.initialFrameHeight=t),this.options.autoHeightEnabled?($(this.body).css({"min-height":t+"px"}),browser.ie&&browser.version<=6&&this.container&&(this.container.style.height=t,this.container.style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"'))):$(this.body).height(t),this.fireEvent("resize")},setWidth:function(t){this.$container&&this.$container.width(t),$(this.body).width(t-1*$(this.body).css("padding-left").replace("px","")-1*$(this.body).css("padding-right").replace("px","")),this.fireEvent("resize")},addshortcutkey:function(t,e){var n={};e?n[t]=e:n=t,utils.extend(this.shortcutkeys,n)},_bindshortcutKeys:function(){var c=this,u=this.shortcutkeys;c.addListener("keydown",function(t,e){var n=e.keyCode||e.which;for(var i in u)for(var r,o=u[i].split(","),s=0;r=o[s++];){var a=(r=r.split(":"))[0],l=r[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(a.toLowerCase())||/^(\d+)$/.test(a))&&("ctrl"==RegExp.$1&&(e.ctrlKey||e.metaKey)&&(""==RegExp.$2||e[RegExp.$2.slice(1)+"Key"])&&n==RegExp.$3||n==RegExp.$1)&&(-1!=c.queryCommandState(i,l)&&c.execCommand(i,l),domUtils.preventDefault(e))}})},getContent:function(t,e,n,i,r){if(t&&utils.isFunction(t)&&(e=t,t=""),e?!e():!this.hasContents())return"";this.fireEvent("beforegetcontent");var o=UM.htmlparser(this.body.innerHTML,i);return this.filterOutputRule(o),this.fireEvent("aftergetcontent",o),o.toHtml(r)},getAllHtml:function(){var t=[];if(this.fireEvent("getAllHtml",t),browser.ie&&8<browser.version){var e="";utils.each(this.document.styleSheets,function(t){e+=t.href?'<link rel="stylesheet" type="text/css" href="'+t.href+'" />':"<style>"+t.cssText+"</style>"}),utils.each(this.document.getElementsByTagName("script"),function(t){e+=t.outerHTML})}return"<html><head>"+(this.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+this.options.charset+'"/>':"")+(e||this.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+this.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var t=new RegExp(domUtils.fillChar,"g"),e=this.body.innerHTML.replace(/[\n\r]/g,"");return(e=e.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(t,e,n){return dtd.$block[n]?"\n":e||""})).replace(t,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var t=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(t,"").replace(/\u00a0/g," ")},setContent:function(t,e,n){var i=this;i.fireEvent("beforesetcontent",t);var r,o,s=UM.htmlparser(t);if(i.filterInputRule(s),t=s.toHtml(),i.body.innerHTML=(e?i.body.innerHTML:"")+t,"p"==i.options.enterTag){var a,l=this.body.firstChild;if(!l||1==l.nodeType&&(dtd.$cdata[l.tagName]||"DIV"==(r=l).tagName&&r.getAttribute("cdata_tag")||domUtils.isCustomeNode(l))&&l===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var c=i.document.createElement("p");l;){for(;l&&(3==l.nodeType||1==l.nodeType&&dtd.p[l.tagName]&&!dtd.$cdata[l.tagName]);)a=l.nextSibling,c.appendChild(l),l=a;if(c.firstChild){if(!l){i.body.appendChild(c);break}l.parentNode.insertBefore(c,l),c=i.document.createElement("p")}l=l.nextSibling}}i.fireEvent("aftersetcontent"),i.fireEvent("contentchange"),!n&&i._selectionChange(),i._bakRange=i._bakIERange=i._bakNativeRange=null,browser.gecko&&(o=this.selection.getNative())&&o.removeAllRanges(),i.options.autoSyncData&&i.form&&u(i.form,i)},focus:function(t){try{var e=this.selection.getRange();t?e.setStartAtLast(this.body.lastChild).setCursor(!1,!0):e.select(!0),this.fireEvent("focus")}catch(t){}},blur:function(){var t=this.selection.getNative();t.empty?t.empty():t.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return!0===this.fireEvent("isfocus")||this.selection.isFocus()},_initEvents:function(){var e=this,t=e.body,n=function(){e._proxyDomEvent.apply(e,arguments)};$(t).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",n).on("focus blur",n).on("mouseup keydown",function(t){"keydown"==t.type&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)||2!=t.button&&e._selectionChange(250,t)})},_proxyDomEvent:function(t){return this.fireEvent(t.type.replace(/^on/,""),t)},_selectionChange:function(t,n){var i,r,o=this,s=!1;browser.ie&&browser.version<9&&n&&"mouseup"==n.type&&(this.selection.getRange().collapsed||(s=!0,i=n.clientX,r=n.clientY));clearTimeout(e),e=setTimeout(function(){try{if(!o.selection.getNative())return}catch(t){return}var e,t;if(s&&"None"==o.selection.getNative().type){e=o.document.body.createTextRange();try{e.moveToPoint(i,r)}catch(t){e=null}}e&&(t=o.selection.getIERange,o.selection.getIERange=function(){return e}),o.selection.cache(),t&&(o.selection.getIERange=t),o.selection._cachedRange&&o.selection._cachedStartElement&&(o.fireEvent("beforeselectionchange"),o.fireEvent("selectionchange",!!n),o.fireEvent("afterselectionchange"),o.selection.clear())},t||50)},_callCmdFn:function(t,e){var n,i,r=(e=Array.prototype.slice.call(e,0)).shift().toLowerCase();return i=(n=this.commands[r]||UM.commands[r])&&n[t],n&&i||"queryCommandState"!=t?i?i.apply(this,[r].concat(e)):void 0:0},mark:function(){return this.execCommand.apply(this,arguments)},execCommand:function(t){if(!this.isFocus()){var e=this.selection._bakRange;e?e.select():this.focus(!0)}"sub"===(t=t.toLowerCase())?t="subscript":"sup"===t?t="superscript":"color"===t?t="forecolor":"center"===t?t="justifycenter":"left"===t?t="justifyleft":"right"===t&&(t="justifyright");var n,i=this,r=i.commands[t]||UM.commands[t];return r&&r.execCommand?(r.notNeedUndo||i.__hasEnterExecCommand?(n=this._callCmdFn("execCommand",arguments),!i.__hasEnterExecCommand&&!r.ignoreContentChange&&!i._ignoreContentChange&&i.fireEvent("contentchange")):(i.__hasEnterExecCommand=!0,-1!=i.queryCommandState.apply(i,arguments)&&(i.fireEvent("saveScene"),i.fireEvent("beforeexeccommand",t),n=this._callCmdFn("execCommand",arguments),!r.ignoreContentChange&&!i._ignoreContentChange&&i.fireEvent("contentchange"),i.fireEvent("afterexeccommand",t),i.fireEvent("saveScene")),i.__hasEnterExecCommand=!1),!i.__hasEnterExecCommand&&!r.ignoreContentChange&&!i._ignoreContentChange&&i._selectionChange(),n):null},queryMark:function(){return this.queryCommandState.apply(this,arguments)},queryCommandState:function(t){try{return this._callCmdFn("queryCommandState",arguments)}catch(t){return 0}},queryCommandValue:function(t){try{return this._callCmdFn("queryCommandValue",arguments)}catch(t){return null}},hasContents:function(t){if(!this.body)return!1;if(t)for(var e,n=0;e=t[n++];)if(0<this.body.getElementsByTagName(e).length)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(t=["div"],n=0;e=t[n++];)for(var i,r=domUtils.getElementsByTagName(this.body,e),o=0;i=r[o++];)if(domUtils.isCustomeNode(i))return!0;return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return 1!=this._isEnabled},setEnabled:function(){var e,n=this;if(n.body.contentEditable=!0,n.lastBk){e=n.selection.getRange();try{e.moveToBookmark(n.lastBk),delete n.lastBk}catch(t){e.setStartAtFirst(n.body).collapse(!0)}e.select(!0)}n.bkqueryCommandState&&(n.queryCommandState=n.bkqueryCommandState,delete n.bkqueryCommandState),n._bkproxyDomEvent&&(n._proxyDomEvent=n._bkproxyDomEvent,delete n._bkproxyDomEvent),n.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(t,e){var n=this;n.body.contentEditable=!1,n._except=t?utils.isArray(t)?t:[t]:[],n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0)),n.bkqueryCommandState||(n.bkqueryCommandState=n.queryCommandState,n.queryCommandState=function(t){return-1!=utils.indexOf(n._except,t)?n.bkqueryCommandState.apply(n,arguments):-1}),e||n._bkproxyDomEvent||(n._bkproxyDomEvent=n._proxyDomEvent,n._proxyDomEvent=function(){return!1}),n.fireEvent("selectionchange"),n.fireEvent("setDisabled",n._except)},disable:function(t){return this.setDisabled(t)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){this.body.innerHTML='<p id="initContent">'+t+"</p>",this.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this,n=e.selection.getRange();if("none"==e.container.style.display){try{n.moveToBookmark(e.lastBk),delete e.lastBk}catch(t){n.setStartAtFirst(e.body).collapse(!0)}setTimeout(function(){n.select(!0)},100),e.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){this.lastBk||(this.lastBk=this.selection.getRange().createBookmark(!0)),this.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(t){var e=UM.I18N[this.options.lang];if(!e)throw Error("not import language file");t=(t||"").split(".");for(var n,i=0;(n=t[i++])&&(e=e[n]););return e},getContentLength:function(t,e){var n=this.getContent(!1,!1,!0).length;if(t){e=(e||[]).concat(["hr","img","iframe"]),n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var i,r=0;i=e[r++];)n+=this.body.getElementsByTagName(i).length}return n},addInputRule:function(t,e){t.ignoreUndo=e,this.inputRules.push(t)},filterInputRule:function(t,e){for(var n,i=0;n=this.inputRules[i++];)e&&n.ignoreUndo||n.call(this,t)},addOutputRule:function(t,e){t.ignoreUndo=e,this.outputRules.push(t)},filterOutputRule:function(t,e){for(var n,i=0;n=this.outputRules[i++];)e&&n.ignoreUndo||n.call(this,t)}},utils.inherits(t,EventBase)}();var filterWord=UM.filterWord=function(){function h(t){return t=t.replace(/[\d.]+\w+/g,function(t){return utils.transUnitToPx(t)})}return function(t){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(t)?t.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(t){if(browser.opera)return"";try{if(/Bitmap/i.test(t))return"";var e=t.match(/width:([ \d.]*p[tx])/i)[1],n=t.match(/height:([ \d.]*p[tx])/i)[1],i=t.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+h(e)+'" height="'+h(n)+'" src="'+i+'" />'}catch(t){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(t,e,n,i){return"class"==e&&"MsoListParagraph"==i?t:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(t,e,n){return n.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(t,e,n,i){for(var r,o=[],s=i.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),a=0;r=s[a];a++){var l,c,u=r.split(":");if(2==u.length){if(l=u[0].toLowerCase(),c=u[1].toLowerCase(),/^(background)\w*/.test(l)&&0==c.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(l)&&/^0\w+$/.test(c))continue;switch(l){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(e)||(o[a]=l.replace(/^mso-|-alt$/g,"")+":"+h(c));continue;case"horiz-align":o[a]="text-align:"+c;continue;case"vert-align":o[a]="vertical-align:"+c;continue;case"font-color":case"mso-foreground":o[a]="color:"+c;continue;case"mso-background":case"mso-highlight":o[a]="background:"+c;continue;case"mso-default-height":o[a]="min-height:"+h(c);continue;case"mso-default-width":o[a]="min-width:"+h(c);continue;case"mso-padding-between-alt":o[a]="border-collapse:separate;border-spacing:"+h(c);continue;case"text-line-through":"single"!=c&&"double"!=c||(o[a]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==c&&(o[a]="display:none");continue;case"margin":if(!/[1-9]/.test(c))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(l)||/text\-indent|padding|margin/.test(l)&&/\-[\d.]+/.test(c))continue;o[a]=l+":"+u[1]}}return e+(o.length?' style="'+o.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(t){return utils.transUnitToPx(t)}):t}}();!function(){var r=UM.uNode=function(t){this.type=t.type,this.data=t.data,this.tagName=t.tagName,this.parentNode=t.parentNode,this.attrs=t.attrs||{},this.children=t.children},c={href:1,src:1,_src:1,_href:1,cdata_data:1},u={style:1,script:1},i="    ",o="\n";function h(t,e,n){return t.push(o),e+(n?1:-1)}function d(t,e){for(var n=0;n<e;n++)t.push(i)}function f(t,e,n,i){switch(t.type){case"root":for(var r,o=0;r=t.children[o++];)n&&"element"==r.type&&!dtd.$inlineWithA[r.tagName]&&1<o&&(h(e,i,!0),d(e,i)),f(r,e,n,i);break;case"text":l=e,"pre"==(a=t).parentNode.tagName?l.push(a.data):l.push(u[a.parentNode.tagName]?utils.html(a.data):a.data.replace(/[ ]{2}/g," &nbsp;"));break;case"element":!function(t,e,n,i){var r="";if(t.attrs){r=[];var o=t.attrs;for(var s in o)r.push(s+(void 0!==o[s]?'="'+(c[s]?utils.html(o[s]).replace(/["]/g,function(t){return"&quot;"}):utils.unhtml(o[s]))+'"':""));r=r.join(" ")}e.push("<"+t.tagName+(r?" "+r:"")+(dtd.$empty[t.tagName]?"/":"")+">"),n&&!dtd.$inlineWithA[t.tagName]&&"pre"!=t.tagName&&t.children&&t.children.length&&(i=h(e,i,!0),d(e,i));if(t.children&&t.children.length)for(var a,l=0;a=t.children[l++];)n&&"element"==a.type&&!dtd.$inlineWithA[a.tagName]&&1<l&&(h(e,i),d(e,i)),f(a,e,n,i);dtd.$empty[t.tagName]||(n&&!dtd.$inlineWithA[t.tagName]&&"pre"!=t.tagName&&t.children&&t.children.length&&(i=h(e,i),d(e,i)),e.push("</"+t.tagName+">"))}(t,e,n,i);break;case"comment":s=t,e.push("\x3c!--"+s.data+"--\x3e")}var s,a,l;return e}function s(t,e){var n;if("element"==t.type&&t.getAttr("id")==e)return t;if(t.children&&t.children.length)for(var i,r=0;i=t.children[r++];)if(n=s(i,e))return n}function a(t,e,n){if("element"==t.type&&t.tagName==e&&n.push(t),t.children&&t.children.length)for(var i,r=0;i=t.children[r++];)a(i,e,n)}r.createElement=function(t){return/[<>]/.test(t)?UM.htmlparser(t).children[0]:new r({type:"element",children:[],tagName:t})},r.createText=function(t,e){return new UM.uNode({type:"text",data:e?t:utils.unhtml(t||"")})},r.prototype={toHtml:function(t){var e=[];return f(this,e,t,0),e.join("")},innerHTML:function(t){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(t)){if(this.children)for(var e=0;n=this.children[e++];)n.parentNode=null;this.children=[];var n,i=UM.htmlparser(t);for(e=0;n=i.children[e++];)this.children.push(n),n.parentNode=this;return this}return(i=new UM.uNode({type:"root",children:this.children})).toHtml()},innerText:function(t,e){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(t){if(this.children)for(var n,i=0;n=this.children[i++];)n.parentNode=null;return this.children=[],this.appendChild(r.createText(t,e)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var t,e=this.parentNode,n=0;t=e.children[n];n++)if(t===this)return 0==n?null:e.children[n-1]},nextSibling:function(){for(var t,e=this.parentNode,n=0;t=e.children[n++];)if(t===this)return e.children[n]},replaceChild:function(t,e){if(this.children){t.parentNode&&t.parentNode.removeChild(t);for(var n,i=0;n=this.children[i];i++)if(n===e)return this.children.splice(i,1,t),e.parentNode=null,t.parentNode=this,t}},appendChild:function(t){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),t.parentNode&&t.parentNode.removeChild(t);for(var e,n=0;e=this.children[n];n++)if(e===t){this.children.splice(n,1);break}return this.children.push(t),t.parentNode=this,t}},insertBefore:function(t,e){if(this.children){t.parentNode&&t.parentNode.removeChild(t);for(var n,i=0;n=this.children[i];i++)if(n===e)return this.children.splice(i,0,t),t.parentNode=this,t}},insertAfter:function(t,e){if(this.children){t.parentNode&&t.parentNode.removeChild(t);for(var n,i=0;n=this.children[i];i++)if(n===e)return this.children.splice(i+1,0,t),t.parentNode=this,t}},removeChild:function(t,e){if(this.children)for(var n,i=0;n=this.children[i];i++)if(n===t){if(this.children.splice(i,1),n.parentNode=null,e&&n.children&&n.children.length)for(var r,o=0;r=n.children[o];o++)this.children.splice(i+o,0,r),r.parentNode=this;return n}},getAttr:function(t){return this.attrs&&this.attrs[t.toLowerCase()]},setAttr:function(t,e){if(t)if(this.attrs||(this.attrs={}),utils.isObject(t))for(var n in t)t[n]?this.attrs[n.toLowerCase()]=t[n]:delete this.attrs[n];else e?this.attrs[t.toLowerCase()]=e:delete this.attrs[t];else delete this.attrs},hasAttr:function(t){var e=this.getAttr(t);return null!=e},getIndex:function(){for(var t,e=this.parentNode,n=0;t=e.children[n];n++)if(t===this)return n;return-1},getNodeById:function(t){var e;if(this.children&&this.children.length)for(var n,i=0;n=this.children[i++];)if(e=s(n,t))return e},getNodesByTagName:function(t){t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");var i=[],r=this;return utils.each(t,function(t){if(r.children&&r.children.length)for(var e,n=0;e=r.children[n++];)a(e,t,i)}),i},getStyle:function(t){var e=this.getAttr("style");if(!e)return"";var n=new RegExp("(^|;)\\s*"+t+":([^;]+)","i"),i=e.match(n);return i&&i[0]?i[2]:""},setStyle:function(t,e){function n(t,e){var n=new RegExp("(^|;)\\s*"+t+":([^;]+;?)","gi");i=i.replace(n,"$1"),e&&(i=t+":"+utils.unhtml(e)+";"+i)}var i=this.getAttr("style");if(i||(i=""),utils.isObject(t))for(var r in t)n(r,t[r]);else n(t,e);this.setAttr("style",utils.trim(i))},hasClass:function(n){if(this.hasAttr("class")){var t=this.getAttr("class").split(/\s+/),i=!1;return $.each(t,function(t,e){e===n&&(i=!0)}),i}return!1},addClass:function(e){var t=null,n=!1;this.hasAttr("class")?((t=(t=this.getAttr("class")).split(/\s+/)).forEach(function(t){t!==e||(n=!0)}),!n&&t.push(e),this.setAttr("class",t.join(" "))):this.setAttr("class",e)},removeClass:function(t){if(this.hasAttr("class")){var e=this.getAttr("class");e=e.replace(new RegExp("\\b"+t+"\\b","g"),""),this.setAttr("class",utils.trim(e).replace(/[ ]{2,}/g," "))}},traversal:function(t){return this.children&&this.children.length&&function t(e,n){if(e.children&&e.children.length)for(var i,r=0;i=e.children[r];)t(i,n),i.parentNode&&(i.children&&i.children.length&&n(i),i.parentNode&&r++);else n(e)}(this,t),this}}}();var htmlparser=UM.htmlparser=function(t,n){var e=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,c=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,i={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};t=t.replace(new RegExp(domUtils.fillChar,"g"),""),n||(t=t.replace(new RegExp("[\\r\\t\\n"+(n?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(n?"":" ")+"]*","g"),function(t,e){return e&&i[e.toLowerCase()]?t.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):t.replace(new RegExp("^[\\r\\n"+(n?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(n?"":" ")+"]+$"),"")}));var u={href:1,src:1},h=UM.uNode,d={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},r={ol:"li",ul:"li"};function o(t,e){if(r[t.tagName]){var n=h.createElement(r[t.tagName]);t.appendChild(n),n.appendChild(h.createText(e)),t=n}else t.appendChild(h.createText(e))}function f(t,e,n){var i;if(i=d[e]){for(var r,o=t;"root"!=o.type;){if(utils.isArray(i)?-1!=utils.indexOf(i,o.tagName):i==o.tagName){t=o,r=!0;break}o=o.parentNode}r||(t=f(t,utils.isArray(i)?i[0]:i))}var s=new h({parentNode:t,type:"element",tagName:e.toLowerCase(),children:dtd.$empty[e]?null:[]});if(n){for(var a,l={};a=c.exec(n);)l[a[1].toLowerCase()]=u[a[1].toLowerCase()]?a[2]||a[3]||a[4]:utils.unhtml(a[2]||a[3]||a[4]);s.attrs=l}return t.children.push(s),dtd.$empty[e]?t:s}for(var s,a,l,p=0,m=0,g=new h({type:"root",children:[]}),y=g;s=e.exec(t);){p=s.index;try{if(m<p&&o(y,t.slice(m,p)),s[3])dtd.$cdata[y.tagName]?o(y,s[0]):y=f(y,s[3].toLowerCase(),s[4]);else if(s[1]){if("root"!=y.type)if(dtd.$cdata[y.tagName]&&!dtd.$cdata[s[1]])o(y,s[0]);else{for(var v=y;"element"==y.type&&y.tagName!=s[1].toLowerCase();)if("root"==(y=y.parentNode).type)throw y=v,"break";y=y.parentNode}}else s[2]&&(a=y,l=s[2],a.children.push(new h({type:"comment",data:l,parentNode:a})))}catch(t){}m=e.lastIndex}return m<t.length&&o(y,t.slice(m)),g},filterNode=UM.filterNode=function(){function d(n,t){switch(n.type){case"text":break;case"element":var e;if(e=t[n.tagName])if("-"===e)n.parentNode.removeChild(n);else if(utils.isFunction(e)){var i=n.parentNode,r=n.getIndex();if(e(n),n.parentNode){if(n.children)for(var o=0;h=n.children[o];)d(h,t),h.parentNode&&o++}else for(o=r;h=i.children[o];)d(h,t),h.parentNode&&o++}else{var s=e.$;if(s&&n.attrs){var a,l={};for(var c in s){if(a=n.getAttr(c),"style"==c&&utils.isArray(s[c])){var u=[];utils.each(s[c],function(t){var e;(e=n.getStyle(t))&&u.push(t+":"+e)}),a=u.join(";")}a&&(l[c]=a)}n.attrs=l}if(n.children)for(o=0;h=n.children[o];)d(h,t),h.parentNode&&o++}else if(dtd.$cdata[n.tagName])n.parentNode.removeChild(n);else{i=n.parentNode,r=n.getIndex();n.parentNode.removeChild(n,!0);var h;for(o=r;h=i.children[o];)d(h,t),h.parentNode&&o++}break;case"comment":n.parentNode.removeChild(n)}}return function(t,e){if(utils.isEmptyObject(e))return t;var n;(n=e["-"])&&utils.each(n.split(" "),function(t){e[t]="-"});for(var i,r=0;i=t.children[r];)d(i,e),i.parentNode&&r++;return t}}(),Wnb_textarea,Mvb,Pvb,Gxb,Hxb,Ixb,Jxb,Lxb,Mxb,Nxb,Oxb;UM.commands.inserthtml={execCommand:function(t,e,n){var i,r,o=this;if(e&&!0!==o.fireEvent("beforeinserthtml",e)){if((r=(i=o.selection.getRange()).document.createElement("div")).style.display="inline",!n){var s=UM.htmlparser(e);o.options.filterRules&&UM.filterNode(s,o.options.filterRules),o.filterInputRule(s),e=s.toHtml()}if(r.innerHTML=utils.trim(e),!i.collapsed){var a=i.startContainer;if(domUtils.isFillChar(a)&&i.setStartBefore(a),a=i.endContainer,domUtils.isFillChar(a)&&i.setEndAfter(a),i.txtToElmBoundary(),i.endContainer&&1==i.endContainer.nodeType&&(a=i.endContainer.childNodes[i.endOffset])&&domUtils.isBr(a)&&i.setEndAfter(a),0==i.startOffset&&(a=i.startContainer,domUtils.isBoundaryNode(a,"firstChild")&&(a=i.endContainer,i.endOffset==(3==a.nodeType?a.nodeValue.length:a.childNodes.length)&&domUtils.isBoundaryNode(a,"lastChild")&&(o.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",i.setStart(o.body.firstChild,0).collapse(!0)))),!i.collapsed&&i.deleteContents(),1==i.startContainer.nodeType)if((l=i.startContainer.childNodes[i.startOffset])&&domUtils.isBlockElm(l)&&(p=l.previousSibling)&&domUtils.isBlockElm(p)){for(i.setEnd(p,p.childNodes.length).collapse();l.firstChild;)p.appendChild(l.firstChild);domUtils.remove(l)}}var l,c,u,h,d=0;for(i.inFillChar()&&(l=i.startContainer,domUtils.isFillChar(l)?(i.setStartBefore(l).collapse(!0),domUtils.remove(l)):domUtils.isFillChar(l,!0)&&(l.nodeValue=l.nodeValue.replace(fillCharReg,""),i.startOffset--,i.collapsed&&i.collapse(!0)));l=r.firstChild;){if(d){for(var f=o.document.createElement("p");l&&(3==l.nodeType||!dtd.$block[l.tagName]);)h=l.nextSibling,f.appendChild(l),l=h;f.firstChild&&(l=f)}if(i.insertNode(l),h=l.nextSibling,!d&&l.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(l)&&(c=domUtils.findParent(l,function(t){return domUtils.isBlockElm(t)}))&&"body"!=c.tagName.toLowerCase()&&(!dtd[c.tagName][l.nodeName]||l.parentNode!==c)){if(dtd[c.tagName][l.nodeName])for(u=l.parentNode;u!==c;)u=(p=u).parentNode;else p=c;domUtils.breakParent(l,p||u);var p=l.previousSibling;domUtils.trimWhiteTextNode(p),p.childNodes.length||domUtils.remove(p),!browser.ie&&(m=l.nextSibling)&&domUtils.isBlockElm(m)&&m.lastChild&&!domUtils.isBr(m.lastChild)&&m.appendChild(o.document.createElement("br")),d=1}var m=l.nextSibling;if(!r.firstChild&&m&&domUtils.isBlockElm(m)){i.setStart(m,0).collapse(!0);break}i.setEndAfter(l).collapse()}if(l=i.startContainer,h&&domUtils.isBr(h)&&domUtils.remove(h),domUtils.isBlockElm(l)&&domUtils.isEmptyNode(l))if(h=l.nextSibling)domUtils.remove(l),1==h.nodeType&&dtd.$block[h.tagName]&&i.setStart(h,0).collapse(!0).shrinkBoundary();else try{l.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(t){i.setStartBefore(l),domUtils.remove(l)}try{if(browser.ie9below&&1==i.startContainer.nodeType&&!i.startContainer.childNodes[i.startOffset])if((p=i.startContainer.childNodes[i.startOffset-1])&&1==p.nodeType&&dtd.$empty[p.tagName]){var g=this.document.createTextNode(domUtils.fillChar);i.insertNode(g).setStart(g,0).collapse(!0)}setTimeout(function(){i.select(!0)})}catch(t){}setTimeout(function(){(i=o.selection.getRange()).scrollIntoView(),o.fireEvent("afterinserthtml")},200)}}},UM.commands.insertimage={execCommand:function(t,e){if((e=utils.isArray(e)?e:[e]).length){var n,i=[],r="";if(n=e[0],1==e.length)r='<img src="'+n.src+'" '+(n._src?' _src="'+n._src+'" ':"")+(n.width?'width="'+n.width+'" ':"")+(n.height?' height="'+n.height+'" ':"")+("left"==n.floatStyle||"right"==n.floatStyle?' style="float:'+n.floatStyle+';"':"")+(n.title&&""!=n.title?' title="'+n.title+'"':"")+(n.border&&"0"!=n.border?' border="'+n.border+'"':"")+(n.alt&&""!=n.alt?' alt="'+n.alt+'"':"")+(n.hspace&&"0"!=n.hspace?' hspace = "'+n.hspace+'"':"")+(n.vspace&&"0"!=n.vspace?' vspace = "'+n.vspace+'"':"")+"/>","center"==n.floatStyle&&(r='<p style="text-align: center">'+r+"</p>"),i.push(r);else for(var o=0;n=e[o++];)r="<p "+("center"==n.floatStyle?'style="text-align: center" ':"")+'><img src="'+n.src+'" '+(n.width?'width="'+n.width+'" ':"")+(n._src?' _src="'+n._src+'" ':"")+(n.height?' height="'+n.height+'" ':"")+' style="'+(n.floatStyle&&"center"!=n.floatStyle?"float:"+n.floatStyle+";":"")+(n.border||"")+'" '+(n.title?' title="'+n.title+'"':"")+" /></p>",i.push(r);this.execCommand("insertHtml",i.join(""),!0)}}},UM.plugins.justify=function(){var n=this;$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(t,e){n.commands[e]={execCommand:function(t){return this.document.execCommand(t)},queryCommandValue:function(t){var e=this.document.queryCommandValue(t);return!0===e||"true"===e?t.replace(/justify/,""):""},queryCommandState:function(t){return this.document.queryCommandState(t)?1:0}}})},UM.plugins.font=function(){for(var t={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},e=[],l={underline:1,strikethrough:1,fontborder:1},s={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},n=12;n<301;n++)e.push(n);function c(t,i,r){var e,n=t.collapsed,o=t.createBookmark();if(n)for(e=o.start.parentNode;dtd.$inline[e.tagName];)e=e.parentNode;else e=domUtils.getCommonAncestor(o.start,o.end);utils.each(domUtils.getElementsByTagName(e,"span"),function(t){if(t.parentNode&&!domUtils.isBookmarkNode(t))if(/\s*border\s*:\s*none;?\s*/i.test(t.style.cssText))/^\s*border\s*:\s*none;?\s*$/.test(t.style.cssText)?domUtils.remove(t,!0):domUtils.removeStyle(t,"border");else{if(/border/i.test(t.style.cssText)&&"SPAN"==t.parentNode.tagName&&/border/i.test(t.parentNode.style.cssText)&&(t.style.cssText=t.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")),"fontborder"!=i||"none"!=r)for(var e=t.nextSibling;e&&1==e.nodeType&&"SPAN"==e.tagName;)if(domUtils.isBookmarkNode(e)&&"fontborder"==i)t.appendChild(e),e=t.nextSibling;else{if(e.style.cssText==t.style.cssText&&(domUtils.moveChild(e,t),domUtils.remove(e)),t.nextSibling===e)break;e=t.nextSibling}if(function(t){for(var e;(e=t.parentNode)&&"SPAN"==e.tagName&&1==domUtils.getChildCount(e,function(t){return!domUtils.isBookmarkNode(t)&&!domUtils.isBr(t)});)e.style.cssText+=t.style.cssText,domUtils.remove(t,!0),t=e}(t),browser.ie&&8<browser.version){var n=domUtils.findParent(t,function(t){return"SPAN"==t.tagName&&/background-color/.test(t.style.cssText)});n&&!/background-color/.test(t.style.cssText)&&(t.style.backgroundColor=n.style.backgroundColor)}}}),t.moveToBookmark(o),function(t,e,n){if(s[e]&&(t.adjustmentBoundary(),!t.collapsed&&1==t.startContainer.nodeType)){var i=t.startContainer.childNodes[t.startOffset];if(i&&domUtils.isTagNode(i,"span")){var r=t.createBookmark();utils.each(domUtils.getElementsByTagName(i,"span"),function(t){t.parentNode&&!domUtils.isBookmarkNode(t)&&("backcolor"==e&&domUtils.getComputedStyle(t,"background-color").toLowerCase()===n||(domUtils.removeStyle(t,s[e]),0==t.style.cssText.replace(/^\s+$/,"").length&&domUtils.remove(t,!0)))}),t.moveToBookmark(r)}}}(t,i,r)}for(var i in this.setOpt({fontfamily:[{name:"songti",val:"å®ä½,SimSun"},{name:"yahei",val:"å¾®è½¯éé»,Microsoft YaHei"},{name:"kaiti",val:"æ¥·ä½,æ¥·ä½_GB2312, SimKai"},{name:"heiti",val:"é»ä½, SimHei"},{name:"lishu",val:"é¶ä¹¦, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:e}),this.addInputRule(function(t){utils.each(t.getNodesByTagName("u s del font strike"),function(t){if("font"==t.tagName){var e=[];for(var n in t.attrs)switch(n){case"size":e.push("font-size:"+({1:"10",2:"12",3:"16",4:"18",5:"24",6:"32",7:"48"}[t.attrs[n]]||t.attrs[n])+"px");break;case"color":e.push("color:"+t.attrs[n]);break;case"face":e.push("font-family:"+t.attrs[n]);break;case"style":e.push(t.attrs[n])}t.attrs={style:e.join(";")}}else{var i="u"==t.tagName?"underline":"line-through";t.attrs={style:(t.getAttr("style")||"")+"text-decoration:"+i+";"}}t.tagName="span"})}),t)!function(s,a){UM.commands[s]={execCommand:function(t,e){e=e||(this.queryCommandState(t)?"none":"underline"==t?"underline":"fontborder"==t?"1px solid #000":"line-through");var n,i=this.selection.getRange();if("default"==e)i.collapsed&&(n=this.document.createTextNode("font"),i.insertNode(n).select()),this.execCommand("removeFormat","span,a",a),n&&(i.setStartBefore(n).collapse(!0),domUtils.remove(n)),c(i,t,e),i.select();else if(i.collapsed){var r=domUtils.findParentByTagName(i.startContainer,"span",!0);if(n=this.document.createTextNode("font"),!r||r.children.length||r[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){if(i.insertNode(n),i.selectNode(n).select(),r=i.document.createElement("span"),l[s]){if(domUtils.findParentByTagName(n,"a",!0))return i.setStartBefore(n).setCursor(),void domUtils.remove(n);this.execCommand("removeFormat","span,a",a)}if(r.style.cssText=a+":"+(t.match(/fontfamily|forecolor/)?e:e+"px"),n.parentNode.insertBefore(r,n),!browser.ie||browser.ie&&9==browser.version)for(var o=r.parentNode;!domUtils.isBlockElm(o);)"SPAN"==o.tagName&&(r.style.cssText=o.style.cssText+";"+r.style.cssText),o=o.parentNode;opera?setTimeout(function(){i.setStart(r,0).collapse(!0),c(i,t,e),i.select()}):(i.setStart(r,0).collapse(!0),c(i,t,e),i.select())}else i.insertNode(n),l[s]&&(i.selectNode(n).select(),this.execCommand("removeFormat","span,a",a,null),r=domUtils.findParentByTagName(n,"span",!0),i.setStartBefore(n)),r&&(r.style.cssText+=";"+a+":"+(t.match(/fontfamily|forecolor/)?e:e+"px")),i.collapse(!0).select();domUtils.remove(n)}else l[s]&&this.queryCommandValue(s)&&this.execCommand("removeFormat","span,a",a),(i=this.selection.getRange()).applyInlineStyle("span",{style:a+":"+(t.match(/fontfamily|forecolor/)?e:e+"px")}),c(i,t,e),i.select();return!0},queryCommandValue:function(t){var e=this.selection.getStart();if("underline"==t||"strikethrough"==t){for(var n,i=e;i&&!domUtils.isBlockElm(i)&&!domUtils.isBody(i);){if(1==i.nodeType&&"none"!=(n=domUtils.getComputedStyle(i,a)))return n;i=i.parentNode}return"none"}if("fontborder"==t){for(var r,o=e;o&&dtd.$inline[o.tagName];){if((r=domUtils.getComputedStyle(o,"border"))&&/1px/.test(r)&&/solid/.test(r))return r;o=o.parentNode}return""}if("FontSize"!=t)return domUtils.getComputedStyle(e,a);var s=domUtils.getComputedStyle(e,a);return(o=/^([\d\.]+)(\w+)$/.exec(s))?Math.floor(o[1])+o[2]:s},queryCommandState:function(t){if(!l[t])return 0;var e=this.queryCommandValue(t);return"fontborder"==t?/1px/.test(e)&&/solid/.test(e):"underline"==t?/underline/.test(e):/line\-through/.test(e)}}}(i,t[i])},UM.plugins.link=function(){this.setOpt("autourldetectinie",!1),browser.ie&&!1===this.options.autourldetectinie&&this.addListener("keyup",function(t,e){var n=e.keyCode;if(13==n||32==n){var i,r=this.selection.getRange().startContainer;if(13==n){if("P"==r.nodeName)if((i=r.previousSibling)&&1==i.nodeType)(i=i.lastChild)&&"A"==i.nodeName&&!i.getAttribute("_href")&&domUtils.remove(i,!0)}else 32==n&&3==r.nodeType&&/^\s$/.test(r.nodeValue)&&(r=r.previousSibling)&&"A"==r.nodeName&&!r.getAttribute("_href")&&domUtils.remove(r,!0)}}),this.addOutputRule(function(t){$.each(t.getNodesByTagName("a"),function(t,e){var n=e.getAttr("_href");/^(ftp|https?|\/|file)/.test(n)||(n="http://"+n),e.setAttr("href",n),e.setAttr("_href"),""==e.getAttr("title")&&e.setAttr("title")})}),this.addInputRule(function(t){$.each(t.getNodesByTagName("a"),function(t,e){e.setAttr("_href",e.getAttr("href"))})}),this.commands.link={execCommand:function(t,e){var n=this.selection.getRange();if(e._href&&(e._href=utils.unhtml(e._href,/[<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g)),e.href&&(e.href=utils.unhtml(e.href,/[<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g)),n.collapsed){var i=n.startContainer;(i=domUtils.findParentByTagName(i,"a",!0))?($(i).attr(e),n.selectNode(i).select()):n.insertNode($("<a>"+e.href+"</a>").attr(e)[0]).select()}else this.document.execCommand("createlink",!1,"_umeditor_link"),utils.each(domUtils.getElementsByTagName(this.body,"a",function(t){return"_umeditor_link"==t.getAttribute("href")}),function(t){"_umeditor_link"==$(t).text()&&$(t).text(e.href),domUtils.setAttributes(t,e),n.selectNode(t).select()})},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var n,t=this.selection.getStartElementPath();return $.each(t,function(t,e){if("A"==e.nodeName)return n=e,!1}),n}},this.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var t="editor_print_"+ +new Date;$('<iframe src="" id="'+t+'" name="'+t+'" frameborder="0"></iframe>').attr("id",t).css({width:"0px",height:"0px",overflow:"hidden",float:"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(this.$container.find(".edui-dialog-container"));var e=window.open("",t,"").document;e.open(),e.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+t+"').remove();},100);},200);<\/script></body></html>"),e.close()},notNeedUndo:1},UM.plugins.paragraph=function(){this.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),this.commands.paragraph={execCommand:function(t,e){return this.document.execCommand("formatBlock",!1,"<"+e+">")},queryCommandValue:function(){try{var t=this.document.queryCommandValue("formatBlock")}catch(t){}return t}}},UM.plugins.horizontal=function(){var s=this;s.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var t=s.selection.getRange().txtToElmBoundary(!0),e=t.startContainer;if(domUtils.isBody(t.startContainer)){var n=t.startContainer.childNodes[t.startOffset];n||(n=$("<p></p>").appendTo(t.startContainer).html(browser.ie?"&nbsp;":"<br/>")[0]),t.setStart(n,0).setCursor()}else{for(;dtd.$inline[e.tagName]&&e.lastChild===e.firstChild;){var i=e.parentNode;i.appendChild(e.firstChild),i.removeChild(e),e=i}for(;dtd.$inline[e.tagName];)e=e.parentNode;if(1==e.childNodes.length&&"HR"==e.lastChild.nodeName){var r=e.lastChild;$(r).insertBefore(e),t.setStart(e,0).setCursor()}else{r=$("hr",e)[0],domUtils.breakParent(r,e);var o=r.previousSibling;o&&domUtils.isEmptyBlock(o)&&$(o).remove(),t.setStart(r.nextSibling,0).setCursor()}}}}},UM.commands.cleardoc={execCommand:function(){var t=this,e=t.selection.getRange();t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",e.setStart(t.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){t.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){var s,o=this,a=o.options.maxUndoCount||20,l=o.options.maxInputCount||20,c=new RegExp(domUtils.fillChar+"|</hr>","gi"),u={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},h=o.options.autoClearEmptyNode;function d(t,e){if(t.length!=e.length)return 0;for(var n=0,i=t.length;n<i;n++)if(t[n]!=e[n])return 0;return 1}function t(){this.undoManger.save()}o.undoManger=new function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],n=UM.htmlparser(t.content.replace(c,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(n,!0),e.options.autoClearEmptyNode=h,e.body.innerHTML=n.toHtml(),e.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(e.document,"td th caption p"),function(t){domUtils.isEmptyNode(t)&&domUtils.fillNode(e.document,t)});try{var i=new dom.Range(e.document,e.body).moveToAddress(t.address);if(browser.ie&&i.collapsed&&1==i.startContainer.nodeType){var r=i.startContainer.childNodes[i.startOffset];(!r||1==r.nodeType&&dtd.$empty[r])&&i.insertNode(e.document.createTextNode(" ")).collapse(!0)}i.select(u[i.startContainer.nodeName.toLowerCase()])}catch(t){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var t=this.editor,e=t.selection.getRange().createAddress(!1,!0);t.fireEvent("beforegetscene");var n=UM.htmlparser(t.body.innerHTML,!0);t.options.autoClearEmptyNode=!1,t.filterOutputRule(n,!0),t.options.autoClearEmptyNode=h;var i=n.toHtml();return browser.ie&&(i=i.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),t.fireEvent("aftergetscene"),{address:e,content:i}},this.save=function(t,e){clearTimeout(s);var n,i,r=this.getScene(e),o=this.list[this.index];o&&o.content==r.content&&(t||(n=o.address,i=r.address,n.collapsed==i.collapsed&&d(n.startAddress,i.startAddress)&&d(n.endAddress,i.endAddress)))||(this.list=this.list.slice(0,this.index+1),this.list.push(r),this.list.length>a&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){p=0,null}},(o.undoManger.editor=o).addListener("saveScene",function(){var t=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,t)}),o.addListener("beforeexeccommand",t),o.addListener("afterexeccommand",t),o.addListener("reset",function(t,e){e||this.undoManger.reset()}),o.commands.redo=o.commands.undo={execCommand:function(t){this.undoManger[t]()},queryCommandState:function(t){return this.undoManger["has"+("undo"==t.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var f={16:1,17:1,18:1,37:1,38:1,39:1,40:1},p=0,m=!1;o.addListener("ready",function(){$(this.body).on("compositionstart",function(){m=!0}).on("compositionend",function(){m=!1})}),o.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var g=!0;o.addListener("keydown",function(t,e){var n=this,i=e.keyCode||e.which;if(UM.browser.gecko&&/<p><br>(<su[bp]>[\w\W]*<\/su[bp]>)*<\/p>/.test(n.body.innerHTML)&&"BR"===n.body.childNodes[0].firstChild.nodeName&&n.body.childNodes[0].removeChild(n.body.childNodes[0].firstChild),!(f[i]||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)){if(m)return;if(!n.selection.getRange().collapsed)return n.undoManger.save(!1,!0),void(g=!1);function r(t){try{t.selection.getRange().collapsed&&t.fireEvent("contentchange"),t.undoManger.save(!1,!0),t.fireEvent("selectionchange")}catch(t){}}0==n.undoManger.list.length&&n.undoManger.save(!0),clearTimeout(s),s=setTimeout(function(){if(m)var t=setInterval(function(){m||(r(n),clearInterval(t))},300);else r(n)},200),i,l<=++p&&r(n)}}),o.addListener("keypress",function(){if(1===o.getPlainTxt().replace("\n","").length){o.execCommand("selectall");var t=1*TextField.dom.getValue().match(/\d+(.\d+)?px/g)[0].match(/\d+(.\d+)?/g)[0];o.mark("fontsize",t),o.mark("color","#000000"),o.selection.clearRange(),o.focus(!0)}}),o.addListener("keyup",function(t,e){if(o.ch2&&1<o.getPlainTxt().replace("\n","").length){var n=/(?:font-size|line-height):\s*1(3)\.\1+px;/g,i=o.getContent();i.match(n)&&(o.setContent(i.replace(n,function(t,e){return""})),o.focus(!0))}var r=e.keyCode||e.which;if(!(f[r]||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)){if(m)return;g||(this.undoManger.save(!1,!0),g=!0)}})},UM.plugins.list=function(){this.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(t){utils.each(t.getNodesByTagName("li"),function(t){0==t.children.length&&t.parentNode.removeChild(t)})}),this.commands.insertorderedlist=this.commands.insertunorderedlist={execCommand:function(t){this.document.execCommand(t);var e=this.selection.getRange(),n=e.createBookmark(!0);return this.$body.find("ol,ul").each(function(t,e){var i=e.parentNode;"P"==i.tagName&&i.lastChild===i.firstChild&&($(e).children().each(function(t,e){var n=i.cloneNode(!1);$(n).append(e.innerHTML),$(e).html("").append(n)}),$(e).insertBefore(i),$(i).remove()),dtd.$inline[i.tagName]&&("SPAN"==i.tagName&&$(e).children().each(function(t,e){var n=i.cloneNode(!1);if("P"!=e.firstChild.nodeName){for(;e.firstChild;)n.appendChild(e.firstChild);$("<p></p>").appendTo(e).append(n)}else{for(;e.firstChild;)n.appendChild(e.firstChild);$(e.firstChild).append(n)}}),domUtils.remove(i,!0))}),e.moveToBookmark(n).select(),!0},queryCommandState:function(t){return this.document.queryCommandState(t)}}},Wnb_textarea=function(t,e){var n=e.ownerDocument.createElement("textarea");return n.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",browser.ie&&browser.version<8&&(n.style.width=e.offsetWidth+"px",n.style.height=e.offsetHeight+"px",e.onresize=function(){n.style.width=e.offsetWidth+"px",n.style.height=e.offsetHeight+"px"}),e.appendChild(n),{container:n,setContent:function(t){n.value=t},getContent:function(){return n.value},select:function(){var t;browser.ie?((t=n.createTextRange()).collapse(!0),t.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){e.removeChild(n),e.onresize=null,e=n=null}}},UM.plugins.source=function(){var o,s=this,t=this.options,a=!1;t.sourceEditor="textarea",s.setOpt({sourceEditorFirst:!1});var l,c=s.getContent;s.commands.source={execCommand:function(){if(a=!a){l=s.selection.getRange().createAddress(!1,!0),s.undoManger&&s.undoManger.save(!0),browser.gecko&&(s.body.contentEditable=!1),s.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",s.fireEvent("beforegetcontent");var t=UM.htmlparser(s.body.innerHTML);s.filterOutputRule(t),t.traversal(function(t){if("element"==t.type)switch(t.tagName){case"td":case"th":case"caption":t.children&&1==t.children.length&&"br"==t.firstChild().tagName&&t.removeChild(t.firstChild());break;case"pre":t.innerText(t.innerText().replace(/&nbsp;/g," "))}}),s.fireEvent("aftergetcontent");var e=t.toHtml(!0);r=s.body.parentNode,(o=Wnb_textarea(s,r)).setContent(e);var n=function(t){return parseInt($(s.body).css(t))};$(o.container).width($(s.body).width()+n("padding-left")+n("padding-right")).height($(s.body).height()),setTimeout(function(){o.select()}),s.getContent=function(){return o.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{s.$body.css({position:"",left:"",top:""});var i=o.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";i=i.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(t,e){return e&&!dtd.$inlineWithA[e.toLowerCase()]?t.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):t.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),s.setContent(i),o.dispose(),o=null,s.getContent=c,s.body.firstChild||(s.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),s.undoManger&&s.undoManger.save(!0),browser.gecko&&(s.body.contentEditable=!0);try{s.selection.getRange().moveToAddress(l).select()}catch(t){}}var r;this.fireEvent("sourcemodechanged",a)},queryCommandState:function(){return 0|a},notNeedUndo:1};var e=s.queryCommandState;s.queryCommandState=function(t){return t=t.toLowerCase(),a?t in{source:1,fullscreen:1}?e.apply(this,arguments):-1:e.apply(this,arguments)}},UM.plugins.enterkey=function(){var l,c=this,a=c.options.enterTag;c.addListener("keyup",function(t,e){if(13==(e.keyCode||e.which)){var n,i=c.selection.getRange(),r=i.startContainer;if(browser.ie)c.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(l)){if(browser.gecko)domUtils.findParentByTagName(r,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0)||(c.document.execCommand("formatBlock",!1,"<p>"),n=1);else if(1==r.nodeType){var o,s=c.document.createTextNode("");if(i.insertNode(s),o=domUtils.findParentByTagName(s,"div",!0)){for(var a=c.document.createElement("p");o.firstChild;)a.appendChild(o.firstChild);o.parentNode.insertBefore(a,o),domUtils.remove(o),i.setStartBefore(s).setCursor(),n=1}domUtils.remove(s)}c.undoManger&&n&&c.undoManger.save()}browser.opera&&i.select()}}}),c.addListener("keydown",function(t,e){if(13==(e.keyCode||e.which)){if(c.fireEvent("beforeenterkeydown"))return void domUtils.preventDefault(e);c.fireEvent("saveScene",!0,!0),l="";var n=c.selection.getRange();if(!n.collapsed){var i=n.startContainer,r=n.endContainer,o=domUtils.findParentByTagName(i,"td",!0),s=domUtils.findParentByTagName(r,"td",!0);if(o&&s&&o!==s||!o&&s||o&&!s)return void(e.preventDefault?e.preventDefault():e.returnValue=!1)}"p"==a&&(browser.ie||((i=domUtils.findParentByTagName(n.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0))||browser.opera?(l=i.tagName,"p"==i.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(i)):(c.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(n=c.selection.getRange(),(i=domUtils.findParentByTagName(n.startContainer,"p",!0))&&domUtils.removeDirtyAttr(i)))))}}),browser.ie&&c.addListener("setDisabled",function(){$(c.body).find("p").each(function(t,e){domUtils.isEmptyBlock(e)&&(e.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var t=window.open("","_blank","").document,e=this.getContent(null,null,!0),n=this.getOpt("UMEDITOR_HOME_URL"),i=-1!=e.indexOf("mathquill-embedded-latex")?'<link rel="stylesheet" href="'+n+'third-party/mathquill/mathquill.css"/><script src="'+n+'third-party/jquery.min.js"><\/script><script src="'+n+'third-party/mathquill/mathquill.min.js"><\/script>':"";t.open(),t.write("<html><head>"+i+"</head><body><div>"+e+"</div></body></html>"),t.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var n=this;n.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),n.addOutputRule(function(t){$.each(t.getNodesByTagName("b i u strike s"),function(t,e){switch(e.tagName){case"b":e.tagName="strong";break;case"i":e.tagName="em";break;case"u":e.tagName="span",e.setStyle("text-decoration","underline");break;case"s":case"strike":e.tagName="span",e.setStyle("text-decoration","line-through")}})}),$.each(["bold","underline","superscript","subscript","italic","strikethrough"],function(t,e){n.commands[e]={execCommand:function(t){var e=this.selection.getRange();if(e.collapsed&&1!=this.queryCommandState(t)){var n=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[t]);return e.insertNode(n).setStart(n,0).setCursor(!1),!0}return UM.cancelSub?void 0:this.document.execCommand(t)},queryCommandState:function(n){if(browser.gecko)return this.document.queryCommandState(n);var t=this.selection.getStartElementPath(),i=!1;return $.each(t,function(t,e){switch(n){case"bold":if("STRONG"==e.nodeName||"B"==e.nodeName)return!(i=1);break;case"underline":if("U"==e.nodeName||"SPAN"==e.nodeName&&"underline"==$(e).css("text-decoration"))return!(i=1);break;case"superscript":if("SUP"==e.nodeName)return!(i=1);break;case"subscript":if("SUB"==e.nodeName)return!(i=1);break;case"italic":if("EM"==e.nodeName||"I"==e.nodeName)return!(i=1);break;case"strikethrough":if("S"==e.nodeName||"STRIKE"==e.nodeName||"SPAN"==e.nodeName&&"line-through"==$(e).css("text-decoration"))return!(i=1)}}),i}}})},UM.plugins.video=function(){var s=this;function a(t,e,n,i,r,o){return o?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" width="'+e+'" height="'+n+'"'+(r?' style="float:'+r+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(i?'id="'+i+'"':"")+' width="'+e+'" height="'+n+'" _url="'+t+'" class="edui-faked-video" src="'+s.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+s.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(r?"float:"+r+";":"")+'" />'}function e(t,n){utils.each(t.getNodesByTagName(n?"img":"embed"),function(t){if("edui-faked-video"==t.getAttr("class")){var e=a(n?t.getAttr("_url"):t.getAttr("src"),t.getAttr("width"),t.getAttr("height"),null,t.getStyle("float")||"",n);t.parentNode.replaceChild(UM.uNode.createElement(e),t)}})}s.addOutputRule(function(t){e(t,!0)}),s.addInputRule(function(t){e(t)}),s.commands.insertvideo={execCommand:function(t,e){for(var n,i=[],r=0,o=(e=utils.isArray(e)?e:[e]).length;r<o;r++)(n=e[r]).url=utils.unhtml(n.url,/[<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g),i.push(a(n.url,n.width||420,n.height||280,"tmpVedio"+r,n.align,!1));s.execCommand("inserthtml",i.join(""),!0)},queryCommandState:function(){var t=s.selection.getRange().getClosedNode();return t&&"edui-faked-video"==t.className?1:0}}},UM.plugins.selectall=function(){this.commands.selectall={execCommand:function(){var t=this.body,e=this.selection.getRange();e.selectNodeContents(t),domUtils.isEmptyBlock(t)&&(browser.opera&&t.firstChild&&1==t.firstChild.nodeType&&e.setStartAtFirst(t.firstChild),e.collapse(!0)),e.select(!0)},notNeedUndo:1},this.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){this.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),this.commands.removeformat={execCommand:function(t,e,c,n,u){var h,d,f=new RegExp("^(?:"+(e||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),p=c?[]:(n||this.options.removeFormatAttributes).split(","),i=new dom.Range(this.document),m=function(t){return 1==t.nodeType};function g(t){if(3==t.nodeType||"span"!=t.tagName.toLowerCase())return 0;if(browser.ie){var e=t.attributes;if(e.length){for(var n=0,i=e.length;n<i;n++)if(e[n].specified)return 0;return 1}}return!t.attributes.length}(i=this.selection.getRange()).collapsed||(!function(t){var e=t.createBookmark();if(t.collapsed&&t.enlarge(!0),!u){var n=domUtils.findParentByTagName(t.startContainer,"a",!0);n&&t.setStartBefore(n),(n=domUtils.findParentByTagName(t.endContainer,"a",!0))&&t.setEndAfter(n)}for(a=(h=t.createBookmark()).start;(d=a.parentNode)&&!domUtils.isBlockElm(d);)domUtils.breakParent(a,d),domUtils.clearEmptySibling(a);if(h.end){for(a=h.end;(d=a.parentNode)&&!domUtils.isBlockElm(d);)domUtils.breakParent(a,d),domUtils.clearEmptySibling(a);for(var i,r=domUtils.getNextDomNode(h.start,!1,m);r&&r!=h.end;)i=domUtils.getNextDomNode(r,!0,m),dtd.$empty[r.tagName.toLowerCase()]||domUtils.isBookmarkNode(r)||(f.test(r.tagName)?c?(domUtils.removeStyle(r,c),g(r)&&"text-decoration"!=c&&domUtils.remove(r,!0)):domUtils.remove(r,!0):dtd.$tableContent[r.tagName]||dtd.$list[r.tagName]||(domUtils.removeAttributes(r,p),g(r)&&domUtils.remove(r,!0))),r=i}var o=h.start.parentNode;!domUtils.isBlockElm(o)||dtd.$tableContent[o.tagName]||dtd.$list[o.tagName]||domUtils.removeAttributes(o,p),o=h.end.parentNode,h.end&&domUtils.isBlockElm(o)&&!dtd.$tableContent[o.tagName]&&!dtd.$list[o.tagName]&&domUtils.removeAttributes(o,p),t.moveToBookmark(h).moveToBookmark(e);for(var s,a=t.startContainer,l=t.collapsed;1==a.nodeType&&domUtils.isEmptyNode(a)&&dtd.$removeEmpty[a.tagName];)s=a.parentNode,t.setStartBefore(a),t.startContainer===t.endContainer&&t.endOffset--,domUtils.remove(a),a=s;if(!l)for(a=t.endContainer;1==a.nodeType&&domUtils.isEmptyNode(a)&&dtd.$removeEmpty[a.tagName];)s=a.parentNode,t.setEndBefore(a),domUtils.remove(a),a=s}(i),i.select())}}},UM.plugins.keystrokes=function(){var h=this,d=!0;h.addListener("keydown",function(t,e){var n=e.keyCode||e.which,i=h.selection.getRange();if(!i.collapsed&&!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)&&(65<=n&&n<=90||48<=n&&n<=57||96<=n&&n<=111||{13:1,8:1,46:1}[n])){var r=i.startContainer;if(domUtils.isFillChar(r)&&i.setStartBefore(r),r=i.endContainer,domUtils.isFillChar(r)&&i.setEndAfter(r),i.txtToElmBoundary(),i.endContainer&&1==i.endContainer.nodeType&&(r=i.endContainer.childNodes[i.endOffset])&&domUtils.isBr(r)&&i.setEndAfter(r),0==i.startOffset&&(r=i.startContainer,domUtils.isBoundaryNode(r,"firstChild")&&(r=i.endContainer,i.endOffset==(3==r.nodeType?r.nodeValue.length:r.childNodes.length)&&domUtils.isBoundaryNode(r,"lastChild"))))return h.fireEvent("saveScene"),h.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",i.setStart(h.body.firstChild,0).setCursor(!1,!0),void h._selectionChange()}if(8==n){if(i=h.selection.getRange(),d=i.collapsed,h.fireEvent("delkeydown",e))return;var o,s;if(i.collapsed&&i.inFillChar()&&(o=i.startContainer,domUtils.isFillChar(o)?(i.setStartBefore(o).shrinkBoundary(!0).collapse(!0),domUtils.remove(o)):(o.nodeValue=o.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),i.startOffset--,i.collapse(!0).select(!0))),o=i.getClosedNode())return h.fireEvent("saveScene"),i.setStartBefore(o),domUtils.remove(o),i.setCursor(),h.fireEvent("saveScene"),void domUtils.preventDefault(e);if(!browser.ie&&(o=domUtils.findParentByTagName(i.startContainer,"table",!0),s=domUtils.findParentByTagName(i.endContainer,"table",!0),o&&!s||!o&&s||o!==s))return void e.preventDefault();if(o=i.startContainer,i.collapsed&&1==o.nodeType){var a=o.childNodes[i.startOffset-1];a&&1==a.nodeType&&"BR"==a.tagName&&(h.fireEvent("saveScene"),i.setStartBefore(a).collapse(!0),domUtils.remove(a),i.select(),h.fireEvent("saveScene"))}if(browser.chrome&&i.collapsed){for(;0==i.startOffset&&!domUtils.isEmptyBlock(i.startContainer);)i.setStartBefore(i.startContainer);var l=i.startContainer.childNodes[i.startOffset-1];l&&"BR"==l.nodeName&&(i.setStartBefore(l),h.fireEvent("saveScene"),$(l).remove(),i.setCursor(),h.fireEvent("saveScene"))}}if(browser.gecko&&46==n){var c=h.selection.getRange();if(c.collapsed&&(o=c.startContainer,domUtils.isEmptyBlock(o))){for(var u=o.parentNode;1==domUtils.getChildCount(u)&&!domUtils.isBody(u);)u=(o=u).parentNode;return void(o===u.lastChild&&e.preventDefault())}}}),h.addListener("keyup",function(t,e){var n;if(8==(e.keyCode||e.which)){if(this.fireEvent("delkeyup"))return;if((n=this.selection.getRange()).collapsed){if((o=domUtils.findParentByTagName(n.startContainer,["h1","h2","h3","h4","h5","h6"],!0))&&domUtils.isEmptyBlock(o)){var i=o.previousSibling;if(i&&"TABLE"!=i.nodeName)return domUtils.remove(o),void n.setStartAtLast(i).setCursor(!1,!0);var r=o.nextSibling;if(r&&"TABLE"!=r.nodeName)return domUtils.remove(o),void n.setStartAtFirst(r).setCursor(!1,!0)}if(domUtils.isBody(n.startContainer)){var o=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});n.insertNode(o).setStart(o,0).setCursor(!1,!0)}}if(!d&&(3==n.startContainer.nodeType||1==n.startContainer.nodeType&&domUtils.isEmptyBlock(n.startContainer)))if(browser.ie){var s=n.document.createElement("span");n.insertNode(s).setStartBefore(s).collapse(!0),n.select(),domUtils.remove(s)}else n.select()}})},UM.plugins.autosave=function(){var n=this,i=new Date,r=20,o=null;n.setOpt("saveInterval",5e36);var s,a,l,c=UM.LocalStorage=(a=window.localStorage||((s=document.createElement("div")).style.display="none",s.addBehavior?(s.addBehavior("#default#userdata"),{getItem:function(t){var e=null;try{document.body.appendChild(s),s.load(l),e=s.getAttribute(t),document.body.removeChild(s)}catch(t){}return e},setItem:function(t,e){document.body.appendChild(s),s.setAttribute(t,e),s.save(l),document.body.removeChild(s)},removeItem:function(t){document.body.appendChild(s),s.removeAttribute(t),s.save(l),document.body.removeChild(s)}}):null)||null,l="localStorage",{saveLocalData:function(t,e){return!(!a||!e||(a.setItem(t,e),0))},getLocalData:function(t){return a?a.getItem(t):null},removeItem:function(t){a&&a.removeItem(t)}});function t(t){var e;new Date-i<r||(t.hasContents()?(i=new Date,t._saveFlag=null,e=n.body.innerHTML,!1!==t.fireEvent("beforeautosave",{content:e})&&(c.saveLocalData(o,e),t.fireEvent("afterautosave",{content:e}))):o&&c.removeItem(o))}n.addListener("ready",function(){var t="-drafts-data",e=null;e=n.key?n.key+t:(n.container.parentNode.id||"ue-common")+t,o=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+e}),n.addListener("contentchange",function(){o&&(n._saveFlag&&window.clearTimeout(n._saveFlag),0<n.options.saveInterval?n._saveFlag=window.setTimeout(function(){t(n)},n.options.saveInterval):t(n))}),n.commands.clearlocaldata={execCommand:function(t,e){o&&c.getLocalData(o)&&c.removeItem(o)},notNeedUndo:!0,ignoreContentChange:!0},n.commands.getlocaldata={execCommand:function(t,e){return o&&c.getLocalData(o)||""},notNeedUndo:!0,ignoreContentChange:!0},n.commands.drafts={execCommand:function(t,e){o&&(n.body.innerHTML=c.getLocalData(o)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",n.focus(!0))},queryCommandState:function(){return o?null===c.getLocalData(o)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){var me=this;me.setOpt("pasteImageEnabled",!0),me.setOpt("dropFileEnabled",!0);var sendAndInsertImage=function(file,editor){var fd=new FormData;fd.append(editor.options.imageFieldName||"upfile",file,file.name||"blob."+file.type.substr("image/".length)),fd.append("type","ajax");var xhr=new XMLHttpRequest;xhr.open("post",me.options.imageUrl,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(t){}}),xhr.send(fd)};function getPasteImage(t){return t.clipboardData&&t.clipboardData.items&&1==t.clipboardData.items.length&&/^image\//.test(t.clipboardData.items[0].type)?t.clipboardData.items:null}function getDropImage(t){return t.dataTransfer&&t.dataTransfer.files?t.dataTransfer.files:null}me.addListener("ready",function(){if(window.FormData&&window.FileReader){var t=function(t){var e,n=!1;if(e="paste"==t.type?getPasteImage(t.originalEvent):getDropImage(t.originalEvent)){for(var i,r=e.length;r--;)(i=e[r]).getAsFile&&(i=i.getAsFile()),i&&0<i.size&&/image\/\w+/i.test(i.type)&&(sendAndInsertImage(i,me),n=!0);if(n)return!1}};me.getOpt("pasteImageEnabled")&&me.$body.on("paste",t),me.getOpt("dropFileEnabled")&&me.$body.on("drop",t),me.$body.on("dragover",function(t){if("Files"==t.originalEvent.dataTransfer.types[0])return!1})}})},UM.plugins.formula=function(){var r=this;function i(){return r.$body.find("iframe.edui-formula-active")[0]||null}function c(){var t=i();t&&t.contentWindow.formula.blur()}r.addInputRule(function(t){$.each(t.getNodesByTagName("span"),function(t,e){if(e.hasClass("mathquill-embedded-latex")){for(var n,i="";n=e.firstChild();)i+=n.data,e.removeChild(n);e.tagName="iframe",e.setAttr({frameborder:"0",src:r.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":utils.unhtml(i)})}})}),r.addOutputRule(function(t){$.each(t.getNodesByTagName("iframe"),function(t,e){e.hasClass("mathquill-embedded-latex")&&(e.tagName="span",e.appendChild(UM.uNode.createText(e.getAttr("data-latex"))),e.setAttr({frameborder:"",src:"","data-latex":""}))})}),r.addListener("click",function(){c()}),r.addListener("afterexeccommand",function(t,e){if("formula"!=e&&c(),"fontsize"===e){var n,i,r=this.getContentTxt(),o=this.getContent(),s=/(?:font-size:\s*(\d+)px;)/g,a=this.selection.getText().split("").filter(function(t,e){return/[\w]/.test(t)}).join(""),l=function(t){return parseFloat(t.split(":")[1].replace("px;",""))};if(r===a){if(!(n=o.match(s))||1===n.length)return;i=l(n[0]),n.some(function(t,e){if(0<e)return i!==l(t)})&&(this.setContent(o.replace(s,function(t,e){return"font-size:"+i+"px;"})),this.execCommand("selectall"))}}}),r.commands.formula={execCommand:function(t,e){var n=i();n?n.contentWindow.formula.insertLatex(e):(r.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+e+"</span>"),browser.ie&&browser.ie9below&&setTimeout(function(){var t=r.selection.getRange(),e=t.startContainer;1!=e.nodeType||e.childNodes[t.startOffset]||(t.insertNode(r.document.createTextNode(" ")),t.setCursor())},100))},queryCommandState:function(t){return 0},queryCommandValue:function(t){var e=i();return e&&e.contentWindow.formula.getLatex()}}},UM.plugins.xssFilter=function(){var n,t=UMEDITOR_CONFIG,r=t.whiteList;function i(n){var i=n.tagName,t=n.attrs;if(!r.hasOwnProperty(i))return n.parentNode.removeChild(n),!1;UM.utils.each(t,function(t,e){-1===UM.utils.indexOf(r[i],e)&&n.setAttr(e)})}r&&t.xssFilterRules&&(this.options.filterRules=(n={},UM.utils.each(r,function(t,e){n[e]=function(t){return i(t)}}),n));var o=[];UM.utils.each(r,function(t,e){o.push(e)}),r&&t.inputXssFilter&&this.addInputRule(function(t){t.traversal(function(t){if("element"!==t.type)return!1;i(t)})}),r&&t.outputXssFilter&&this.addOutputRule(function(t){t.traversal(function(t){if("element"!==t.type)return!1;i(t)})})},function(l){l.parseTmpl=function(t,e){var n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(t,e){return"',obj."+e.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(t,e){return"');"+e.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",n);return e?i(e):i},l.extend2=function(t,e){for(var n=arguments,i="boolean"==l.type(n[n.length-1])&&n[n.length-1],r="boolean"==l.type(n[n.length-1])?n.length-1:n.length,o=1;o<r;o++){var s=n[o];for(var a in s)i&&t.hasOwnProperty(a)||(t[a]=s[a])}return t},l.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);var r=[],s=function(){},c="edui";s.prototype={on:function(t,e){return this.root().on(t,l.proxy(e,this)),this},off:function(t,e){return this.root().off(t,l.proxy(e,this)),this},trigger:function(t,e){return!1!==this.root().trigger(t,e)&&this},root:function(t){return this._$el||(this._$el=t)},destroy:function(){},data:function(t,e){return void 0!==e?(this.root().data(c+t,e),this):this.root().data(c+t)},register:function(t,e,n){r.push({evtname:t,$els:l.isArray(e)?e:[e],handler:l.proxy(n,e)})}},l.fn.edui=function(t){return t?this.data("eduiwidget",t):this.data("eduiwidget")};var u=1;UM.ui={define:function(r,t,e){var a,n,o=UM.ui[r]=function(t,e,n){if(t.prototype=l.extend2(l.extend({},e),(UM.ui[n]||s).prototype,!0),t.prototype.supper=(UM.ui[n]||s).prototype,UM.ui[n]&&UM.ui[n].prototype.defaultOpt){var i=UM.ui[n].prototype.defaultOpt,r=t.prototype.defaultOpt;t.prototype.defaultOpt=l.extend({},i,r||{})}return t}(function(t,e){var n=function(){};l.extend(n.prototype,o.prototype,{guid:r+u++,widgetName:r});var i=new n;if("string"==l.type(t))return i.init&&i.init({}),i.root().edui(i),i.root().find("a").click(function(t){t.preventDefault()}),i.root()[c+r].apply(i.root(),arguments);e&&i.root(e),i.init&&i.init(!t||l.isPlainObject(t)?l.extend2(t||{},i.defaultOpt||{},!0):t);try{i.root().find("a").click(function(t){t.preventDefault()})}catch(t){}return i.root().edui(i)},t,e);a=o,l[c+(n=r)]=a,l.fn[c+n]=function(r){var o,s=Array.prototype.slice.call(arguments,1);return this.each(function(t,e){var n=l(e),i=n.edui();if(i||(a(r&&l.isPlainObject(r)?r:{},n),n.edui(i)),"string"==l.type(r))if("this"==r)o=i;else{if((o=i[r].apply(i,s))!==i&&void 0!==o)return!1;o=null}}),null!==o?o:this}}},l(function(){l(document).on("click mouseup mousedown dblclick mouseover",function(i){l.each(r,function(t,n){n.evtname==i.type&&l.each(n.$els,function(t,e){e[0]===i.target||l.contains(e[0],i.target)||n.handler(i)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if : !${texttype}%>div class="edui-btn edui-btn-${icon} <%if : ${name}%>edui-btn-name-${name}<%/if%>" unselectable="on" onmousedown="return false" <%else%>a class="edui-text-btn"<%/if%><% if: ${title} %> data-original-title="${title}" <%/if%>> <% if: ${icon} %><div unselectable="on" class="edui-icon-${icon} edui-icon"></div><%/if%><%if: ${text} %><span unselectable="on" onmousedown="return false" class="edui-button-label">${text}</span><%/if%><%if: ${caret} && ${text}%><span class="edui-button-spacing"></span><%/if%><% if: ${caret} %><span unselectable="on" onmousedown="return false" class="edui-caret"></span><%/if%></<%if: !${texttype}%>div<%else%>a<%/if%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(e){var n=this;return n.root($(UM.utils.render(n.tpl,e))).click(function(t){n.wrapclick(e.click,t)}),n.root().hover(function(){n.root().hasClass("edui-disabled")||n.root().toggleClass("edui-hover")}),n},wrapclick:function(t,e){return this.disabled()||(this.root().trigger("wrapclick"),$.proxy(t,this,e)()),this},label:function(t){return void 0===t?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(t),this)},disabled:function(t){return void 0===t?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",t),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(t){return void 0===t?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",t),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.on("click",function(){t.wrapclick(function(){e.edui().show()})}).register("click",t.root(),function(t){e.hide()})}}),UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var t=this.root($(this.tpl));this.data("$btnToolbar",t.find(".edui-btn-toolbar"))},appendToBtnmenu:function(t){var n=this.data("$btnToolbar");t=$.isArray(t)?t:[t],$.each(t,function(t,e){n.append(e)})}}),UM.ui.define("menu",{show:function(t,e,n,i,r){n=n||"position",!1!==this.trigger("beforeshow")&&(this.root().css($.extend({display:"block"},t?{top:t[n]().top+("right"==e?0:t.outerHeight())-(i||0),left:t[n]().left+("right"==e?t.outerWidth():0)-(r||0)}:{})),this.trigger("aftershow"))},hide:function(t){var e;!1!==this.trigger("beforehide")&&((e=this.root().data("parentmenu"))&&(e.data("parentmenu")||t)&&e.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(t){var e=this;t.data("$mergeObj")||(t.data("$mergeObj",e.root()),t.on("wrapclick",function(t){e.show()}),e.register("click",t,function(t){e.hide()}),e.data("$mergeObj",t))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for: ${data} as ${ci}%><%if: ${ci.divider}%><li class="edui-divider"></li><%else%><li class="${ci.active} || ${ci.disabled}" data-value="${ci.value}"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em>${ci.label}</a></li><%/if%><%/for%></ul>',defaultOpt:{data:[],click:function(){}},init:function(e){var o=this,s={click:1,mouseover:1,mouseout:1};this.root($(UM.utils.render(this.tmpl,e))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(t){$.proxy(e.click,o,t,$(this).data("value"),$(this))()}).find("li").each(function(t,n){var i=$(this);if(!i.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var r=e.data[t];$.each(s,function(e){r[e]&&i[e](function(t){$.proxy(r[e],n)(t,r,o.root)})})}})},disabled:function(e){$("li[class!=edui-divider]",this.root()).each(function(){var t=$(this);!0===e?t.addClass("edui-disabled"):$.isFunction(e)?t.toggleClass("edui-disabled",e(li)):t.removeClass("edui-disabled")})},val:function(e){var n;if($('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var t=$(this);if(void 0===e){if(t.find("em.edui-dropmenu-checked").length)return n=t.data("value"),!1}else t.find("em").toggleClass("edui-dropmenu-checked",t.data("value")==e)}),void 0===e)return n},addSubmenu:function(t,e,n){n=n||0;var i=$("li[class!=edui-divider]",this.root()),r=$('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+t+"</a></li>").append(e);0<=n&&n<i.length?r.insertBefore(i[n]):n<0?r.insertBefore(i[0]):n>=i.length&&r.appendTo(i)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if: ${name}%>edui-splitbutton-${name}<%/if%>"  unselectable="on" <%if: ${title}%>data-original-title="${title}"<%/if%>><div class="edui-btn"  unselectable="on" ><%if: ${icon}%><div  unselectable="on" class="edui-icon-${icon} edui-icon"></div><%/if%><%if: ${text}%>${text}<%/if%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(e){var n=this;return n.root($(UM.utils.render(n.tpl,e))),n.root().find(".edui-btn:first").click(function(t){n.disabled()||$.proxy(e.click,n)()}),n.root().find(".edui-dropdown-toggle").click(function(){n.disabled()||n.trigger("arrowclick")}),n.root().hover(function(){n.root().hasClass("edui-disabled")||n.root().toggleClass("edui-hover")}),n},wrapclick:function(t,e){return this.disabled()||$.proxy(t,this,e)(),this},disabled:function(t){return void 0===t?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",t).find(".edui-btn").toggleClass("edui-disabled",t),this)},active:function(t){return void 0===t?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",t).find(".edui-btn:first").toggleClass("edui-active",t),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){e.edui().show()})}),t.register("click",t.root().find(".edui-dropdown-toggle"),function(t){e.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if : ${name}%>edui-splitbutton-${name}<%/if%>"  unselectable="on" <%if: ${title}%>data-original-title="${title}"<%/if%>><div class="edui-btn"  unselectable="on" ><%if: ${icon}%><div unselectable="on" class="edui-icon-${icon} edui-icon"></div><%/if%><div class="edui-splitbutton-color-label" <%if: ${color}%>style="background: ${color}"<%/if%>></div><%if: ${text}%>${text}<%/if%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(t){this.supper.init.call(this,t)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if:!${stopprop}%>onmousedown="return false"<%/if%>><div class="edui-popup-body" unselectable="on" onmousedown="return false">${subtpl|raw}</div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(t){return this.root($(UM.utils.render(this.tpl,t))),this},mergeTpl:function(t){return UM.utils.render(this.tpl,{subtpl:t})},show:function(t,e){e||(e={});var n=e.fnname||"position";!1!==this.trigger("beforeshow")&&(this.root().css($.extend({display:"block"},t?{top:t[n]().top+("right"==e.dir?0:t.outerHeight())-(e.offsetTop||0),left:t[n]().left+("right"==e.dir?t.outerWidth():0)-(e.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:e.caretTop||0,left:e.caretLeft||0,position:"absolute"}).addClass(e.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e,n){var i=this;e.data("$mergeObj")||(e.data("$mergeObj",i.root()),e.on("wrapclick",function(t){i.show(e,n)}),i.register("click",e,function(t){i.hide()}),i.data("$mergeObj",e))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(t){return t.$doc&&(this.defaultOpt.$doc=t.$doc),t.$wrap&&(this.defaultOpt.$wrap=t.$wrap),this.root($(UM.utils.render(this.tpl,t))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){utils.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(t){var e=this,n=e.defaultOpt.$doc;switch(t.type){case"mousedown":var i;-1!=(i=t.target||t.srcElement).className.indexOf("edui-scale-hand")&&(e.dragId=i.className.slice(-1),e.startPos.x=e.prePos.x=t.clientX,e.startPos.y=e.prePos.y=t.clientY,n.bind("mousemove",$.proxy(e._eventHandler,e)));break;case"mousemove":-1!=e.dragId&&(e.updateContainerStyle(e.dragId,{x:t.clientX-e.prePos.x,y:t.clientY-e.prePos.y}),e.prePos.x=t.clientX,e.prePos.y=t.clientY,e.updateTargetElement());break;case"mouseup":if(-1!=e.dragId)e.dragId=-1,e.updateTargetElement(),e.data("$scaleTarget").parent()&&e.attachTo(e.data("$scaleTarget"));n.unbind("mousemove",$.proxy(e._eventHandler,e))}},updateTargetElement:function(){var t=this.root(),e=this.data("$scaleTarget");e.css({width:t.width(),height:t.height()}),this.attachTo(e)},updateContainerStyle:function(t,e){var n,i=this.root(),r=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=r[t][0]&&(n=parseInt(i.offset().left)+e.x,i.css("left",this._validScaledProp("left",n))),0!=r[t][1]&&(n=parseInt(i.offset().top)+e.y,i.css("top",this._validScaledProp("top",n))),0!=r[t][2]&&(n=i.width()+r[t][2]*e.x,i.css("width",this._validScaledProp("width",n))),0!=r[t][3]&&(n=i.height()+r[t][3]*e.y,i.css("height",this._validScaledProp("height",n)))},_validScaledProp:function(t,i){var e=this.root(),n=this.defaultOpt.$doc,r=function(t,e,n){return n<t+e?n-e:i};switch(i=isNaN(i)?0:i,t){case"left":return i<0?0:r(i,e.width(),n.width());case"top":return i<0?0:r(i,e.height(),n.height());case"width":return i<=0?1:r(i,e.offset().left,n.width());case"height":return i<=0?1:r(i,e.offset().top,n.height())}},show:function(t){t&&this.attachTo(t),this.root().bind("mousedown",$.proxy(this._eventHandler,this)),this.defaultOpt.$doc.bind("mouseup",$.proxy(this._eventHandler,this)),this.root().show(),this.trigger("aftershow")},hide:function(){this.root().unbind("mousedown",$.proxy(this._eventHandler,this)),this.defaultOpt.$doc.unbind("mouseup",$.proxy(this._eventHandler,this)),this.root().hide(),this.trigger("afterhide")},attachTo:function(t){var e=t.offset(),n=this.root(),i=this.defaultOpt.$wrap,r=i.offset();this.data("$scaleTarget",t),this.root().css({position:"absolute",width:t.width(),height:t.height(),left:e.left-r.left-parseInt(i.css("border-left-width"))-parseInt(n.css("border-left-width")),top:e.top-r.top-parseInt(i.css("border-top-width"))-parseInt(n.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(t){for(var e="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),n='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if : ${name}%> edui-colorpicker-${name}<%/if%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+t.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >',i=0;i<e.length;i++)i&&i%10==0&&(n+="</tr>"+(60==i?'<tr><td colspan="10">'+t.lang_standardColor+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-firstrow"':"")+">"),n+=i<70?'<td><a unselectable="on" onmousedown="return false" title="'+e[i]+'" class="edui-colorpicker-colorcell" data-color="#'+e[i]+'" style="background-color:#'+e[i]+";border:solid #ccc;"+(i<10||60<=i?"border-width:1px;":10<=i&&i<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return n+="</tr></table></div>"},init:function(t){var e=this;e.root($(UM.utils.render(e.supper.mergeTpl(e.tpl(t)),t))),e.root().on("click",function(t){e.trigger("pickcolor",$(t.target).data("color"))})}},"popup"),Mvb="edui-combobox-item",Pvb="edui-combobox-item-label",UM.ui.define("combobox",{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if: ${comboboxName} !==\'\'%> edui-combobox-${comboboxName}<%/if%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if: ${autoRecord} %><%for : ${recordStack} as ${recordItem}, ${index}%><%var : style = ${itemStyles}[${recordItem}]%><%var : record = ${items}[${recordItem}]%><li class="${itemClassName}<%if: ${selected} == ${recordItem}%> edui-combobox-checked<%/if%>" data-item-index="${recordItem}" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="${labelClassName}" style="${style}" unselectable="on" onmousedown="return false">${record}</label></li><%/for%><%if: ${index} %><li class="edui-combobox-item-separator"></li><%/if%><%/if%><%for: ${items} as ${item}, ${itemIndex}%><%var : labelStyle = ${itemStyles}[${itemIndex}]%><li class="${itemClassName}<%if: ${selected} == ${item} %> edui-combobox-checked<%/if%> edui-combobox-item-${itemIndex}" data-item-index="${itemIndex}" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="${labelClassName}" style="${labelStyle}" unselectable="on" onmousedown="return false">${item}</label></li><%/for%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(t){$.extend(this._optionAdaptation(t),this._createItemMapping(t.recordStack,t.items),{itemClassName:Mvb,iconClass:"edui-combobox-checked-icon",labelClassName:Pvb}),this._transStack(t),this.root($(UM.utils.render(this.tpl,t))),this.data("options",t).initEvent()},initEvent:function(){this.initSelectItem(),this.initItemActive()},initSelectItem:function(){var n=this;n.root().delegate("."+Mvb,"click",function(){var t=$(this),e=t.attr("data-item-index");return n.trigger("comboboxselect",{index:e,label:t.find(".edui-combobox-item-label").text(),value:n.data("options").value[e]}).select(e),n.hide(),!1})},initItemActive:function(){var e={mouseenter:"addClass",mouseleave:"removeClass"};$.IE6&&this.root().delegate("."+Mvb,"mouseenter mouseleave",function(t){$(this)[e[t.type]]("edui-combobox-item-hover")}).one("afterhide",function(){})},select:function(t){var e=this.data("options").itemCount,n=this.data("options").autowidthitem;return n&&!n.length&&(n=this.data("options").items),0==e||(t<0?t=e+t%e:e<=t&&(t=e-1),this.trigger("changebefore",n[t]),this._update(t),this.trigger("changeafter",n[t])),null},selectItemByLabel:function(t){var n=this.data("options").itemMapping,i=this,r=null;!$.isArray(t)&&(t=[t]),$.each(t,function(t,e){if(void 0!==(r=n[e]))return i.select(r),!1})},_transStack:function(n){var i=[],r=-1,o=-1;$.each(n.recordStack,function(t,e){r=n.itemMapping[e],$.isNumeric(r)&&(i.push(r),e==n.selected&&(o=r))}),n.recordStack=i,n.selected=o,i=null},_optionAdaptation:function(t){if(!("itemStyles"in t)){t.itemStyles=[];for(var e=0,n=t.items.length;e<n;e++)t.itemStyles.push("")}return t.autowidthitem=t.autowidthitem||t.items,t.itemCount=t.items.length,t},_createItemMapping:function(t,e){var n={},i={recordStack:[],mapping:{}};return $.each(e,function(t,e){n[e]=t}),i.itemMapping=n,$.each(t,function(t,e){void 0!==n[e]&&(i.recordStack.push(n[e]),i.mapping[e]=n[e])}),i},_update:function(n){var t=this.data("options"),i=[],e=null;$.each(t.recordStack,function(t,e){e!=n&&i.push(+e)}),i.unshift(+n),i.length>t.recordCount&&(i.length=t.recordCount),t.recordStack=i,t.selected=+n,e=$(UM.utils.render(this.tpl,t)),this.root().html(e.html()),i=e=null}},"menu"),UM.ui.define("buttoncombobox",{defaultOpt:{label:"",title:""},init:function(t){var e=this,n=$.eduibutton({caret:!0,name:t.comboboxName,title:t.title,text:t.label,click:function(){e.show(this.root())}});e.supper.init.call(e,t),e.on("changebefore",function(t,e){n.eduibutton("label",e)}),e.data("button",n),e.attachTo(n)},button:function(){return this.data("button")}},"combobox"),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title">${title}</h3></div><div class="edui-modal-body"  style="<%if: ${width}%>width:${width}px;<%/if%><%if: ${height}%>height:${height}px;<%/if%>"> </div><% if: ${cancellabel} || ${oklabel} %><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if: ${oklabel}%><div class="edui-btn edui-btn-primary" data-ok="modal">${oklabel}</div><%/if%><%if: ${cancellabel}%><div class="edui-btn" data-hide="modal">${cancellabel}</div><%/if%></div><%/if%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(t){var e=this;e.root($(UM.utils.render(e.tpl,t||{}))),e.data("options",t),t.okFn&&e.on("ok",$.proxy(t.okFn,e)),t.cancelFn&&e.on("beforehide",$.proxy(t.cancelFn,e)),e.root().delegate('[data-hide="modal"]',"click",$.proxy(e.hide,e)).delegate('[data-ok="modal"]',"click",$.proxy(e.ok,e)),$('[data-hide="modal"],[data-ok="modal"]',e.root()).hover(function(){$(this).toggleClass("edui-hover")})},toggle:function(){return this[this.data("isShown")?"hide":"show"]()},show:function(){var t=this;t.trigger("beforeshow"),t.data("isShown")||(t.data("isShown",!0),t.escape(),t.backdrop(function(){t.autoCenter(),t.root().show().focus().trigger("aftershow")}))},showTip:function(t){$(".edui-modal-tip",this.root()).html(t).fadeIn()},hideTip:function(t){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){!$.IE6&&this.root().css("margin-left",-this.root().width()/2)},hide:function(){this.trigger("beforehide"),this.data("isShown")&&(this.data("isShown",!1),this.escape(),this.hideModal())},escape:function(){var e=this;e.data("isShown")&&e.data("options").keyboard?e.root().on("keyup",function(t){27==t.which&&e.hide()}):e.data("isShown")||e.root().off("keyup")},hideModal:function(){var t=this;t.root().hide(),t.backdrop(function(){t.removeBackdrop(),t.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){this.data("isShown")&&this.data("options").backdrop&&(this.$backdrop=$('<div class="edui-modal-backdrop" />').click("static"==this.data("options").backdrop?$.proxy(this.root()[0].focus,this.root()[0]):$.proxy(this.hide,this))),this.trigger("afterbackdrop"),t&&t()},attachTo:function(t){var e=this;t.data("$mergeObj")||(t.data("$mergeObj",e.root()),t.on("click",function(){e.toggle(t)}),e.data("$mergeObj",t))},ok:function(){this.trigger("beforeok"),!1!==this.trigger("ok",this)&&this.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(t){this.root($(UM.utils.render(this.tpl,t||{})))},content:function(t){var e=$(t.currentTarget).attr("data-original-title");this.root().find(".edui-tooltip-inner").text(e)},position:function(t){var e=$(t.currentTarget);this.root().css($.extend({display:"block"},e?{top:e.outerHeight(),left:(e.outerWidth()-this.root().outerWidth())/2}:{}))},show:function(t){if(!$(t.currentTarget).hasClass("edui-disabled")){this.content(t),this.root().appendTo($(t.currentTarget)),this.position(t),this.root().css("display","block")}},hide:function(){this.root().css("display","none")},attachTo:function(t){var n=this;function i(t){var e=this;$.contains(document.body,e.root()[0])||e.root().appendTo(t),e.data("tooltip",e.root()),t.each(function(){$(this).attr("data-original-title")&&$(this).on("mouseenter",$.proxy(e.show,e)).on("mouseleave click",$.proxy(e.hide,e))})}"undefined"===$.type(t)?$("[data-original-title]").each(function(t,e){i.call(n,$(e))}):t.data("tooltip")||i.call(n,t)}}),UM.ui.define("tab",{init:function(t){var e=this,n=t.selector;$.type(n)&&(e.root($(n,t.context)),e.data("context",t.context),$(n,e.data("context")).on("click",function(t){e.show(t)}))},show:function(t){var e,n,i,r=this,o=$(t.target),s=o.closest("ul");e=(e=o.attr("data-context"))&&e.replace(/.*(?=#[^\s]*$)/,"");var a=o.parent("li");a.length&&!a.hasClass("edui-active")&&(n=s.find(".edui-active:last a")[0],t=$.Event("beforeshow",{target:o[0],relatedTarget:n}),r.trigger(t),t.isDefaultPrevented()||(i=$(e,r.data("context")),r.activate(o.parent("li"),s),r.activate(i,i.parent(),function(){r.trigger({type:"aftershow",relatedTarget:n})})))},activate:function(t,e,n){if(void 0===t)return $(".edui-tab-item.edui-active",this.root()).index();e.find("> .edui-active").removeClass("edui-active"),t.addClass("edui-active"),n&&n()}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(t){return this.root($($.parseTmpl(this.tpl,t))),this}}),Gxb=UM,Hxb={},Ixb={},Jxb=[],Lxb={},Mxb={},Nxb={},Oxb=null,utils.extend(Gxb,{defaultWidth:100,defaultHeight:18,registerUI:function(t,e){utils.each(t.split(/\s+/),function(t){Hxb[t]=e})},setEditor:function(t){!Ixb[t.id]&&(Ixb[t.id]=t)},registerWidget:function(t,e,n){Lxb[t]=$.extend2(e,{$root:"",_preventDefault:!1,root:function(t){return this.$root||(this.$root=t)},preventDefault:function(){this._preventDefault=!0},clear:!1}),n&&(Mxb[t]=n)},getWidgetData:function(t){return Lxb[t]},setWidgetBody:function(t,n,e){e._widgetData||utils.extend(e,{_widgetData:{},getWidgetData:function(t){return this._widgetData[t]},getWidgetCallback:function(t){var e=this;return function(){return Mxb[t].apply(e,[e,n].concat(Array.prototype.slice.call(arguments,0)))}}});var i=Lxb[t];if(!i)return null;(i=e._widgetData[t])||(i=Lxb[t],i=e._widgetData[t]="function"==$.type(i)?i:utils.clone(i)),i.root(n.edui().getBodyContainer()),i.initContent(e,n),i._preventDefault||i.initEvent(e,n),i.width&&n.width(i.width)},setActiveWidget:function(t){},getEditor:function(t,e){var n=Ixb[t]||(Ixb[t]=this.createEditor(t,e));return Oxb=Oxb?Math.max(n.getOpt("zIndex"),Oxb):n.getOpt("zIndex"),n.body.focus(),window.textInput=n},buildText:function(n){return function(t,e){return n.getEditor(t,e)}},setTopEditor:function(n){$.each(Ixb,function(t,e){n==e?n.$container&&n.$container.css("zIndex",Oxb+1):e.$container&&e.$container.css("zIndex",e.getOpt("zIndex"))})},clearCache:function(t){Ixb[t]&&delete Ixb[t]},delEditor:function(t){var e;(e=Ixb[t])&&e.destroy()},ready:function(t){Jxb.push(t)},createEditor:function(n,i){var r=new Gxb.Editor(i);function t(){var t=this.createUI("#"+n,r,i);r.key=n,r.ready(function(){$.each(Jxb,function(t,e){$.proxy(e,r)()})});var e=r.options;e.initialFrameWidth?e.minFrameWidth=e.initialFrameWidth:e.minFrameWidth=e.initialFrameWidth=r.$body.width()||Gxb.defaultWidth,t.css({width:e.initialFrameWidth,zIndex:r.getOpt("zIndex")}),Gxb.browser.ie&&6===Gxb.browser.version&&document.execCommand("BackgroundImageCache",!1,!0),r.render(n),$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",t)).css("z-index",r.getOpt("zIndex")+1),t.find("a").click(function(t){t.preventDefault()}),r.fireEvent("afteruiready")}return r.langIsReady?$.proxy(t,this)():r.addListener("langReady",$.proxy(t,this)),r},createUI:function(t,i,e){var n,r=$(t);n=$('<div class="textfield-container autowidth"><div class="textfield-editor-body"></div><div data-full="x" data-cursor="w-resize" class="textfield-drag" data-name="textfield-drag"><span class="textfield-drag-point"></span></div></div>').insertBefore(r);var o=e.point.y;1<(s=$("#zoomIn-container").attr("data-float")||1)&&(o-=(14*s-14)/2),e.point&&n.css({left:e.point.x,top:o}),i.$container=n,i.container=n[0],i.$body=r,browser.ie&&browser.ie9above&&$('<span style="padding:0;margin:0;height:0;width:0"></span>').insertAfter(n),$.each(Hxb,function(t,e){var n=e.call(i,t);n&&(Nxb[t]=n)}),n.find(".textfield-editor-body").append(r);var s=$("#zoomIn-container").attr("data-float")||1;return n.find(t).css("font-size",14*s),n},createToolbar:function(t,e){var n=$.eduitoolbar(),i=n.edui();if(t.toolbar&&t.toolbar.length){var r=[];$.each(t.toolbar,function(t,e){$.each(e.split(/\s+/),function(t,e){if("|"==e)$.eduiseparator&&r.push($.eduiseparator());else{var n=Nxb[e];"fullscreen"==e?n&&r.unshift(n):n&&r.push(n)}}),r.length&&i.appendToBtnmenu(r)})}else n.find(".edui-btn-toolbar").remove();return n}}),window.buildText=Gxb.buildText(Gxb),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(e){var t=this,n=$.eduibutton({icon:e,click:function(){t.execCommand(e)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),function(){var o={},s=["width","height","position","top","left","margin","padding","overflowX","overflowY"],e={},n={},i={},r={};function a(t){var e=this;if(!t)throw new Error("invalid params, notfound editor");e.editor=t,r[t.uid]=this,t.addListener("destroy",function(){delete r[t.uid],e.editor=null})}UM.registerUI("fullscreen",function(e){var t=this,n=$.eduibutton({icon:"fullscreen",title:t.options.labelMap&&t.options.labelMap[e]||t.getLang("labelMap."+e),click:function(){t.execCommand(e),UM.setTopEditor(t)}});return t.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),t.addListener("ready",function(){t.options.fullscreen&&a.getInstance(t).toggle()}),n}),UM.commands.fullscreen={execCommand:function(t){a.getInstance(this).toggle()},queryCommandState:function(t){return this._edui_fullscreen_status},notNeedUndo:1},a.prototype={toggle:function(){var t=this.editor,e=this.isFullState();t.fireEvent("beforefullscreenchange",!e),this.update(!e),e?this.revert():this.enlarge(),t.fireEvent("afterfullscreenchange",!e),"true"===t.body.contentEditable&&t.fireEvent("fullscreenchanged",!e),t.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var t=this.editor.options,e=/%$/.test(t.initialFrameHeight)?"100%":t.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(t){this.editor._edui_fullscreen_status=t},resize:function(){var t,e,n,i=null,r=0,o=0,s=this.editor,a=null;this.isFullState()&&(e=(i=$(window)).width(),t=i.height(),a=this.getEditorHolder(),r=parseInt(domUtils.getComputedStyle(a,"border-width"),10)||0,r+=parseInt(domUtils.getComputedStyle(s.container,"border-width"),10)||0,o+=parseInt(domUtils.getComputedStyle(a,"padding-left"),10)+parseInt(domUtils.getComputedStyle(a,"padding-right"),10)||0,$.IE6&&a.style.setExpression("height",null),n=this.getBound(),$(s.container).css({width:e+"px",height:t+"px",position:$.IE6?"absolute":"fixed",top:n.top,left:n.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),$(a).css({width:e-2*r-o+"px",height:t-2*r-(s.options.withoutToolbar?0:$(".edui-toolbar",s.container).outerHeight())-$(".edui-bottombar",s.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var t=this.editor.container.style,e=null,n={},i=0,r=s.length;i<r;i++)n[e=s[i]]=t[e];o[this.editor.uid]=n,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var t=$(this.getEditorHolder());e[this.editor.uid]={width:t.css("width"),overflowX:t.css("overflowX"),overflowY:t.css("overflowY"),height:t.css("height")}},saveDocumentStatus:function(){var t=$(this.getEditorDocumentBody());n[this.editor.uid]={overflowX:t.css("overflowX"),overflowY:t.css("overflowY")},i[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var t=this.getEditorHolder(),e=this.getContentAreaStatus();this.supportMin()&&(delete e.height,t.style.height=null),$(t).css(e)},revertDocumentStatus:function(){var t=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",t.body.overflowX),$(this.getEditorDocumentElement()).css("overflowY",t.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return o[this.editor.uid]},getContentAreaStatus:function(){return e[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:n[this.editor.uid],html:i[this.editor.uid]}},supportMin:function(){var t=null;return this._support||(t=document.createElement("div"),this._support="minWidth"in t.style,t=null),this._support},getBound:function(){var t={html:!0,body:!0},e={top:0,left:0},n=null;return $.IE6&&(n=this.editor.container.offsetParent)&&!t[n.nodeName.toLowerCase()]&&(t=n.getBoundingClientRect(),e.top=-t.top,e.left=-t.left),e},getStyleValue:function(t){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),t))}},$.extend(a,{listen:function(){var e=null;a._hasFullscreenListener||(a._hasFullscreenListener=!0,$(window).on("resize",function(){null!==e&&(window.clearTimeout(e),e=null),e=window.setTimeout(function(){for(var t in r)r[t].resize();e=null},50)}))},getInstance:function(t){return r[t.uid]||new a(t),r[t.uid]}}),a.listen()}(),UM.registerUI("link image video map formula",function(e){this.options.labelMap&&this.options.labelMap[e]||this.getLang("labelMap."+e),this.options.UMEDITOR_HOME_URL;var n=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),UM.registerUI("autofloat",function(){var h=this,d=h.getLang();h.setOpt({autoFloatEnabled:!1,topOffset:0});var t=!1!==h.options.autoFloatEnabled,f=h.options.topOffset;t&&h.ready(function(){var i=browser.ie&&browser.version<=6,r=browser.quirks;var t,o,s,a=document.createElement("div"),l=!1;function n(){a.parentNode&&a.parentNode.removeChild(a),o.style.cssText=t}function c(){var t=function(t){var e;try{e=t.getBoundingClientRect()}catch(t){e={left:0,top:0,height:0,width:0}}for(var n,i={left:Math.round(e.left),top:Math.round(e.top),height:Math.round(e.bottom-e.top),width:Math.round(e.right-e.left)};(n=t.ownerDocument)!==document&&(t=domUtils.getWindow(n).frameElement);)e=t.getBoundingClientRect(),i.left+=e.left,i.top+=e.top;return i.bottom=i.top+i.height,i.right=i.left+i.width,i}(h.container),e=h.options.toolbarTopOffset||0;t.top<0&&t.bottom-o.offsetHeight>e?function(){if(!l){var t=domUtils.getXY(o),e=domUtils.getComputedStyle(o,"position"),n=domUtils.getComputedStyle(o,"left");o.style.width=o.offsetWidth+"px",o.style.zIndex=1*h.options.zIndex+1,o.parentNode.insertBefore(a,o),i||r&&browser.ie?("absolute"!=o.style.position&&(o.style.position="absolute"),o.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-s+f+"px"):"fixed"!=o.style.position&&(o.style.position="fixed",o.style.top=f+"px",("absolute"==e||"relative"==e)&&parseFloat(n)&&(o.style.left=t.x+"px"))}}():n()}var e,u=utils.defer(function(){c()},browser.ie?200:100,!0);h.addListener("destroy",function(){$(window).off("scroll resize",c),h.removeListener("keydown",u)}),(UM.ui||(alert(d.autofloatMsg),0))&&(o=$(".edui-toolbar",h.container)[0],h.addListener("afteruiready",function(){setTimeout(function(){s=$(o).offset().top},100)}),t=o.style.cssText,a.style.height=o.offsetHeight+"px",i&&((e=document.body.style).backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"),$(window).on("scroll resize",c),h.addListener("keydown",u),h.addListener("resize",function(){n(),a.style.height=o.offsetHeight+"px",c()}),h.addListener("beforefullscreenchange",function(t,e){e&&(n(),l=e)}),h.addListener("fullscreenchanged",function(t,e){e||c(),l=e}),h.addListener("sourcemodechanged",function(t,e){setTimeout(function(){c()},0)}),h.addListener("clearDoc",function(){setTimeout(function(){c()},0)}))})}),UM.registerUI("source",function(e){var t=this;t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())});var n=$.eduibutton({icon:e,click:function(){t.execCommand(e),UM.setTopEditor(t)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),UM.registerUI("paragraph fontfamily fontsize",function(i){var n=this,t=n.options.labelMap&&n.options.labelMap[i]||n.getLang("labelMap."+i),e={label:t,title:t,comboboxName:i,items:n.options[i]||[],itemStyles:[],value:[],autowidthitem:[]},r=null,o=null;if(0==e.items.length)return null;switch(i){case"paragraph":e=function(t){var e=[];for(var n in t.items)t.value.push(n),e.push(n),t.autowidthitem.push(s(n));return t.items=e,t.autoRecord=!1,t}(e);break;case"fontfamily":e=function(t){for(var e=null,n=[],i=0,r=t.items.length;i<r;i++)e=t.items[i].val,n.push(e.split(/\s*,\s*/)[0]),t.itemStyles.push("font-family: "+e),t.value.push(e),t.autowidthitem.push(s(n[i]));return t.items=n,t}(e);break;case"fontsize":e=function(t){var e=null,n=[];t.itemStyles=[],t.value=[];for(var i=0,r=t.items.length;i<r;i++)e=t.items[i],n.push(e),t.itemStyles.push("font-size: "+e+"px");return t.value=t.items,t.items=n,t.autoRecord=!1,t}(e)}return!n.selectBox&&(n.selectBox={}),r=$.eduibuttoncombobox(e).css("zIndex",n.getOpt("zIndex")+1),o=r.edui(),(n.selectBox[i]=o).on("comboboxselect",function(t,e){n.execCommand(i,e.value)}).on("beforeshow",function(){0===r.parent().length&&r.appendTo(n.$container.find(".edui-dialog-container")),UM.setTopEditor(n)}),this.addListener("selectionchange",function(t){var e=this.queryCommandState(i),n=this.queryCommandValue(i);o.button().edui().disabled(-1==e).active(1==e),n&&(n=n.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),o.selectItemByLabel(n))}),o.button().addClass("edui-combobox");function s(t,e){var n=$("<span>").html(t).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),i=n.width();return n.remove(),n=null,i<50?t:(t=t.slice(0,e?-4:-1)).length?s(t+"...",!0):"..."}}),UM.plugins.ch2=function(){var A=this;A.addListener("keydown",function(t,e){if(A.queryCommandState("ch2")&&16!==e.keyCode&&20!==e.keyCode&&A.hasContents()&&/[a-zA-Z]/g.test(A.getPlainTxt())){var n=A.queryCommandState("subscript"),i=A.queryCommandState("superscript"),r=/^\d$/.test(String.fromCharCode(e.keyCode));e.key,String.fromCharCode(e.keyCode);r&&!e.shiftKey?n||A.execCommand("subscript"):n&&A.execCommand("subscript"),13===e.which&&(n&&A.execCommand("subscript"),i&&A.execCommand("superscript"))}}),A.commands.ch2={execCommand:function(t,e){var n;if(textInput.hasContents()){void 0===A.ch2&&(A.ch2=!1);var i,r=textInput.selection.getText().split("").filter(function(t,e){return/[\w\+\=\-\_\?\~\`\/\)\(\*\&\^\%\$\#\@\!\{\}\[\]\;\'\:\"\<\,\>\.\?\/\s]/.test(t)}).join(""),o=A.getContentTxt(),s=A.getContent();if(s=s.replace(/&#39;/g,"'"),window.indraw&&("select"===window.indraw.tool.type?i=textInput.getContent().match(/<\/?su[bp]\s*(style=(['"])([a-z0-0\s;]*)\2)?>/g):"textfield"===window.indraw.tool.type&&(i=A.ch2)),r===o)if(i)n=textInput.getContent().replace(/<\/?su[bp]\s*(style=(['"])([a-z0-0\s;]*)\2)?>/g,""),A.setContent(n),A.mark("selectall");else{var a=s.replace(/\<\/?sup\>/g,"").replace(/(?!sub)\>([^<>]+)\<(?!\/sub)/g,function(t,e){return">"+e.replace(/([\d]+)/g,function(t,e){return"<sub>"+e+"</sub>"})+"<"});A.setContent(a),A.mark("selectall")}else if(r.match(/\d/))if(i)A.selection._bakRange.removeInlineStyle("sub");else{for(var l=A.selection._bakRange.cloneContents(),c=!1,u=0;u<$(A.getContent()).length;u++)textInput.selection.getText()==$(A.getContent())[u].childNodes[0].childNodes[0].nodeValue&&(c=!0);if(1<l.childNodes.length&&1==l.childNodes[0].nodeType){var h=A.selection._bakRange.startContainer,d=(A.selection._bakRange.startOffset,A.selection._bakRange.endContainer),f=(A.selection._bakRange.endOffset,A.selection._bakRange.startContainer),p=A.selection._bakRange.startOffset;parseInt(p.toString());A.selection._bakRange.deleteContents();for(var m=0;m<l.childNodes.length;m++)if(0==m)for(var g=l.childNodes[m].childNodes[0].innerText,y=0,v=0;v<g.length;v++){if(0==v)A.selection._bakRange.setStart(f,p+y);else{f=A.selection._bakRange.startContainer;p=A.selection._bakRange.startOffset,A.selection._bakRange.setStart(f,p+y)}if(g[v].match(/\d/))(b=document.createElement("sub")).innerHTML=g[v];else var b=document.createTextNode(g[v]);A.selection._bakRange.insertNode(b),0==y&&(h=b),y+=1}else if(0<m&&m<l.childNodes.length-1){var w=l.childNodes[m].childNodes[0].innerText,x=l.childNodes[m].childNodes[0].getAttribute("style");if(w=w.replace(/([\d]+)/g,function(t){return"<sub>"+t+"</sub>"}),1==m){f=A.selection._bakRange.startContainer;A.selection._bakRange.setStartAfter(f.parentNode);var S=document.createElement("p")}else{A.selection._bakRange.setStartAfter(S);S=document.createElement("p")}S.innerHTML='<span style="'+x+'">'+w+"</span>",A.selection._bakRange.insertNode(S)}else{var E=l.childNodes[m].childNodes[0].innerText,C=0;for(v=0;v<E.length;v++){if(0==v)A.selection._bakRange.setStart(d,C);else{f=A.selection._bakRange.startContainer;A.selection._bakRange.setStart(f,C)}if(E[v].match(/\d/)){var T=document.createElement("sub");T.innerHTML=E[v];var N=T;A.selection._bakRange.insertNode(N),C+=1}else{N=document.createTextNode(E[v]);A.selection._bakRange.insertNode(N),C+=1}d=N}}A.selection._bakRange.setStart(h,0),A.selection._bakRange.setEnd(d,1),A.selection._bakRange.select()}else if(c){var k=r.replace(/(\d+)/g,function(t,e){return"<sub>"+e+"</sub>"}),_=document.createElement("span");_.innerHTML=k,A.selection._bakRange.deleteContents().insertNode(_).select(),!/font\-size/.test(k)&&A.execCommand("fontsize",14)}else{f=A.selection._bakRange.startContainer,p=A.selection._bakRange.startOffset;A.selection._bakRange.deleteContents();for(m=y=0;m<r.length;m++){if(0==m)A.selection._bakRange.setStart(f,p);else{f=A.selection._bakRange.startContainer,p=A.selection._bakRange.startOffset;A.selection._bakRange.setStart(f,p+1)}if(r[m].match(/\d/))(b=document.createElement("sub")).innerHTML=r[m];else b=document.createTextNode(r[m]);A.selection._bakRange.insertNode(b),0==y&&(h=b),y+=1}d=b;A.selection._bakRange.setStart(h,0),A.selection._bakRange.setEnd(d,1),A.selection._bakRange.select()}}return A.ch2=!A.ch2,A.ch2}},queryCommandState:function(t){return!!A.ch2},queryCommandValue:function(t){return A.ch2}}},UM.plugins.custom_paste=function(){var y=this;y.addListener("ready",function(){$(y.body).on("cut",function(){!y.selection.getRange().collapsed&&y.undoManger&&y.undoManger.save()}).on(browser.ie||browser.opera?"keydown":"paste",function(t){var r=!1;if(!browser.ie&&!browser.opera||(t.ctrlKey||t.metaKey)&&"86"==t.keyCode){var o=t.originalEvent.clipboardData;if(o.types&&o.types.forEach(function(t){var e=o.getData(t);if("text/html"===t){var n=/\/div\>|\/h1\>|\/h2\>|\/h3\>|\/ul\>|\/table\>|\/tr\>|\/td\>|\/th\>|\/li\>|\/ul\>|\/a\>|\<img|\<pre|\<meta|\<button|\<article|\/h4\>|text-decoration-style/.test(e);if(/content="Microsoft\s*([a-z]+)\s*\d+"/i.test(e)||n){var i=o.getData("text/plain");/\n/.test(i)?i.split("\n").reverse().forEach(function(t,e){t&&("<br>"===y.body.lastChild.innerHTML&&y.body.removeChild(y.body.lastChild),y.mark("insertHtml","<p>"+t+"</p>"))}):("<p><br></p>"===y.body.innerHTML&&y.body.childNodes[0].removeChild(y.body.childNodes[0].firstChild),y.mark("insertHtml",o.getData("text/plain"))),r=!0}}}),r)return!1;(function(t){var e=this.document;if(!e.getElementById("baidu_pastebin")){var n=this.selection.getRange(),i=n.createBookmark(),r=e.createElement("div");if(r.id="baidu_pastebin",this.body.appendChild(r),i.start.style.display="",r.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+$(i.start).position().top+"px",n.selectNodeContents(r).select(!0),browser.webkit)for(var o,s=0,a=e.querySelectorAll("#baidu_pastebin");o=a[s++];){if(!domUtils.isEmptyNode(o)){r=o;break}domUtils.remove(o)}try{r.parentNode.removeChild(r)}catch(t){}n.moveToBookmark(i).select(!0),t(r),setTimeout(function(){/font\-size/.test(y.body.innerHTML)||(y.execCommand("selectall"),y.execCommand("fontsize",14))},16)}}).call(y,function(t){!function(t){var e;if(t.firstChild){for(var n,i=domUtils.getElementsByTagName(t,"span"),r=0;n=i[r++];)"_baidu_cut_start"!=n.id&&"_baidu_cut_end"!=n.id||domUtils.remove(n);if(browser.webkit){var o,s=t.querySelectorAll("div br");for(r=0;o=s[r++];){var a=o.parentNode;"DIV"==a.tagName&&1==a.childNodes.length&&(a.innerHTML="<p><br/></p>",domUtils.remove(a))}var l,c=t.querySelectorAll("#baidu_pastebin");for(r=0;l=c[r++];){var u=y.document.createElement("p");for(l.parentNode.insertBefore(u,l);l.firstChild;)u.appendChild(l.firstChild);domUtils.remove(l)}var h=t.querySelectorAll("meta");for(r=0;f=h[r++];)domUtils.remove(f);for(s=t.querySelectorAll("br"),r=0;f=s[r++];)/^apple-/i.test(f.className)&&domUtils.remove(f)}if(browser.gecko){var d=t.querySelectorAll("[_moz_dirty]");for(r=0;f=d[r++];)f.removeAttribute("_moz_dirty")}if(!browser.ie){var f,p=t.querySelectorAll("span.Apple-style-span");for(r=0;f=p[r++];)domUtils.remove(f,!0)}e=t.innerHTML,e=UM.filterWord(e);var m=UM.htmlparser(e);if(y.options.filterRules&&UM.filterNode(m,y.options.filterRules),y.filterInputRule(m),browser.webkit){var g=m.lastChild();g&&"element"==g.type&&"br"==g.tagName&&m.removeChild(g),utils.each(y.body.querySelectorAll("div"),function(t){domUtils.isEmptyBlock(t)&&domUtils.remove(t)})}if(e={html:m.toHtml()},y.fireEvent("beforepaste",e,m),!e.html)return;y.addListener("afterpaste",function(t,e){y.body.innerHTML=e.html,/font\-size/.test(e.html)||(y.execCommand("selectall"),y.execCommand("fontsize",14))}),y.execCommand("insertHtml",e.html,!0),y.fireEvent("afterpaste",e)}}(t)})}})})},UM.registerUI("forecolor backcolor",function(n){var i=this,t=null,r=null,e=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(n);e.edui().disabled(-1==t).active(1==t)}),e=$.eduicolorsplitbutton({icon:n,caret:!0,name:n,title:i.getLang("labelMap")[n],click:function(){i.execCommand(n,domUtils.getComputedStyle(r[0],"background-color"))}}),r=e.edui().colorLabel(),t=$.eduicolorpicker({name:n,lang_clearColor:i.getLang("clearColor")||"",lang_themeColor:i.getLang("themeColor")||"",lang_standardColor:i.getLang("standardColor")||""}).on("pickcolor",function(t,e){window.setTimeout(function(){r.css("backgroundColor",e),i.execCommand(n,e)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",i.getOpt("zIndex")+1),e.edui().on("arrowclick",function(){t.parent().length||i.$container.find(".edui-dialog-container").append(t),t.edui().show(e,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(i)}).register("click",e,function(){t.edui().hide()}),e}),window.textInput=null}(jQuery);